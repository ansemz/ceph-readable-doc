
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Integrating with OpenStack Keystone &mdash; Ceph Documentation</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     'dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Ceph Documentation" href="../../" />
    <link rel="up" title="Ceph Object Gateway" href="../" />
    <link rel="next" title="OpenStack Barbican Integration" href="../barbican/" />
    <link rel="prev" title="librgw (Python)" href="../api/" />
    <script type="text/javascript" src="http://ayni.ceph.com/public/js/ceph.js"></script>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../barbican/" title="OpenStack Barbican Integration"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../api/" title="librgw (Python)"
             accesskey="P">previous</a> |</li>
        <li><a href="../../">Ceph Documentation</a> &raquo;</li>
          <li><a href="../" accesskey="U">Ceph Object Gateway</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="integrating-with-openstack-keystone">
<h1>Integrating with OpenStack Keystone<a class="headerlink" href="#integrating-with-openstack-keystone" title="Permalink to this headline">¶</a></h1>
<p>It is possible to integrate the Ceph Object Gateway with Keystone, the OpenStack
identity service. This sets up the gateway to accept Keystone as the users
authority. A user that Keystone authorizes to access the gateway will also be
automatically created on the Ceph Object Gateway (if didn&#8217;t exist beforehand). A
token that Keystone validates will be considered as valid by the gateway.</p>
<p>The following configuration options are available for Keystone integration:</p>
<div class="highlight-python"><pre>[client.radosgw.gateway]
rgw keystone api version = {keystone api version}
rgw keystone url = {keystone server url:keystone server admin port}
rgw keystone admin token = {keystone admin token}
rgw keystone accepted roles = {accepted user roles}
rgw keystone token cache size = {number of tokens to cache}
rgw keystone revocation interval = {number of seconds before checking revoked tickets}
rgw keystone implicit tenants = {true for private tenant for each new user}
rgw s3 auth use keystone = true
nss db path = {path to nss db}</pre>
</div>
<p>It is also possible to configure a Keystone service tenant, user &amp; password for
keystone (for v2.0 version of the OpenStack Identity API), similar to the way
OpenStack services tend to be configured, this avoids the need for setting the
shared secret <tt class="docutils literal"><span class="pre">rgw</span> <span class="pre">keystone</span> <span class="pre">admin</span> <span class="pre">token</span></tt> in the configuration file, which is
recommended to be disabled in production environments. The service tenant
credentials should have admin privileges, for more details refer the <a class="reference external" href="http://docs.openstack.org/developer/keystone/configuringservices.html#setting-up-projects-users-and-roles">Openstack
keystone documentation</a>, which explains the process in detail. The requisite
configuration options for are:</p>
<div class="highlight-python"><pre>rgw keystone admin user = {keystone service tenant user name}
rgw keystone admin password = {keystone service tenant user password}
rgw keystone admin tenant = {keystone service tenant name}</pre>
</div>
<p>A Ceph Object Gateway user is mapped into a Keystone <tt class="docutils literal"><span class="pre">tenant</span></tt>. A Keystone user
has different roles assigned to it on possibly more than a single tenant. When
the Ceph Object Gateway gets the ticket, it looks at the tenant, and the user
roles that are assigned to that ticket, and accepts/rejects the request
according to the <tt class="docutils literal"><span class="pre">rgw</span> <span class="pre">keystone</span> <span class="pre">accepted</span> <span class="pre">roles</span></tt> configurable.</p>
<p>For a v3 version of the OpenStack Identity API you should replace
<tt class="docutils literal"><span class="pre">rgw</span> <span class="pre">keystone</span> <span class="pre">admin</span> <span class="pre">tenant</span></tt> with:</p>
<div class="highlight-python"><pre>rgw keystone admin domain = {keystone admin domain name}
rgw keystone admin project = {keystone admin project name}</pre>
</div>
<div class="section" id="prior-to-kilo">
<h2>Prior to Kilo<a class="headerlink" href="#prior-to-kilo" title="Permalink to this headline">¶</a></h2>
<p>Keystone itself needs to be configured to point to the Ceph Object Gateway as an
object-storage endpoint:</p>
<div class="highlight-python"><pre>keystone service-create --name swift --type object-store
keystone endpoint-create --service-id &lt;id&gt; --publicurl http://radosgw.example.com/swift/v1 \
        --internalurl http://radosgw.example.com/swift/v1 --adminurl http://radosgw.example.com/swift/v1</pre>
</div>
</div>
<div class="section" id="as-of-kilo">
<h2>As of Kilo<a class="headerlink" href="#as-of-kilo" title="Permalink to this headline">¶</a></h2>
<p>Keystone itself needs to be configured to point to the Ceph Object Gateway as an
object-storage endpoint:</p>
<div class="highlight-python"><pre>openstack service create --name=swift \
                         --description="Swift Service" \
                         object-store
+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | Swift Service                    |
| enabled     | True                             |
| id          | 37c4c0e79571404cb4644201a4a6e5ee |
| name        | swift                            |
| type        | object-store                     |
+-------------+----------------------------------+

openstack endpoint create --region RegionOne \
     --publicurl   "http://radosgw.example.com:8080/swift/v1" \
     --adminurl    "http://radosgw.example.com:8080/swift/v1" \
     --internalurl "http://radosgw.example.com:8080/swift/v1" \
     swift
+--------------+------------------------------------------+
| Field        | Value                                    |
+--------------+------------------------------------------+
| adminurl     | http://radosgw.example.com:8080/swift/v1 |
| id           | e4249d2b60e44743a67b5e5b38c18dd3         |
| internalurl  | http://radosgw.example.com:8080/swift/v1 |
| publicurl    | http://radosgw.example.com:8080/swift/v1 |
| region       | RegionOne                                |
| service_id   | 37c4c0e79571404cb4644201a4a6e5ee         |
| service_name | swift                                    |
| service_type | object-store                             |
+--------------+------------------------------------------+

$ openstack endpoint show object-store
+--------------+------------------------------------------+
| Field        | Value                                    |
+--------------+------------------------------------------+
| adminurl     | http://radosgw.example.com:8080/swift/v1 |
| enabled      | True                                     |
| id           | e4249d2b60e44743a67b5e5b38c18dd3         |
| internalurl  | http://radosgw.example.com:8080/swift/v1 |
| publicurl    | http://radosgw.example.com:8080/swift/v1 |
| region       | RegionOne                                |
| service_id   | 37c4c0e79571404cb4644201a4a6e5ee         |
| service_name | swift                                    |
| service_type | object-store                             |
+--------------+------------------------------------------+</pre>
</div>
<p>The keystone URL is the Keystone admin RESTful API URL. The admin token is the
token that is configured internally in Keystone for admin requests.</p>
<p>The Ceph Object Gateway will query Keystone periodically for a list of revoked
tokens. These requests are encoded and signed. Also, Keystone may be configured
to provide self-signed tokens, which are also encoded and signed. The gateway
needs to be able to decode and verify these signed messages, and the process
requires that the gateway be set up appropriately. Currently, the Ceph Object
Gateway will only be able to perform the procedure if it was compiled with
<tt class="docutils literal"><span class="pre">--with-nss</span></tt>. Configuring the Ceph Object Gateway to work with Keystone also
requires converting the OpenSSL certificates that Keystone uses for creating the
requests to the nss db format, for example:</p>
<div class="highlight-python"><pre>mkdir /var/ceph/nss

openssl x509 -in /etc/keystone/ssl/certs/ca.pem -pubkey | \
        certutil -d /var/ceph/nss -A -n ca -t "TCu,Cu,Tuw"
openssl x509 -in /etc/keystone/ssl/certs/signing_cert.pem -pubkey | \
        certutil -A -d /var/ceph/nss -n signing_cert -t "P,P,P"</pre>
</div>
<p>Openstack keystone may also be terminated with a self signed ssl certificate, in
order for radosgw to interact with keystone in such a case, you could either
install keystone&#8217;s ssl certificate in the node running radosgw. Alternatively
radosgw could be made to not verify the ssl certificate at all (similar to
openstack clients with a <tt class="docutils literal"><span class="pre">--insecure</span></tt> switch) by setting the value of the
configurable <tt class="docutils literal"><span class="pre">rgw</span> <span class="pre">keystone</span> <span class="pre">verify</span> <span class="pre">ssl</span></tt> to false.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../start/intro/">Intro to Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../start/">Installation (Quick)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/">Installation (Manual)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rados/">Ceph Storage Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cephfs/">Ceph Filesystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rbd/rbd/">Ceph Block Device</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">Ceph Object Gateway</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../install/install-ceph-gateway/">Manual Install w/Civetweb</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config-fcgi/">Simple Configuration w/Apache/FastCGI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../federated-config/">Federated Configuration (Deprecated)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multisite/">Multisite Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config-ref/">Config Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../admin/">Admin Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../s3/">S3 API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../swift/">Swift API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../adminops/">Admin Ops API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/">Python binding</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">OpenStack Keystone Integration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prior-to-kilo">Prior to Kilo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#as-of-kilo">As of Kilo</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../barbican/">OpenStack Barbican Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multitenancy/">Multi-tenancy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../compression/">Compression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../encryption/">Server-Side Encryption</a></li>
<li class="toctree-l2"><a class="reference internal" href="../layout/">Data Layout in RADOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade_to_jewel/">Upgrade to Older Versions of Jewel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../man/8/radosgw/">Manpage radosgw</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../man/8/radosgw-admin/">Manpage radosgw-admin</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../mgr/">Ceph Manager Daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture/">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/">Ceph Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary/">Glossary</a></li>
</ul>


<!-- ugly kludge to make genindex look like it's part of the toc -->
<ul style="margin-top: -10px"><li class="toctree-l1"><a class="reference internal" href="../../genindex/">Index</a></li></ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../barbican/" title="OpenStack Barbican Integration"
             >next</a> |</li>
        <li class="right" >
          <a href="../api/" title="librgw (Python)"
             >previous</a> |</li>
        <li><a href="../../">Ceph Documentation</a> &raquo;</li>
          <li><a href="../" >Ceph Object Gateway</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2016, Red Hat, Inc, and contributors. Licensed under Creative Commons BY-SA.
    </div>
  </body>
</html>