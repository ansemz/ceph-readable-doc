
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>管理指南 &mdash; Ceph Documentation</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     'dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Ceph Documentation" href="../../" />
    <link rel="up" title="Ceph 对象网关" href="../" />
    <link rel="next" title="Ceph 对象网关的 S3 兼容 API" href="../s3/" />
    <link rel="prev" title="Ceph 对象网关配置参考" href="../config-ref/" />
    

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../s3/" title="Ceph 对象网关的 S3 兼容 API"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../config-ref/" title="Ceph 对象网关配置参考"
             accesskey="P">previous</a> |</li>
        <li><a href="../../">Ceph Documentation</a> &raquo;</li>
          <li><a href="../" accesskey="U">Ceph 对象网关</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="id1">
<h1>管理指南<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>Once you have your Ceph Object Storage service up and running, you may
administer the service with user management, access controls, quotas
and usage tracking among other features.</p>
<div class="section" id="user-management">
<span id="id2"></span><h2>用户管理<a class="headerlink" href="#user-management" title="Permalink to this headline">¶</a></h2>
<p>Ceph Object Storage user management refers to users of the Ceph Object Storage
service (i.e., not the Ceph Object Gateway as a user of the Ceph Storage
Cluster). You must create a user, access key and secret to enable end users to
interact with Ceph Object Gateway services.</p>
<p>There are two user types:</p>
<ul class="simple">
<li><strong>User:</strong> The term &#8216;user&#8217; reflects a user of the S3 interface.</li>
<li><strong>Subuser:</strong> The term &#8216;subuser&#8217; reflects a user of the Swift interface. A subuser
is associated to a user .</li>
</ul>
<p class="ditaa">
<img src="../../_images/ditaa-b4d57ecd6d1bf334f8d70e716c0870738a375d5a.png"/>
</p>
<p>You can create, modify, view, suspend and remove users and subusers. In addition
to user and subuser IDs, you may add a display name and an email address for a
user.  You can specify a key and secret, or generate a key and secret
automatically. When generating or specifying keys, note that user IDs correspond
to an S3 key type and subuser IDs correspond to a swift key type. Swift keys
also have access levels of <tt class="docutils literal"><span class="pre">read</span></tt>, <tt class="docutils literal"><span class="pre">write</span></tt>, <tt class="docutils literal"><span class="pre">readwrite</span></tt> and <tt class="docutils literal"><span class="pre">full</span></tt>.</p>
<div class="section" id="create-a-user">
<span id="id3"></span><h3>创建用户<a class="headerlink" href="#create-a-user" title="Permalink to this headline">¶</a></h3>
<p>To create a user (S3 interface), execute the following:</p>
<div class="highlight-python"><pre>radosgw-admin user create --uid={username} --display-name="{display-name}" [--email={email}]</pre>
</div>
<p>For example:</p>
<div class="highlight-python"><pre>radosgw-admin user create --uid=johndoe --display-name="John Doe" --email=john@example.com</pre>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;user_id&quot;</span><span class="o">:</span> <span class="s2">&quot;johndoe&quot;</span><span class="p">,</span>
  <span class="s2">&quot;display_name&quot;</span><span class="o">:</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">,</span>
  <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;john@example.com&quot;</span><span class="p">,</span>
  <span class="s2">&quot;suspended&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;max_buckets&quot;</span><span class="o">:</span> <span class="mi">1000</span><span class="p">,</span>
  <span class="s2">&quot;auid&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;subusers&quot;</span><span class="o">:</span> <span class="p">[],</span>
  <span class="s2">&quot;keys&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="s2">&quot;johndoe&quot;</span><span class="p">,</span>
          <span class="s2">&quot;access_key&quot;</span><span class="o">:</span> <span class="s2">&quot;11BS02LGFB6AL6H1ADMW&quot;</span><span class="p">,</span>
          <span class="s2">&quot;secret_key&quot;</span><span class="o">:</span> <span class="s2">&quot;vzCEkuryfn060dfee4fgQPqFrncKEIkh3ZcdOANY&quot;</span><span class="p">}],</span>
  <span class="s2">&quot;swift_keys&quot;</span><span class="o">:</span> <span class="p">[],</span>
  <span class="s2">&quot;caps&quot;</span><span class="o">:</span> <span class="p">[],</span>
  <span class="s2">&quot;op_mask&quot;</span><span class="o">:</span> <span class="s2">&quot;read, write, delete&quot;</span><span class="p">,</span>
  <span class="s2">&quot;default_placement&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
  <span class="s2">&quot;placement_tags&quot;</span><span class="o">:</span> <span class="p">[],</span>
  <span class="s2">&quot;bucket_quota&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;enabled&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">&quot;max_size_kb&quot;</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
      <span class="s2">&quot;max_objects&quot;</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span>
  <span class="s2">&quot;user_quota&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;enabled&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">&quot;max_size_kb&quot;</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
      <span class="s2">&quot;max_objects&quot;</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span>
  <span class="s2">&quot;temp_url_keys&quot;</span><span class="o">:</span> <span class="p">[]}</span>
</pre></div>
</div>
<p>Creating a user also creates an <tt class="docutils literal"><span class="pre">access_key</span></tt> and <tt class="docutils literal"><span class="pre">secret_key</span></tt> entry for use
with any S3 API-compatible client.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Check the key output. Sometimes <tt class="docutils literal"><span class="pre">radosgw-admin</span></tt>
generates a JSON escape (<tt class="docutils literal"><span class="pre">\</span></tt>) character, and some clients
do not know how to handle JSON escape characters. Remedies include
removing the JSON escape character (<tt class="docutils literal"><span class="pre">\</span></tt>), encapsulating the string
in quotes, regenerating the key and ensuring that it
does not have a JSON escape character or specify the key and secret
manually.</p>
</div>
</div>
<div class="section" id="create-a-subuser">
<span id="id4"></span><h3>创建子用户<a class="headerlink" href="#create-a-subuser" title="Permalink to this headline">¶</a></h3>
<p>要创建用户的子用户（ Swift 接口），必须指定用户 ID （
<tt class="docutils literal"><span class="pre">--uid={username}</span></tt> ）、子用户 ID 和这个子用户的访问级别。</p>
<div class="highlight-python"><pre>radosgw-admin subuser create --uid={uid} --subuser={uid} --access=[ read | write | readwrite | full ]</pre>
</div>
<p>例如：</p>
<div class="highlight-python"><pre>radosgw-admin subuser create --uid=johndoe --subuser=johndoe:swift --access=full</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><tt class="docutils literal"><span class="pre">full</span></tt> 不等于 <tt class="docutils literal"><span class="pre">readwrite</span></tt> ，因为它还包括访问控制策略。</p>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;user_id&quot;</span><span class="o">:</span> <span class="s2">&quot;johndoe&quot;</span><span class="p">,</span>
  <span class="s2">&quot;display_name&quot;</span><span class="o">:</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">,</span>
  <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;john@example.com&quot;</span><span class="p">,</span>
  <span class="s2">&quot;suspended&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;max_buckets&quot;</span><span class="o">:</span> <span class="mi">1000</span><span class="p">,</span>
  <span class="s2">&quot;auid&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;subusers&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;johndoe:swift&quot;</span><span class="p">,</span>
          <span class="s2">&quot;permissions&quot;</span><span class="o">:</span> <span class="s2">&quot;full-control&quot;</span><span class="p">}],</span>
  <span class="s2">&quot;keys&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="s2">&quot;johndoe&quot;</span><span class="p">,</span>
          <span class="s2">&quot;access_key&quot;</span><span class="o">:</span> <span class="s2">&quot;11BS02LGFB6AL6H1ADMW&quot;</span><span class="p">,</span>
          <span class="s2">&quot;secret_key&quot;</span><span class="o">:</span> <span class="s2">&quot;vzCEkuryfn060dfee4fgQPqFrncKEIkh3ZcdOANY&quot;</span><span class="p">}],</span>
  <span class="s2">&quot;swift_keys&quot;</span><span class="o">:</span> <span class="p">[],</span>
  <span class="s2">&quot;caps&quot;</span><span class="o">:</span> <span class="p">[],</span>
  <span class="s2">&quot;op_mask&quot;</span><span class="o">:</span> <span class="s2">&quot;read, write, delete&quot;</span><span class="p">,</span>
  <span class="s2">&quot;default_placement&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
  <span class="s2">&quot;placement_tags&quot;</span><span class="o">:</span> <span class="p">[],</span>
  <span class="s2">&quot;bucket_quota&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;enabled&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">&quot;max_size_kb&quot;</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
      <span class="s2">&quot;max_objects&quot;</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span>
  <span class="s2">&quot;user_quota&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;enabled&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">&quot;max_size_kb&quot;</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
      <span class="s2">&quot;max_objects&quot;</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span>
  <span class="s2">&quot;temp_url_keys&quot;</span><span class="o">:</span> <span class="p">[]}</span>
</pre></div>
</div>
</div>
<div class="section" id="get-user-info">
<span id="id5"></span><h3>获取用户信息<a class="headerlink" href="#get-user-info" title="Permalink to this headline">¶</a></h3>
<p>要获取某一用户的信息，可指定 <tt class="docutils literal"><span class="pre">user</span> <span class="pre">info</span></tt> 和用户 ID （
<tt class="docutils literal"><span class="pre">--uid={username}</span></tt> ）。</p>
<div class="highlight-python"><pre>radosgw-admin user info --uid=johndoe</pre>
</div>
</div>
<div class="section" id="modify-user-info">
<span id="id6"></span><h3>修改用户信息<a class="headerlink" href="#modify-user-info" title="Permalink to this headline">¶</a></h3>
<p>To modify information about a user, you must specify the user ID (<tt class="docutils literal"><span class="pre">--uid={username}</span></tt>)
and the attributes you want to modify. Typical modifications are to keys and secrets,
email addresses, display names and access levels. For example:</p>
<div class="highlight-python"><pre>radosgw-admin user modify --uid=johndoe --display-name="John E. Doe"</pre>
</div>
<p>To modify subuser values, specify <tt class="docutils literal"><span class="pre">subuser</span> <span class="pre">modify</span></tt> and the subuser ID. For example:</p>
<div class="highlight-python"><pre>radosgw-admin subuser modify --uid=johndoe:swift --access=full</pre>
</div>
</div>
<div class="section" id="user-enable-suspend">
<span id="id7"></span><h3>用户的暂停、启用<a class="headerlink" href="#user-enable-suspend" title="Permalink to this headline">¶</a></h3>
<p>When you create a user, the user is enabled by default. However, you may suspend
user  privileges and re-enable them at a later time. To suspend a user, specify
<tt class="docutils literal"><span class="pre">user</span> <span class="pre">suspend</span></tt> and the user ID.</p>
<div class="highlight-python"><pre>radosgw-admin user suspend --uid=johndoe</pre>
</div>
<p>To re-enable a suspended user, specify <tt class="docutils literal"><span class="pre">user</span> <span class="pre">enable</span></tt> and the user ID.</p>
<div class="highlight-python"><pre>radosgw-admin user enable --uid=johndoe</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Disabling the user disables the subuser.</p>
</div>
</div>
<div class="section" id="id8">
<h3>删除用户<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>删除用户时，这个用户以及他的子用户都会被删除。当然，如果你愿意，可以只删除子用户。要删除用户（及其子用户），可指定 <tt class="docutils literal"><span class="pre">user</span> <span class="pre">rm</span></tt> 和用户 ID ：</p>
<div class="highlight-python"><pre>radosgw-admin user rm --uid=johndoe</pre>
</div>
<p>只想删除子用户时，可指定 <tt class="docutils literal"><span class="pre">subuser</span> <span class="pre">rm</span></tt> 和子用户 ID 。</p>
<div class="highlight-python"><pre>radosgw-admin subuser rm --subuser=johndoe:swift</pre>
</div>
<p>其它可选操作：</p>
<ul class="simple">
<li><strong>清除数据：</strong> 加 <tt class="docutils literal"><span class="pre">--purge-data</span></tt> 选项可清除与此 UID 相关的所有数据。</li>
<li><strong>清除密钥：</strong> 加 <tt class="docutils literal"><span class="pre">--purge-keys</span></tt> 选项可清除与此 UID 相关的所有密钥。</li>
</ul>
</div>
<div class="section" id="id9">
<h3>删除子用户<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>你删除子用户的同时，也失去了 Swift 接口的访问方式，但是这个用户还在系统中存在。要删除子用户，可指定 <tt class="docutils literal"><span class="pre">subuser</span> <span class="pre">rm</span></tt> 及子用户
ID ：</p>
<div class="highlight-python"><pre>radosgw-admin subuser rm --subuser=johndoe:swift</pre>
</div>
<p>其它可选操作：</p>
<ul class="simple">
<li><strong>清除密钥：</strong> 加 <tt class="docutils literal"><span class="pre">--purge-keys</span></tt> 选项可清除与此 UID 相关的所有密钥。</li>
</ul>
</div>
<div class="section" id="id10">
<h3>增加、删除密钥<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>用户和子用户都必须有密钥才能访问 S3 或 Swift 接口。用 S3 访问时，用户需要一个由访问密钥和私钥组成的密钥对；而用 Swift 访问时，通常只需要一个私钥（密码），并且要和相关的用户 ID 一起用才行。你可以创建密钥，并指定或生成访问密钥和/或私钥；也可以删除密钥。相关选项有：</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">--key-type=&lt;type&gt;</span></tt> 指定密钥类型，选项有： s3 、 swift ；</li>
<li><tt class="docutils literal"><span class="pre">--access-key=&lt;key&gt;</span></tt> 手动指定 S3 的访问密钥；</li>
<li><tt class="docutils literal"><span class="pre">--secret-key=&lt;key&gt;</span></tt> 手动指定 S3 私钥或者 Swift 私钥；</li>
<li><tt class="docutils literal"><span class="pre">--gen-access-key</span></tt> 自动生成 S3 访问密钥；</li>
<li><tt class="docutils literal"><span class="pre">--gen-secret</span></tt> 自动生成一个 S3 私钥或 Swift 私钥。</li>
</ul>
<p>给用户人为指定 S3 密钥对的实例如下：</p>
<div class="highlight-python"><pre>radosgw-admin key create --uid=foo --key-type=s3 --access-key fooAccessKey --secret-key fooSecretKey</pre>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;user_id&quot;</span><span class="o">:</span> <span class="s2">&quot;foo&quot;</span><span class="p">,</span>
  <span class="s2">&quot;rados_uid&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;display_name&quot;</span><span class="o">:</span> <span class="s2">&quot;foo&quot;</span><span class="p">,</span>
  <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;foo@example.com&quot;</span><span class="p">,</span>
  <span class="s2">&quot;suspended&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;keys&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="s2">&quot;foo&quot;</span><span class="p">,</span>
      <span class="s2">&quot;access_key&quot;</span><span class="o">:</span> <span class="s2">&quot;fooAccessKey&quot;</span><span class="p">,</span>
      <span class="s2">&quot;secret_key&quot;</span><span class="o">:</span> <span class="s2">&quot;fooSecretKey&quot;</span><span class="p">}],</span>
<span class="p">}</span>
</pre></div>
</div>
<p>请注意，你可以给一个用户创建多个 S3 密钥对。</p>
<p>给一个子用户配置指定的 swift 私钥：</p>
<div class="highlight-python"><pre>radosgw-admin key create --subuser=foo:bar --key-type=swift --secret-key barSecret</pre>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;user_id&quot;</span><span class="o">:</span> <span class="s2">&quot;foo&quot;</span><span class="p">,</span>
  <span class="s2">&quot;rados_uid&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;display_name&quot;</span><span class="o">:</span> <span class="s2">&quot;foo&quot;</span><span class="p">,</span>
  <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;foo@example.com&quot;</span><span class="p">,</span>
  <span class="s2">&quot;suspended&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;subusers&quot;</span><span class="o">:</span> <span class="p">[</span>
     <span class="p">{</span> <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;foo:bar&quot;</span><span class="p">,</span>
       <span class="s2">&quot;permissions&quot;</span><span class="o">:</span> <span class="s2">&quot;full-control&quot;</span><span class="p">}],</span>
  <span class="s2">&quot;swift_keys&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="s2">&quot;foo:bar&quot;</span><span class="p">,</span>
      <span class="s2">&quot;secret_key&quot;</span><span class="o">:</span> <span class="s2">&quot;asfghjghghmgm&quot;</span><span class="p">}]}</span>
</pre></div>
</div>
<p>请注意，一个子用户只能有一个 swift 私钥。</p>
<p>如果将子用户与 S3 密钥对关联，那么这些子用户也能用于 S3 API:</p>
<div class="highlight-python"><pre>radosgw-admin key create --subuser=foo:bar --key-type=s3 --access-key barAccessKey --secret-key barSecretKey</pre>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;user_id&quot;</span><span class="o">:</span> <span class="s2">&quot;foo&quot;</span><span class="p">,</span>
  <span class="s2">&quot;rados_uid&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;display_name&quot;</span><span class="o">:</span> <span class="s2">&quot;foo&quot;</span><span class="p">,</span>
  <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;foo@example.com&quot;</span><span class="p">,</span>
  <span class="s2">&quot;suspended&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;subusers&quot;</span><span class="o">:</span> <span class="p">[</span>
     <span class="p">{</span> <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;foo:bar&quot;</span><span class="p">,</span>
       <span class="s2">&quot;permissions&quot;</span><span class="o">:</span> <span class="s2">&quot;full-control&quot;</span><span class="p">}],</span>
  <span class="s2">&quot;keys&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="s2">&quot;foo:bar&quot;</span><span class="p">,</span>
      <span class="s2">&quot;access_key&quot;</span><span class="o">:</span> <span class="s2">&quot;barAccessKey&quot;</span><span class="p">,</span>
      <span class="s2">&quot;secret_key&quot;</span><span class="o">:</span> <span class="s2">&quot;barSecretKey&quot;</span><span class="p">}],</span>
<span class="p">}</span>
</pre></div>
</div>
<p>要删除一个 S3 密钥对，需指定访问密钥。</p>
<div class="highlight-python"><pre>radosgw-admin key rm --uid=foo --key-type=s3 --access-key=fooAccessKey</pre>
</div>
<p>删除 swift 私钥。</p>
<div class="highlight-python"><pre>radosgw-admin key rm -subuser=foo:bar --key-type=swift</pre>
</div>
</div>
<div class="section" id="add-remove-admin-capabilities">
<span id="id11"></span><h3>增加、删除管理能力<a class="headerlink" href="#add-remove-admin-capabilities" title="Permalink to this headline">¶</a></h3>
<p>Ceph 存储集群提供了一个管理 API ，用户可以通过 REST API 使用管理功能。默认情况下，用户<strong>无权</strong>访问这个 API ，给用户分配管理能力后，他才能使用管理功能。</p>
<p>要给用户分配管理能力，执行下面的：</p>
<div class="highlight-python"><pre>radosgw-admin caps add --uid={uid} --caps={caps}</pre>
</div>
<p>你可以给 users 、 buckets 、 metadata 和 usage （利用率）分配
read 、 write 或 all 能力，例如：</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">caps</span><span class="o">=</span><span class="s2">&quot;[users|buckets|metadata|usage|zone]=[*|read|write|read, write]&quot;</span>
</pre></div>
</div>
<p>例如：</p>
<div class="highlight-python"><pre>radosgw-admin caps add --uid=johndoe --caps="users=*;buckets=*"</pre>
</div>
<p>要删除某用户的管理能力，可用下面的命令：</p>
<div class="highlight-python"><pre>radosgw-admin caps rm --uid=johndoe --caps={caps}</pre>
</div>
</div>
</div>
<div class="section" id="quota-management">
<span id="id12"></span><h2>配额管理<a class="headerlink" href="#quota-management" title="Permalink to this headline">¶</a></h2>
<p>Ceph 对象网关允许你给用户及其拥有的桶设置配额，可设置的配额有桶内的最大对象数、和桶可以存储的最大数据尺寸。</p>
<ul class="simple">
<li><strong>桶：</strong> 加 <tt class="docutils literal"><span class="pre">--bucket</span></tt> 选项说明配额操作作用于用户拥有的桶。</li>
<li><strong>最大对象数：</strong> <tt class="docutils literal"><span class="pre">--max-objects</span></tt> 选项用于指定最大对象数，负值表示禁用此配置。</li>
<li><strong>最大尺寸：</strong> <tt class="docutils literal"><span class="pre">--max-size</span></tt> 选项用于指定配额尺寸，单位是 B/K/M/G/T ，默认值为 B 。负值表示禁用此配置。</li>
<li><strong>配额作用域：</strong> <tt class="docutils literal"><span class="pre">--quota-scope</span></tt> 参数可指定配额的作用域，可选的有 <tt class="docutils literal"><span class="pre">bucket</span></tt> 和 <tt class="docutils literal"><span class="pre">user</span></tt> 。桶配额作用于用户拥有的桶；用户配额作用于用户。</li>
</ul>
<div class="section" id="set-user-quota">
<span id="id13"></span><h3>设置用户配额<a class="headerlink" href="#set-user-quota" title="Permalink to this headline">¶</a></h3>
<p>启用配额前，必须先配置配额参数。例如：</p>
<div class="highlight-python"><pre>radosgw-admin quota set --quota-scope=user --uid=&lt;uid&gt; [--max-objects=&lt;num objects&gt;] [--max-size=&lt;max size&gt;]</pre>
</div>
<p>例如：</p>
<div class="highlight-python"><pre>radosgw-admin quota set --quota-scope=user --uid=johndoe --max-objects=1024 --max-size=1024B</pre>
</div>
<p>对象数和、或最大尺寸为负值时，表示不再检查这种配额属性。</p>
</div>
<div class="section" id="enable-disable-user-quota">
<span id="id14"></span><h3>启用或禁用用户配额<a class="headerlink" href="#enable-disable-user-quota" title="Permalink to this headline">¶</a></h3>
<p>设置好用户配额后就可以启用了。例如：</p>
<div class="highlight-python"><pre>radosgw-admin quota enable --quota-scope=user --uid=&lt;uid&gt;</pre>
</div>
<p>你也可以关闭已启用的用户配额功能。例如：</p>
<div class="highlight-python"><pre>radosgw-admin quota disable --quota-scope=user --uid=&lt;uid&gt;</pre>
</div>
</div>
<div class="section" id="set-bucket-quota">
<span id="id15"></span><h3>设置桶配额<a class="headerlink" href="#set-bucket-quota" title="Permalink to this headline">¶</a></h3>
<p>Bucket quotas apply to the buckets owned by the specified <tt class="docutils literal"><span class="pre">uid</span></tt>. They are
independent of the user.</p>
<div class="highlight-python"><pre>radosgw-admin quota set --uid=&lt;uid&gt; --quota-scope=bucket [--max-objects=&lt;num objects&gt;] [--max-size=&lt;max size]</pre>
</div>
<p>A negative value for num objects and / or max size means that the
specific quota attribute check is disabled.</p>
</div>
<div class="section" id="enable-disable-bucket-quota">
<span id="id16"></span><h3>启用、禁用桶配额<a class="headerlink" href="#enable-disable-bucket-quota" title="Permalink to this headline">¶</a></h3>
<p>设置好桶配额后，你可以这样启用：</p>
<div class="highlight-python"><pre>radosgw-admin quota enable --quota-scope=bucket --uid=&lt;uid&gt;</pre>
</div>
<p>已启用的桶配额可禁用。例如：</p>
<div class="highlight-python"><pre>radosgw-admin quota disable --quota-scope=bucket --uid=&lt;uid&gt;</pre>
</div>
</div>
<div class="section" id="get-quota-settings">
<span id="id17"></span><h3>查看配额配置信息<a class="headerlink" href="#get-quota-settings" title="Permalink to this headline">¶</a></h3>
<p>You may access each user&#8217;s quota settings via the user information
API. To read user quota setting information with the CLI interface,
execute the following:</p>
<div class="highlight-python"><pre>radosgw-admin user info --uid=&lt;uid&gt;</pre>
</div>
</div>
<div class="section" id="update-quota-stats">
<span id="id18"></span><h3>更新配额统计信息<a class="headerlink" href="#update-quota-stats" title="Permalink to this headline">¶</a></h3>
<p>Quota stats get updated asynchronously. You can update quota
statistics for all users and all buckets manually to retrieve
the latest quota stats.</p>
<div class="highlight-python"><pre>radosgw-admin user stats --uid=&lt;uid&gt; --sync-stats</pre>
</div>
</div>
<div class="section" id="get-user-usage-stats">
<span id="id19"></span><h3>查看用户使用情况的统计信息<a class="headerlink" href="#get-user-usage-stats" title="Permalink to this headline">¶</a></h3>
<p>查看用户已经消耗了多少配额可以用下列命令：</p>
<div class="highlight-python"><pre>radosgw-admin user stats --uid=&lt;uid&gt;</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">你可以用 <tt class="docutils literal"><span class="pre">radosgw-admin</span> <span class="pre">user</span> <span class="pre">stats</span></tt> 命令，加上
<tt class="docutils literal"><span class="pre">--sync-stats</span></tt> 选项来获取最新数据。</p>
</div>
</div>
<div class="section" id="default-quotas">
<span id="id20"></span><h3>默认配额<a class="headerlink" href="#default-quotas" title="Permalink to this headline">¶</a></h3>
<p>你可以在配置文件里设置默认配额，新增用户会采用这些默认值，而已经存在的用户不受影响。如果相关的默认配额是写在配置文件里的，那么这些配额会分配给新用户，并对其启用配额管理功能。请参考
<a class="reference external" href="../config-ref/">Ceph 对象网关配置参考</a>里的 <tt class="docutils literal"><span class="pre">rgw</span> <span class="pre">bucket</span> <span class="pre">default</span> <span class="pre">quota</span> <span class="pre">max</span> <span class="pre">objects</span></tt> 、
<tt class="docutils literal"><span class="pre">rgw</span> <span class="pre">bucket</span> <span class="pre">default</span> <span class="pre">quota</span> <span class="pre">max</span> <span class="pre">size</span></tt> 、 <tt class="docutils literal"><span class="pre">rgw</span> <span class="pre">user</span> <span class="pre">default</span> <span class="pre">quota</span> <span class="pre">max</span> <span class="pre">objects</span></tt>
和 <tt class="docutils literal"><span class="pre">rgw</span> <span class="pre">user</span> <span class="pre">default</span> <span class="pre">quota</span> <span class="pre">max</span> <span class="pre">size</span></tt> 。</p>
</div>
<div class="section" id="reading-writing-global-quotas">
<span id="id21"></span><h3>读取、写入全局配额<a class="headerlink" href="#reading-writing-global-quotas" title="Permalink to this headline">¶</a></h3>
<p>你可以在 period 配置中读取或写入全局配额设置，查看全局配额配置可以用：</p>
<div class="highlight-python"><pre>radosgw-admin global quota get</pre>
</div>
<p>全局配额选项可以用 <tt class="docutils literal"><span class="pre">global</span> <span class="pre">quota</span></tt> 系列命令修改，如
<tt class="docutils literal"><span class="pre">quota</span> <span class="pre">set</span></tt> 、 <tt class="docutils literal"><span class="pre">quota</span> <span class="pre">enable</span></tt> 和 <tt class="docutils literal"><span class="pre">quota</span> <span class="pre">disable</span></tt> 命令。</p>
<div class="highlight-python"><pre>radosgw-admin global quota set --quota-scope bucket --max-objects 1024
radosgw-admin global quota enable --quota-scope bucket</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">多站配置方案中有 realm 和 period ，改变全局配额后，必须用 <tt class="docutils literal"><span class="pre">period</span> <span class="pre">update</span> <span class="pre">--commit</span></tt> 提交变更。如果压根没有
period ，必须重启网关，以使变更生效。</p>
</div>
</div>
</div>
<div class="section" id="id22">
<h2>使用情况<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h2>
<p>Ceph 对象网关会记录每个用户的使用情况，你可以查看某段时间内用户的使用情况。</p>
<ul class="simple">
<li>需要在 ceph.conf 的 [client.rgw] 段下加
<tt class="docutils literal"><span class="pre">rgw</span> <span class="pre">enable</span> <span class="pre">usage</span> <span class="pre">log</span> <span class="pre">=</span> <span class="pre">true</span></tt> 配置，然后重启 radosgw 服务。</li>
</ul>
<p>选项有：</p>
<ul class="simple">
<li><strong>Start Date:</strong> The <tt class="docutils literal"><span class="pre">--start-date</span></tt> option allows you to filter usage
stats from a particular start date (<strong>format:</strong> <tt class="docutils literal"><span class="pre">yyyy-mm-dd[HH:MM:SS]</span></tt>).</li>
<li><strong>End Date:</strong> The <tt class="docutils literal"><span class="pre">--end-date</span></tt> option allows you to filter usage up
to a particular date (<strong>format:</strong> <tt class="docutils literal"><span class="pre">yyyy-mm-dd[HH:MM:SS]</span></tt>).</li>
<li><strong>Log Entries:</strong> The <tt class="docutils literal"><span class="pre">--show-log-entries</span></tt> option allows you to specify
whether or not to include log entries with the usage stats
(options: <tt class="docutils literal"><span class="pre">true</span></tt> | <tt class="docutils literal"><span class="pre">false</span></tt>).</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You may specify time with minutes and seconds, but it is stored
with 1 hour resolution.</p>
</div>
<div class="section" id="show-usage">
<span id="id23"></span><h3>查看使用情况<a class="headerlink" href="#show-usage" title="Permalink to this headline">¶</a></h3>
<p>To show usage statistics, specify the <tt class="docutils literal"><span class="pre">usage</span> <span class="pre">show</span></tt>. To show usage for a
particular user, you must specify a user ID. You may also specify a start date,
end date, and whether or not to show log entries.:</p>
<div class="highlight-python"><pre>radosgw-admin usage show --uid=johndoe --start-date=2012-03-01 --end-date=2012-04-01</pre>
</div>
<p>You may also show a summary of usage information for all users by omitting a user ID.</p>
<div class="highlight-python"><pre>radosgw-admin usage show --show-log-entries=false</pre>
</div>
</div>
<div class="section" id="trim-usage">
<span id="id24"></span><h3>清理统计日志<a class="headerlink" href="#trim-usage" title="Permalink to this headline">¶</a></h3>
<p>With heavy use, usage logs can begin to take up storage space. You can trim
usage logs for all users and for specific users. You may also specify date
ranges for trim operations.</p>
<div class="highlight-python"><pre>radosgw-admin usage trim --start-date=2010-01-01 --end-date=2010-12-31
radosgw-admin usage trim --uid=johndoe
radosgw-admin usage trim --uid=johndoe --end-date=2013-12-31</pre>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../start/intro/">Ceph 简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../start/">安装（快速）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/">安装（手动）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rados/">Ceph 存储集群</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cephfs/">Ceph 文件系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rbd/rbd/">Ceph 块设备</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">Ceph 对象网关</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../install/install-ceph-gateway/">基于 Civetweb 手动安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config-fcgi/">基于 Apache/FastCGI 的简单配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../federated-config/">联盟配置（已废弃）</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multisite/">多站配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config-ref/">配置参考</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">管理指南</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#user-management">用户管理</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#create-a-user">创建用户</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-a-subuser">创建子用户</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-user-info">获取用户信息</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modify-user-info">修改用户信息</a></li>
<li class="toctree-l4"><a class="reference internal" href="#user-enable-suspend">用户的暂停、启用</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id8">删除用户</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">删除子用户</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id10">增加、删除密钥</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-remove-admin-capabilities">增加、删除管理能力</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#quota-management">配额管理</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#set-user-quota">设置用户配额</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enable-disable-user-quota">启用或禁用用户配额</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-bucket-quota">设置桶配额</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enable-disable-bucket-quota">启用、禁用桶配额</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-quota-settings">查看配额配置信息</a></li>
<li class="toctree-l4"><a class="reference internal" href="#update-quota-stats">更新配额统计信息</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-user-usage-stats">查看用户使用情况的统计信息</a></li>
<li class="toctree-l4"><a class="reference internal" href="#default-quotas">默认配额</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reading-writing-global-quotas">读取、写入全局配额</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id22">使用情况</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#show-usage">查看使用情况</a></li>
<li class="toctree-l4"><a class="reference internal" href="#trim-usage">清理统计日志</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../s3/">S3 API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../swift/">Swift API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../adminops/">管理操作 API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/">Python 接口</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ldap-auth/">与 LDAP 认证服务对接</a></li>
<li class="toctree-l2"><a class="reference internal" href="../keystone/">与 OpenStack Keystone 对接</a></li>
<li class="toctree-l2"><a class="reference internal" href="../barbican/">与 OpenStack Barbican 对接</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multitenancy/">多租户</a></li>
<li class="toctree-l2"><a class="reference internal" href="../compression/">压缩</a></li>
<li class="toctree-l2"><a class="reference internal" href="../encryption/">服务器端加密</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bucketpolicy/">桶策略</a></li>
<li class="toctree-l2"><a class="reference internal" href="../layout/">RADOS 中的数据布局</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade_to_jewel/">升级到 Jewel 的早期版本</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/">故障排除</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../man/8/radosgw/">radosgw 手册页</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../man/8/radosgw-admin/">radosgw-admin 手册页</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../mgr/">Ceph 管理器守护进程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/">API 文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture/">体系结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/">开发文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/">Ceph 版本</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary/">Ceph 术语</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../README/">中文版翻译说明</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../translation-convention/">中文版词语翻译惯例</a></li>
</ul>


<!-- ugly kludge to make genindex look like it's part of the toc -->
<ul style="margin-top: -10px"><li class="toctree-l1"><a class="reference internal" href="../../genindex/">Index</a></li></ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../s3/" title="Ceph 对象网关的 S3 兼容 API"
             >next</a> |</li>
        <li class="right" >
          <a href="../config-ref/" title="Ceph 对象网关配置参考"
             >previous</a> |</li>
        <li><a href="../../">Ceph Documentation</a> &raquo;</li>
          <li><a href="../" >Ceph 对象网关</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2016, Red Hat, Inc, and contributors. Licensed under Creative Commons BY-SA.
    </div>
  </body>
</html>