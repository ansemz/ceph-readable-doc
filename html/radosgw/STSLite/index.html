
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>STS Lite &#8212; Ceph Documentation</title>
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/js/ceph.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="Role" href="../role/" />
    <link rel="prev" title="Rados Gateway Data Layout" href="../layout/" />
    <script type="text/javascript" src="http://ayni.ceph.com/public/js/ceph.js"></script>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../role/" title="Role"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../layout/" title="Rados Gateway Data Layout"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">Ceph Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../" accesskey="U">Ceph Object Gateway</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            

<div id="dev-warning" class="admonition note" style="display:none;">
  <p class="first admonition-title">Notice</p>
  <p class="last">This document is for a development version of Ceph.</p>
</div>

<div id="eol-warning" class="admonition warning" style="display:none;">
  <p class="first admonition-title">Warning</p>
  <p class="last">This document is for an unsupported version of Ceph.</p>
</div>
  <div id="docubetter" align="right" style="display:none; padding: 15px; font-weight: bold;">
    <a id="edit-on-github" href="https://github.com/ceph/ceph/edit/master/doc/radosgw/STSLite.rst" rel="nofollow">Edit on GitHub</a> | <a href="https://github.com/ceph/ceph/projects/4">Report a Documentation Bug</a>
  </div>

  
  <div class="section" id="sts-lite">
<h1>STS Lite<a class="headerlink" href="#sts-lite" title="Permalink to this headline">¶</a></h1>
<p>Ceph Object Gateway provides support for a subset of Amazon Secure Token Service
(STS) APIs. STS Lite provides access to a set of temporary credentials for
Identity and Access Management.</p>
<p>STS authentication mechanism has been integrated with Keystone in Ceph Object
Gateway. A set of temporary security credentials is returned after authenticating
a set of AWS credentials with Keystone. These temporary credentials can be used
to make subsequent S3 calls which will be authenticated by the STS engine,
resulting in less load on the Keystone server.</p>
<div class="section" id="sts-lite-rest-apis">
<h2>STS Lite REST APIs<a class="headerlink" href="#sts-lite-rest-apis" title="Permalink to this headline">¶</a></h2>
<p>The following STS Lite REST APIs have been implemented in Ceph Object Gateway:</p>
<p>1. GetSessionToken: Returns a set of temporary credentials for a set of AWS
credentials. This API can be used for initial authentication with Keystone
and the temporary credentials returned can be used to make subsequent S3
calls. The temporary credentials will have the same permission as that of the
AWS credentials.</p>
<dl class="docutils">
<dt>Parameters:</dt>
<dd><p class="first"><strong>DurationSeconds</strong> (Integer/ Optional): The duration in seconds for which the
credentials should remain valid. Its default value is 3600. Its default max
value is 43200 which is can be configured using rgw sts max session duration.</p>
<p><strong>SerialNumber</strong> (String/ Optional): The Id number of the MFA device associated
with the user making the GetSessionToken call.</p>
<p class="last"><strong>TokenCode</strong> (String/ Optional): The value provided by the MFA device, if MFA is required.</p>
</dd>
</dl>
<p>An end user needs to attach a policy to allow invocation of GetSessionToken API using its permanent
credentials and to allow subsequent s3 operations invocation using only the temporary credentials returned
by GetSessionToken.
The following is an example of attaching the policy to a user ‘TESTER1’:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">s3curl</span><span class="o">.</span><span class="n">pl</span> <span class="o">--</span><span class="n">debug</span> <span class="o">--</span><span class="nb">id</span> <span class="n">admin</span> <span class="o">--</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="s2">&quot;http://localhost:8000/?Action=PutUserPolicy&amp;PolicyName=Policy1&amp;UserName=TESTER1&amp;PolicyDocument=\{</span><span class="se">\&quot;</span><span class="s2">Version</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">2012-10-17</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">Statement</span><span class="se">\&quot;</span><span class="s2">:\[\{</span><span class="se">\&quot;</span><span class="s2">Effect</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">Deny</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">Action</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">s3:*</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">Resource</span><span class="se">\&quot;</span><span class="s2">:\[</span><span class="se">\&quot;</span><span class="s2">*</span><span class="se">\&quot;</span><span class="s2">\],</span><span class="se">\&quot;</span><span class="s2">Condition</span><span class="se">\&quot;</span><span class="s2">:\{</span><span class="se">\&quot;</span><span class="s2">BoolIfExists</span><span class="se">\&quot;</span><span class="s2">:\{</span><span class="se">\&quot;</span><span class="s2">sts:authentication</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">false</span><span class="se">\&quot;</span><span class="s2">\}\}\},\{</span><span class="se">\&quot;</span><span class="s2">Effect</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">Allow</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">Action</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">sts:GetSessionToken</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">Resource</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">*</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">Condition</span><span class="se">\&quot;</span><span class="s2">:\{</span><span class="se">\&quot;</span><span class="s2">BoolIfExists</span><span class="se">\&quot;</span><span class="s2">:\{</span><span class="se">\&quot;</span><span class="s2">sts:authentication</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">false</span><span class="se">\&quot;</span><span class="s2">\}\}\}\]\}&amp;Version=2010-05-08&quot;</span>
</pre></div>
</div>
<p>The user attaching the policy needs to have admin caps. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">radosgw</span><span class="o">-</span><span class="n">admin</span> <span class="n">caps</span> <span class="n">add</span> <span class="o">--</span><span class="n">uid</span><span class="o">=</span><span class="s2">&quot;TESTER&quot;</span> <span class="o">--</span><span class="n">caps</span><span class="o">=</span><span class="s2">&quot;user-policy=*&quot;</span>
</pre></div>
</div>
<p>2. AssumeRole: Returns a set of temporary credentials that can be used for
cross-account access. The temporary credentials will have permissions that are
allowed by both - permission policies attached with the Role and policy attached
with the AssumeRole API.</p>
<dl class="docutils">
<dt>Parameters:</dt>
<dd><p class="first"><strong>RoleArn</strong> (String/ Required): ARN of the Role to Assume.</p>
<p><strong>RoleSessionName</strong> (String/ Required): An Identifier for the assumed role
session.</p>
<p><strong>Policy</strong> (String/ Optional): An IAM Policy in JSON format.</p>
<p><strong>DurationSeconds</strong> (Integer/ Optional): The duration in seconds of the session.
Its default value is 3600.</p>
<p><strong>ExternalId</strong> (String/ Optional): A unique Id that might be used when a role is
assumed in another account.</p>
<p><strong>SerialNumber</strong> (String/ Optional): The Id number of the MFA device associated
with the user making the AssumeRole call.</p>
<p class="last"><strong>TokenCode</strong> (String/ Optional): The value provided by the MFA device, if the
trust policy of the role being assumed requires MFA.</p>
</dd>
</dl>
</div>
<div class="section" id="sts-lite-configuration">
<h2>STS Lite Configuration<a class="headerlink" href="#sts-lite-configuration" title="Permalink to this headline">¶</a></h2>
<p>The following configurable options are available for STS Lite integration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">client</span><span class="o">.</span><span class="n">radosgw</span><span class="o">.</span><span class="n">gateway</span><span class="p">]</span>
<span class="n">rgw</span> <span class="n">sts</span> <span class="n">key</span> <span class="o">=</span> <span class="p">{</span><span class="n">sts</span> <span class="n">key</span> <span class="k">for</span> <span class="n">encrypting</span> <span class="n">the</span> <span class="n">session</span> <span class="n">token</span><span class="p">}</span>
<span class="n">rgw</span> <span class="n">s3</span> <span class="n">auth</span> <span class="n">use</span> <span class="n">sts</span> <span class="o">=</span> <span class="n">true</span>
</pre></div>
</div>
<p>The above STS configurables can be used with the Keystone configurables if one
needs to use STS Lite in conjunction with Keystone. The complete set of
configurable options will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">client</span><span class="o">.</span><span class="n">radosgw</span><span class="o">.</span><span class="n">gateway</span><span class="p">]</span>
<span class="n">rgw</span> <span class="n">sts</span> <span class="n">key</span> <span class="o">=</span> <span class="p">{</span><span class="n">sts</span> <span class="n">key</span> <span class="k">for</span> <span class="n">encrypting</span><span class="o">/</span> <span class="n">decrypting</span> <span class="n">the</span> <span class="n">session</span> <span class="n">token</span><span class="p">}</span>
<span class="n">rgw</span> <span class="n">s3</span> <span class="n">auth</span> <span class="n">use</span> <span class="n">sts</span> <span class="o">=</span> <span class="n">true</span>

<span class="n">rgw</span> <span class="n">keystone</span> <span class="n">url</span> <span class="o">=</span> <span class="p">{</span><span class="n">keystone</span> <span class="n">server</span> <span class="n">url</span><span class="p">:</span><span class="n">keystone</span> <span class="n">server</span> <span class="n">admin</span> <span class="n">port</span><span class="p">}</span>
<span class="n">rgw</span> <span class="n">keystone</span> <span class="n">admin</span> <span class="n">project</span> <span class="o">=</span> <span class="p">{</span><span class="n">keystone</span> <span class="n">admin</span> <span class="n">project</span> <span class="n">name</span><span class="p">}</span>
<span class="n">rgw</span> <span class="n">keystone</span> <span class="n">admin</span> <span class="n">tenant</span> <span class="o">=</span> <span class="p">{</span><span class="n">keystone</span> <span class="n">service</span> <span class="n">tenant</span> <span class="n">name</span><span class="p">}</span>
<span class="n">rgw</span> <span class="n">keystone</span> <span class="n">admin</span> <span class="n">domain</span> <span class="o">=</span> <span class="p">{</span><span class="n">keystone</span> <span class="n">admin</span> <span class="n">domain</span> <span class="n">name</span><span class="p">}</span>
<span class="n">rgw</span> <span class="n">keystone</span> <span class="n">api</span> <span class="n">version</span> <span class="o">=</span> <span class="p">{</span><span class="n">keystone</span> <span class="n">api</span> <span class="n">version</span><span class="p">}</span>
<span class="n">rgw</span> <span class="n">keystone</span> <span class="n">implicit</span> <span class="n">tenants</span> <span class="o">=</span> <span class="p">{</span><span class="n">true</span> <span class="k">for</span> <span class="n">private</span> <span class="n">tenant</span> <span class="k">for</span> <span class="n">each</span> <span class="n">new</span> <span class="n">user</span><span class="p">}</span>
<span class="n">rgw</span> <span class="n">keystone</span> <span class="n">admin</span> <span class="n">password</span> <span class="o">=</span> <span class="p">{</span><span class="n">keystone</span> <span class="n">service</span> <span class="n">tenant</span> <span class="n">user</span> <span class="n">name</span><span class="p">}</span>
<span class="n">rgw</span> <span class="n">keystone</span> <span class="n">admin</span> <span class="n">user</span> <span class="o">=</span> <span class="n">keystone</span> <span class="n">service</span> <span class="n">tenant</span> <span class="n">user</span> <span class="n">password</span><span class="p">}</span>
<span class="n">rgw</span> <span class="n">keystone</span> <span class="n">accepted</span> <span class="n">roles</span> <span class="o">=</span> <span class="p">{</span><span class="n">accepted</span> <span class="n">user</span> <span class="n">roles</span><span class="p">}</span>
<span class="n">rgw</span> <span class="n">keystone</span> <span class="n">token</span> <span class="n">cache</span> <span class="n">size</span> <span class="o">=</span> <span class="p">{</span><span class="n">number</span> <span class="n">of</span> <span class="n">tokens</span> <span class="n">to</span> <span class="n">cache</span><span class="p">}</span>
<span class="n">rgw</span> <span class="n">keystone</span> <span class="n">revocation</span> <span class="n">interval</span> <span class="o">=</span> <span class="p">{</span><span class="n">number</span> <span class="n">of</span> <span class="n">seconds</span> <span class="n">before</span> <span class="n">checking</span> <span class="n">revoked</span> <span class="n">tickets</span><span class="p">}</span>
<span class="n">rgw</span> <span class="n">s3</span> <span class="n">auth</span> <span class="n">use</span> <span class="n">keystone</span> <span class="o">=</span> <span class="n">true</span>
<span class="n">rgw</span> <span class="n">nss</span> <span class="n">db</span> <span class="n">path</span> <span class="o">=</span> <span class="p">{</span><span class="n">path</span> <span class="n">to</span> <span class="n">nss</span> <span class="n">db</span><span class="p">}</span>
</pre></div>
</div>
<p>Note: By default, STS and S3 APIs co-exist in the same namespace, and both S3
and STS APIs can be accessed via the same endpoint in Ceph Object Gateway.</p>
</div>
<div class="section" id="example-showing-how-to-use-sts-lite-with-keystone">
<h2>Example showing how to Use STS Lite with Keystone<a class="headerlink" href="#example-showing-how-to-use-sts-lite-with-keystone" title="Permalink to this headline">¶</a></h2>
<p>The following are the steps needed to use STS Lite with Keystone. Boto 3.x has
been used to write an example code to show the integration of STS Lite with
Keystone.</p>
<ol class="arabic simple">
<li>Generate EC2 credentials :</li>
</ol>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">openstack</span> <span class="nx">ec2</span> <span class="nx">credentials</span> <span class="nx">create</span>
<span class="o">+------------+--------------------------------------------------------+</span>
<span class="o">|</span> <span class="nx">Field</span>      <span class="o">|</span> <span class="nx">Value</span>                                                  <span class="o">|</span>
<span class="o">+------------+--------------------------------------------------------+</span>
<span class="o">|</span> <span class="nx">access</span>     <span class="o">|</span> <span class="nx">b924dfc87d454d15896691182fdeb0ef</span>                       <span class="o">|</span>
<span class="o">|</span> <span class="nx">links</span>      <span class="o">|</span> <span class="p">{</span><span class="nx">u</span><span class="s1">&#39;self&#39;</span><span class="o">:</span> <span class="nx">u</span><span class="s1">&#39;http://192.168.0.15/identity/v3/users/     |</span>
<span class="s1">|            | 40a7140e424f493d8165abc652dc731c/credentials/          |</span>
<span class="s1">|            | OS-EC2/b924dfc87d454d15896691182fdeb0ef&#39;</span><span class="p">}</span>              <span class="o">|</span>
<span class="o">|</span> <span class="nx">project_id</span> <span class="o">|</span> <span class="nx">c703801dccaf4a0aaa39bec8c481e25a</span>                       <span class="o">|</span>
<span class="o">|</span> <span class="nx">secret</span>     <span class="o">|</span> <span class="mi">6</span><span class="nx">a2142613c504c42a94ba2b82147dc28</span>                       <span class="o">|</span>
<span class="o">|</span> <span class="nx">trust_id</span>   <span class="o">|</span> <span class="nx">None</span>                                                   <span class="o">|</span>
<span class="o">|</span> <span class="nx">user_id</span>    <span class="o">|</span> <span class="mi">40</span><span class="nx">a7140e424f493d8165abc652dc731c</span>                       <span class="o">|</span>
<span class="o">+------------+--------------------------------------------------------+</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Use the credentials created in the step 1. to get back a set of temporary
credentials using GetSessionToken API.</li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">boto3</span>

<span class="n">access_key</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ec2</span> <span class="n">access</span> <span class="n">key</span><span class="o">&gt;</span>
<span class="n">secret_key</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ec2</span> <span class="n">secret</span> <span class="n">key</span><span class="o">&gt;</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;sts&#39;</span><span class="p">,</span>
<span class="n">aws_access_key_id</span><span class="o">=</span><span class="n">access_key</span><span class="p">,</span>
<span class="n">aws_secret_access_key</span><span class="o">=</span><span class="n">secret_key</span><span class="p">,</span>
<span class="n">endpoint_url</span><span class="o">=&lt;</span><span class="n">STS</span> <span class="n">URL</span><span class="o">&gt;</span><span class="p">,</span>
<span class="n">region_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_session_token</span><span class="p">(</span>
    <span class="n">DurationSeconds</span><span class="o">=</span><span class="mi">43200</span>
<span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>The temporary credentials obtained in step 2. can be used for making S3 calls:</li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s3client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">,</span>
  <span class="n">aws_access_key_id</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;Credentials&#39;</span><span class="p">][</span><span class="s1">&#39;AccessKeyId&#39;</span><span class="p">],</span>
  <span class="n">aws_secret_access_key</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;Credentials&#39;</span><span class="p">][</span><span class="s1">&#39;SecretAccessKey&#39;</span><span class="p">],</span>
  <span class="n">aws_session_token</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;Credentials&#39;</span><span class="p">][</span><span class="s1">&#39;SessionToken&#39;</span><span class="p">],</span>
  <span class="n">endpoint_url</span><span class="o">=&lt;</span><span class="n">S3</span> <span class="n">URL</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="n">region_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="n">bucket</span> <span class="o">=</span> <span class="n">s3client</span><span class="o">.</span><span class="n">create_bucket</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="s1">&#39;my-new-shiny-bucket&#39;</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">s3client</span><span class="o">.</span><span class="n">list_buckets</span><span class="p">()</span>
<span class="k">for</span> <span class="n">bucket</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;Buckets&quot;</span><span class="p">]:</span>
    <span class="k">print</span> <span class="s2">&quot;{name}</span><span class="se">\t</span><span class="s2">{created}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">bucket</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">],</span>
                <span class="n">created</span> <span class="o">=</span> <span class="n">bucket</span><span class="p">[</span><span class="s1">&#39;CreationDate&#39;</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li>The following is an example of AssumeRole API call:</li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">boto3</span>

<span class="n">access_key</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ec2</span> <span class="n">access</span> <span class="n">key</span><span class="o">&gt;</span>
<span class="n">secret_key</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ec2</span> <span class="n">secret</span> <span class="n">key</span><span class="o">&gt;</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;sts&#39;</span><span class="p">,</span>
<span class="n">aws_access_key_id</span><span class="o">=</span><span class="n">access_key</span><span class="p">,</span>
<span class="n">aws_secret_access_key</span><span class="o">=</span><span class="n">secret_key</span><span class="p">,</span>
<span class="n">endpoint_url</span><span class="o">=&lt;</span><span class="n">STS</span> <span class="n">URL</span><span class="o">&gt;</span><span class="p">,</span>
<span class="n">region_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">assume_role</span><span class="p">(</span>
<span class="n">RoleArn</span><span class="o">=</span><span class="s1">&#39;arn:aws:iam:::role/application_abc/component_xyz/S3Access&#39;</span><span class="p">,</span>
<span class="n">RoleSessionName</span><span class="o">=</span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span>
<span class="n">DurationSeconds</span><span class="o">=</span><span class="mi">3600</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Note: A role ‘S3Access’, needs to be created before calling the AssumeRole API.</p>
</div>
<div class="section" id="limitations-and-workarounds">
<h2>Limitations and Workarounds<a class="headerlink" href="#limitations-and-workarounds" title="Permalink to this headline">¶</a></h2>
<p>1. Keystone currently supports only S3 requests, hence in order to successfully
authenticate an STS request, the following workaround needs to be added to boto
to the following file - botocore/auth.py</p>
<p>Lines 13-16 have been added as a workaround in the code block below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SigV4Auth</span><span class="p">(</span><span class="n">BaseSigner</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Sign a request with Signature V4.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">REQUIRES_REGION</span> <span class="o">=</span> <span class="bp">True</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">credentials</span><span class="p">,</span> <span class="n">service_name</span><span class="p">,</span> <span class="n">region_name</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span> <span class="o">=</span> <span class="n">credentials</span>
      <span class="c1"># We initialize these value here so the unit tests can have</span>
      <span class="c1"># valid values.  But these will get overriden in ``add_auth``</span>
      <span class="c1"># later for real requests.</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_region_name</span> <span class="o">=</span> <span class="n">region_name</span>
      <span class="k">if</span> <span class="n">service_name</span> <span class="o">==</span> <span class="s1">&#39;sts&#39;</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">_service_name</span> <span class="o">=</span> <span class="s1">&#39;s3&#39;</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">_service_name</span> <span class="o">=</span> <span class="n">service_name</span>
</pre></div>
</div>
</div>
</div>



          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../start/intro/">Intro to Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../start/">Installation (ceph-deploy)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/">Installation (Manual)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../start/kube-helm/">Installation (Kubernetes + Helm)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rados/">Ceph Storage Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cephfs/">Ceph Filesystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rbd/">Ceph Block Device</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">Ceph Object Gateway</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../install/install-ceph-gateway/">Manual Install w/Civetweb</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frontends/">HTTP Frontends</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multisite/">Multisite Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pools/">Configuring Pools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config-ref/">Config Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../admin/">Admin Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../s3/">S3 API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../swift/">Swift API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../adminops/">Admin Ops API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/">Python binding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nfs/">Export over NFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../keystone/">OpenStack Keystone Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../barbican/">OpenStack Barbican Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../opa/">Open Policy Agent Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multitenancy/">Multi-tenancy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../compression/">Compression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ldap-auth/">LDAP Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../encryption/">Server-Side Encryption</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bucketpolicy/">Bucket Policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dynamicresharding/">Dynamic bucket index resharding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mfa/">Multi factor authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sync-modules/">Sync Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../layout/">Data Layout in RADOS</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">STS Lite</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#sts-lite-rest-apis">STS Lite REST APIs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sts-lite-configuration">STS Lite Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-showing-how-to-use-sts-lite-with-keystone">Example showing how to Use STS Lite with Keystone</a></li>
<li class="toctree-l3"><a class="reference internal" href="#limitations-and-workarounds">Limitations and Workarounds</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../role/">Role</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../man/8/radosgw/">Manpage radosgw</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../man/8/radosgw-admin/">Manpage radosgw-admin</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../mgr/">Ceph Manager Daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture/">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/internals/">Ceph Internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../governance/">Governance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ceph-volume/">ceph-volume</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/">Ceph Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary/">Glossary</a></li>
</ul>


<!-- ugly kludge to make genindex look like it's part of the toc -->
<ul style="margin-top: -10px"><li class="toctree-l1"><a class="reference internal" href="../../genindex/">Index</a></li></ul>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../role/" title="Role"
             >next</a> |</li>
        <li class="right" >
          <a href="../layout/" title="Rados Gateway Data Layout"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">Ceph Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../" >Ceph Object Gateway</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Red Hat, Inc, and contributors. Licensed under Creative Commons Attribution Share Alike 3.0 (CC-BY-SA-3.0).
    </div>
  </body>
</html>