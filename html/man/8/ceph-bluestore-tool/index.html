
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>ceph-bluestore-tool – bluestore 管理工具 &#8212; Ceph Documentation</title>
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../../_static/js/ceph.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex/" />
    <link rel="search" title="Search" href="../../../search/" />
    <script type="text/javascript" src="http://ayni.ceph.com/public/js/ceph.js"></script>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../">Ceph Documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            

<div id="dev-warning" class="admonition note" style="display:none;">
  <p class="first admonition-title">Notice</p>
  <p class="last">This document is for a development version of Ceph.</p>
</div>

<div id="eol-warning" class="admonition warning" style="display:none;">
  <p class="first admonition-title">Warning</p>
  <p class="last">This document is for an unsupported version of Ceph.</p>
</div>
  <div id="docubetter" align="right" style="display:none; padding: 15px; font-weight: bold;">
    <a id="edit-on-github" href="https://github.com/ceph/ceph/edit/master/doc/man/8/ceph-bluestore-tool.rst" rel="nofollow">Edit on GitHub</a> | <a href="https://github.com/ceph/ceph/projects/4">Report a Documentation Bug</a>
  </div>

  
  <div class="section" id="ceph-bluestore-tool-bluestore">
<h1>ceph-bluestore-tool – bluestore 管理工具<a class="headerlink" href="#ceph-bluestore-tool-bluestore" title="Permalink to this headline">¶</a></h1>
<div class="section" id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line"><strong>ceph-bluestore-tool</strong> <em>command</em>
[ –dev <em>device</em> … ]
[ –path <em>osd path</em> ]
[ –out-dir <em>dir</em> ]
[ –log-file | -l <em>filename</em> ]
[ –deep ]</div>
<div class="line"><strong>ceph-bluestore-tool</strong> fsck|repair –path <em>osd path</em> [ –deep ]</div>
<div class="line"><strong>ceph-bluestore-tool</strong> show-label –dev <em>device</em> …</div>
<div class="line"><strong>ceph-bluestore-tool</strong> prime-osd-dir –dev <em>device</em> –path <em>osd path</em></div>
<div class="line"><strong>ceph-bluestore-tool</strong> bluefs-export –path <em>osd path</em> –out-dir <em>dir</em></div>
<div class="line"><strong>ceph-bluestore-tool</strong> bluefs-bdev-new-wal –path <em>osd path</em> –dev-target <em>new-device</em></div>
<div class="line"><strong>ceph-bluestore-tool</strong> bluefs-bdev-new-db –path <em>osd path</em> –dev-target <em>new-device</em></div>
<div class="line"><strong>ceph-bluestore-tool</strong> bluefs-bdev-migrate –path <em>osd path</em> –dev-target <em>new-device</em> –devs-source <em>device1</em> [–devs-source <em>device2</em>]</div>
<div class="line"><strong>ceph-bluestore-tool</strong> free-dump|free-score –path <em>osd path</em> [ –allocator block/bluefs-wal/bluefs-db/bluefs-slow ]</div>
</div>
</div>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p><strong>ceph-bluestore-tool</strong> is a utility to perform low-level administrative
operations on a BlueStore instance.</p>
</div>
<div class="section" id="commands">
<h2>Commands<a class="headerlink" href="#commands" title="Permalink to this headline">¶</a></h2>
<p><strong class="command">help</strong></p>
<blockquote>
<div><p>show help</p>
</div></blockquote>
<p><strong class="command">fsck</strong> [ –deep ]</p>
<blockquote>
<div><p>run consistency check on BlueStore metadata.  If <em>–deep</em> is specified, also read all object data and verify checksums.</p>
</div></blockquote>
<p><strong class="command">repair</strong></p>
<blockquote>
<div><p>Run a consistency check <em>and</em> repair any errors we can.</p>
</div></blockquote>
<p><strong class="command">bluefs-export</strong></p>
<blockquote>
<div><p>Export the contents of BlueFS (i.e., rocksdb files) to an output directory.</p>
</div></blockquote>
<p><strong class="command">bluefs-bdev-sizes</strong> –path <em>osd path</em></p>
<blockquote>
<div><p>Print the device sizes, as understood by BlueFS, to stdout.</p>
</div></blockquote>
<p><strong class="command">bluefs-bdev-expand</strong> –path <em>osd path</em></p>
<blockquote>
<div><p>Instruct BlueFS to check the size of its block devices and, if they have expanded, make use of the additional space.</p>
</div></blockquote>
<p><strong class="command">bluefs-bdev-new-wal</strong> –path <em>osd path</em> –dev-target <em>new-device</em></p>
<blockquote>
<div><p>Adds WAL device to BlueFS, fails if WAL device already exists.</p>
</div></blockquote>
<p><strong class="command">bluefs-bdev-new-db</strong> –path <em>osd path</em> –dev-target <em>new-device</em></p>
<blockquote>
<div><p>Adds DB device to BlueFS, fails if DB device already exists.</p>
</div></blockquote>
<p><strong class="command">bluefs-bdev-migrate</strong> –dev-target <em>new-device</em> –devs-source <em>device1</em> [–devs-source <em>device2</em>]</p>
<blockquote>
<div><p>Moves BlueFS data from source device(s) to the target one, source devices
(except the main one) are removed on success. Target device can be both
already attached or new device. In the latter case it’s added to OSD
replacing one of the source devices. Following replacement rules apply
(in the order of precedence, stop on the first match):</p>
<blockquote>
<div><ul class="simple">
<li><p>if source list has DB volume - target device replaces it.</p></li>
<li><p>if source list has WAL volume - target device replace it.</p></li>
<li><p>if source list has slow volume only - operation isn’t permitted, requires explicit allocation via new-db/new-wal command.</p></li>
</ul>
</div></blockquote>
</div></blockquote>
<p><strong class="command">show-label</strong> –dev <em>device</em> […]</p>
<blockquote>
<div><p>Show device label(s).</p>
</div></blockquote>
<p><strong class="command">free-dump</strong> –path <em>osd path</em> [ –allocator block/bluefs-wal/bluefs-db/bluefs-slow ]</p>
<blockquote>
<div><p>Dump all free regions in allocator.</p>
</div></blockquote>
<p><strong class="command">free-score</strong> –path <em>osd path</em> [ –allocator block/bluefs-wal/bluefs-db/bluefs-slow ]</p>
<blockquote>
<div><p>Give a [0-1] number that represents quality of fragmentation in allocator.
0 represents case when all free space is in one chunk. 1 represents worst possible fragmentation.</p>
</div></blockquote>
</div>
<div class="section" id="options">
<h2>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-ceph-bluestore-tool-dev">
<code class="sig-name descname">--dev</code><code class="sig-prename descclassname"> *device*</code><a class="headerlink" href="#cmdoption-ceph-bluestore-tool-dev" title="Permalink to this definition">¶</a></dt>
<dd><p>Add <em>device</em> to the list of devices to consider</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-ceph-bluestore-tool-devs-source">
<code class="sig-name descname">--devs-source</code><code class="sig-prename descclassname"> *device*</code><a class="headerlink" href="#cmdoption-ceph-bluestore-tool-devs-source" title="Permalink to this definition">¶</a></dt>
<dd><p>Add <em>device</em> to the list of devices to consider as sources for migrate operation</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-ceph-bluestore-tool-dev-target">
<code class="sig-name descname">--dev-target</code><code class="sig-prename descclassname"> *device*</code><a class="headerlink" href="#cmdoption-ceph-bluestore-tool-dev-target" title="Permalink to this definition">¶</a></dt>
<dd><p>Specify target <em>device</em> migrate operation or device to add for adding new DB/WAL.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-ceph-bluestore-tool-path">
<code class="sig-name descname">--path</code><code class="sig-prename descclassname"> *osd path*</code><a class="headerlink" href="#cmdoption-ceph-bluestore-tool-path" title="Permalink to this definition">¶</a></dt>
<dd><p>Specify an osd path.  In most cases, the device list is inferred from the symlinks present in <em>osd path</em>.  This is usually simpler than explicitly specifying the device(s) with –dev.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-ceph-bluestore-tool-out-dir">
<code class="sig-name descname">--out-dir</code><code class="sig-prename descclassname"> *dir*</code><a class="headerlink" href="#cmdoption-ceph-bluestore-tool-out-dir" title="Permalink to this definition">¶</a></dt>
<dd><p>Output directory for bluefs-export</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-ceph-bluestore-tool-l">
<code class="sig-name descname">-l</code><code class="sig-prename descclassname"></code><code class="sig-prename descclassname">, </code><code class="sig-name descname">--log-file</code><code class="sig-prename descclassname"> *log file*</code><a class="headerlink" href="#cmdoption-ceph-bluestore-tool-l" title="Permalink to this definition">¶</a></dt>
<dd><p>file to log to</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-ceph-bluestore-tool-log-level">
<code class="sig-name descname">--log-level</code><code class="sig-prename descclassname"> *num*</code><a class="headerlink" href="#cmdoption-ceph-bluestore-tool-log-level" title="Permalink to this definition">¶</a></dt>
<dd><p>debug log level.  Default is 30 (extremely verbose), 20 is very
verbose, 10 is verbose, and 1 is not very verbose.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-ceph-bluestore-tool-deep">
<code class="sig-name descname">--deep</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-ceph-bluestore-tool-deep" title="Permalink to this definition">¶</a></dt>
<dd><p>deep scrub/repair (read and validate object data, not just metadata)</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-ceph-bluestore-tool-allocator">
<code class="sig-name descname">--allocator</code><code class="sig-prename descclassname"> *name*</code><a class="headerlink" href="#cmdoption-ceph-bluestore-tool-allocator" title="Permalink to this definition">¶</a></dt>
<dd><p>Useful for <em>free-dump</em> and <em>free-score</em> actions. Selects allocator(s).</p>
</dd></dl>

</div>
<div class="section" id="device-labels">
<h2>Device labels<a class="headerlink" href="#device-labels" title="Permalink to this headline">¶</a></h2>
<p>Every BlueStore block device has a single block label at the beginning of the
device.  You can dump the contents of the label with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span><span class="o">-</span><span class="n">bluestore</span><span class="o">-</span><span class="n">tool</span> <span class="n">show</span><span class="o">-</span><span class="n">label</span> <span class="o">--</span><span class="n">dev</span> <span class="o">*</span><span class="n">device</span><span class="o">*</span>
</pre></div>
</div>
<p>The main device will have a lot of metadata, including information
that used to be stored in small files in the OSD data directory.  The
auxiliary devices (db and wal) will only have the minimum required
fields (OSD UUID, size, device type, birth time).</p>
</div>
<div class="section" id="osd-directory-priming">
<h2>OSD directory priming<a class="headerlink" href="#osd-directory-priming" title="Permalink to this headline">¶</a></h2>
<p>You can generate the content for an OSD data directory that can start up a
BlueStore OSD with the <em>prime-osd-dir</em> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span><span class="o">-</span><span class="n">bluestore</span><span class="o">-</span><span class="n">tool</span> <span class="n">prime</span><span class="o">-</span><span class="n">osd</span><span class="o">-</span><span class="nb">dir</span> <span class="o">--</span><span class="n">dev</span> <span class="o">*</span><span class="n">main</span> <span class="n">device</span><span class="o">*</span> <span class="o">--</span><span class="n">path</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">ceph</span><span class="o">/</span><span class="n">osd</span><span class="o">/</span><span class="n">ceph</span><span class="o">-*</span><span class="nb">id</span><span class="o">*</span>
</pre></div>
</div>
</div>
<div class="section" id="availability">
<h2>Availability<a class="headerlink" href="#availability" title="Permalink to this headline">¶</a></h2>
<p><strong>ceph-bluestore-tool</strong> is part of Ceph, a massively scalable,
open-source, distributed storage system. Please refer to the Ceph
documentation at <a class="reference external" href="http://ceph.com/docs">http://ceph.com/docs</a> for more information.</p>
</div>
<div class="section" id="see-also">
<h2>See also<a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../ceph-osd/"><span class="doc">ceph-osd</span></a>(8)</p>
</div>
</div>



          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../">
              <img class="logo" src="../../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../../">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../start/intro/">Ceph 简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../start/">安装（ ceph-deploy ）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/">安装（手动）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rados/">Ceph 存储集群</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cephfs/">Ceph 文件系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rbd/">Ceph 块设备</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../radosgw/">Ceph 对象网关</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mgr/">Ceph 管理器守护进程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/">API 文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../architecture/">体系结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev/developer_guide/">开发者指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev/internals/">Ceph Internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ceph-volume/">ceph-volume</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/">Ceph 版本</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary/">Ceph 术语</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../translation_cn/">中文版翻译资源</a></li>
</ul>


<!-- ugly kludge to make genindex look like it's part of the toc -->
<ul style="margin-top: -10px"><li class="toctree-l1"><a class="reference internal" href="../../../genindex/">Index</a></li></ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../">Ceph Documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Red Hat, Inc, and contributors. Licensed under Creative Commons Attribution Share Alike 3.0 (CC-BY-SA-3.0).
    </div>
  </body>
</html>