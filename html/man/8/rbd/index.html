
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>rbd – manage rados block device (RBD) images &mdash; Ceph Documentation</title>
    
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     'dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="top" title="Ceph Documentation" href="../../../" />
    <link rel="up" title="Ceph Block Device" href="../../../rbd/rbd/" />
    <link rel="next" title="rbd-fuse – expose rbd images as files" href="../rbd-fuse/" />
    <link rel="prev" title="Block Devices and CloudStack" href="../../../rbd/rbd-cloudstack/" />
    <script type="text/javascript" src="http://ayni.ceph.com/public/js/ceph.js"></script>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../rbd-fuse/" title="rbd-fuse – expose rbd images as files"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../../../rbd/rbd-cloudstack/" title="Block Devices and CloudStack"
             accesskey="P">previous</a> |</li>
        <li><a href="../../../">Ceph Documentation</a> &raquo;</li>
          <li><a href="../../../rbd/rbd/" accesskey="U">Ceph Block Device</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="rbd-manage-rados-block-device-rbd-images">
<h1>rbd &#8211; manage rados block device (RBD) images<a class="headerlink" href="#rbd-manage-rados-block-device-rbd-images" title="Permalink to this headline">¶</a></h1>
<div class="section" id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line"><strong>rbd</strong> [ -c <em>ceph.conf</em> ] [ -m <em>monaddr</em> ] [&#8211;cluster <em>cluster-name</em>]
[ -p | &#8211;pool <em>pool</em> ] [ <em>command</em> ... ]</div>
</div>
</div>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p><strong>rbd</strong> is a utility for manipulating rados block device (RBD) images,
used by the Linux rbd driver and the rbd storage driver for QEMU/KVM.
RBD images are simple block devices that are striped over objects and
stored in a RADOS object store. The size of the objects the image is
striped over must be a power of two.</p>
</div>
<div class="section" id="options">
<h2>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-rbd-c">
<tt class="descname">-c</tt><tt class="descclassname"> ceph.conf</tt><tt class="descclassname">, </tt><tt class="descname">--conf</tt><tt class="descclassname"> ceph.conf</tt><a class="headerlink" href="#cmdoption-rbd-c" title="Permalink to this definition">¶</a></dt>
<dd><p>Use ceph.conf configuration file instead of the default /etc/ceph/ceph.conf to
determine monitor addresses during startup.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-rbd-m">
<tt class="descname">-m</tt><tt class="descclassname"> monaddress[:port]</tt><a class="headerlink" href="#cmdoption-rbd-m" title="Permalink to this definition">¶</a></dt>
<dd><p>Connect to specified monitor (instead of looking through ceph.conf).</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-rbd--cluster">
<tt class="descname">--cluster</tt><tt class="descclassname"> cluster-name</tt><a class="headerlink" href="#cmdoption-rbd--cluster" title="Permalink to this definition">¶</a></dt>
<dd><p>Use different cluster name as compared to default cluster name <em>ceph</em>.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-rbd-p">
<tt class="descname">-p</tt><tt class="descclassname"> pool-name</tt><tt class="descclassname">, </tt><tt class="descname">--pool</tt><tt class="descclassname"> pool-name</tt><a class="headerlink" href="#cmdoption-rbd-p" title="Permalink to this definition">¶</a></dt>
<dd><p>Interact with the given pool. Required by most commands.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-rbd--no-progress">
<tt class="descname">--no-progress</tt><tt class="descclassname"></tt><a class="headerlink" href="#cmdoption-rbd--no-progress" title="Permalink to this definition">¶</a></dt>
<dd><p>Do not output progress information (goes to standard error by
default for some commands).</p>
</dd></dl>

</div>
<div class="section" id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-rbd--image-format">
<tt class="descname">--image-format</tt><tt class="descclassname"> format-id</tt><a class="headerlink" href="#cmdoption-rbd--image-format" title="Permalink to this definition">¶</a></dt>
<dd><p>Specifies which object layout to use. The default is 2.</p>
<ul class="simple">
<li>format 1 - (deprecated) Use the original format for a new rbd image. This
format is understood by all versions of librbd and the kernel rbd module,
but does not support newer features like cloning.</li>
<li>format 2 - Use the second rbd format, which is supported by
librbd and kernel since version 3.11 (except for striping). This adds
support for cloning and is more easily extensible to allow more
features in the future.</li>
</ul>
</dd></dl>

<dl class="option">
<dt id="cmdoption-rbd-s">
<tt class="descname">-s</tt><tt class="descclassname"> size-in-M/G/T</tt><tt class="descclassname">, </tt><tt class="descname">--size</tt><tt class="descclassname"> size-in-M/G/T</tt><a class="headerlink" href="#cmdoption-rbd-s" title="Permalink to this definition">¶</a></dt>
<dd><p>Specifies the size of the new rbd image or the new size of the existing rbd
image in M/G/T.  If no suffix is given, unit M is assumed.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-rbd--object-size">
<tt class="descname">--object-size</tt><tt class="descclassname"> size-in-B/K/M</tt><a class="headerlink" href="#cmdoption-rbd--object-size" title="Permalink to this definition">¶</a></dt>
<dd><p>Specifies the object size in B/K/M.  Object size will be rounded up the
nearest power of two; if no suffix is given, unit B is assumed.  The default
object size is 4M, smallest is 4K and maximum is 32M.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-rbd--stripe-unit">
<tt class="descname">--stripe-unit</tt><tt class="descclassname"> size-in-B/K/M</tt><a class="headerlink" href="#cmdoption-rbd--stripe-unit" title="Permalink to this definition">¶</a></dt>
<dd><p>Specifies the stripe unit size in B/K/M.  If no suffix is given, unit B is
assumed.  See striping section (below) for more details.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-rbd--stripe-count">
<tt class="descname">--stripe-count</tt><tt class="descclassname"> num</tt><a class="headerlink" href="#cmdoption-rbd--stripe-count" title="Permalink to this definition">¶</a></dt>
<dd><p>Specifies the number of objects to stripe over before looping back
to the first object.  See striping section (below) for more details.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-rbd--snap">
<tt class="descname">--snap</tt><tt class="descclassname"> snap</tt><a class="headerlink" href="#cmdoption-rbd--snap" title="Permalink to this definition">¶</a></dt>
<dd><p>Specifies the snapshot name for the specific operation.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-rbd--id">
<tt class="descname">--id</tt><tt class="descclassname"> username</tt><a class="headerlink" href="#cmdoption-rbd--id" title="Permalink to this definition">¶</a></dt>
<dd><p>Specifies the username (without the <tt class="docutils literal"><span class="pre">client.</span></tt> prefix) to use with the map command.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-rbd--keyring">
<tt class="descname">--keyring</tt><tt class="descclassname"> filename</tt><a class="headerlink" href="#cmdoption-rbd--keyring" title="Permalink to this definition">¶</a></dt>
<dd><p>Specifies a keyring file containing a secret for the specified user
to use with the map command.  If not specified, the default keyring
locations will be searched.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-rbd--keyfile">
<tt class="descname">--keyfile</tt><tt class="descclassname"> filename</tt><a class="headerlink" href="#cmdoption-rbd--keyfile" title="Permalink to this definition">¶</a></dt>
<dd><p>Specifies a file containing the secret key of <tt class="docutils literal"><span class="pre">--id</span> <span class="pre">user</span></tt> to use with the map command.
This option is overridden by <tt class="docutils literal"><span class="pre">--keyring</span></tt> if the latter is also specified.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-rbd--shared">
<tt class="descname">--shared</tt><tt class="descclassname"> lock-tag</tt><a class="headerlink" href="#cmdoption-rbd--shared" title="Permalink to this definition">¶</a></dt>
<dd><p>Option for <cite>lock add</cite> that allows multiple clients to lock the
same image if they use the same tag. The tag is an arbitrary
string. This is useful for situations where an image must
be open from more than one client at once, like during
live migration of a virtual machine, or for use underneath
a clustered filesystem.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-rbd--format">
<tt class="descname">--format</tt><tt class="descclassname"> format</tt><a class="headerlink" href="#cmdoption-rbd--format" title="Permalink to this definition">¶</a></dt>
<dd><p>Specifies output formatting (default: plain, json, xml)</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-rbd--pretty-format">
<tt class="descname">--pretty-format</tt><tt class="descclassname"></tt><a class="headerlink" href="#cmdoption-rbd--pretty-format" title="Permalink to this definition">¶</a></dt>
<dd><p>Make json or xml formatted output more human-readable.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-rbd-o">
<tt class="descname">-o</tt><tt class="descclassname"> krbd-options</tt><tt class="descclassname">, </tt><tt class="descname">--options</tt><tt class="descclassname"> krbd-options</tt><a class="headerlink" href="#cmdoption-rbd-o" title="Permalink to this definition">¶</a></dt>
<dd><p>Specifies which options to use when mapping or unmapping an image via the
rbd kernel driver.  krbd-options is a comma-separated list of options
(similar to mount(8) mount options).  See kernel rbd (krbd) options section
below for more details.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-rbd--read-only">
<tt class="descname">--read-only</tt><tt class="descclassname"></tt><a class="headerlink" href="#cmdoption-rbd--read-only" title="Permalink to this definition">¶</a></dt>
<dd><p>Map the image read-only.  Equivalent to -o ro.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-rbd--image-feature">
<tt class="descname">--image-feature</tt><tt class="descclassname"> feature-name</tt><a class="headerlink" href="#cmdoption-rbd--image-feature" title="Permalink to this definition">¶</a></dt>
<dd><p>Specifies which RBD format 2 feature should be enabled when creating
an image. Multiple features can be enabled by repeating this option
multiple times. The following features are supported:</p>
<ul class="simple">
<li>layering: layering support</li>
<li>striping: striping v2 support</li>
<li>exclusive-lock: exclusive locking support</li>
<li>object-map: object map support (requires exclusive-lock)</li>
<li>fast-diff: fast diff calculations (requires object-map)</li>
<li>deep-flatten: snapshot flatten support</li>
<li>journaling: journaled IO support (requires exclusive-lock)</li>
</ul>
</dd></dl>

<dl class="option">
<dt id="cmdoption-rbd--image-shared">
<tt class="descname">--image-shared</tt><tt class="descclassname"></tt><a class="headerlink" href="#cmdoption-rbd--image-shared" title="Permalink to this definition">¶</a></dt>
<dd><p>Specifies that the image will be used concurrently by multiple clients.
This will disable features that are dependent upon exclusive ownership
of the image.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-rbd--whole-object">
<tt class="descname">--whole-object</tt><tt class="descclassname"></tt><a class="headerlink" href="#cmdoption-rbd--whole-object" title="Permalink to this definition">¶</a></dt>
<dd><p>Specifies that the diff should be limited to the extents of a full object
instead of showing intra-object deltas. When the object map feature is
enabled on an image, limiting the diff to the object extents will
dramatically improve performance since the differences can be computed
by examining the in-memory object map instead of querying RADOS for each
object within the image.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-rbd--limit">
<tt class="descname">--limit</tt><tt class="descclassname"></tt><a class="headerlink" href="#cmdoption-rbd--limit" title="Permalink to this definition">¶</a></dt>
<dd><p>Specifies the limit for the number of snapshots permitted.</p>
</dd></dl>

</div>
<div class="section" id="commands">
<h2>Commands<a class="headerlink" href="#commands" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt><strong class="command">ls</strong> [-l | &#8211;long] [<em>pool-name</em>]</dt>
<dd>Will list all rbd images listed in the rbd_directory object.  With
-l, also show snapshots, and use longer-format output including
size, parent (if clone), format, etc.</dd>
<dt><strong class="command">du</strong> [-p | &#8211;pool <em>pool-name</em>] [<em>image-spec</em> | <em>snap-spec</em>]</dt>
<dd><p class="first">Will calculate the provisioned and actual disk usage of all images and
associated snapshots within the specified pool.  It can also be used against
individual images and snapshots.</p>
<p class="last">If the RBD fast-diff feature isn&#8217;t enabled on images, this operation will
require querying the OSDs for every potential object within the image.</p>
</dd>
<dt><strong class="command">info</strong> <em>image-spec</em> | <em>snap-spec</em></dt>
<dd>Will dump information (such as size and object size) about a specific rbd image.
If image is a clone, information about its parent is also displayed.
If a snapshot is specified, whether it is protected is shown as well.</dd>
<dt><strong class="command">create</strong> (-s | &#8211;size <em>size-in-M/G/T</em>) [&#8211;image-format <em>format-id</em>] [&#8211;object-size <em>size-in-B/K/M</em>] [&#8211;stripe-unit <em>size-in-B/K/M</em> &#8211;stripe-count <em>num</em>] [&#8211;image-feature <em>feature-name</em>]... [&#8211;image-shared] <em>image-spec</em></dt>
<dd>Will create a new rbd image. You must also specify the size via &#8211;size.  The
&#8211;stripe-unit and &#8211;stripe-count arguments are optional, but must be used together.</dd>
<dt><strong class="command">clone</strong> [&#8211;object-size <em>size-in-B/K/M</em>] [&#8211;stripe-unit <em>size-in-B/K/M</em> &#8211;stripe-count <em>num</em>] [&#8211;image-feature <em>feature-name</em>] [&#8211;image-shared] <em>parent-snap-spec</em> <em>child-image-spec</em></dt>
<dd><p class="first">Will create a clone (copy-on-write child) of the parent snapshot.
Object size will be identical to that of the parent image unless
specified. Size will be the same as the parent snapshot. The &#8211;stripe-unit
and &#8211;stripe-count arguments are optional, but must be used together.</p>
<p class="last">The parent snapshot must be protected (see <cite>rbd snap protect</cite>).
This requires image format 2.</p>
</dd>
<dt><strong class="command">flatten</strong> <em>image-spec</em></dt>
<dd><p class="first">If image is a clone, copy all shared blocks from the parent snapshot and
make the child independent of the parent, severing the link between
parent snap and child.  The parent snapshot can be unprotected and
deleted if it has no further dependent clones.</p>
<p class="last">This requires image format 2.</p>
</dd>
<dt><strong class="command">children</strong> <em>snap-spec</em></dt>
<dd><p class="first">List the clones of the image at the given snapshot. This checks
every pool, and outputs the resulting poolname/imagename.</p>
<p class="last">This requires image format 2.</p>
</dd>
<dt><strong class="command">resize</strong> (-s | &#8211;size <em>size-in-M/G/T</em>) [&#8211;allow-shrink] <em>image-spec</em></dt>
<dd>Resizes rbd image. The size parameter also needs to be specified.
The &#8211;allow-shrink option lets the size be reduced.</dd>
<dt><strong class="command">rm</strong> <em>image-spec</em></dt>
<dd>Deletes an rbd image (including all data blocks). If the image has
snapshots, this fails and nothing is deleted.</dd>
<dt><strong class="command">export</strong> [&#8211;export-format <em>format (1 or 2)</em>] (<em>image-spec</em> | <em>snap-spec</em>) [<em>dest-path</em>]</dt>
<dd>Exports image to dest path (use - for stdout).
The &#8211;export-format accepts &#8216;1&#8217; or &#8216;2&#8217; currently. Format 2 allow us to export not only the content
of image, but also the snapshots and other properties, such as image_order, features.</dd>
<dt><strong class="command">import</strong> [&#8211;export-format <em>format (1 or 2)</em>] [&#8211;image-format <em>format-id</em>] [&#8211;object-size <em>size-in-B/K/M</em>] [&#8211;stripe-unit <em>size-in-B/K/M</em> &#8211;stripe-count <em>num</em>] [&#8211;image-feature <em>feature-name</em>]... [&#8211;image-shared] <em>src-path</em> [<em>image-spec</em>]</dt>
<dd><p class="first">Creates a new image and imports its data from path (use - for
stdin).  The import operation will try to create sparse rbd images
if possible.  For import from stdin, the sparsification unit is
the data block size of the destination image (object size).</p>
<p>The &#8211;stripe-unit and &#8211;stripe-count arguments are optional, but must be
used together.</p>
<p class="last">The &#8211;export-format accepts &#8216;1&#8217; or &#8216;2&#8217; currently. Format 2 allow us to import not only the content
of image, but also the snapshots and other properties, such as image_order, features.</p>
</dd>
<dt><strong class="command">export-diff</strong> [&#8211;from-snap <em>snap-name</em>] [&#8211;whole-object] (<em>image-spec</em> | <em>snap-spec</em>) <em>dest-path</em></dt>
<dd>Exports an incremental diff for an image to dest path (use - for stdout).  If
an initial snapshot is specified, only changes since that snapshot are included; otherwise,
any regions of the image that contain data are included.  The end snapshot is specified
using the standard &#8211;snap option or &#64;snap syntax (see below).  The image diff format includes
metadata about image size changes, and the start and end snapshots.  It efficiently represents
discarded or &#8216;zero&#8217; regions of the image.</dd>
<dt><strong class="command">merge-diff</strong> <em>first-diff-path</em> <em>second-diff-path</em> <em>merged-diff-path</em></dt>
<dd>Merge two continuous incremental diffs of an image into one single diff. The
first diff&#8217;s end snapshot must be equal with the second diff&#8217;s start snapshot.
The first diff could be - for stdin, and merged diff could be - for stdout, which
enables multiple diff files to be merged using something like
&#8216;rbd merge-diff first second - | rbd merge-diff - third result&#8217;. Note this command
currently only support the source incremental diff with stripe_count == 1</dd>
<dt><strong class="command">import-diff</strong> <em>src-path</em> <em>image-spec</em></dt>
<dd>Imports an incremental diff of an image and applies it to the current image.  If the diff
was generated relative to a start snapshot, we verify that snapshot already exists before
continuing.  If there was an end snapshot we verify it does not already exist before
applying the changes, and create the snapshot when we are done.</dd>
<dt><strong class="command">diff</strong> [&#8211;from-snap <em>snap-name</em>] [&#8211;whole-object] <em>image-spec</em> | <em>snap-spec</em></dt>
<dd>Dump a list of byte extents in the image that have changed since the specified start
snapshot, or since the image was created.  Each output line includes the starting offset
(in bytes), the length of the region (in bytes), and either &#8216;zero&#8217; or &#8216;data&#8217; to indicate
whether the region is known to be zeros or may contain other data.</dd>
<dt><strong class="command">cp</strong> (<em>src-image-spec</em> | <em>src-snap-spec</em>) <em>dest-image-spec</em></dt>
<dd>Copies the content of a src-image into the newly created dest-image.
dest-image will have the same size, object size, and image format as src-image.</dd>
<dt><strong class="command">mv</strong> <em>src-image-spec</em> <em>dest-image-spec</em></dt>
<dd>Renames an image.  Note: rename across pools is not supported.</dd>
<dt><strong class="command">image-meta list</strong> <em>image-spec</em></dt>
<dd>Show metadata held on the image. The first column is the key
and the second column is the value.</dd>
<dt><strong class="command">image-meta get</strong> <em>image-spec</em> <em>key</em></dt>
<dd>Get metadata value with the key.</dd>
<dt><strong class="command">image-meta set</strong> <em>image-spec</em> <em>key</em> <em>value</em></dt>
<dd>Set metadata key with the value. They will displayed in <cite>image-meta list</cite>.</dd>
<dt><strong class="command">image-meta remove</strong> <em>image-spec</em> <em>key</em></dt>
<dd>Remove metadata key with the value.</dd>
<dt><strong class="command">object-map rebuild</strong> <em>image-spec</em> | <em>snap-spec</em></dt>
<dd>Rebuilds an invalid object map for the specified image. An image snapshot can be
specified to rebuild an invalid object map for a snapshot.</dd>
<dt><strong class="command">snap ls</strong> <em>image-spec</em></dt>
<dd>Dumps the list of snapshots inside a specific image.</dd>
<dt><strong class="command">snap create</strong> <em>snap-spec</em></dt>
<dd>Creates a new snapshot. Requires the snapshot name parameter specified.</dd>
<dt><strong class="command">snap rollback</strong> <em>snap-spec</em></dt>
<dd>Rollback image content to snapshot. This will iterate through the entire blocks
array and update the data head content to the snapshotted version.</dd>
<dt><strong class="command">snap rm</strong> [&#8211;force] <em>snap-spec</em></dt>
<dd>Removes the specified snapshot.</dd>
<dt><strong class="command">snap purge</strong> <em>image-spec</em></dt>
<dd>Removes all snapshots from an image.</dd>
<dt><strong class="command">snap protect</strong> <em>snap-spec</em></dt>
<dd><p class="first">Protect a snapshot from deletion, so that clones can be made of it
(see <cite>rbd clone</cite>).  Snapshots must be protected before clones are made;
protection implies that there exist dependent cloned children that
refer to this snapshot.  <cite>rbd clone</cite> will fail on a nonprotected
snapshot.</p>
<p class="last">This requires image format 2.</p>
</dd>
<dt><strong class="command">snap unprotect</strong> <em>snap-spec</em></dt>
<dd><p class="first">Unprotect a snapshot from deletion (undo <cite>snap protect</cite>).  If cloned
children remain, <cite>snap unprotect</cite> fails.  (Note that clones may exist
in different pools than the parent snapshot.)</p>
<p class="last">This requires image format 2.</p>
</dd>
<dt><strong class="command">snap limit set</strong> [&#8211;limit] <em>limit</em> <em>image-spec</em></dt>
<dd>Set a limit for the number of snapshots allowed on an image.</dd>
<dt><strong class="command">snap limit clear</strong> <em>image-spec</em></dt>
<dd>Remove any previously set limit on the number of snapshots allowed on
an image.</dd>
<dt><strong class="command">map</strong> [-o | &#8211;options <em>krbd-options</em> ] [&#8211;read-only] <em>image-spec</em> | <em>snap-spec</em></dt>
<dd>Maps the specified image to a block device via the rbd kernel module.</dd>
<dt><strong class="command">unmap</strong> [-o | &#8211;options <em>krbd-options</em> ] <em>image-spec</em> | <em>snap-spec</em> | <em>device-path</em></dt>
<dd>Unmaps the block device that was mapped via the rbd kernel module.</dd>
<dt><strong class="command">showmapped</strong></dt>
<dd>Show the rbd images that are mapped via the rbd kernel module.</dd>
<dt><strong class="command">nbd map</strong> [&#8211;device <em>device-path</em>] [&#8211;read-only] <em>image-spec</em> | <em>snap-spec</em></dt>
<dd>Maps the specified image to a block device via the rbd-nbd tool.</dd>
<dt><strong class="command">nbd unmap</strong> <em>device-path</em></dt>
<dd>Unmaps the block device that was mapped via the rbd-nbd tool.</dd>
<dt><strong class="command">nbd list</strong></dt>
<dd>Show the list of used nbd devices via the rbd-nbd tool.</dd>
<dt><strong class="command">status</strong> <em>image-spec</em></dt>
<dd>Show the status of the image, including which clients have it open.</dd>
<dt><strong class="command">feature disable</strong> <em>image-spec</em> <em>feature-name</em>...</dt>
<dd>Disables the specified feature on the specified image. Multiple features can
be specified.</dd>
<dt><strong class="command">feature enable</strong> <em>image-spec</em> <em>feature-name</em>...</dt>
<dd>Enables the specified feature on the specified image. Multiple features can
be specified.</dd>
<dt><strong class="command">lock list</strong> <em>image-spec</em></dt>
<dd>Show locks held on the image. The first column is the locker
to use with the <cite>lock remove</cite> command.</dd>
<dt><strong class="command">lock add</strong> [&#8211;shared <em>lock-tag</em>] <em>image-spec</em> <em>lock-id</em></dt>
<dd>Lock an image. The lock-id is an arbitrary name for the user&#8217;s
convenience. By default, this is an exclusive lock, meaning it
will fail if the image is already locked. The &#8211;shared option
changes this behavior. Note that locking does not affect
any operation other than adding a lock. It does not
protect an image from being deleted.</dd>
<dt><strong class="command">lock remove</strong> <em>image-spec</em> <em>lock-id</em> <em>locker</em></dt>
<dd>Release a lock on an image. The lock id and locker are
as output by lock ls.</dd>
<dt><strong class="command">bench</strong> &#8211;io-type &lt;read | write&gt; [&#8211;io-size <em>size-in-B/K/M/G/T</em>] [&#8211;io-threads <em>num-ios-in-flight</em>] [&#8211;io-total <em>size-in-B/K/M/G/T</em>] [&#8211;io-pattern seq | rand] <em>image-spec</em></dt>
<dd>Generate a series of IOs to the image and measure the IO throughput and
latency.  If no suffix is given, unit B is assumed for both &#8211;io-size and
&#8211;io-total.  Defaults are: &#8211;io-size 4096, &#8211;io-threads 16, &#8211;io-total 1G,
&#8211;io-pattern seq.</dd>
</dl>
</div>
<div class="section" id="image-and-snap-specs">
<h2>Image and snap specs<a class="headerlink" href="#image-and-snap-specs" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line"><em>image-spec</em> is [<em>pool-name</em>]/<em>image-name</em></div>
<div class="line"><em>snap-spec</em>  is [<em>pool-name</em>]/<em>image-name</em>&#64;<em>snap-name</em></div>
</div>
<p>The default for <em>pool-name</em> is &#8220;rbd&#8221;.  If an image name contains a slash
character (&#8216;/&#8217;), <em>pool-name</em> is required.</p>
<p>You may specify each name individually, using &#8211;pool, &#8211;image and &#8211;snap
options, but this is discouraged in favor of the above spec syntax.</p>
</div>
<div class="section" id="striping">
<h2>Striping<a class="headerlink" href="#striping" title="Permalink to this headline">¶</a></h2>
<p>RBD images are striped over many objects, which are then stored by the
Ceph distributed object store (RADOS).  As a result, read and write
requests for the image are distributed across many nodes in the
cluster, generally preventing any single node from becoming a
bottleneck when individual images get large or busy.</p>
<p>The striping is controlled by three parameters:</p>
<dl class="option">
<dt id="cmdoption-rbd-size">
<tt class="descname">-size</tt><tt class="descclassname"></tt><a class="headerlink" href="#cmdoption-rbd-size" title="Permalink to this definition">¶</a></dt>
<dd><p>The size of objects we stripe over is a power of two. It will be rounded up the nearest power of two.
The default object size is 4 MB, smallest is 4K and maximum is 32M.</p>
</dd></dl>

<dl class="option">
<dt>
<tt class="descname">stripe_unit</tt></dt>
<dd><p>Each [<em>stripe_unit</em>] contiguous bytes are stored adjacently in the same object, before we move on
to the next object.</p>
</dd></dl>

<dl class="option">
<dt>
<tt class="descname">stripe_count</tt></dt>
<dd><p>After we write [<em>stripe_unit</em>] bytes to [<em>stripe_count</em>] objects, we loop back to the initial object
and write another stripe, until the object reaches its maximum size.  At that point,
we move on to the next [<em>stripe_count</em>] objects.</p>
</dd></dl>

<p>By default, [<em>stripe_unit</em>] is the same as the object size and [<em>stripe_count</em>] is 1.  Specifying a different
[<em>stripe_unit</em>] requires that the STRIPINGV2 feature be supported (added in Ceph v0.53) and format 2 images be
used.</p>
</div>
<div class="section" id="kernel-rbd-krbd-options">
<h2>Kernel rbd (krbd) options<a class="headerlink" href="#kernel-rbd-krbd-options" title="Permalink to this headline">¶</a></h2>
<p>Most of these options are useful mainly for debugging and benchmarking.  The
default values are set in the kernel and may therefore depend on the version of
the running kernel.</p>
<p>Per client instance <cite>rbd map</cite> options:</p>
<ul class="simple">
<li>fsid=aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee - FSID that should be assumed by
the client.</li>
<li>ip=a.b.c.d[:p] - IP and, optionally, port the client should use.</li>
<li>share - Enable sharing of client instances with other mappings (default).</li>
<li>noshare - Disable sharing of client instances with other mappings.</li>
<li>crc - Enable CRC32C checksumming for data writes (default).</li>
<li>nocrc - Disable CRC32C checksumming for data writes.</li>
<li>cephx_require_signatures - Require cephx message signing (since 3.19,
default).</li>
<li>nocephx_require_signatures - Don&#8217;t require cephx message signing (since
3.19).</li>
<li>tcp_nodelay - Disable Nagle&#8217;s algorithm on client sockets (since 4.0,
default).</li>
<li>notcp_nodelay - Enable Nagle&#8217;s algorithm on client sockets (since 4.0).</li>
<li>cephx_sign_messages - Enable message signing (since 4.4, default).</li>
<li>nocephx_sign_messages - Disable message signing (since 4.4).</li>
<li>mount_timeout=x - A timeout on various steps in <cite>rbd map</cite> and <cite>rbd unmap</cite>
sequences (default is 60 seconds).  In particular, since 4.2 this can be used
to ensure that <cite>rbd unmap</cite> eventually times out when there is no network
connection to a cluster.</li>
<li>osdkeepalive=x - OSD keepalive timeout (default is 5 seconds).</li>
<li>osd_idle_ttl=x - OSD idle TTL (default is 60 seconds).</li>
</ul>
<p>Per mapping (block device) <cite>rbd map</cite> options:</p>
<ul class="simple">
<li>rw - Map the image read-write (default).</li>
<li>ro - Map the image read-only.  Equivalent to &#8211;read-only.</li>
<li>queue_depth=x - queue depth (since 4.2, default is 128 requests).</li>
<li>lock_on_read - Acquire exclusive lock on reads, in addition to writes and
discards (since 4.9).</li>
<li>exclusive - Disable automatic exclusive lock transitions (since 4.12).</li>
</ul>
<p><cite>rbd unmap</cite> options:</p>
<ul class="simple">
<li>force - Force the unmapping of a block device that is open (since 4.9).  The
driver will wait for running requests to complete and then unmap; requests
sent to the driver after initiating the unmap will be failed.</li>
</ul>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>To create a new rbd image that is 100 GB:</p>
<div class="highlight-python"><pre>rbd create mypool/myimage --size 102400</pre>
</div>
<p>To use a non-default object size (8 MB):</p>
<div class="highlight-python"><pre>rbd create mypool/myimage --size 102400 --object-size 8M</pre>
</div>
<p>To delete an rbd image (be careful!):</p>
<div class="highlight-python"><pre>rbd rm mypool/myimage</pre>
</div>
<p>To create a new snapshot:</p>
<div class="highlight-python"><pre>rbd snap create mypool/myimage@mysnap</pre>
</div>
<p>To create a copy-on-write clone of a protected snapshot:</p>
<div class="highlight-python"><pre>rbd clone mypool/myimage@mysnap otherpool/cloneimage</pre>
</div>
<p>To see which clones of a snapshot exist:</p>
<div class="highlight-python"><pre>rbd children mypool/myimage@mysnap</pre>
</div>
<p>To delete a snapshot:</p>
<div class="highlight-python"><pre>rbd snap rm mypool/myimage@mysnap</pre>
</div>
<p>To map an image via the kernel with cephx enabled:</p>
<div class="highlight-python"><pre>rbd map mypool/myimage --id admin --keyfile secretfile</pre>
</div>
<p>To map an image via the kernel with different cluster name other than default <em>ceph</em>:</p>
<div class="highlight-python"><pre>rbd map mypool/myimage --cluster cluster-name</pre>
</div>
<p>To unmap an image:</p>
<div class="highlight-python"><pre>rbd unmap /dev/rbd0</pre>
</div>
<p>To create an image and a clone from it:</p>
<div class="highlight-python"><pre>rbd import --image-format 2 image mypool/parent
rbd snap create mypool/parent@snap
rbd snap protect mypool/parent@snap
rbd clone mypool/parent@snap otherpool/child</pre>
</div>
<p>To create an image with a smaller stripe_unit (to better distribute small writes in some workloads):</p>
<div class="highlight-python"><pre>rbd create mypool/myimage --size 102400 --stripe-unit 65536B --stripe-count 16</pre>
</div>
<p>To change an image from one image format to another, export it and then
import it as the desired image format:</p>
<div class="highlight-python"><pre>rbd export mypool/myimage@snap /tmp/img
rbd import --image-format 2 /tmp/img mypool/myimage2</pre>
</div>
<p>To lock an image for exclusive use:</p>
<div class="highlight-python"><pre>rbd lock add mypool/myimage mylockid</pre>
</div>
<p>To release a lock:</p>
<div class="highlight-python"><pre>rbd lock remove mypool/myimage mylockid client.2485</pre>
</div>
</div>
<div class="section" id="availability">
<h2>Availability<a class="headerlink" href="#availability" title="Permalink to this headline">¶</a></h2>
<p><strong>rbd</strong> is part of Ceph, a massively scalable, open-source, distributed storage system. Please refer to
the Ceph documentation at <a class="reference external" href="http://ceph.com/docs">http://ceph.com/docs</a> for more information.</p>
</div>
<div class="section" id="see-also">
<h2>See also<a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../ceph/"><em>ceph</em></a>(8),
<a class="reference internal" href="../rados/"><em>rados</em></a>(8)</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../">
              <img class="logo" src="../../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../../">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../start/intro/">Intro to Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../start/">Installation (Quick)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/">Installation (Manual)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rados/">Ceph Storage Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cephfs/">Ceph Filesystem</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../rbd/rbd/">Ceph Block Device</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../rbd/rados-rbd-cmds/">Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../rbd/rbd-ko/">Kernel Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../rbd/rbd-snapshot/">Snapshots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../rbd/rbd-mirroring/">Mirroring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../rbd/qemu-rbd/">QEMU</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../rbd/libvirt/">libvirt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../rbd/rbd-config-ref/">Cache Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../rbd/rbd-openstack/">OpenStack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../rbd/rbd-cloudstack/">CloudStack</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Manpage rbd</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#synopsis">Synopsis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#description">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#options">Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parameters">Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#commands">Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="#image-and-snap-specs">Image and snap specs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#striping">Striping</a></li>
<li class="toctree-l3"><a class="reference internal" href="#kernel-rbd-krbd-options">Kernel rbd (krbd) options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#examples">Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#availability">Availability</a></li>
<li class="toctree-l3"><a class="reference internal" href="#see-also">See also</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../rbd-fuse/">Manpage rbd-fuse</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rbd-nbd/">Manpage rbd-nbd</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ceph-rbdnamer/">Manpage ceph-rbdnamer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../rbd/rbd-replay/">RBD Replay</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rbd-replay-prep/">Manpage rbd-replay-prep</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rbd-replay/">Manpage rbd-replay</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rbd-replay-many/">Manpage rbd-replay-many</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rbdmap/">Manpage rbdmap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../rbd/librbdpy/">librbd</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../radosgw/">Ceph Object Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mgr/">Ceph Manager Daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../architecture/">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev/">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release-notes/">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/">Ceph Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary/">Glossary</a></li>
</ul>


<!-- ugly kludge to make genindex look like it's part of the toc -->
<ul style="margin-top: -10px"><li class="toctree-l1"><a class="reference internal" href="../../../genindex/">Index</a></li></ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../rbd-fuse/" title="rbd-fuse – expose rbd images as files"
             >next</a> |</li>
        <li class="right" >
          <a href="../../../rbd/rbd-cloudstack/" title="Block Devices and CloudStack"
             >previous</a> |</li>
        <li><a href="../../../">Ceph Documentation</a> &raquo;</li>
          <li><a href="../../../rbd/rbd/" >Ceph Block Device</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2016, Red Hat, Inc, and contributors. Licensed under Creative Commons BY-SA.
    </div>
  </body>
</html>