
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>rbdmap – map RBD devices at boot time &mdash; Ceph Documentation</title>
    
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     'dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="top" title="Ceph Documentation" href="../../../" />
    <link rel="up" title="Ceph Block Device" href="../../../rbd/rbd/" />
    <link rel="next" title="Librbd (Python)" href="../../../rbd/librbdpy/" />
    <link rel="prev" title="rbd-replay-many – replay a rados block device (RBD) workload on several clients" href="../rbd-replay-many/" />
    <script type="text/javascript" src="http://ayni.ceph.com/public/js/ceph.js"></script>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../../rbd/librbdpy/" title="Librbd (Python)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../rbd-replay-many/" title="rbd-replay-many – replay a rados block device (RBD) workload on several clients"
             accesskey="P">previous</a> |</li>
        <li><a href="../../../">Ceph Documentation</a> &raquo;</li>
          <li><a href="../../../rbd/rbd/" accesskey="U">Ceph Block Device</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="rbdmap-map-rbd-devices-at-boot-time">
<h1>rbdmap &#8211; map RBD devices at boot time<a class="headerlink" href="#rbdmap-map-rbd-devices-at-boot-time" title="Permalink to this headline">¶</a></h1>
<div class="section" id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line"><strong>rbdmap map</strong></div>
<div class="line"><strong>rbdmap unmap</strong></div>
</div>
</div>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p><strong>rbdmap</strong> is a shell script that automates <tt class="docutils literal"><span class="pre">rbd</span> <span class="pre">map</span></tt> and <tt class="docutils literal"><span class="pre">rbd</span> <span class="pre">unmap</span></tt>
operations on one or more RBD (RADOS Block Device) images. While the script can be
run manually by the system administrator at any time, the principal use case is
automatic mapping/mounting of RBD images at boot time (and unmounting/unmapping
at shutdown), as triggered by the init system (a systemd unit file,
<tt class="docutils literal"><span class="pre">rbdmap.service</span></tt> is included with the ceph-common package for this purpose).</p>
<p>The script takes a single argument, which can be either &#8220;map&#8221; or &#8220;unmap&#8221;.
In either case, the script parses a configuration file (defaults to <tt class="docutils literal"><span class="pre">/etc/ceph/rbdmap</span></tt>,
but can be overridden via an environment variable <tt class="docutils literal"><span class="pre">RBDMAPFILE</span></tt>). Each line
of the configuration file corresponds to an RBD image which is to be mapped, or
unmapped.</p>
<p>The configuration file format is:</p>
<div class="highlight-python"><pre>IMAGESPEC RBDOPTS</pre>
</div>
<p>where <tt class="docutils literal"><span class="pre">IMAGESPEC</span></tt> should be specified as <tt class="docutils literal"><span class="pre">POOLNAME/IMAGENAME</span></tt> (the pool
name, a forward slash, and the image name), or merely <tt class="docutils literal"><span class="pre">IMAGENAME</span></tt>, in which
case the <tt class="docutils literal"><span class="pre">POOLNAME</span></tt> defaults to &#8220;rbd&#8221;. <tt class="docutils literal"><span class="pre">RBDOPTS</span></tt> is an optional list of
parameters to be passed to the underlying <tt class="docutils literal"><span class="pre">rbd</span> <span class="pre">map</span></tt> command. These parameters
and their values should be specified as a comma-separated string:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">PARAM1</span><span class="o">=</span><span class="n">VAL1</span><span class="p">,</span><span class="n">PARAM2</span><span class="o">=</span><span class="n">VAL2</span><span class="p">,</span><span class="o">...</span><span class="p">,</span><span class="n">PARAMN</span><span class="o">=</span><span class="n">VALN</span>
</pre></div>
</div>
<p>This will cause the script to issue an <tt class="docutils literal"><span class="pre">rbd</span> <span class="pre">map</span></tt> command like the following:</p>
<div class="highlight-python"><pre>rbd map POOLNAME/IMAGENAME --PARAM1 VAL1 --PARAM2 VAL2</pre>
</div>
<p>(See the <tt class="docutils literal"><span class="pre">rbd</span></tt> manpage for a full list of possible options.)</p>
<p>When run as <tt class="docutils literal"><span class="pre">rbdmap</span> <span class="pre">map</span></tt>, the script parses the configuration file, and for
each RBD image specified attempts to first map the image (using the <tt class="docutils literal"><span class="pre">rbd</span> <span class="pre">map</span></tt>
command) and, second, to mount the image.</p>
<p>When run as <tt class="docutils literal"><span class="pre">rbdmap</span> <span class="pre">unmap</span></tt>, images listed in the configuration file will
be unmounted and unmapped.</p>
<p><tt class="docutils literal"><span class="pre">rbdmap</span> <span class="pre">unmap-all</span></tt> attempts to unmount and subsequently unmap all currently
mapped RBD images, regardless of whether or not they&#8217;re listed in the
configuration file.</p>
<p>If successful, the <tt class="docutils literal"><span class="pre">rbd</span> <span class="pre">map</span></tt> operation maps the image to a <tt class="docutils literal"><span class="pre">/dev/rbdX</span></tt>
device, at which point a udev rule is triggered to create a friendly device
name symlink, <tt class="docutils literal"><span class="pre">/dev/rbd/POOLNAME/IMAGENAME</span></tt>, pointing to the real mapped
device.</p>
<p>In order for mounting/unmounting to succeed, the friendly device name must
have a corresponding entry in <tt class="docutils literal"><span class="pre">/etc/fstab</span></tt>.</p>
<p>When writing <tt class="docutils literal"><span class="pre">/etc/fstab</span></tt> entries for RBD images, it&#8217;s a good idea to specify
the &#8220;noauto&#8221; (or &#8220;nofail&#8221;) mount option. This prevents the init system from
trying to mount the device too early - before the device in question even
exists. (Since <tt class="docutils literal"><span class="pre">rbdmap.service</span></tt>
executes a shell script, it is typically triggered quite late in the boot
sequence.)</p>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>Example <tt class="docutils literal"><span class="pre">/etc/ceph/rbdmap</span></tt> for two RBD images called &#8220;bar1&#8221; and &#8220;bar2&#8221;, both
in pool &#8220;foopool&#8221;:</p>
<div class="highlight-python"><pre>foopool/bar1    id=admin,keyring=/etc/ceph/ceph.client.admin.keyring
foopool/bar2    id=admin,keyring=/etc/ceph/ceph.client.admin.keyring</pre>
</div>
<p>Each line in the file contains two strings: the image spec and the options to
be passed to <tt class="docutils literal"><span class="pre">rbd</span> <span class="pre">map</span></tt>. These two lines get transformed into the following
commands:</p>
<div class="highlight-python"><pre>rbd map foopool/bar1 --id admin --keyring /etc/ceph/ceph.client.admin.keyring
rbd map foopool/bar2 --id admin --keyring /etc/ceph/ceph.client.admin.keyring</pre>
</div>
<p>If the images had XFS filesystems on them, the corresponding <tt class="docutils literal"><span class="pre">/etc/fstab</span></tt>
entries might look like this:</p>
<div class="highlight-python"><pre>/dev/rbd/foopool/bar1 /mnt/bar1 xfs noauto 0 0
/dev/rbd/foopool/bar2 /mnt/bar2 xfs noauto 0 0</pre>
</div>
<p>After creating the images and populating the <tt class="docutils literal"><span class="pre">/etc/ceph/rbdmap</span></tt> file, making
the images get automatically mapped and mounted at boot is just a matter of
enabling that unit:</p>
<div class="highlight-python"><pre>systemctl enable rbdmap.service</pre>
</div>
</div>
<div class="section" id="options">
<h2>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h2>
<p>None</p>
</div>
<div class="section" id="availability">
<h2>Availability<a class="headerlink" href="#availability" title="Permalink to this headline">¶</a></h2>
<p><strong>rbdmap</strong> is part of Ceph, a massively scalable, open-source, distributed
storage system. Please refer to the Ceph documentation at
<a class="reference external" href="http://ceph.com/docs">http://ceph.com/docs</a> for more information.</p>
</div>
<div class="section" id="see-also">
<h2>See also<a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../rbd/"><em>rbd</em></a>(8),</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../">
              <img class="logo" src="../../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../../">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../start/intro/">Intro to Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../start/">Installation (Quick)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/">Installation (Manual)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rados/">Ceph Storage Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cephfs/">Ceph Filesystem</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../rbd/rbd/">Ceph Block Device</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../rbd/rados-rbd-cmds/">Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../rbd/rbd-ko/">Kernel Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../rbd/rbd-snapshot/">Snapshots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../rbd/rbd-mirroring/">Mirroring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../rbd/qemu-rbd/">QEMU</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../rbd/libvirt/">libvirt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../rbd/rbd-config-ref/">Cache Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../rbd/rbd-openstack/">OpenStack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../rbd/rbd-cloudstack/">CloudStack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rbd/">Manpage rbd</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rbd-fuse/">Manpage rbd-fuse</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rbd-nbd/">Manpage rbd-nbd</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ceph-rbdnamer/">Manpage ceph-rbdnamer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../rbd/rbd-replay/">RBD Replay</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rbd-replay-prep/">Manpage rbd-replay-prep</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rbd-replay/">Manpage rbd-replay</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rbd-replay-many/">Manpage rbd-replay-many</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Manpage rbdmap</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#synopsis">Synopsis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#description">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#examples">Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#options">Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#availability">Availability</a></li>
<li class="toctree-l3"><a class="reference internal" href="#see-also">See also</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../rbd/librbdpy/">librbd</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../radosgw/">Ceph Object Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mgr/">Ceph Manager Daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../architecture/">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev/">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release-notes/">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/">Ceph Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary/">Glossary</a></li>
</ul>


<!-- ugly kludge to make genindex look like it's part of the toc -->
<ul style="margin-top: -10px"><li class="toctree-l1"><a class="reference internal" href="../../../genindex/">Index</a></li></ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../../rbd/librbdpy/" title="Librbd (Python)"
             >next</a> |</li>
        <li class="right" >
          <a href="../rbd-replay-many/" title="rbd-replay-many – replay a rados block device (RBD) workload on several clients"
             >previous</a> |</li>
        <li><a href="../../../">Ceph Documentation</a> &raquo;</li>
          <li><a href="../../../rbd/rbd/" >Ceph Block Device</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2016, Red Hat, Inc, and contributors. Licensed under Creative Commons BY-SA.
    </div>
  </body>
</html>