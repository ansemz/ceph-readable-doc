

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>ceph-objectstore-tool – 修改或检查一个 OSD 的状态 &mdash; Ceph Documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/ceph.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex/" />
    <link rel="search" title="Search" href="../../../search/" /> 
</head>

<body class="wy-body-for-nav">

   
  <header class="top-bar">
    

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../" class="icon icon-home"></a> &raquo;</li>
        
      <li>ceph-objectstore-tool – 修改或检查一个 OSD 的状态</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/man/8/ceph-objectstore-tool.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
  </header>
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #eee" >
          

          
            <a href="../../../">
          

          
            
            <img src="../../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../start/intro/">Ceph 简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/">安装 Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cephadm/">Cephadm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rados/">Ceph 存储集群</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cephfs/">Ceph 文件系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rbd/">Ceph 块设备</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../radosgw/">Ceph 对象网关</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mgr/">Ceph 管理器守护进程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mgr/dashboard/">Ceph 仪表盘</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/">API 文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../architecture/">体系结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev/developer_guide/">开发者指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev/internals/">Ceph 内幕</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../governance/">项目管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../foundation/">Ceph 基金会</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ceph-volume/">ceph-volume</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/general/">Ceph 版本（总目录）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/">Ceph 版本（索引）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security/">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary/">Ceph 术语</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../jaegertracing/">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../translation_cn/">中文版翻译资源</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../">Ceph</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
<div id="dev-warning" class="admonition note">
  <p class="first admonition-title">Notice</p>
  <p class="last">This document is for a development version of Ceph.</p>
</div>
  <div id="docubetter" align="right" style="padding: 5px; font-weight: bold;">
    <a href="https://pad.ceph.com/p/Report_Documentation_Bugs">Report a Documentation Bug</a>
  </div>

  
  <div class="section" id="ceph-objectstore-tool-osd">
<h1>ceph-objectstore-tool – 修改或检查一个 OSD 的状态<a class="headerlink" href="#ceph-objectstore-tool-osd" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id1">
<h2>提纲<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line"><strong>ceph-objectstore-tool</strong> –data-path <em>path to osd</em> [–op <em>list</em> ]</div>
</div>
<p>支持的对象操作：</p>
<ul class="simple">
<li><p>(get|set)-bytes [file]</p></li>
<li><p>set-(attr|omap) [file]</p></li>
<li><p>(get|rm)-attr|omap)</p></li>
<li><p>get-omaphdr</p></li>
<li><p>set-omaphdr [file]</p></li>
<li><p>list-attrs</p></li>
<li><p>list-omap</p></li>
<li><p>remove|removeall</p></li>
<li><p>dump</p></li>
<li><p>set-size</p></li>
<li><p>clear-data-digest</p></li>
<li><p>remove-clone-metadata</p></li>
</ul>
</div>
<div class="section" id="id2">
<h2>描述<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p><strong>ceph-objectstore-tool</strong> is a tool for modifying the state of an OSD. It facilitates manipulating an object’s content, removing an object, listing the omap, manipulating the omap header, manipulating the omap key, listing object attributes, and manipulating object attribute keys.</p>
<p><strong>ceph-objectstore-tool</strong> provides two main modes: (1) a mode that specifies the “–op” argument (for example, <strong>ceph-objectstore-tool</strong> –data-path $PATH_TO_OSD –op $SELECT_OPERATION [–pgid $PGID] [–dry-run]), and (2) a mode for positional object operations. If the second mode is used, the object can be specified by ID or by the JSON output of the –op list.</p>
<div class="line-block">
<div class="line"><strong>ceph-objectstore-tool</strong> –data-path <em>path to osd</em> [–pgid <em>$PG_ID</em> ][–op <em>command</em>]</div>
<div class="line"><strong>ceph-objectstore-tool</strong> –data-path <em>path to osd</em> [ –op <em>list $OBJECT_ID</em>]</div>
</div>
<p>支持的 –op 命令：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="n">info</span>
<span class="o">*</span> <span class="n">log</span>
<span class="o">*</span> <span class="n">remove</span>
<span class="o">*</span> <span class="n">mkfs</span>
<span class="o">*</span> <span class="n">fsck</span>
<span class="o">*</span> <span class="n">repair</span>
<span class="o">*</span> <span class="n">fuse</span>
<span class="o">*</span> <span class="n">dup</span>
<span class="o">*</span> <span class="n">export</span>
<span class="o">*</span> <span class="n">export</span><span class="o">-</span><span class="n">remove</span>
<span class="o">*</span> <span class="kn">import</span>
<span class="o">*</span> <span class="nb">list</span>
<span class="o">*</span> <span class="nb">list</span><span class="o">-</span><span class="n">slow</span><span class="o">-</span><span class="n">omap</span>
<span class="o">*</span> <span class="n">fix</span><span class="o">-</span><span class="n">lost</span>
<span class="o">*</span> <span class="nb">list</span><span class="o">-</span><span class="n">pgs</span>
<span class="o">*</span> <span class="n">dump</span><span class="o">-</span><span class="n">journal</span>
<span class="o">*</span> <span class="n">dump</span><span class="o">-</span><span class="nb">super</span>
<span class="o">*</span> <span class="n">meta</span><span class="o">-</span><span class="nb">list</span>
<span class="o">*</span> <span class="n">get</span><span class="o">-</span><span class="n">osdmap</span>
<span class="o">*</span> <span class="nb">set</span><span class="o">-</span><span class="n">osdmap</span>
<span class="o">*</span> <span class="n">get</span><span class="o">-</span><span class="n">inc</span><span class="o">-</span><span class="n">osdmap</span>
<span class="o">*</span> <span class="nb">set</span><span class="o">-</span><span class="n">inc</span><span class="o">-</span><span class="n">osdmap</span>
<span class="o">*</span> <span class="n">mark</span><span class="o">-</span><span class="n">complete</span>
<span class="o">*</span> <span class="n">reset</span><span class="o">-</span><span class="n">last</span><span class="o">-</span><span class="n">complete</span>
<span class="o">*</span> <span class="n">apply</span><span class="o">-</span><span class="n">layour</span><span class="o">-</span><span class="n">settings</span>
<span class="o">*</span> <span class="n">update</span><span class="o">-</span><span class="n">mon</span><span class="o">-</span><span class="n">db</span>
<span class="o">*</span> <span class="n">dump</span><span class="o">-</span><span class="n">export</span>
<span class="o">*</span> <span class="n">trim</span><span class="o">-</span><span class="n">pg</span><span class="o">-</span><span class="n">log</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h2>安装<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p><strong>ceph-objectstore-tool</strong> 在 <cite>ceph-osd</cite> 软件包里。</p>
</div>
<div class="section" id="id4">
<h2>实例<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id5">
<h3>对象的修改<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>这些命令可修改一个 OSD 的状态，使用 ceph-objectstore-tool 时这个 OSD 一定不能运行。</p>
</div>
<div class="section" id="id6">
<h3>罗列对象和归置组<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>确保目标 OSD 处于停机状态:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>systemctl status ceph-osd@$OSD_NUMBER
</pre></div>
</div>
<p>用 ceph-objectstore-tool 罗列对象:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>systemctl status ceph-osd@$OSD_NUMBER
</pre></div>
</div>
<p>找出一个 OSD 内的所有对象:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --op list
</pre></div>
</div>
<p>找出一个归置组内的所有对象:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID --op list
</pre></div>
</div>
<p>找出一个对象所属的归置组（ PG ）:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --op list $OBJECT_ID
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h3>丢失对象的修正<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>确保此 OSD 处于停机状态:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="n">status</span> <span class="n">ceph</span><span class="o">-</span><span class="n">osd</span><span class="nd">@OSD_NUMBER</span>
</pre></div>
</div>
<p>修正所有丢失的对象:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --op fix-lost
</pre></div>
</div>
<p>修正指定归置组内、所有丢失的对象:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID --op fix-lost
</pre></div>
</div>
<p>根据标识符修正一个丢失的对象:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --op fix-lost $OBJECT_ID
</pre></div>
</div>
<p>修正以前丢失的对象:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --op fix-lost
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h3>修改一个对象的内容<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>确保目标 OSD 处于停机状态:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>systemctl status ceph-osd@$OSD_NUMBER
</pre></div>
</div>
</li>
<li><p>通过罗列此 OSD 或归置组内的对象找到要修改的对象。</p></li>
<li><p>在对象中写入字节串之前，先做此对象的备份和工作副本。下面是此命令的语法格式:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID $OBJECT get-bytes &gt; $OBJECT_FILE_NAME
</pre></div>
</div>
</li>
</ol>
<p>例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-0 --pgid 0.1c &#39;{&quot;oid&quot;:&quot;zone_info.default&quot;,&quot;key&quot;:&quot;&quot;,&quot;snapid&quot;:-2,&quot;hash&quot;:235010478,&quot;max&quot;:0,&quot;pool&quot;:11,&quot;namespace&quot;:&quot;&quot;}&#39; get-bytes &gt; zone_info.default.backup</span>

<span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-0 --pgid 0.1c &#39;{&quot;oid&quot;:&quot;zone_info.default&quot;,&quot;key&quot;:&quot;&quot;,&quot;snapid&quot;:-2,&quot;hash&quot;:235010478,&quot;max&quot;:0,&quot;pool&quot;:11,&quot;namespace&quot;:&quot;&quot;}&#39; get-bytes &gt; zone_info.default.working-copy</span>
</pre></div>
</div>
<p>第一个命令创建了备份副本，而第二个命令创建的是工作副本。</p>
<ol class="arabic" start="4">
<li><p>编辑工作副本那个对象文件。</p></li>
<li><p>填入此对象的变更字节:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID $OBJECT set-bytes &lt; $OBJECT_FILE_NAME
</pre></div>
</div>
</li>
</ol>
<p>例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-0 --pgid 0.1c &#39;{&quot;oid&quot;:&quot;zone_info.default&quot;,&quot;key&quot;:&quot;&quot;,&quot;snapid&quot;:-2,&quot;hash&quot;:235010478,&quot;max&quot;:0,&quot;pool&quot;:11,&quot;namespace&quot;:&quot;&quot;}&#39; set-bytes &lt; zone_info.default.working-copy</span>
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h3>对象的删除<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>用 <strong>ceph-objectstore-tool</strong> 删除对象。对象被删除后，其内容以及引用都会从归置组（ PG ）删除。</p>
<p>删除一个对象（语法）:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID $OBJECT remove
</pre></div>
</div>
<p>删除一个对象（实例）:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-0 --pgid 0.1c &#39;{&quot;oid&quot;:&quot;zone_info.default&quot;,&quot;key&quot;:&quot;&quot;,&quot;snapid&quot;:-2,&quot;hash&quot;:235010478,&quot;max&quot;:0,&quot;pool&quot;:11,&quot;namespace&quot;:&quot;&quot;}&#39; remove</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h3>罗列对象图<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>用 ceph-objectstore-tool 罗列对象图（ OMAP ）的内容。其输出是一系列键名。</p>
<ol class="arabic">
<li><p>确认此 OSD 处于停机状态：</p>
<p>语法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>systemctl status ceph-osd@$OSD_NUMBER
</pre></div>
</div>
<p>实例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># systemctl status ceph-osd@1</span>
</pre></div>
</div>
</li>
<li><p>罗列其对象图：</p>
<p>语法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID $OBJECT list-omap
</pre></div>
</div>
<p>实例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-0 --pgid 0.1c &#39;{&quot;oid&quot;:&quot;zone_info.default&quot;,&quot;key&quot;:&quot;&quot;,&quot;snapid&quot;:-2,&quot;hash&quot;:235010478,&quot;max&quot;:0,&quot;pool&quot;:11,&quot;namespace&quot;:&quot;&quot;}&#39; list-omap</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="manipulating-the-object-map-header">
<h3>Manipulating the Object Map Header<a class="headerlink" href="#manipulating-the-object-map-header" title="Permalink to this headline">¶</a></h3>
<p>The <strong>ceph-objectstore-tool</strong> utility will output the object map (OMAP) header with the values associated with the object’s keys.</p>
<p>Note: If using FileStore as the OSD backend object store, then add the <cite>–journal-path $PATH_TO_JOURNAL</cite> argument when getting or setting the object map header, where the <cite>$PATH_TO_JOURNAL</cite> variable is the absolute path to the OSD journal; for example <cite>/var/lib/ceph/osd/ceph-0/journal</cite>.</p>
<div class="section" id="prerequisites">
<h4>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ul class="simple">
<li><p>Having root access to the Ceph OSD node.</p></li>
<li><p>Stopping the ceph-osd daemon.</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="procedure">
<h4>Procedure<a class="headerlink" href="#procedure" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Verify that the target OSD is down:</p>
<p>语法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>systemctl status ceph-osd@$OSD_NUMBER
</pre></div>
</div>
<p>实例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># systemctl status ceph-osd@1</span>
</pre></div>
</div>
<p>Get the object map header:</p>
<p>语法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID $OBJECT get-omaphdr &gt; $OBJECT_MAP_FILE_NAME
</pre></div>
</div>
<p>实例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-0 --pgid 0.1c &#39;{&quot;oid&quot;:&quot;zone_info.default&quot;,&quot;key&quot;:&quot;&quot;,&quot;snapid&quot;:-2,&quot;hash&quot;:235010478,&quot;max&quot;:0,&quot;pool&quot;:11,&quot;namespace&quot;:&quot;&quot;}&#39;  get-omaphdr &gt; zone_info.default.omaphdr.txt</span>
</pre></div>
</div>
<p>Set the object map header:</p>
<p>语法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID $OBJECT get-omaphdr &lt; $OBJECT_MAP_FILE_NAME
</pre></div>
</div>
<p>实例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-0 --pgid 0.1c &#39;{&quot;oid&quot;:&quot;zone_info.default&quot;,&quot;key&quot;:&quot;&quot;,&quot;snapid&quot;:-2,&quot;hash&quot;:235010478,&quot;max&quot;:0,&quot;pool&quot;:11,&quot;namespace&quot;:&quot;&quot;}&#39;  set-omaphdr &lt; zone_info.default.omaphdr.txt</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="manipulating-the-object-map-key">
<h3>Manipulating the Object Map Key<a class="headerlink" href="#manipulating-the-object-map-key" title="Permalink to this headline">¶</a></h3>
<p>Use the <strong>ceph-objectstore-tool</strong> utility to change the object map (OMAP) key. You need to provide the data path, the placement group identifier (PG ID), the object, and the key in the OMAP.
Note</p>
<p>If using FileStore as the OSD backend object store, then add the <cite>–journal-path $PATH_TO_JOURNAL</cite> argument when getting, setting or removing the object map key, where the <cite>$PATH_TO_JOURNAL</cite> variable is the absolute path to the OSD journal; for example <cite>/var/lib/ceph/osd/ceph-0/journal</cite>.</p>
<p>Prerequisites</p>
<blockquote>
<div><ul class="simple">
<li><p>Having root access to the Ceph OSD node.</p></li>
<li><p>Stopping the ceph-osd daemon.</p></li>
</ul>
</div></blockquote>
<p>Procedure</p>
<blockquote>
<div><blockquote>
<div><p>Get the object map key:</p>
<p>语法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID $OBJECT get-omap $KEY &gt; $OBJECT_MAP_FILE_NAME
</pre></div>
</div>
</div></blockquote>
<p>实例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-0 --pgid 0.1c &#39;{&quot;oid&quot;:&quot;zone_info.default&quot;,&quot;key&quot;:&quot;&quot;,&quot;snapid&quot;:-2,&quot;hash&quot;:235010478,&quot;max&quot;:0,&quot;pool&quot;:11,&quot;namespace&quot;:&quot;&quot;}&#39;  get-omap &quot;&quot; &gt; zone_info.default.omap.txt</span>
</pre></div>
</div>
<p>Set the object map key:</p>
<p>语法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID $OBJECT set-omap $KEY &lt; $OBJECT_MAP_FILE_NAME
</pre></div>
</div>
<p>实例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-0 --pgid 0.1c &#39;{&quot;oid&quot;:&quot;zone_info.default&quot;,&quot;key&quot;:&quot;&quot;,&quot;snapid&quot;:-2,&quot;hash&quot;:235010478,&quot;max&quot;:0,&quot;pool&quot;:11,&quot;namespace&quot;:&quot;&quot;}&#39; set-omap &quot;&quot; &lt; zone_info.default.omap.txt</span>
</pre></div>
</div>
<p>Remove the object map key:</p>
<p>语法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID $OBJECT rm-omap $KEY
</pre></div>
</div>
<p>实例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-0 --pgid 0.1c &#39;{&quot;oid&quot;:&quot;zone_info.default&quot;,&quot;key&quot;:&quot;&quot;,&quot;snapid&quot;:-2,&quot;hash&quot;:235010478,&quot;max&quot;:0,&quot;pool&quot;:11,&quot;namespace&quot;:&quot;&quot;}&#39; rm-omap &quot;&quot;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="listing-an-object-s-attributes">
<h3>Listing an Object’s Attributes<a class="headerlink" href="#listing-an-object-s-attributes" title="Permalink to this headline">¶</a></h3>
<p>Use the <strong>ceph-objectstore-tool</strong> utility to list an object’s attributes. The output provides you with the object’s keys and values.
Note</p>
<p>If you are using FileStore as the OSD backend object store and the journal is on a different disk, you must add the <cite>–journal-path $PATH_TO_JOURNAL</cite> argument when listing an object’s attributes, where the <cite>$PATH_TO_JOURNAL</cite> variable is the absolute path to the OSD journal; for example <cite>/var/lib/ceph/osd/ceph-0/journal</cite>.</p>
<div class="section" id="id11">
<h4>Prerequisites<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ul class="simple">
<li><p>Having root access to the Ceph OSD node.</p></li>
<li><p>Stopping the ceph-osd daemon.</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="id12">
<h4>Procedure<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Verify that the target OSD is down:</p>
<p>语法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>systemctl status ceph-osd@$OSD_NUMBER
</pre></div>
</div>
<p>实例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># systemctl status ceph-osd@1</span>
</pre></div>
</div>
<p>List the object’s attributes:</p>
<p>语法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID $OBJECT list-attrs
</pre></div>
</div>
<p>实例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-0 --pgid 0.1c &#39;{&quot;oid&quot;:&quot;zone_info.default&quot;,&quot;key&quot;:&quot;&quot;,&quot;snapid&quot;:-2,&quot;hash&quot;:235010478,&quot;max&quot;:0,&quot;pool&quot;:11,&quot;namespace&quot;:&quot;&quot;}&#39; list-attrs</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="manipulating-the-object-attribute-key">
<h3>MANIPULATING THE OBJECT ATTRIBUTE KEY<a class="headerlink" href="#manipulating-the-object-attribute-key" title="Permalink to this headline">¶</a></h3>
<p>Use the ceph-objectstore-tool utility to change an object’s attributes. To manipulate the object’s attributes you need the data and journal paths, the placement group identifier (PG ID), the object, and the key in the object’s attribute.
Note</p>
<p>If you are using FileStore as the OSD backend object store and the journal is on a different disk, you must add the <cite>–journal-path $PATH_TO_JOURNAL</cite> argument when getting, setting or removing the object’s attributes. Where the <cite>$PATH_TO_JOURNAL</cite> variable is the absolute path to the OSD journal, for example <cite>/var/lib/ceph/osd/ceph-0/journal</cite>.</p>
<p>Prerequisites</p>
<blockquote>
<div><ul class="simple">
<li><p>Having root access to the Ceph OSD node.</p></li>
<li><p>Stopping the ceph-osd daemon.</p></li>
</ul>
</div></blockquote>
<p>Procedure</p>
<blockquote>
<div><blockquote>
<div><p>Verify that the target OSD is down.</p>
</div></blockquote>
<p>语法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>systemctl status ceph-osd@$OSD_NUMBER
</pre></div>
</div>
<p>实例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># systemctl status ceph-osd@1</span>
</pre></div>
</div>
<p>Get the object’s attributes:</p>
<p>语法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID $OBJECT get-attrs $KEY &gt; $OBJECT_ATTRS_FILE_NAME
</pre></div>
</div>
<p>实例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-0  --pgid 0.1c &#39;{&quot;oid&quot;:&quot;zone_info.default&quot;,&quot;key&quot;:&quot;&quot;,&quot;snapid&quot;:-2,&quot;hash&quot;:235010478,&quot;max&quot;:0,&quot;pool&quot;:11,&quot;namespace&quot;:&quot;&quot;}&#39; get-attrs &quot;oid&quot; &gt; zone_info.default.attr.txt</span>
</pre></div>
</div>
<p>Set an object’s attributes:</p>
<p>语法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID $OBJECT  set-attrs $KEY &lt; $OBJECT_ATTRS_FILE_NAME
</pre></div>
</div>
<p>实例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-0 --pgid 0.1c &#39;{&quot;oid&quot;:&quot;zone_info.default&quot;,&quot;key&quot;:&quot;&quot;,&quot;snapid&quot;:-2,&quot;hash&quot;:235010478,&quot;max&quot;:0,&quot;pool&quot;:11,&quot;namespace&quot;:&quot;&quot;}&#39; set-attrs &quot;oid&quot; &lt; zone_info.default.attr.txt</span>
</pre></div>
</div>
<p>Remove an object’s attributes:</p>
<p>语法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID $OBJECT rm-attrs $KEY
</pre></div>
</div>
<p>实例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-0 --pgid 0.1c &#39;{&quot;oid&quot;:&quot;zone_info.default&quot;,&quot;key&quot;:&quot;&quot;,&quot;snapid&quot;:-2,&quot;hash&quot;:235010478,&quot;max&quot;:0,&quot;pool&quot;:11,&quot;namespace&quot;:&quot;&quot;}&#39; rm-attrs &quot;oid&quot;</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="id13">
<h2>选项<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h2>
<dl class="std option">
<dt id="cmdoption-help">
<code class="sig-name descname"><span class="pre">--help</span></code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-help" title="Permalink to this definition">¶</a></dt>
<dd><p>输出帮助消息</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-type">
<code class="sig-name descname"><span class="pre">--type</span></code><code class="sig-prename descclassname"> <span class="pre">arg</span></code><a class="headerlink" href="#cmdoption-type" title="Permalink to this definition">¶</a></dt>
<dd><p>Arg is one of [bluestore (default), filestore, memstore]. This option is needed only if the tool can’t tell the type from –data-path.</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-data-path">
<code class="sig-name descname"><span class="pre">--data-path</span></code><code class="sig-prename descclassname"> <span class="pre">arg</span></code><a class="headerlink" href="#cmdoption-data-path" title="Permalink to this definition">¶</a></dt>
<dd><p>path to object store, mandatory</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-journal-path">
<code class="sig-name descname"><span class="pre">--journal-path</span></code><code class="sig-prename descclassname"> <span class="pre">arg</span></code><a class="headerlink" href="#cmdoption-journal-path" title="Permalink to this definition">¶</a></dt>
<dd><p>path to journal, use if tool can’t find it</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-pgid">
<code class="sig-name descname"><span class="pre">--pgid</span></code><code class="sig-prename descclassname"> <span class="pre">arg</span></code><a class="headerlink" href="#cmdoption-pgid" title="Permalink to this definition">¶</a></dt>
<dd><p>PG id, mandatory for info, log, remove, export, export-remove, mark-complete, trim-pg-log, and mandatory for apply-layout-settings if –pool is not specified</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-pool">
<code class="sig-name descname"><span class="pre">--pool</span></code><code class="sig-prename descclassname"> <span class="pre">arg</span></code><a class="headerlink" href="#cmdoption-pool" title="Permalink to this definition">¶</a></dt>
<dd><p>Pool name, mandatory for apply-layout-settings if –pgid is not specified</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-op">
<code class="sig-name descname"><span class="pre">--op</span></code><code class="sig-prename descclassname"> <span class="pre">arg</span></code><a class="headerlink" href="#cmdoption-op" title="Permalink to this definition">¶</a></dt>
<dd><p>Arg is one of [info, log, remove, mkfs, fsck, repair, fuse, dup, export, export-remove, import, list, fix-lost, list-pgs, dump-journal, dump-super, meta-list, get-osdmap, set-osdmap, get-inc-osdmap, set-inc-osdmap, mark-complete, reset-last-complete, apply-layout-settings, update-mon-db, dump-export, trim-pg-log]</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-epoch">
<code class="sig-name descname"><span class="pre">--epoch</span></code><code class="sig-prename descclassname"> <span class="pre">arg</span></code><a class="headerlink" href="#cmdoption-epoch" title="Permalink to this definition">¶</a></dt>
<dd><p>epoch# for get-osdmap and get-inc-osdmap, the current epoch in use if not specified</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-file">
<code class="sig-name descname"><span class="pre">--file</span></code><code class="sig-prename descclassname"> <span class="pre">arg</span></code><a class="headerlink" href="#cmdoption-file" title="Permalink to this definition">¶</a></dt>
<dd><p>path of file to export, export-remove, import, get-osdmap, set-osdmap, get-inc-osdmap or set-inc-osdmap</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-mon-store-path">
<code class="sig-name descname"><span class="pre">--mon-store-path</span></code><code class="sig-prename descclassname"> <span class="pre">arg</span></code><a class="headerlink" href="#cmdoption-mon-store-path" title="Permalink to this definition">¶</a></dt>
<dd><p>path of monstore to update-mon-db</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-fsid">
<code class="sig-name descname"><span class="pre">--fsid</span></code><code class="sig-prename descclassname"> <span class="pre">arg</span></code><a class="headerlink" href="#cmdoption-fsid" title="Permalink to this definition">¶</a></dt>
<dd><p>fsid for new store created by mkfs</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-target-data-path">
<code class="sig-name descname"><span class="pre">--target-data-path</span></code><code class="sig-prename descclassname"> <span class="pre">arg</span></code><a class="headerlink" href="#cmdoption-target-data-path" title="Permalink to this definition">¶</a></dt>
<dd><p>path of target object store (for –op dup)</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-mountpoint">
<code class="sig-name descname"><span class="pre">--mountpoint</span></code><code class="sig-prename descclassname"> <span class="pre">arg</span></code><a class="headerlink" href="#cmdoption-mountpoint" title="Permalink to this definition">¶</a></dt>
<dd><p>fuse mountpoint</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-format">
<code class="sig-name descname"><span class="pre">--format</span></code><code class="sig-prename descclassname"> <span class="pre">arg</span> <span class="pre">(=json-pretty)</span></code><a class="headerlink" href="#cmdoption-format" title="Permalink to this definition">¶</a></dt>
<dd><p>Output format which may be json, json-pretty, xml, xml-pretty</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-debug">
<code class="sig-name descname"><span class="pre">--debug</span></code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-debug" title="Permalink to this definition">¶</a></dt>
<dd><p>Enable diagnostic output to stderr</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-force">
<code class="sig-name descname"><span class="pre">--force</span></code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-force" title="Permalink to this definition">¶</a></dt>
<dd><p>Ignore some types of errors and proceed with operation - USE WITH CAUTION: CORRUPTION POSSIBLE NOW OR IN THE FUTURE</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-skip-journal-replay">
<code class="sig-name descname"><span class="pre">--skip-journal-replay</span></code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-skip-journal-replay" title="Permalink to this definition">¶</a></dt>
<dd><p>Disable journal replay</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-skip-mount-omap">
<code class="sig-name descname"><span class="pre">--skip-mount-omap</span></code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-skip-mount-omap" title="Permalink to this definition">¶</a></dt>
<dd><p>Disable mounting of omap</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-head">
<code class="sig-name descname"><span class="pre">--head</span></code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-head" title="Permalink to this definition">¶</a></dt>
<dd><p>Find head/snapdir when searching for objects by name</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-dry-run">
<code class="sig-name descname"><span class="pre">--dry-run</span></code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-dry-run" title="Permalink to this definition">¶</a></dt>
<dd><p>Don’t modify the objectstore</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-namespace">
<code class="sig-name descname"><span class="pre">--namespace</span></code><code class="sig-prename descclassname"> <span class="pre">arg</span></code><a class="headerlink" href="#cmdoption-namespace" title="Permalink to this definition">¶</a></dt>
<dd><p>Specify namespace when searching for objects</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-rmtype">
<code class="sig-name descname"><span class="pre">--rmtype</span></code><code class="sig-prename descclassname"> <span class="pre">arg</span></code><a class="headerlink" href="#cmdoption-rmtype" title="Permalink to this definition">¶</a></dt>
<dd><p>Specify corrupting object removal ‘snapmap’ or ‘nosnapmap’ - TESTING USE ONLY</p>
</dd></dl>

</div>
<div class="section" id="id14">
<h2>错误码<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h2>
<p>“Mount failed with ‘(11) Resource temporarily unavailable” - 可能是你试图在一个运行着的 OSD 上运行 <strong>ceph-objectstore-tool</strong> 。</p>
</div>
<div class="section" id="id15">
<h2>使用范围<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h2>
<p><strong>rgw-orphan-list</strong> 是 Ceph 的一部分，这是个伸缩力强、开源、
分布式的存储系统，更多信息参见 <a class="reference external" href="https://docs.ceph.com">https://docs.ceph.com</a> 。</p>
</div>
</div>



           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2016, Ceph authors and contributors. Licensed under Creative Commons Attribution Share Alike 3.0 (CC-BY-SA-3.0).

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>