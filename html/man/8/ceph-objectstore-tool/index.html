
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>ceph-objectstore-tool – 修改或检查一个 OSD 的状态 &#8212; Ceph Documentation</title>
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script src="../../../_static/js/ceph.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex/" />
    <link rel="search" title="Search" href="../../../search/" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../">Ceph Documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            

<div id="dev-warning" class="admonition note" style="display:none;">
  <p class="first admonition-title">Notice</p>
  <p class="last">This document is for a development version of Ceph.</p>
</div>

<div id="eol-warning" class="admonition warning" style="display:none;">
  <p class="first admonition-title">Warning</p>
  <p class="last">This document is for an unsupported version of Ceph.</p>
</div>
  <div id="docubetter" align="right" style="display:none; padding: 15px; font-weight: bold;">
    <a id="edit-on-github" href="https://github.com/ceph/ceph/edit/master/doc/man/8/ceph-objectstore-tool.rst" rel="nofollow">Edit on GitHub</a> | <a href="https://pad.ceph.com/p/Report_Documentation_Bugs">Report a Documentation Bug</a>
  </div>

  
  <div class="section" id="ceph-objectstore-tool-osd">
<h1>ceph-objectstore-tool – 修改或检查一个 OSD 的状态<a class="headerlink" href="#ceph-objectstore-tool-osd" title="Permalink to this headline">¶</a></h1>
<div class="section" id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line"><strong>ceph-objectstore-tool</strong> –data-path <em>path to osd</em> [–op <em>list</em> ]</div>
</div>
<p>Possible object operations:</p>
<ul class="simple">
<li><p>(get|set)-bytes [file]</p></li>
<li><p>set-(attr|omap) [file]</p></li>
<li><p>(get|rm)-attr|omap)</p></li>
<li><p>get-omaphdr</p></li>
<li><p>set-omaphdr [file]</p></li>
<li><p>list-attrs</p></li>
<li><p>list-omap</p></li>
<li><p>remove|removeall</p></li>
<li><p>dump</p></li>
<li><p>set-size</p></li>
<li><p>clear-data-digest</p></li>
<li><p>remove-clone-metadata</p></li>
</ul>
</div>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p><strong>ceph-objectstore-tool</strong> is a tool for modifying the state of an OSD. It facilitates manipulating an object’s content, removing an object, listing the omap, manipulating the omap header, manipulating the omap key, listing object attributes, and manipulating object attribute keys.</p>
<p><strong>ceph-objectstore-tool</strong> provides two main modes: (1) a mode that specifies the “–op” argument (for example, <strong>ceph-objectstore-tool</strong> –data-path $PATH_TO_OSD –op $SELECT_OPERATION [–pgid $PGID] [–dry-run]), and (2) a mode for positional object operations. If the second mode is used, the object can be specified by ID or by the JSON output of the –op list.</p>
<div class="line-block">
<div class="line"><strong>ceph-objectstore-tool</strong> –data-path <em>path to osd</em> [–pgid <em>$PG_ID</em> ][–op <em>command</em>]</div>
<div class="line"><strong>ceph-objectstore-tool</strong> –data-path <em>path to osd</em> [ –op <em>list $OBJECT_ID</em>]</div>
</div>
<p>Possible -op commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="n">info</span>
<span class="o">*</span> <span class="n">log</span>
<span class="o">*</span> <span class="n">remove</span>
<span class="o">*</span> <span class="n">mkfs</span>
<span class="o">*</span> <span class="n">fsck</span>
<span class="o">*</span> <span class="n">repair</span>
<span class="o">*</span> <span class="n">fuse</span>
<span class="o">*</span> <span class="n">dup</span>
<span class="o">*</span> <span class="n">export</span>
<span class="o">*</span> <span class="n">export</span><span class="o">-</span><span class="n">remove</span>
<span class="o">*</span> <span class="kn">import</span>
<span class="o">*</span> <span class="nb">list</span>
<span class="o">*</span> <span class="nb">list</span><span class="o">-</span><span class="n">slow</span><span class="o">-</span><span class="n">omap</span>
<span class="o">*</span> <span class="n">fix</span><span class="o">-</span><span class="n">lost</span>
<span class="o">*</span> <span class="nb">list</span><span class="o">-</span><span class="n">pgs</span>
<span class="o">*</span> <span class="n">dump</span><span class="o">-</span><span class="n">journal</span>
<span class="o">*</span> <span class="n">dump</span><span class="o">-</span><span class="nb">super</span>
<span class="o">*</span> <span class="n">meta</span><span class="o">-</span><span class="nb">list</span>
<span class="o">*</span> <span class="n">get</span><span class="o">-</span><span class="n">osdmap</span>
<span class="o">*</span> <span class="nb">set</span><span class="o">-</span><span class="n">osdmap</span>
<span class="o">*</span> <span class="n">get</span><span class="o">-</span><span class="n">inc</span><span class="o">-</span><span class="n">osdmap</span>
<span class="o">*</span> <span class="nb">set</span><span class="o">-</span><span class="n">inc</span><span class="o">-</span><span class="n">osdmap</span>
<span class="o">*</span> <span class="n">mark</span><span class="o">-</span><span class="n">complete</span>
<span class="o">*</span> <span class="n">reset</span><span class="o">-</span><span class="n">last</span><span class="o">-</span><span class="n">complete</span>
<span class="o">*</span> <span class="n">apply</span><span class="o">-</span><span class="n">layour</span><span class="o">-</span><span class="n">settings</span>
<span class="o">*</span> <span class="n">update</span><span class="o">-</span><span class="n">mon</span><span class="o">-</span><span class="n">db</span>
<span class="o">*</span> <span class="n">dump</span><span class="o">-</span><span class="n">export</span>
<span class="o">*</span> <span class="n">trim</span><span class="o">-</span><span class="n">pg</span><span class="o">-</span><span class="n">log</span>
</pre></div>
</div>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>The <cite>ceph-osd</cite> package provides <strong>ceph-objectstore-tool</strong>.</p>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<div class="section" id="modifying-objects">
<h3>Modifying Objects<a class="headerlink" href="#modifying-objects" title="Permalink to this headline">¶</a></h3>
<p>These commands modify state of an OSD. The OSD must not be running when ceph-objectstore-tool is used.</p>
</div>
<div class="section" id="listing-objects-and-placement-groups">
<h3>Listing Objects and Placement Groups<a class="headerlink" href="#listing-objects-and-placement-groups" title="Permalink to this headline">¶</a></h3>
<p>Make sure that the target OSD is down:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>systemctl status ceph-osd@$OSD_NUMBER
</pre></div>
</div>
<p>List objects with ceph-objectstore-tool:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>systemctl status ceph-osd@$OSD_NUMBER
</pre></div>
</div>
<p>Identify all objects within an OSD:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --op list
</pre></div>
</div>
<p>Identify all objects within a placement group:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID --op list
</pre></div>
</div>
<p>Identify the placement group (PG) that an object belongs to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --op list $OBJECT_ID
</pre></div>
</div>
</div>
<div class="section" id="fixing-lost-objects">
<h3>Fixing Lost Objects<a class="headerlink" href="#fixing-lost-objects" title="Permalink to this headline">¶</a></h3>
<p>Make sure the OSD is down:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="n">status</span> <span class="n">ceph</span><span class="o">-</span><span class="n">osd</span><span class="nd">@OSD_NUMBER</span>
</pre></div>
</div>
<p>Fix all lost objects:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --op fix-lost
</pre></div>
</div>
<p>Fix all the lost objects within a specified placement group:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID --op fix-lost
</pre></div>
</div>
<p>Fix a lost object by its identifier:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --op fix-lost $OBJECT_ID
</pre></div>
</div>
<p>Fix legacy lost objects:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --op fix-lost
</pre></div>
</div>
</div>
<div class="section" id="manipulating-an-object-s-content">
<h3>Manipulating an object’s content<a class="headerlink" href="#manipulating-an-object-s-content" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>Make sure that the target OSD is down:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>systemctl status ceph-osd@$OSD_NUMBER
</pre></div>
</div>
</li>
<li><p>Find the object by listing the objects of the OSD or placement group.</p></li>
<li><p>Before setting the bytes on the object, make a backup and a working copy of the object. Here is the syntactic form of that command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID $OBJECT get-bytes &gt; $OBJECT_FILE_NAME
</pre></div>
</div>
</li>
</ol>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-0 --pgid 0.1c &#39;{&quot;oid&quot;:&quot;zone_info.default&quot;,&quot;key&quot;:&quot;&quot;,&quot;snapid&quot;:-2,&quot;hash&quot;:235010478,&quot;max&quot;:0,&quot;pool&quot;:11,&quot;namespace&quot;:&quot;&quot;}&#39; get-bytes &gt; zone_info.default.backup</span>

<span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-0 --pgid 0.1c &#39;{&quot;oid&quot;:&quot;zone_info.default&quot;,&quot;key&quot;:&quot;&quot;,&quot;snapid&quot;:-2,&quot;hash&quot;:235010478,&quot;max&quot;:0,&quot;pool&quot;:11,&quot;namespace&quot;:&quot;&quot;}&#39; get-bytes &gt; zone_info.default.working-copy</span>
</pre></div>
</div>
<p>The first command creates the back-up copy, and the second command creates the working copy.</p>
<ol class="arabic" start="4">
<li><p>Edit the working copy object file.</p></li>
<li><p>Set the bytes of the object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID $OBJECT set-bytes &lt; $OBJECT_FILE_NAME
</pre></div>
</div>
</li>
</ol>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-0 --pgid 0.1c &#39;{&quot;oid&quot;:&quot;zone_info.default&quot;,&quot;key&quot;:&quot;&quot;,&quot;snapid&quot;:-2,&quot;hash&quot;:235010478,&quot;max&quot;:0,&quot;pool&quot;:11,&quot;namespace&quot;:&quot;&quot;}&#39; set-bytes &lt; zone_info.default.working-copy</span>
</pre></div>
</div>
</div>
<div class="section" id="removing-an-object">
<h3>Removing an Object<a class="headerlink" href="#removing-an-object" title="Permalink to this headline">¶</a></h3>
<p>Use <strong>ceph-objectstore-tool</strong> to remove objects. When an object is removed, its contents and references are removed from the placement group (PG).</p>
<p>Remove an object (syntax):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID $OBJECT remove
</pre></div>
</div>
<p>Remove an object (example):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-0 --pgid 0.1c &#39;{&quot;oid&quot;:&quot;zone_info.default&quot;,&quot;key&quot;:&quot;&quot;,&quot;snapid&quot;:-2,&quot;hash&quot;:235010478,&quot;max&quot;:0,&quot;pool&quot;:11,&quot;namespace&quot;:&quot;&quot;}&#39; remove</span>
</pre></div>
</div>
</div>
<div class="section" id="listing-the-object-map">
<h3>Listing the Object Map<a class="headerlink" href="#listing-the-object-map" title="Permalink to this headline">¶</a></h3>
<p>Use the ceph-objectstore-tool to list the contents of the object map (OMAP). The output is a list of keys.</p>
<ol class="arabic">
<li><p>Verify the appropriate OSD is down:</p>
<p>Syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>systemctl status ceph-osd@$OSD_NUMBER
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># systemctl status ceph-osd@1</span>
</pre></div>
</div>
</li>
<li><p>List the object map:</p>
<p>Syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID $OBJECT list-omap
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-0 --pgid 0.1c &#39;{&quot;oid&quot;:&quot;zone_info.default&quot;,&quot;key&quot;:&quot;&quot;,&quot;snapid&quot;:-2,&quot;hash&quot;:235010478,&quot;max&quot;:0,&quot;pool&quot;:11,&quot;namespace&quot;:&quot;&quot;}&#39; list-omap</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="manipulating-the-object-map-header">
<h3>Manipulating the Object Map Header<a class="headerlink" href="#manipulating-the-object-map-header" title="Permalink to this headline">¶</a></h3>
<p>The <strong>ceph-objectstore-tool</strong> utility will output the object map (OMAP) header with the values associated with the object’s keys.</p>
<p>Note: If using FileStore as the OSD backend object store, then add the <cite>–journal-path $PATH_TO_JOURNAL</cite> argument when getting or setting the object map header, where the <cite>$PATH_TO_JOURNAL</cite> variable is the absolute path to the OSD journal; for example <cite>/var/lib/ceph/osd/ceph-0/journal</cite>.</p>
<div class="section" id="prerequisites">
<h4>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ul class="simple">
<li><p>Having root access to the Ceph OSD node.</p></li>
<li><p>Stopping the ceph-osd daemon.</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="procedure">
<h4>Procedure<a class="headerlink" href="#procedure" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Verify that the target OSD is down:</p>
<p>Syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>systemctl status ceph-osd@$OSD_NUMBER
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># systemctl status ceph-osd@1</span>
</pre></div>
</div>
<p>Get the object map header:</p>
<p>Syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID $OBJECT get-omaphdr &gt; $OBJECT_MAP_FILE_NAME
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-0 --pgid 0.1c &#39;{&quot;oid&quot;:&quot;zone_info.default&quot;,&quot;key&quot;:&quot;&quot;,&quot;snapid&quot;:-2,&quot;hash&quot;:235010478,&quot;max&quot;:0,&quot;pool&quot;:11,&quot;namespace&quot;:&quot;&quot;}&#39;  get-omaphdr &gt; zone_info.default.omaphdr.txt</span>
</pre></div>
</div>
<p>Set the object map header:</p>
<p>Syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID $OBJECT get-omaphdr &lt; $OBJECT_MAP_FILE_NAME
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-0 --pgid 0.1c &#39;{&quot;oid&quot;:&quot;zone_info.default&quot;,&quot;key&quot;:&quot;&quot;,&quot;snapid&quot;:-2,&quot;hash&quot;:235010478,&quot;max&quot;:0,&quot;pool&quot;:11,&quot;namespace&quot;:&quot;&quot;}&#39;  set-omaphdr &lt; zone_info.default.omaphdr.txt</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="manipulating-the-object-map-key">
<h3>Manipulating the Object Map Key<a class="headerlink" href="#manipulating-the-object-map-key" title="Permalink to this headline">¶</a></h3>
<p>Use the <strong>ceph-objectstore-tool</strong> utility to change the object map (OMAP) key. You need to provide the data path, the placement group identifier (PG ID), the object, and the key in the OMAP.
Note</p>
<p>If using FileStore as the OSD backend object store, then add the <cite>–journal-path $PATH_TO_JOURNAL</cite> argument when getting, setting or removing the object map key, where the <cite>$PATH_TO_JOURNAL</cite> variable is the absolute path to the OSD journal; for example <cite>/var/lib/ceph/osd/ceph-0/journal</cite>.</p>
<p>Prerequisites</p>
<blockquote>
<div><ul class="simple">
<li><p>Having root access to the Ceph OSD node.</p></li>
<li><p>Stopping the ceph-osd daemon.</p></li>
</ul>
</div></blockquote>
<p>Procedure</p>
<blockquote>
<div><blockquote>
<div><p>Get the object map key:</p>
<p>Syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID $OBJECT get-omap $KEY &gt; $OBJECT_MAP_FILE_NAME
</pre></div>
</div>
</div></blockquote>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-0 --pgid 0.1c &#39;{&quot;oid&quot;:&quot;zone_info.default&quot;,&quot;key&quot;:&quot;&quot;,&quot;snapid&quot;:-2,&quot;hash&quot;:235010478,&quot;max&quot;:0,&quot;pool&quot;:11,&quot;namespace&quot;:&quot;&quot;}&#39;  get-omap &quot;&quot; &gt; zone_info.default.omap.txt</span>
</pre></div>
</div>
<p>Set the object map key:</p>
<p>Syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID $OBJECT set-omap $KEY &lt; $OBJECT_MAP_FILE_NAME
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-0 --pgid 0.1c &#39;{&quot;oid&quot;:&quot;zone_info.default&quot;,&quot;key&quot;:&quot;&quot;,&quot;snapid&quot;:-2,&quot;hash&quot;:235010478,&quot;max&quot;:0,&quot;pool&quot;:11,&quot;namespace&quot;:&quot;&quot;}&#39; set-omap &quot;&quot; &lt; zone_info.default.omap.txt</span>
</pre></div>
</div>
<p>Remove the object map key:</p>
<p>Syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID $OBJECT rm-omap $KEY
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-0 --pgid 0.1c &#39;{&quot;oid&quot;:&quot;zone_info.default&quot;,&quot;key&quot;:&quot;&quot;,&quot;snapid&quot;:-2,&quot;hash&quot;:235010478,&quot;max&quot;:0,&quot;pool&quot;:11,&quot;namespace&quot;:&quot;&quot;}&#39; rm-omap &quot;&quot;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="listing-an-object-s-attributes">
<h3>Listing an Object’s Attributes<a class="headerlink" href="#listing-an-object-s-attributes" title="Permalink to this headline">¶</a></h3>
<p>Use the <strong>ceph-objectstore-tool</strong> utility to list an object’s attributes. The output provides you with the object’s keys and values.
Note</p>
<p>If you are using FileStore as the OSD backend object store and the journal is on a different disk, you must add the <cite>–journal-path $PATH_TO_JOURNAL</cite> argument when listing an object’s attributes, where the <cite>$PATH_TO_JOURNAL</cite> variable is the absolute path to the OSD journal; for example <cite>/var/lib/ceph/osd/ceph-0/journal</cite>.</p>
<div class="section" id="id1">
<h4>Prerequisites<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ul class="simple">
<li><p>Having root access to the Ceph OSD node.</p></li>
<li><p>Stopping the ceph-osd daemon.</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="id2">
<h4>Procedure<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Verify that the target OSD is down:</p>
<p>Syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>systemctl status ceph-osd@$OSD_NUMBER
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># systemctl status ceph-osd@1</span>
</pre></div>
</div>
<p>List the object’s attributes:</p>
<p>Syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID $OBJECT list-attrs
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-0 --pgid 0.1c &#39;{&quot;oid&quot;:&quot;zone_info.default&quot;,&quot;key&quot;:&quot;&quot;,&quot;snapid&quot;:-2,&quot;hash&quot;:235010478,&quot;max&quot;:0,&quot;pool&quot;:11,&quot;namespace&quot;:&quot;&quot;}&#39; list-attrs</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="manipulating-the-object-attribute-key">
<h3>MANIPULATING THE OBJECT ATTRIBUTE KEY<a class="headerlink" href="#manipulating-the-object-attribute-key" title="Permalink to this headline">¶</a></h3>
<p>Use the ceph-objectstore-tool utility to change an object’s attributes. To manipulate the object’s attributes you need the data and journal paths, the placement group identifier (PG ID), the object, and the key in the object’s attribute.
Note</p>
<p>If you are using FileStore as the OSD backend object store and the journal is on a different disk, you must add the <cite>–journal-path $PATH_TO_JOURNAL</cite> argument when getting, setting or removing the object’s attributes. Where the <cite>$PATH_TO_JOURNAL</cite> variable is the absolute path to the OSD journal, for example <cite>/var/lib/ceph/osd/ceph-0/journal</cite>.</p>
<p>Prerequisites</p>
<blockquote>
<div><ul class="simple">
<li><p>Having root access to the Ceph OSD node.</p></li>
<li><p>Stopping the ceph-osd daemon.</p></li>
</ul>
</div></blockquote>
<p>Procedure</p>
<blockquote>
<div><blockquote>
<div><p>Verify that the target OSD is down.</p>
</div></blockquote>
<p>Syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>systemctl status ceph-osd@$OSD_NUMBER
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># systemctl status ceph-osd@1</span>
</pre></div>
</div>
<p>Get the object’s attributes:</p>
<p>Syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID $OBJECT get-attrs $KEY &gt; $OBJECT_ATTRS_FILE_NAME
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-0  --pgid 0.1c &#39;{&quot;oid&quot;:&quot;zone_info.default&quot;,&quot;key&quot;:&quot;&quot;,&quot;snapid&quot;:-2,&quot;hash&quot;:235010478,&quot;max&quot;:0,&quot;pool&quot;:11,&quot;namespace&quot;:&quot;&quot;}&#39; get-attrs &quot;oid&quot; &gt; zone_info.default.attr.txt</span>
</pre></div>
</div>
<p>Set an object’s attributes:</p>
<p>Syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID $OBJECT  set-attrs $KEY &lt; $OBJECT_ATTRS_FILE_NAME
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-0 --pgid 0.1c &#39;{&quot;oid&quot;:&quot;zone_info.default&quot;,&quot;key&quot;:&quot;&quot;,&quot;snapid&quot;:-2,&quot;hash&quot;:235010478,&quot;max&quot;:0,&quot;pool&quot;:11,&quot;namespace&quot;:&quot;&quot;}&#39; set-attrs &quot;oid&quot; &lt; zone_info.default.attr.txt</span>
</pre></div>
</div>
<p>Remove an object’s attributes:</p>
<p>Syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-objectstore-tool --data-path $PATH_TO_OSD --pgid $PG_ID $OBJECT rm-attrs $KEY
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@osd</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-0 --pgid 0.1c &#39;{&quot;oid&quot;:&quot;zone_info.default&quot;,&quot;key&quot;:&quot;&quot;,&quot;snapid&quot;:-2,&quot;hash&quot;:235010478,&quot;max&quot;:0,&quot;pool&quot;:11,&quot;namespace&quot;:&quot;&quot;}&#39; rm-attrs &quot;oid&quot;</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="options">
<h2>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-help">
<code class="sig-name descname">--help</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-help" title="Permalink to this definition">¶</a></dt>
<dd><p>produce help message</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-type">
<code class="sig-name descname">--type</code><code class="sig-prename descclassname"> arg</code><a class="headerlink" href="#cmdoption-type" title="Permalink to this definition">¶</a></dt>
<dd><p>Arg is one of [bluestore (default), filestore, memstore]. This option is needed only if the tool can’t tell the type from –data-path.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-data-path">
<code class="sig-name descname">--data-path</code><code class="sig-prename descclassname"> arg</code><a class="headerlink" href="#cmdoption-data-path" title="Permalink to this definition">¶</a></dt>
<dd><p>path to object store, mandatory</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-journal-path">
<code class="sig-name descname">--journal-path</code><code class="sig-prename descclassname"> arg</code><a class="headerlink" href="#cmdoption-journal-path" title="Permalink to this definition">¶</a></dt>
<dd><p>path to journal, use if tool can’t find it</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-pgid">
<code class="sig-name descname">--pgid</code><code class="sig-prename descclassname"> arg</code><a class="headerlink" href="#cmdoption-pgid" title="Permalink to this definition">¶</a></dt>
<dd><p>PG id, mandatory for info, log, remove, export, export-remove, mark-complete, trim-pg-log, and mandatory for apply-layout-settings if –pool is not specified</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-pool">
<code class="sig-name descname">--pool</code><code class="sig-prename descclassname"> arg</code><a class="headerlink" href="#cmdoption-pool" title="Permalink to this definition">¶</a></dt>
<dd><p>Pool name, mandatory for apply-layout-settings if –pgid is not specified</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-op">
<code class="sig-name descname">--op</code><code class="sig-prename descclassname"> arg</code><a class="headerlink" href="#cmdoption-op" title="Permalink to this definition">¶</a></dt>
<dd><p>Arg is one of [info, log, remove, mkfs, fsck, repair, fuse, dup, export, export-remove, import, list, fix-lost, list-pgs, dump-journal, dump-super, meta-list, get-osdmap, set-osdmap, get-inc-osdmap, set-inc-osdmap, mark-complete, reset-last-complete, apply-layout-settings, update-mon-db, dump-export, trim-pg-log]</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-epoch">
<code class="sig-name descname">--epoch</code><code class="sig-prename descclassname"> arg</code><a class="headerlink" href="#cmdoption-epoch" title="Permalink to this definition">¶</a></dt>
<dd><p>epoch# for get-osdmap and get-inc-osdmap, the current epoch in use if not specified</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-file">
<code class="sig-name descname">--file</code><code class="sig-prename descclassname"> arg</code><a class="headerlink" href="#cmdoption-file" title="Permalink to this definition">¶</a></dt>
<dd><p>path of file to export, export-remove, import, get-osdmap, set-osdmap, get-inc-osdmap or set-inc-osdmap</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-mon-store-path">
<code class="sig-name descname">--mon-store-path</code><code class="sig-prename descclassname"> arg</code><a class="headerlink" href="#cmdoption-mon-store-path" title="Permalink to this definition">¶</a></dt>
<dd><p>path of monstore to update-mon-db</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-fsid">
<code class="sig-name descname">--fsid</code><code class="sig-prename descclassname"> arg</code><a class="headerlink" href="#cmdoption-fsid" title="Permalink to this definition">¶</a></dt>
<dd><p>fsid for new store created by mkfs</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-target-data-path">
<code class="sig-name descname">--target-data-path</code><code class="sig-prename descclassname"> arg</code><a class="headerlink" href="#cmdoption-target-data-path" title="Permalink to this definition">¶</a></dt>
<dd><p>path of target object store (for –op dup)</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-mountpoint">
<code class="sig-name descname">--mountpoint</code><code class="sig-prename descclassname"> arg</code><a class="headerlink" href="#cmdoption-mountpoint" title="Permalink to this definition">¶</a></dt>
<dd><p>fuse mountpoint</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-format">
<code class="sig-name descname">--format</code><code class="sig-prename descclassname"> arg (=json-pretty)</code><a class="headerlink" href="#cmdoption-format" title="Permalink to this definition">¶</a></dt>
<dd><p>Output format which may be json, json-pretty, xml, xml-pretty</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-debug">
<code class="sig-name descname">--debug</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-debug" title="Permalink to this definition">¶</a></dt>
<dd><p>Enable diagnostic output to stderr</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-force">
<code class="sig-name descname">--force</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-force" title="Permalink to this definition">¶</a></dt>
<dd><p>Ignore some types of errors and proceed with operation - USE WITH CAUTION: CORRUPTION POSSIBLE NOW OR IN THE FUTURE</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-skip-journal-replay">
<code class="sig-name descname">--skip-journal-replay</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-skip-journal-replay" title="Permalink to this definition">¶</a></dt>
<dd><p>Disable journal replay</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-skip-mount-omap">
<code class="sig-name descname">--skip-mount-omap</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-skip-mount-omap" title="Permalink to this definition">¶</a></dt>
<dd><p>Disable mounting of omap</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-head">
<code class="sig-name descname">--head</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-head" title="Permalink to this definition">¶</a></dt>
<dd><p>Find head/snapdir when searching for objects by name</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-dry-run">
<code class="sig-name descname">--dry-run</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-dry-run" title="Permalink to this definition">¶</a></dt>
<dd><p>Don’t modify the objectstore</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-namespace">
<code class="sig-name descname">--namespace</code><code class="sig-prename descclassname"> arg</code><a class="headerlink" href="#cmdoption-namespace" title="Permalink to this definition">¶</a></dt>
<dd><p>Specify namespace when searching for objects</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-rmtype">
<code class="sig-name descname">--rmtype</code><code class="sig-prename descclassname"> arg</code><a class="headerlink" href="#cmdoption-rmtype" title="Permalink to this definition">¶</a></dt>
<dd><p>Specify corrupting object removal ‘snapmap’ or ‘nosnapmap’ - TESTING USE ONLY</p>
</dd></dl>

</div>
<div class="section" id="error-codes">
<h2>Error Codes<a class="headerlink" href="#error-codes" title="Permalink to this headline">¶</a></h2>
<p>“Mount failed with ‘(11) Resource temporarily unavailable” - This might mean that you have attempted to run <strong>ceph-objectstore-tool</strong> on a running OSD.</p>
</div>
<div class="section" id="availability">
<h2>Availability<a class="headerlink" href="#availability" title="Permalink to this headline">¶</a></h2>
<p><strong>ceph-objectstore-tool</strong> is part of Ceph, a massively scalable, open-source, distributed storage system. <strong>ceph-objectstore-tool</strong> is provided by the package <cite>ceph-osd</cite>. Refer to the Ceph documentation at htpp://ceph.com/docs for more information.</p>
</div>
</div>



          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../">
              <img class="logo" src="../../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../../">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../start/intro/">Ceph 简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/">安装 Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cephadm/">Cephadm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rados/">Ceph 存储集群</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cephfs/">Ceph 文件系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rbd/">Ceph 块设备</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../radosgw/">Ceph 对象网关</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mgr/">Ceph 管理器守护进程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mgr/dashboard/">Ceph 仪表盘</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/">API 文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../architecture/">体系结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev/developer_guide/">开发者指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev/internals/">Ceph 内幕</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../governance/">项目管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../foundation/">Ceph 基金会</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ceph-volume/">ceph-volume</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/general/">Ceph 版本（总目录）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/">Ceph 版本（索引）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary/">Ceph 术语</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../translation_cn/">中文版翻译资源</a></li>
</ul>


<!-- ugly kludge to make genindex look like it's part of the toc -->
<ul style="margin-top: -10px"><li class="toctree-l1"><a class="reference internal" href="../../../genindex/">Index</a></li></ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../">Ceph Documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Ceph authors and contributors. Licensed under Creative Commons Attribution Share Alike 3.0 (CC-BY-SA-3.0).
    </div>
  </body>
</html>