

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>监控概览 &mdash; Ceph Documentation</title>
  

  
  <link rel="stylesheet" href="../_static/ceph.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/ceph.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="API 文档" href="../api/" />
    <link rel="prev" title="CLI API Commands Module" href="../mgr/cli_api/" /> 
</head>

<body class="wy-body-for-nav">

   
  <header class="top-bar">
    <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../" class="icon icon-home"></a> &raquo;</li>
      <li>监控概览</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/monitoring/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
  </header>
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #eee" >
          

          
            <a href="../">
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../start/">Ceph 简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/">安装 Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cephadm/">Cephadm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rados/">Ceph 存储集群</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cephfs/">Ceph 文件系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rbd/">Ceph 块设备</a></li>
<li class="toctree-l1"><a class="reference internal" href="../radosgw/">Ceph 对象网关</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mgr/">Ceph 管理器守护进程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mgr/dashboard/">Ceph 仪表盘</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">监控概览</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#ceph-monitoring-stack">Ceph Monitoring stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ceph-metrics">Ceph metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#performance-metrics">Performance metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#osd-performance">OSD performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="#physical-disk-performance">Physical disk performance:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pool-metrics">Pool metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#object-metrics">Object metrics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#generic-metrics">Generic metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#get-operations-related-metrics">GET operations: related metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#put-operations-related-metrics">Put operations: related metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#useful-queries">Useful queries</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#filesystem-metrics">Filesystem Metrics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#main-metrics">Main metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">Useful queries:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#block-metrics">Block metrics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">Main metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">Useful queries</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#hardware-monitoring">Hardware monitoring</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/">API 文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture/">体系结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/developer_guide/">开发者指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/internals/">Ceph 内幕</a></li>
<li class="toctree-l1"><a class="reference internal" href="../governance/">项目管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../foundation/">Ceph 基金会</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ceph-volume/">ceph-volume</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases/general/">Ceph 版本（总目录）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases/">Ceph 版本（索引）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hardware-monitoring/">Hardware monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary/">Ceph 术语</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jaegertracing/">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../translation_cn/">中文版翻译资源</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">Ceph</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
<div id="dev-warning" class="admonition note">
  <p class="first admonition-title">Notice</p>
  <p class="last">This document is for a development version of Ceph.</p>
</div>
  <div id="docubetter" align="right" style="padding: 5px; font-weight: bold;">
    <a href="https://pad.ceph.com/p/Report_Documentation_Bugs">Report a Documentation Bug</a>
  </div>

  
  <section id="monitoring">
<span id="id1"></span><h1>监控概览<a class="headerlink" href="#monitoring" title="Permalink to this heading"></a></h1>
<p>这部分文档的目的是解释 Ceph 监控栈和主要 Ceph 指标的含义。</p>
<p>With a good understand of the Ceph monitoring stack and metrics users can
create customized monitoring tools, like Prometheus queries, Grafana
dashboards, or scripts.</p>
<section id="ceph-monitoring-stack">
<h2>Ceph Monitoring stack<a class="headerlink" href="#ceph-monitoring-stack" title="Permalink to this heading"></a></h2>
<p>Ceph provides a default monitoring stack wich is installed by cephadm and
explained in the <a class="reference internal" href="../cephadm/services/monitoring/#mgr-cephadm-monitoring"><span class="std std-ref">Monitoring Services</span></a> section of
the cephadm documentation.</p>
</section>
<section id="ceph-metrics">
<h2>Ceph metrics<a class="headerlink" href="#ceph-metrics" title="Permalink to this heading"></a></h2>
<p>The main source for Ceph metrics are the performance counters exposed by each
Ceph daemon. The <a class="reference internal" href="../dev/perf_counters/"><span class="doc">性能计数器</span></a> are native Ceph monitoring data</p>
<p>Performance counters are transformed into standard Prometheus metrics by the
Ceph exporter daemon. This daemon runs on every Ceph cluster host and exposes a
metrics end point where all the performance counters exposed by all the Ceph
daemons running in the host are published in the form of Prometheus metrics.</p>
<p>In addition to the Ceph exporter, there is another agent to expose Ceph
metrics. It is the Prometheus manager module, wich exposes metrics related to
the whole cluster, basically metrics that are not produced by individual Ceph
daemons.</p>
<p>The main source for obtaining Ceph metrics is the metrics endpoint exposed by
the Cluster Prometheus server.  Ceph can provide you with the Prometheus
endpoint where you can obtain the complete list of metrics (coming from Ceph
exporter daemons and Prometheus manager module) and exeute queries.</p>
<p>Use the following command to obtain the Prometheus server endpoint in your
cluster:</p>
<p>Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># ceph orch ps --service_name prometheus</span>
NAME<span class="w">                         </span>HOST<span class="w">                          </span>PORTS<span class="w">   </span>STATUS<span class="w">          </span>REFRESHED<span class="w">  </span>AGE<span class="w">  </span>MEM<span class="w"> </span>USE<span class="w">  </span>MEM<span class="w"> </span>LIM<span class="w">  </span>VERSION<span class="w">  </span>IMAGE<span class="w"> </span>ID<span class="w">      </span>CONTAINER<span class="w"> </span>ID
prometheus.cephtest-node-00<span class="w">  </span>cephtest-node-00.cephlab.com<span class="w">  </span>*:9095<span class="w">  </span>running<span class="w"> </span><span class="o">(</span>103m<span class="o">)</span><span class="w">    </span>50s<span class="w"> </span>ago<span class="w">   </span>5w<span class="w">     </span>142M<span class="w">        </span>-<span class="w">  </span><span class="m">2</span>.33.4<span class="w">   </span>514e6a882f6e<span class="w">  </span>efe3cbc2e521
</pre></div>
</div>
<p>With this information you can connect to
<code class="docutils literal notranslate"><span class="pre">http://cephtest-node-00.cephlab.com:9095</span></code> to access the Prometheus server
interface.</p>
<p>And the complete list of metrics (with help) for your cluster will be available
in:</p>
<p><code class="docutils literal notranslate"><span class="pre">http://cephtest-node-00.cephlab.com:9095/api/v1/targets/metadata</span></code></p>
<p>It is good to outline that the main tool allowing users to observe and monitor a Ceph cluster is the <strong>Ceph dashboard</strong>. It provides graphics where the most important cluster and service metrics are represented. Most of the examples in this document are extracted from the dashboard graphics or extrapolated from the metrics exposed by the Ceph dashboard.</p>
</section>
<section id="performance-metrics">
<h2>Performance metrics<a class="headerlink" href="#performance-metrics" title="Permalink to this heading"></a></h2>
<p>Main metrics used to measure Cluster Ceph performance:</p>
<p>All metrics have the following labels:
<code class="docutils literal notranslate"><span class="pre">ceph_daemon</span></code>: identifier of the OSD daemon generating the metric
<code class="docutils literal notranslate"><span class="pre">instance</span></code>: the IP address of the ceph exporter instance exposing the metric.
<code class="docutils literal notranslate"><span class="pre">job</span></code>: prometheus scrape job</p>
<p>Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ceph_osd_op_r<span class="o">{</span><span class="nv">ceph_daemon</span><span class="o">=</span><span class="s2">&quot;osd.0&quot;</span>,<span class="w"> </span><span class="nv">instance</span><span class="o">=</span><span class="s2">&quot;192.168.122.7:9283&quot;</span>,<span class="w"> </span><span class="nv">job</span><span class="o">=</span><span class="s2">&quot;ceph&quot;</span><span class="o">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">73981</span>
</pre></div>
</div>
<p><em>Cluster I/O (throughput):</em>
Use <code class="docutils literal notranslate"><span class="pre">ceph_osd_op_r_out_bytes</span></code> and <code class="docutils literal notranslate"><span class="pre">ceph_osd_op_w_in_bytes</span></code> to obtain the cluster throughput generated by clients</p>
<p>Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Writes<span class="w"> </span><span class="o">(</span>B/s<span class="o">)</span>:
sum<span class="o">(</span>irate<span class="o">(</span>ceph_osd_op_w_in_bytes<span class="o">[</span>1m<span class="o">]))</span>

Reads<span class="w"> </span><span class="o">(</span>B/s<span class="o">)</span>:
sum<span class="o">(</span>irate<span class="o">(</span>ceph_osd_op_r_out_bytes<span class="o">[</span>1m<span class="o">]))</span>
</pre></div>
</div>
<p><em>Cluster I/O (operations):</em>
Use <code class="docutils literal notranslate"><span class="pre">ceph_osd_op_r</span></code>, <code class="docutils literal notranslate"><span class="pre">ceph_osd_op_w</span></code> to obtain the number of operations generated by clients</p>
<p>Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Writes<span class="w"> </span><span class="o">(</span>ops/s<span class="o">)</span>:
sum<span class="o">(</span>irate<span class="o">(</span>ceph_osd_op_w<span class="o">[</span>1m<span class="o">]))</span>

Reads<span class="w"> </span><span class="o">(</span>ops/s<span class="o">)</span>:
sum<span class="o">(</span>irate<span class="o">(</span>ceph_osd_op_r<span class="o">[</span>1m<span class="o">]))</span>
</pre></div>
</div>
<p><em>Latency:</em>
Use <code class="docutils literal notranslate"><span class="pre">ceph_osd_op_latency_sum</span></code> wich represents the delay before a OSD transfer of data begins following a client instruction for its transfer</p>
<p>Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sum<span class="o">(</span>irate<span class="o">(</span>ceph_osd_op_latency_sum<span class="o">[</span>1m<span class="o">]))</span>
</pre></div>
</div>
</section>
<section id="osd-performance">
<h2>OSD performance<a class="headerlink" href="#osd-performance" title="Permalink to this heading"></a></h2>
<p>The previous explained cluster performance metrics are based in OSD metrics, selecting the right label we can obtain for a single OSD the same performance information explained for the cluster:</p>
<p>Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>OSD<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>latency
irate<span class="o">(</span>ceph_osd_op_r_latency_sum<span class="o">{</span><span class="nv">ceph_daemon</span><span class="o">=</span>~<span class="s2">&quot;osd.0&quot;</span><span class="o">}[</span>1m<span class="o">])</span><span class="w"> </span>/<span class="w"> </span>on<span class="w"> </span><span class="o">(</span>ceph_daemon<span class="o">)</span><span class="w"> </span>irate<span class="o">(</span>ceph_osd_op_r_latency_count<span class="o">[</span>1m<span class="o">])</span>

OSD<span class="w"> </span><span class="m">0</span><span class="w"> </span>write<span class="w"> </span>IOPS
irate<span class="o">(</span>ceph_osd_op_w<span class="o">{</span><span class="nv">ceph_daemon</span><span class="o">=</span>~<span class="s2">&quot;osd.0&quot;</span><span class="o">}[</span>1m<span class="o">])</span>

OSD<span class="w"> </span><span class="m">0</span><span class="w"> </span>write<span class="w"> </span>thughtput<span class="w"> </span><span class="o">(</span>bytes<span class="o">)</span>
irate<span class="o">(</span>ceph_osd_op_w_in_bytes<span class="o">{</span><span class="nv">ceph_daemon</span><span class="o">=</span>~<span class="s2">&quot;osd.0&quot;</span><span class="o">}[</span>1m<span class="o">])</span>

OSD.0<span class="w"> </span>total<span class="w"> </span>raw<span class="w"> </span>capacity<span class="w"> </span>available
ceph_osd_stat_bytes<span class="o">{</span><span class="nv">ceph_daemon</span><span class="o">=</span><span class="s2">&quot;osd.0&quot;</span>,<span class="w"> </span><span class="nv">instance</span><span class="o">=</span><span class="s2">&quot;cephtest-node-00.cephlab.com:9283&quot;</span>,<span class="w"> </span><span class="nv">job</span><span class="o">=</span><span class="s2">&quot;ceph&quot;</span><span class="o">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">536451481</span>
</pre></div>
</div>
</section>
<section id="physical-disk-performance">
<h2>Physical disk performance:<a class="headerlink" href="#physical-disk-performance" title="Permalink to this heading"></a></h2>
<p>Combining Prometheus <code class="docutils literal notranslate"><span class="pre">node_exporter</span></code> metrics with Ceph metrics we can have
information about the performance provided by physical disks used by OSDs.</p>
<p>Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Read<span class="w"> </span>latency<span class="w"> </span>of<span class="w"> </span>device<span class="w"> </span>used<span class="w"> </span>by<span class="w"> </span>OSD<span class="w"> </span><span class="m">0</span>:
label_replace<span class="o">(</span>irate<span class="o">(</span>node_disk_read_time_seconds_total<span class="o">[</span>1m<span class="o">])</span><span class="w"> </span>/<span class="w"> </span>irate<span class="o">(</span>node_disk_reads_completed_total<span class="o">[</span>1m<span class="o">])</span>,<span class="w"> </span><span class="s2">&quot;instance&quot;</span>,<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>,<span class="w"> </span><span class="s2">&quot;instance&quot;</span>,<span class="w"> </span><span class="s2">&quot;([^:.]*).*&quot;</span><span class="o">)</span><span class="w"> </span>and<span class="w"> </span>on<span class="w"> </span><span class="o">(</span>instance,<span class="w"> </span>device<span class="o">)</span><span class="w"> </span>label_replace<span class="o">(</span>label_replace<span class="o">(</span>ceph_disk_occupation_human<span class="o">{</span><span class="nv">ceph_daemon</span><span class="o">=</span>~<span class="s2">&quot;osd.0&quot;</span><span class="o">}</span>,<span class="w"> </span><span class="s2">&quot;device&quot;</span>,<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>,<span class="w"> </span><span class="s2">&quot;device&quot;</span>,<span class="w"> </span><span class="s2">&quot;/dev/(.*)&quot;</span><span class="o">)</span>,<span class="w"> </span><span class="s2">&quot;instance&quot;</span>,<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>,<span class="w"> </span><span class="s2">&quot;instance&quot;</span>,<span class="w"> </span><span class="s2">&quot;([^:.]*).*&quot;</span><span class="o">)</span>

Write<span class="w"> </span>latency<span class="w"> </span>of<span class="w"> </span>device<span class="w"> </span>used<span class="w"> </span>by<span class="w"> </span>OSD<span class="w"> </span><span class="m">0</span>
label_replace<span class="o">(</span>irate<span class="o">(</span>node_disk_write_time_seconds_total<span class="o">[</span>1m<span class="o">])</span><span class="w"> </span>/<span class="w"> </span>irate<span class="o">(</span>node_disk_writes_completed_total<span class="o">[</span>1m<span class="o">])</span>,<span class="w"> </span><span class="s2">&quot;instance&quot;</span>,<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>,<span class="w"> </span><span class="s2">&quot;instance&quot;</span>,<span class="w"> </span><span class="s2">&quot;([^:.]*).*&quot;</span><span class="o">)</span><span class="w"> </span>and<span class="w"> </span>on<span class="w"> </span><span class="o">(</span>instance,<span class="w"> </span>device<span class="o">)</span><span class="w"> </span>label_replace<span class="o">(</span>label_replace<span class="o">(</span>ceph_disk_occupation_human<span class="o">{</span><span class="nv">ceph_daemon</span><span class="o">=</span>~<span class="s2">&quot;osd.0&quot;</span><span class="o">}</span>,<span class="w"> </span><span class="s2">&quot;device&quot;</span>,<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>,<span class="w"> </span><span class="s2">&quot;device&quot;</span>,<span class="w"> </span><span class="s2">&quot;/dev/(.*)&quot;</span><span class="o">)</span>,<span class="w"> </span><span class="s2">&quot;instance&quot;</span>,<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>,<span class="w"> </span><span class="s2">&quot;instance&quot;</span>,<span class="w"> </span><span class="s2">&quot;([^:.]*).*&quot;</span><span class="o">)</span>

IOPS<span class="w"> </span><span class="o">(</span>device<span class="w"> </span>used<span class="w"> </span>by<span class="w"> </span>OSD.0<span class="o">)</span>
reads:
label_replace<span class="o">(</span>irate<span class="o">(</span>node_disk_reads_completed_total<span class="o">[</span>1m<span class="o">])</span>,<span class="w"> </span><span class="s2">&quot;instance&quot;</span>,<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>,<span class="w"> </span><span class="s2">&quot;instance&quot;</span>,<span class="w"> </span><span class="s2">&quot;([^:.]*).*&quot;</span><span class="o">)</span><span class="w"> </span>and<span class="w"> </span>on<span class="w"> </span><span class="o">(</span>instance,<span class="w"> </span>device<span class="o">)</span><span class="w"> </span>label_replace<span class="o">(</span>label_replace<span class="o">(</span>ceph_disk_occupation_human<span class="o">{</span><span class="nv">ceph_daemon</span><span class="o">=</span>~<span class="s2">&quot;osd.0&quot;</span><span class="o">}</span>,<span class="w"> </span><span class="s2">&quot;device&quot;</span>,<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>,<span class="w"> </span><span class="s2">&quot;device&quot;</span>,<span class="w"> </span><span class="s2">&quot;/dev/(.*)&quot;</span><span class="o">)</span>,<span class="w"> </span><span class="s2">&quot;instance&quot;</span>,<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>,<span class="w"> </span><span class="s2">&quot;instance&quot;</span>,<span class="w"> </span><span class="s2">&quot;([^:.]*).*&quot;</span><span class="o">)</span>

writes:
label_replace<span class="o">(</span>irate<span class="o">(</span>node_disk_writes_completed_total<span class="o">[</span>1m<span class="o">])</span>,<span class="w"> </span><span class="s2">&quot;instance&quot;</span>,<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>,<span class="w"> </span><span class="s2">&quot;instance&quot;</span>,<span class="w"> </span><span class="s2">&quot;([^:.]*).*&quot;</span><span class="o">)</span><span class="w"> </span>and<span class="w"> </span>on<span class="w"> </span><span class="o">(</span>instance,<span class="w"> </span>device<span class="o">)</span><span class="w"> </span>label_replace<span class="o">(</span>label_replace<span class="o">(</span>ceph_disk_occupation_human<span class="o">{</span><span class="nv">ceph_daemon</span><span class="o">=</span>~<span class="s2">&quot;osd.0&quot;</span><span class="o">}</span>,<span class="w"> </span><span class="s2">&quot;device&quot;</span>,<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>,<span class="w"> </span><span class="s2">&quot;device&quot;</span>,<span class="w"> </span><span class="s2">&quot;/dev/(.*)&quot;</span><span class="o">)</span>,<span class="w"> </span><span class="s2">&quot;instance&quot;</span>,<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>,<span class="w"> </span><span class="s2">&quot;instance&quot;</span>,<span class="w"> </span><span class="s2">&quot;([^:.]*).*&quot;</span><span class="o">)</span>

Throughput<span class="w"> </span><span class="o">(</span>device<span class="w"> </span>used<span class="w"> </span>by<span class="w"> </span>OSD.0<span class="o">)</span>
reads:
label_replace<span class="o">(</span>irate<span class="o">(</span>node_disk_read_bytes_total<span class="o">[</span>1m<span class="o">])</span>,<span class="w"> </span><span class="s2">&quot;instance&quot;</span>,<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>,<span class="w"> </span><span class="s2">&quot;instance&quot;</span>,<span class="w"> </span><span class="s2">&quot;([^:.]*).*&quot;</span><span class="o">)</span><span class="w"> </span>and<span class="w"> </span>on<span class="w"> </span><span class="o">(</span>instance,<span class="w"> </span>device<span class="o">)</span><span class="w"> </span>label_replace<span class="o">(</span>label_replace<span class="o">(</span>ceph_disk_occupation_human<span class="o">{</span><span class="nv">ceph_daemon</span><span class="o">=</span>~<span class="s2">&quot;osd.0&quot;</span><span class="o">}</span>,<span class="w"> </span><span class="s2">&quot;device&quot;</span>,<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>,<span class="w"> </span><span class="s2">&quot;device&quot;</span>,<span class="w"> </span><span class="s2">&quot;/dev/(.*)&quot;</span><span class="o">)</span>,<span class="w"> </span><span class="s2">&quot;instance&quot;</span>,<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>,<span class="w"> </span><span class="s2">&quot;instance&quot;</span>,<span class="w"> </span><span class="s2">&quot;([^:.]*).*&quot;</span><span class="o">)</span>

writes:
label_replace<span class="o">(</span>irate<span class="o">(</span>node_disk_written_bytes_total<span class="o">[</span>1m<span class="o">])</span>,<span class="w"> </span><span class="s2">&quot;instance&quot;</span>,<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>,<span class="w"> </span><span class="s2">&quot;instance&quot;</span>,<span class="w"> </span><span class="s2">&quot;([^:.]*).*&quot;</span><span class="o">)</span><span class="w"> </span>and<span class="w"> </span>on<span class="w"> </span><span class="o">(</span>instance,<span class="w"> </span>device<span class="o">)</span><span class="w"> </span>label_replace<span class="o">(</span>label_replace<span class="o">(</span>ceph_disk_occupation_human<span class="o">{</span><span class="nv">ceph_daemon</span><span class="o">=</span>~<span class="s2">&quot;osd.0&quot;</span><span class="o">}</span>,<span class="w"> </span><span class="s2">&quot;device&quot;</span>,<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>,<span class="w"> </span><span class="s2">&quot;device&quot;</span>,<span class="w"> </span><span class="s2">&quot;/dev/(.*)&quot;</span><span class="o">)</span>,<span class="w"> </span><span class="s2">&quot;instance&quot;</span>,<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>,<span class="w"> </span><span class="s2">&quot;instance&quot;</span>,<span class="w"> </span><span class="s2">&quot;([^:.]*).*&quot;</span><span class="o">)</span>

Physical<span class="w"> </span>Device<span class="w"> </span>Utilization<span class="w"> </span><span class="o">(</span>%<span class="o">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>OSD.0<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>last<span class="w"> </span><span class="m">5</span><span class="w"> </span>minutes
label_replace<span class="o">(</span>irate<span class="o">(</span>node_disk_io_time_seconds_total<span class="o">[</span>5m<span class="o">])</span>,<span class="w"> </span><span class="s2">&quot;instance&quot;</span>,<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>,<span class="w"> </span><span class="s2">&quot;instance&quot;</span>,<span class="w"> </span><span class="s2">&quot;([^:.]*).*&quot;</span><span class="o">)</span><span class="w"> </span>and<span class="w"> </span>on<span class="w"> </span><span class="o">(</span>instance,<span class="w"> </span>device<span class="o">)</span><span class="w"> </span>label_replace<span class="o">(</span>label_replace<span class="o">(</span>ceph_disk_occupation_human<span class="o">{</span><span class="nv">ceph_daemon</span><span class="o">=</span>~<span class="s2">&quot;osd.0&quot;</span><span class="o">}</span>,<span class="w"> </span><span class="s2">&quot;device&quot;</span>,<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>,<span class="w"> </span><span class="s2">&quot;device&quot;</span>,<span class="w"> </span><span class="s2">&quot;/dev/(.*)&quot;</span><span class="o">)</span>,<span class="w"> </span><span class="s2">&quot;instance&quot;</span>,<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>,<span class="w"> </span><span class="s2">&quot;instance&quot;</span>,<span class="w"> </span><span class="s2">&quot;([^:.]*).*&quot;</span><span class="o">)</span>
</pre></div>
</div>
</section>
<section id="pool-metrics">
<h2>Pool metrics<a class="headerlink" href="#pool-metrics" title="Permalink to this heading"></a></h2>
<p>These metrics have the following labels:
<code class="docutils literal notranslate"><span class="pre">instance</span></code>: the ip address of the Ceph exporter daemon producing the metric.
<code class="docutils literal notranslate"><span class="pre">pool_id</span></code>: identifier of the pool
<code class="docutils literal notranslate"><span class="pre">job</span></code>: prometheus scrape job</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_pool_metadata</span></code>: Information about the pool It can be used together
with other metrics to provide more contextual information in queries and
graphs.  Apart of the three common labels this metric provide the following
extra labels:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">compression_mode</span></code>: compression used in the pool (lz4, snappy, zlib,
zstd, none). Example: compression_mode=”none”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">description</span></code>: brief description of the pool type (replica:number of
replicas or Erasure code: ec profile). Example: description=”replica:3”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: name of the pool. Example: name=”.mgr”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code>: type of pool (replicated/erasure code). Example: type=”replicated”</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_pool_bytes_used</span></code>: Total raw capacity consumed by user data and associated overheads by pool (metadata + redundancy):</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_pool_stored</span></code>: Total of CLIENT data stored in the pool</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_pool_compress_under_bytes</span></code>: Data eligible to be compressed in the pool</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_pool_compress_bytes_used</span></code>:  Data compressed in the pool</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_pool_rd</span></code>: CLIENT read operations per pool (reads per second)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_pool_rd_bytes</span></code>: CLIENT read operations in bytes per pool</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_pool_wr</span></code>: CLIENT write operations per pool (writes per second)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_pool_wr_bytes</span></code>: CLIENT write operation in bytes per pool</p></li>
</ul>
<p><strong>Useful queries</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Total<span class="w"> </span>raw<span class="w"> </span>capacity<span class="w"> </span>available<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>cluster:
sum<span class="o">(</span>ceph_osd_stat_bytes<span class="o">)</span>

Total<span class="w"> </span>raw<span class="w"> </span>capacity<span class="w"> </span>consumed<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>cluster<span class="w"> </span><span class="o">(</span>including<span class="w"> </span>metadata<span class="w"> </span>+<span class="w"> </span>redundancy<span class="o">)</span>:
sum<span class="o">(</span>ceph_pool_bytes_used<span class="o">)</span>

Total<span class="w"> </span>of<span class="w"> </span>CLIENT<span class="w"> </span>data<span class="w"> </span>stored<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>cluster:
sum<span class="o">(</span>ceph_pool_stored<span class="o">)</span>

Compression<span class="w"> </span>savings:
sum<span class="o">(</span>ceph_pool_compress_under_bytes<span class="w"> </span>-<span class="w"> </span>ceph_pool_compress_bytes_used<span class="o">)</span>

CLIENT<span class="w"> </span>IOPS<span class="w"> </span><span class="k">for</span><span class="w"> </span>a<span class="w"> </span>pool<span class="w"> </span><span class="o">(</span>testrbdpool<span class="o">)</span>
reads:<span class="w"> </span>irate<span class="o">(</span>ceph_pool_rd<span class="o">[</span>1m<span class="o">])</span><span class="w"> </span>*<span class="w"> </span>on<span class="o">(</span>pool_id<span class="o">)</span><span class="w"> </span>group_left<span class="o">(</span>instance,name<span class="o">)</span><span class="w"> </span>ceph_pool_metadata<span class="o">{</span><span class="nv">name</span><span class="o">=</span>~<span class="s2">&quot;testrbdpool&quot;</span><span class="o">}</span>
writes:<span class="w"> </span>irate<span class="o">(</span>ceph_pool_wr<span class="o">[</span>1m<span class="o">])</span><span class="w"> </span>*<span class="w"> </span>on<span class="o">(</span>pool_id<span class="o">)</span><span class="w"> </span>group_left<span class="o">(</span>instance,name<span class="o">)</span><span class="w"> </span>ceph_pool_metadata<span class="o">{</span><span class="nv">name</span><span class="o">=</span>~<span class="s2">&quot;testrbdpool&quot;</span><span class="o">}</span>

CLIENT<span class="w"> </span>Throughput<span class="w"> </span><span class="k">for</span><span class="w"> </span>a<span class="w"> </span>pool
reads:<span class="w"> </span>irate<span class="o">(</span>ceph_pool_rd_bytes<span class="o">[</span>1m<span class="o">])</span><span class="w"> </span>*<span class="w"> </span>on<span class="o">(</span>pool_id<span class="o">)</span><span class="w"> </span>group_left<span class="o">(</span>instance,name<span class="o">)</span><span class="w"> </span>ceph_pool_metadata<span class="o">{</span><span class="nv">name</span><span class="o">=</span>~<span class="s2">&quot;testrbdpool&quot;</span><span class="o">}</span>
writes:<span class="w"> </span>irate<span class="o">(</span>ceph_pool_wr_bytes<span class="o">[</span>1m<span class="o">])</span><span class="w"> </span>*<span class="w"> </span>on<span class="o">(</span>pool_id<span class="o">)</span><span class="w"> </span>group_left<span class="o">(</span>instance,name<span class="o">)</span><span class="w"> </span>ceph_pool_metadata<span class="o">{</span><span class="nv">name</span><span class="o">=</span>~<span class="s2">&quot;testrbdpool&quot;</span><span class="o">}</span>
</pre></div>
</div>
</section>
<section id="object-metrics">
<h2>Object metrics<a class="headerlink" href="#object-metrics" title="Permalink to this heading"></a></h2>
<p>These metrics have the following labels:
<code class="docutils literal notranslate"><span class="pre">instance</span></code>: the ip address of the ceph exporter daemon providing the metric
<code class="docutils literal notranslate"><span class="pre">instance_id</span></code>: identifier of the rgw daemon
<code class="docutils literal notranslate"><span class="pre">job</span></code>: prometheus scrape job</p>
<p>Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ceph_rgw_req<span class="o">{</span><span class="nv">instance</span><span class="o">=</span><span class="s2">&quot;192.168.122.7:9283&quot;</span>,<span class="w"> </span><span class="nv">instance_id</span><span class="o">=</span><span class="s2">&quot;154247&quot;</span>,<span class="w"> </span><span class="nv">job</span><span class="o">=</span><span class="s2">&quot;ceph&quot;</span><span class="o">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12345</span>
</pre></div>
</div>
<section id="generic-metrics">
<h3>Generic metrics<a class="headerlink" href="#generic-metrics" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_rgw_metadata</span></code>: Provides generic information about the RGW daemon.  It
can be used together with other metrics to provide more contextual
information in queries and graphs. Apart from the three common labels, this
metric provides the following extra labels:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_daemon</span></code>: Name of the Ceph daemon. Example:
ceph_daemon=”rgw.rgwtest.cephtest-node-00.sxizyq”,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_version</span></code>: Version of Ceph daemon. Example: ceph_version=”ceph
version 17.2.6 (d7ff0d10654d2280e08f1ab989c7cdf3064446a5) quincy (stable)”,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hostname</span></code>: Name of the host where the daemon runs. Example:
hostname:”cephtest-node-00.cephlab.com”,</p></li>
</ul>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">ceph_rgw_req</span></code>: Number total of requests for the daemon (GET+PUT+DELETE)</dt><dd><p>Useful to detect bottlenecks and optimize load distribution.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">ceph_rgw_qlen</span></code>: RGW operations queue length for the daemon.</dt><dd><p>Useful to detect bottlenecks and optimize load distribution.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">ceph_rgw_failed_req</span></code>: Aborted requests.</dt><dd><p>Useful to detect daemon errors</p>
</dd>
</dl>
</li>
</ul>
</section>
<section id="get-operations-related-metrics">
<h3>GET operations: related metrics<a class="headerlink" href="#get-operations-related-metrics" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_rgw_get_initial_lat_count</span></code>: Number of get operations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_rgw_get_initial_lat_sum</span></code>: Total latency time for the GET operations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_rgw_get</span></code>: Number total of GET requests</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_rgw_get_b</span></code>: Total bytes transferred in GET operations</p></li>
</ul>
</section>
<section id="put-operations-related-metrics">
<h3>Put operations: related metrics<a class="headerlink" href="#put-operations-related-metrics" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_rgw_put_initial_lat_count</span></code>: Number of get operations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_rgw_put_initial_lat_sum</span></code>: Total latency time for the PUT operations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_rgw_put</span></code>: Total number of PUT operations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_rgw_get_b</span></code>: Total bytes transferred in PUT operations</p></li>
</ul>
</section>
<section id="useful-queries">
<h3>Useful queries<a class="headerlink" href="#useful-queries" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>The<span class="w"> </span>average<span class="w"> </span>of<span class="w"> </span>get<span class="w"> </span>latencies:
rate<span class="o">(</span>ceph_rgw_get_initial_lat_sum<span class="o">[</span>30s<span class="o">])</span><span class="w"> </span>/<span class="w"> </span>rate<span class="o">(</span>ceph_rgw_get_initial_lat_count<span class="o">[</span>30s<span class="o">])</span><span class="w"> </span>*<span class="w"> </span>on<span class="w"> </span><span class="o">(</span>instance_id<span class="o">)</span><span class="w"> </span>group_left<span class="w"> </span><span class="o">(</span>ceph_daemon<span class="o">)</span><span class="w"> </span>ceph_rgw_metadata

The<span class="w"> </span>average<span class="w"> </span>of<span class="w"> </span>put<span class="w"> </span>latencies:
rate<span class="o">(</span>ceph_rgw_put_initial_lat_sum<span class="o">[</span>30s<span class="o">])</span><span class="w"> </span>/<span class="w"> </span>rate<span class="o">(</span>ceph_rgw_put_initial_lat_count<span class="o">[</span>30s<span class="o">])</span><span class="w"> </span>*<span class="w"> </span>on<span class="w"> </span><span class="o">(</span>instance_id<span class="o">)</span><span class="w"> </span>group_left<span class="w"> </span><span class="o">(</span>ceph_daemon<span class="o">)</span><span class="w"> </span>ceph_rgw_metadata

Total<span class="w"> </span>requests<span class="w"> </span>per<span class="w"> </span>second:
rate<span class="o">(</span>ceph_rgw_req<span class="o">[</span>30s<span class="o">])</span><span class="w"> </span>*<span class="w"> </span>on<span class="w"> </span><span class="o">(</span>instance_id<span class="o">)</span><span class="w"> </span>group_left<span class="w"> </span><span class="o">(</span>ceph_daemon<span class="o">)</span><span class="w"> </span>ceph_rgw_metadata

Total<span class="w"> </span>number<span class="w"> </span>of<span class="w"> </span><span class="s2">&quot;other&quot;</span><span class="w"> </span>operations<span class="w"> </span><span class="o">(</span>LIST,<span class="w"> </span>DELETE<span class="o">)</span>
rate<span class="o">(</span>ceph_rgw_req<span class="o">[</span>30s<span class="o">])</span><span class="w"> </span>-<span class="w">  </span><span class="o">(</span>rate<span class="o">(</span>ceph_rgw_get<span class="o">[</span>30s<span class="o">])</span><span class="w"> </span>+<span class="w"> </span>rate<span class="o">(</span>ceph_rgw_put<span class="o">[</span>30s<span class="o">]))</span>

GET<span class="w"> </span>latencies
rate<span class="o">(</span>ceph_rgw_get_initial_lat_sum<span class="o">[</span>30s<span class="o">])</span><span class="w"> </span>/<span class="w">  </span>rate<span class="o">(</span>ceph_rgw_get_initial_lat_count<span class="o">[</span>30s<span class="o">])</span><span class="w"> </span>*<span class="w"> </span>on<span class="w"> </span><span class="o">(</span>instance_id<span class="o">)</span><span class="w"> </span>group_left<span class="w"> </span><span class="o">(</span>ceph_daemon<span class="o">)</span><span class="w"> </span>ceph_rgw_metadata

PUT<span class="w"> </span>latencies
rate<span class="o">(</span>ceph_rgw_put_initial_lat_sum<span class="o">[</span>30s<span class="o">])</span><span class="w"> </span>/<span class="w">  </span>rate<span class="o">(</span>ceph_rgw_put_initial_lat_count<span class="o">[</span>30s<span class="o">])</span><span class="w"> </span>*<span class="w"> </span>on<span class="w"> </span><span class="o">(</span>instance_id<span class="o">)</span><span class="w"> </span>group_left<span class="w"> </span><span class="o">(</span>ceph_daemon<span class="o">)</span><span class="w"> </span>ceph_rgw_metadata

Bandwidth<span class="w"> </span>consumed<span class="w"> </span>by<span class="w"> </span>GET<span class="w"> </span>operations
sum<span class="o">(</span>rate<span class="o">(</span>ceph_rgw_get_b<span class="o">[</span>30s<span class="o">]))</span>

Bandwidth<span class="w"> </span>consumed<span class="w"> </span>by<span class="w"> </span>PUT<span class="w"> </span>operations
sum<span class="o">(</span>rate<span class="o">(</span>ceph_rgw_put_b<span class="o">[</span>30s<span class="o">]))</span>

Bandwidth<span class="w"> </span>consumed<span class="w"> </span>by<span class="w"> </span>RGW<span class="w"> </span>instance<span class="w"> </span><span class="o">(</span>PUTs<span class="w"> </span>+<span class="w"> </span>GETs<span class="o">)</span>
sum<span class="w"> </span>by<span class="w"> </span><span class="o">(</span>instance_id<span class="o">)</span><span class="w"> </span><span class="o">(</span>rate<span class="o">(</span>ceph_rgw_get_b<span class="o">[</span>30s<span class="o">])</span><span class="w"> </span>+<span class="w"> </span>rate<span class="o">(</span>ceph_rgw_put_b<span class="o">[</span>30s<span class="o">]))</span><span class="w"> </span>*<span class="w"> </span>on<span class="w"> </span><span class="o">(</span>instance_id<span class="o">)</span><span class="w"> </span>group_left<span class="w"> </span><span class="o">(</span>ceph_daemon<span class="o">)</span><span class="w"> </span>ceph_rgw_metadata

Http<span class="w"> </span>errors:
rate<span class="o">(</span>ceph_rgw_failed_req<span class="o">[</span>30s<span class="o">])</span>
</pre></div>
</div>
</section>
</section>
<section id="filesystem-metrics">
<h2>Filesystem Metrics<a class="headerlink" href="#filesystem-metrics" title="Permalink to this heading"></a></h2>
<p>These metrics have the following labels:
<code class="docutils literal notranslate"><span class="pre">ceph_daemon</span></code>: The name of the MDS daemon
<code class="docutils literal notranslate"><span class="pre">instance</span></code>: the ip address (and port) of of the Ceph exporter daemon exposing the metric
<code class="docutils literal notranslate"><span class="pre">job</span></code>: prometheus scrape job</p>
<p>Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ceph_mds_request<span class="o">{</span><span class="nv">ceph_daemon</span><span class="o">=</span><span class="s2">&quot;mds.test.cephtest-node-00.hmhsoh&quot;</span>,<span class="w"> </span><span class="nv">instance</span><span class="o">=</span><span class="s2">&quot;192.168.122.7:9283&quot;</span>,<span class="w"> </span><span class="nv">job</span><span class="o">=</span><span class="s2">&quot;ceph&quot;</span><span class="o">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1452</span>
</pre></div>
</div>
<section id="main-metrics">
<h3>Main metrics<a class="headerlink" href="#main-metrics" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_mds_metadata</span></code>: Provides general information about the MDS daemon.  It
can be used together with other metrics to provide more contextual
information in queries and graphs.  It provides the following extra labels:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_version</span></code>: MDS daemon Ceph version</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fs_id</span></code>: filesystem cluster id</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hostname</span></code>: Host name where the MDS daemon runs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">public_addr</span></code>: Public address where the MDS daemon runs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rank</span></code>: Rank of the MDS daemon</p></li>
</ul>
</li>
</ul>
<p>Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ceph_mds_metadata<span class="o">{</span><span class="nv">ceph_daemon</span><span class="o">=</span><span class="s2">&quot;mds.test.cephtest-node-00.hmhsoh&quot;</span>,<span class="w"> </span><span class="nv">ceph_version</span><span class="o">=</span><span class="s2">&quot;ceph version 17.2.6 (d7ff0d10654d2280e08f1ab989c7cdf3064446a5) quincy (stable)&quot;</span>,<span class="w"> </span><span class="nv">fs_id</span><span class="o">=</span><span class="s2">&quot;-1&quot;</span>,<span class="w"> </span><span class="nv">hostname</span><span class="o">=</span><span class="s2">&quot;cephtest-node-00.cephlab.com&quot;</span>,<span class="w"> </span><span class="nv">instance</span><span class="o">=</span><span class="s2">&quot;cephtest-node-00.cephlab.com:9283&quot;</span>,<span class="w"> </span><span class="nv">job</span><span class="o">=</span><span class="s2">&quot;ceph&quot;</span>,<span class="w"> </span><span class="nv">public_addr</span><span class="o">=</span><span class="s2">&quot;192.168.122.145:6801/118896446&quot;</span>,<span class="w"> </span><span class="nv">rank</span><span class="o">=</span><span class="s2">&quot;-1&quot;</span><span class="o">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_mds_request</span></code>: Total number of requests for the MDs daemon</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_mds_reply_latency_sum</span></code>: Reply latency total</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_mds_reply_latency_count</span></code>: Reply latency count</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_mds_server_handle_client_request</span></code>: Number of client requests</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_mds_sessions_session_count</span></code>: Session count</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_mds_sessions_total_load</span></code>: Total load</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_mds_sessions_sessions_open</span></code>: Sessions currently open</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_mds_sessions_sessions_stale</span></code>: Sessions currently stale</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_objecter_op_r</span></code>: Number of read operations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_objecter_op_w</span></code>: Number of write operations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_mds_root_rbytes</span></code>: Total number of bytes managed by the daemon</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_mds_root_rfiles</span></code>: Total number of files managed by the daemon</p></li>
</ul>
</section>
<section id="id2">
<h3>Useful queries:<a class="headerlink" href="#id2" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Total<span class="w"> </span>MDS<span class="w"> </span>daemons<span class="w"> </span><span class="nb">read</span><span class="w"> </span>workload:
sum<span class="o">(</span>rate<span class="o">(</span>ceph_objecter_op_r<span class="o">[</span>1m<span class="o">]))</span>

Total<span class="w"> </span>MDS<span class="w"> </span>daemons<span class="w"> </span>write<span class="w"> </span>workload:
sum<span class="o">(</span>rate<span class="o">(</span>ceph_objecter_op_w<span class="o">[</span>1m<span class="o">]))</span>

MDS<span class="w"> </span>daemon<span class="w"> </span><span class="nb">read</span><span class="w"> </span>workload:<span class="w"> </span><span class="o">(</span>daemon<span class="w"> </span>name<span class="w"> </span>is<span class="w"> </span><span class="s2">&quot;mdstest&quot;</span><span class="o">)</span>
sum<span class="o">(</span>rate<span class="o">(</span>ceph_objecter_op_r<span class="o">{</span><span class="nv">ceph_daemon</span><span class="o">=</span>~<span class="s2">&quot;mdstest&quot;</span><span class="o">}[</span>1m<span class="o">]))</span>

MDS<span class="w"> </span>daemon<span class="w"> </span>write<span class="w"> </span>workload:<span class="w"> </span><span class="o">(</span>daemon<span class="w"> </span>name<span class="w"> </span>is<span class="w"> </span><span class="s2">&quot;mdstest&quot;</span><span class="o">)</span>
sum<span class="o">(</span>rate<span class="o">(</span>ceph_objecter_op_r<span class="o">{</span><span class="nv">ceph_daemon</span><span class="o">=</span>~<span class="s2">&quot;mdstest&quot;</span><span class="o">}[</span>1m<span class="o">]))</span>

The<span class="w"> </span>average<span class="w"> </span>of<span class="w"> </span>reply<span class="w"> </span>latencies:
rate<span class="o">(</span>ceph_mds_reply_latency_sum<span class="o">[</span>30s<span class="o">])</span><span class="w"> </span>/<span class="w"> </span>rate<span class="o">(</span>ceph_mds_reply_latency_count<span class="o">[</span>30s<span class="o">])</span>

Total<span class="w"> </span>requests<span class="w"> </span>per<span class="w"> </span>second:
rate<span class="o">(</span>ceph_mds_request<span class="o">[</span>30s<span class="o">])</span><span class="w"> </span>*<span class="w"> </span>on<span class="w"> </span><span class="o">(</span>instance<span class="o">)</span><span class="w"> </span>group_right<span class="w"> </span><span class="o">(</span>ceph_daemon<span class="o">)</span><span class="w"> </span>ceph_mds_metadata
</pre></div>
</div>
</section>
</section>
<section id="block-metrics">
<h2>Block metrics<a class="headerlink" href="#block-metrics" title="Permalink to this heading"></a></h2>
<p>By default RBD metrics for images are not available in order to provide the
best performance in the prometheus manager module.</p>
<p>To produce metrics for RBD images it is needed to configure properly the
manager option <code class="docutils literal notranslate"><span class="pre">mgr/prometheus/rbd_stats_pools</span></code>. For more information please
see <a class="reference internal" href="../mgr/prometheus/#prometheus-rbd-io-statistics"><span class="std std-ref">Ceph 健康检查</span></a></p>
<p>These metrics have the following labels:
<code class="docutils literal notranslate"><span class="pre">image</span></code>: Name of the image which produces the metric value.
<code class="docutils literal notranslate"><span class="pre">instance</span></code>: Node where the rbd metric is produced. (It points to the Ceph exporter daemon)
<code class="docutils literal notranslate"><span class="pre">job</span></code>: Name of the Prometheus scrape job.
<code class="docutils literal notranslate"><span class="pre">pool</span></code>: Image pool name.</p>
<p>Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ceph_rbd_read_bytes<span class="o">{</span><span class="nv">image</span><span class="o">=</span><span class="s2">&quot;test2&quot;</span>,<span class="w"> </span><span class="nv">instance</span><span class="o">=</span><span class="s2">&quot;cephtest-node-00.cephlab.com:9283&quot;</span>,<span class="w"> </span><span class="nv">job</span><span class="o">=</span><span class="s2">&quot;ceph&quot;</span>,<span class="w"> </span><span class="nv">pool</span><span class="o">=</span><span class="s2">&quot;testrbdpool&quot;</span><span class="o">}</span>
</pre></div>
</div>
<section id="id3">
<h3>Main metrics<a class="headerlink" href="#id3" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_rbd_read_bytes</span></code>: RBD image bytes read</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_rbd_read_latency_count</span></code>: RBD image reads latency count</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_rbd_read_latency_sum</span></code>: RBD image reads latency total</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_rbd_read_ops</span></code>: RBD image reads count</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_rbd_write_bytes</span></code>: RBD image bytes written</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_rbd_write_latency_count</span></code>: RBD image writes latency count</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_rbd_write_latency_sum</span></code>: RBD image writes latency total</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph_rbd_write_ops</span></code>: RBD image writes count</p></li>
</ul>
</section>
<section id="id4">
<h3>Useful queries<a class="headerlink" href="#id4" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>The<span class="w"> </span>average<span class="w"> </span>of<span class="w"> </span><span class="nb">read</span><span class="w"> </span>latencies:
rate<span class="o">(</span>ceph_rbd_read_latency_sum<span class="o">[</span>30s<span class="o">])</span><span class="w"> </span>/<span class="w"> </span>rate<span class="o">(</span>ceph_rbd_read_latency_count<span class="o">[</span>30s<span class="o">])</span><span class="w"> </span>*<span class="w"> </span>on<span class="w"> </span><span class="o">(</span>instance<span class="o">)</span><span class="w"> </span>group_left<span class="w"> </span><span class="o">(</span>ceph_daemon<span class="o">)</span><span class="w"> </span>ceph_rgw_metadata
</pre></div>
</div>
</section>
</section>
<section id="hardware-monitoring">
<h2>Hardware monitoring<a class="headerlink" href="#hardware-monitoring" title="Permalink to this heading"></a></h2>
<p>See <a class="reference internal" href="../hardware-monitoring/#hardware-monitoring"><span class="std std-ref">Hardware monitoring</span></a></p>
</section>
</section>



<div id="support-the-ceph-foundation" class="admonition note">
  <p class="first admonition-title">Brought to you by the Ceph Foundation</p>
  <p class="last">The Ceph Documentation is a community resource funded and hosted by the non-profit <a href="https://ceph.io/en/foundation/">Ceph Foundation</a>. If you would like to support this and our other efforts, please consider <a href="https://ceph.io/en/foundation/join/">joining now</a>.</p>
</div>


           </div>
           
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../mgr/cli_api/" class="btn btn-neutral float-left" title="CLI API Commands Module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../api/" class="btn btn-neutral float-right" title="API 文档" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016, Ceph authors and contributors. Licensed under Creative Commons Attribution Share Alike 3.0 (CC-BY-SA-3.0).</p>
  </div>

   

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>