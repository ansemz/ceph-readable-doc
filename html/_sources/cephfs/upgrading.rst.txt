
升级比 Firefly 老的文件系统，需过 Jewel 这个槛
==============================================

.. tip::

    本建议是给那些用 *Firefly* (0.80) 之前的 Ceph 创建了文\
    件系统的用户们。打算创建新文件系统的用户可以忽略此建议。

Ceph 版本小于 Firefly 的，使用了现已废弃的格式来存储 CephFS
目录对象，也就是 TMAP 。到 Jewel 版以后， RADOS 就不再支持\
此格式的读取了，所以，对于升级 CephFS 的用户来说，非常重要\
的事就是转换旧目录对象格式。

在所有的 MDS 和 OSD 服务器上安装 Jewel 版、并重启服务后，\
运行下面的命令：

::
    
    cephfs-data-scan tmap_upgrade <metadata pool name>

此命令只需运行一次，且运行期间没必要中止其它服务。这个命令\
要运行不少时间，因为它得遍历元数据存储池内的所有对象。在此\
命令运行期间，你可以放心地、正常使用文件系统。如果此命令因\
故中止，可以放心地再次运行。

如果你想把一个比 Firefly 还老的 CephFS 文件系统升级到比
Jewel 更高的版本，必须先升级到 Jewel 版，然后运行
``tmap_upgrade`` 命令，之后才能升级到最新版本。

