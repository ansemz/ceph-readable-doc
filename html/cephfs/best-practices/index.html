
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>CephFS best practices &mdash; Ceph Documentation</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     'dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Ceph Documentation" href="../../" />
    <link rel="up" title="Ceph Filesystem" href="../" />
    <link rel="next" title="CephFS Administrative commands" href="../administration/" />
    <link rel="prev" title="mount.ceph – mount a ceph file system" href="../../man/8/mount.ceph/" />
    <script type="text/javascript" src="http://ayni.ceph.com/public/js/ceph.js"></script>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../administration/" title="CephFS Administrative commands"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../../man/8/mount.ceph/" title="mount.ceph – mount a ceph file system"
             accesskey="P">previous</a> |</li>
        <li><a href="../../">Ceph Documentation</a> &raquo;</li>
          <li><a href="../" accesskey="U">Ceph Filesystem</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="cephfs-best-practices">
<h1>CephFS best practices<a class="headerlink" href="#cephfs-best-practices" title="Permalink to this headline">¶</a></h1>
<p>This guide provides recommendations for best results when deploying CephFS.</p>
<p>For the actual configuration guide for CephFS, please see the instructions
at <a class="reference internal" href="../"><em>Ceph Filesystem</em></a>.</p>
<div class="section" id="which-ceph-version">
<h2>Which Ceph version?<a class="headerlink" href="#which-ceph-version" title="Permalink to this headline">¶</a></h2>
<p>Use at least the Jewel (v10.2.0) release of Ceph.  This is the first
release to include stable CephFS code and fsck/repair tools.  Make sure
you are using the latest point release to get bug fixes.</p>
<p>Note that Ceph releases do not include a kernel, this is versioned
and released separately.  See below for guidance of choosing an
appropriate kernel version if you are using the kernel client
for CephFS.</p>
</div>
<div class="section" id="most-stable-configuration">
<h2>Most stable configuration<a class="headerlink" href="#most-stable-configuration" title="Permalink to this headline">¶</a></h2>
<p>Some features in CephFS are still experimental.  See
<a class="reference internal" href="../experimental-features/"><em>Experimental Features</em></a> for guidance on these.</p>
<p>For the best chance of a happy healthy filesystem, use a <strong>single active MDS</strong>
and <strong>do not use snapshots</strong>.  Both of these are the default.</p>
<p>Note that creating multiple MDS daemons is fine, as these will simply be
used as standbys.  However, for best stability you should avoid
adjusting <tt class="docutils literal"><span class="pre">max_mds</span></tt> upwards, as this would cause multiple
daemons to be active at once.</p>
</div>
<div class="section" id="which-client">
<h2>Which client?<a class="headerlink" href="#which-client" title="Permalink to this headline">¶</a></h2>
<p>The fuse client is the easiest way to get up to date code, while
the kernel client will often give better performance.</p>
<p>The clients do not always provide equivalent functionality, for example
the fuse client supports client-enforced quotas while the kernel client
does not.</p>
<p>When encountering bugs or performance issues, it is often instructive to
try using the other client, in order to find out whether the bug was
client-specific or not (and then to let the developers know).</p>
<div class="section" id="which-kernel-version">
<h3>Which kernel version?<a class="headerlink" href="#which-kernel-version" title="Permalink to this headline">¶</a></h3>
<p>Because the kernel client is distributed as part of the linux kernel (not
as part of packaged ceph releases),
you will need to consider which kernel version to use on your client nodes.
Older kernels are known to include buggy ceph clients, and may not support
features that more recent Ceph clusters support.</p>
<p>Remember that the &#8220;latest&#8221; kernel in a stable linux distribution is likely
to be years behind the latest upstream linux kernel where Ceph development
takes place (including bug fixes).</p>
<p>As a rough guide, as of Ceph 10.x (Jewel), you should be using a least a
4.x kernel.  If you absolutely have to use an older kernel, you should use
the fuse client instead of the kernel client.</p>
<p>This advice does not apply if you are using a linux distribution that
includes CephFS support, as in this case the distributor will be responsible
for backporting fixes to their stable kernel: check with your vendor.</p>
</div>
</div>
<div class="section" id="reporting-issues">
<h2>Reporting issues<a class="headerlink" href="#reporting-issues" title="Permalink to this headline">¶</a></h2>
<p>If you have identified a specific issue, please report it with as much
information as possible.  Especially important information:</p>
<ul class="simple">
<li>Ceph versions installed on client and server</li>
<li>Whether you are using the kernel or fuse client</li>
<li>If you are using the kernel client, what kernel version?</li>
<li>How many clients are in play, doing what kind of workload?</li>
<li>If a system is &#8216;stuck&#8217;, is that affecting all clients or just one?</li>
<li>Any ceph health messages</li>
<li>Any backtraces in the ceph logs from crashes</li>
</ul>
<p>If you are satisfied that you have found a bug, please file it on
<a class="reference external" href="http://tracker.ceph.com">http://tracker.ceph.com</a>.  For more general queries please write
to the ceph-users mailing list.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../start/intro/">Intro to Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../start/">Installation (Quick)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/">Installation (Manual)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rados/">Ceph Storage Cluster</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">Ceph Filesystem</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../#using-cephfs">Using CephFS</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../rados/deployment/ceph-deploy-mds/">Add/Remove MDS(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../standby/">Terminology</a></li>
<li class="toctree-l3"><a class="reference internal" href="../standby/#referring-to-mds-daemons">Referring to MDS daemons</a></li>
<li class="toctree-l3"><a class="reference internal" href="../standby/#managing-failover">Managing failover</a></li>
<li class="toctree-l3"><a class="reference internal" href="../standby/#configuring-standby-daemons">Configuring standby daemons</a></li>
<li class="toctree-l3"><a class="reference internal" href="../standby/#examples">Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mds-config-ref/">MDS Configuration Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../client-config-ref/">Client Configuration Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../journaler/">Journaler Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../man/8/ceph-mds/">Manpage ceph-mds</a></li>
<li class="toctree-l3"><a class="reference internal" href="../createfs/">Create CephFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../kernel/">Mount CephFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fuse/">Mount CephFS as FUSE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fstab/">Mount CephFS in fstab</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../man/8/ceph-fuse/">Manpage ceph-fuse</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../man/8/mount.ceph/">Manpage mount.ceph</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">Deployment best practices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#which-ceph-version">Which Ceph version?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#most-stable-configuration">Most stable configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#which-client">Which client?</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#which-kernel-version">Which kernel version?</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#reporting-issues">Reporting issues</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../administration/">Administrative commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../posix/">POSIX compatibility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../experimental-features/">Experimental Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../experimental-features/#previously-experimental-features">Previously experimental features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quota/">CephFS Quotas</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hadoop/">Using Ceph with Hadoop</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cephfs-journal-tool/">cephfs-journal-tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../file-layouts/">File layouts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../eviction/">Client eviction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../full/">Handling full filesystems</a></li>
<li class="toctree-l3"><a class="reference internal" href="../health-messages/">Health messages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting/">Troubleshooting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../disaster-recovery/">Disaster recovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="../client-auth/">Client authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../upgrading/">Upgrading old filesystems</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dirfrags/">Configuring directory fragmentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../multimds/">Configuring multiple active MDS daemons</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../#for-developers">For developers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../rbd/rbd/">Ceph Block Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../radosgw/">Ceph Object Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mgr/">Ceph Manager Daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture/">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/">Ceph Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary/">Glossary</a></li>
</ul>


<!-- ugly kludge to make genindex look like it's part of the toc -->
<ul style="margin-top: -10px"><li class="toctree-l1"><a class="reference internal" href="../../genindex/">Index</a></li></ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../administration/" title="CephFS Administrative commands"
             >next</a> |</li>
        <li class="right" >
          <a href="../../man/8/mount.ceph/" title="mount.ceph – mount a ceph file system"
             >previous</a> |</li>
        <li><a href="../../">Ceph Documentation</a> &raquo;</li>
          <li><a href="../" >Ceph Filesystem</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2016, Red Hat, Inc, and contributors. Licensed under Creative Commons BY-SA.
    </div>
  </body>
</html>