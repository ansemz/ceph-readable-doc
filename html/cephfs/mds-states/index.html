
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>MDS States &#8212; Ceph Documentation</title>
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/js/ceph.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="Terminology" href="../standby/" />
    <link rel="prev" title="Add/Remove Metadata Server" href="../add-remove-mds/" />
    <script type="text/javascript" src="http://ayni.ceph.com/public/js/ceph.js"></script>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../standby/" title="Terminology"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../add-remove-mds/" title="Add/Remove Metadata Server"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">Ceph Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../" accesskey="U">Ceph Filesystem</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            

<div id="dev-warning" class="admonition note" style="display:none;">
  <p class="first admonition-title">Notice</p>
  <p class="last">This document is for a development version of Ceph.</p>
</div>

<div id="eol-warning" class="admonition warning" style="display:none;">
  <p class="first admonition-title">Warning</p>
  <p class="last">This document is for an unsupported version of Ceph.</p>
</div>
  <div id="docubetter" align="right" style="display:none; padding: 15px; font-weight: bold;">
    <a id="edit-on-github" href="https://github.com/ceph/ceph/edit/master/doc/cephfs/mds-states.rst" rel="nofollow">Edit on GitHub</a> | <a href="https://github.com/ceph/ceph/projects/4">Report a Documentation Bug</a>
  </div>

  
  <div class="section" id="mds-states">
<h1>MDS States<a class="headerlink" href="#mds-states" title="Permalink to this headline">¶</a></h1>
<p>The Metadata Server (MDS) goes through several states during normal operation
in CephFS. For example, some states indicate that the MDS is recovering from a
failover by a previous instance of the MDS. Here we’ll document all of these
states and include a state diagram to visualize the transitions.</p>
<div class="section" id="state-descriptions">
<h2>State Descriptions<a class="headerlink" href="#state-descriptions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="common-states">
<h3>Common states<a class="headerlink" href="#common-states" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">up</span><span class="p">:</span><span class="n">active</span>
</pre></div>
</div>
<p>This is the normal operating state of the MDS. It indicates that the MDS
and its rank in the file system is available.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">up</span><span class="p">:</span><span class="n">standby</span>
</pre></div>
</div>
<p>The MDS is available to takeover for a failed rank (see also <a class="reference internal" href="../standby/#mds-standby"><span class="std std-ref">Terminology</span></a>).
The monitor will automatically assign an MDS in this state to a failed rank
once available.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">up</span><span class="p">:</span><span class="n">standby_replay</span>
</pre></div>
</div>
<p>The MDS is following the journal of another <code class="docutils literal notranslate"><span class="pre">up:active</span></code> MDS. Should the
active MDS fail, having a standby MDS in replay mode is desirable as the MDS is
replaying the live journal and will more quickly takeover. A downside to having
standby replay MDSs is that they are not available to takeover for any other
MDS that fails, only the MDS they follow.</p>
</div>
<div class="section" id="less-common-or-transitory-states">
<h3>Less common or transitory states<a class="headerlink" href="#less-common-or-transitory-states" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">up</span><span class="p">:</span><span class="n">boot</span>
</pre></div>
</div>
<p>This state is broadcast to the Ceph monitors during startup. This state is
never visible as the Monitor immediately assign the MDS to an available rank or
commands the MDS to operate as a standby. The state is documented here for
completeness.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">up</span><span class="p">:</span><span class="n">creating</span>
</pre></div>
</div>
<p>The MDS is creating a new rank (perhaps rank 0) by constructing some per-rank
metadata (like the journal) and entering the MDS cluster.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">up</span><span class="p">:</span><span class="n">starting</span>
</pre></div>
</div>
<p>The MDS is restarting a stopped rank. It opens associated per-rank metadata
and enters the MDS cluster.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">up</span><span class="p">:</span><span class="n">stopping</span>
</pre></div>
</div>
<p>When a rank is stopped, the monitors command an active MDS to enter the
<code class="docutils literal notranslate"><span class="pre">up:stopping</span></code> state. In this state, the MDS accepts no new client
connections, migrates all subtrees to other ranks in the file system, flush its
metadata journal, and, if the last rank (0), evict all clients and shutdown
(see also <a class="reference internal" href="../administration/#cephfs-administration"><span class="std std-ref">CephFS Administrative commands</span></a>).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">up</span><span class="p">:</span><span class="n">replay</span>
</pre></div>
</div>
<p>The MDS taking over a failed rank. This state represents that the MDS is
recovering its journal and other metadata.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">up</span><span class="p">:</span><span class="n">resolve</span>
</pre></div>
</div>
<p>The MDS enters this state from <code class="docutils literal notranslate"><span class="pre">up:replay</span></code> if the Ceph file system has
multiple ranks (including this one), i.e. it’s not a single active MDS cluster.
The MDS is resolving any uncommitted inter-MDS operations. All ranks in the
file system must be in this state or later for progress to be made, i.e. no
rank can be failed/damaged or <code class="docutils literal notranslate"><span class="pre">up:replay</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">up</span><span class="p">:</span><span class="n">reconnect</span>
</pre></div>
</div>
<p>An MDS enters this state from <code class="docutils literal notranslate"><span class="pre">up:replay</span></code> or <code class="docutils literal notranslate"><span class="pre">up:resolve</span></code>. This state is to
solicit reconnections from clients. Any client which had a session with this
rank must reconnect during this time, configurable via
<code class="docutils literal notranslate"><span class="pre">mds_reconnect_timeout</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">up</span><span class="p">:</span><span class="n">rejoin</span>
</pre></div>
</div>
<p>The MDS enters this state from <code class="docutils literal notranslate"><span class="pre">up:reconnect</span></code>. In this state, the MDS is
rejoining the MDS cluster cache. In particular, all inter-MDS locks on metadata
are reestablished.</p>
<p>If there are no known client requests to be replayed, the MDS directly becomes
<code class="docutils literal notranslate"><span class="pre">up:active</span></code> from this state.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">up</span><span class="p">:</span><span class="n">clientreplay</span>
</pre></div>
</div>
<p>The MDS may enter this state from <code class="docutils literal notranslate"><span class="pre">up:rejoin</span></code>. The MDS is replaying any
client requests which were replied to but not yet durable (not journaled).
Clients resend these requests during <code class="docutils literal notranslate"><span class="pre">up:reconnect</span></code> and the requests are
replayed once again. The MDS enters <code class="docutils literal notranslate"><span class="pre">up:active</span></code> after completing replay.</p>
</div>
<div class="section" id="failed-states">
<h3>Failed states<a class="headerlink" href="#failed-states" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">down</span><span class="p">:</span><span class="n">failed</span>
</pre></div>
</div>
<p>No MDS actually holds this state. Instead, it is applied to the rank in the file system. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ceph fs dump
...
max_mds 1
in      0
up      {}
failed  0
...
</pre></div>
</div>
<p>Rank 0 is part of the failed set.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">down</span><span class="p">:</span><span class="n">damaged</span>
</pre></div>
</div>
<p>No MDS actually holds this state. Instead, it is applied to the rank in the file system. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ceph fs dump
...
max_mds 1
in      0
up      {}
failed
damaged 0
...
</pre></div>
</div>
<p>Rank 0 has become damaged (see also <a class="reference internal" href="../disaster-recovery/#cephfs-disaster-recovery"><span class="std std-ref">Disaster recovery</span></a>) and placed in
the <code class="docutils literal notranslate"><span class="pre">damaged</span></code> set. An MDS which was running as rank 0 found metadata damage
that could not be automatically recovered. Operator intervention is required.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">down</span><span class="p">:</span><span class="n">stopped</span>
</pre></div>
</div>
<p>No MDS actually holds this state. Instead, it is applied to the rank in the file system. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ceph fs dump
...
max_mds 1
in      0
up      {}
failed
damaged
stopped 1
...
</pre></div>
</div>
<p>The rank has been stopped by reducing <code class="docutils literal notranslate"><span class="pre">max_mds</span></code> (see also <a class="reference internal" href="../multimds/#cephfs-multimds"><span class="std std-ref">Configuring multiple active MDS daemons</span></a>).</p>
</div>
</div>
<div class="section" id="state-diagram">
<h2>State Diagram<a class="headerlink" href="#state-diagram" title="Permalink to this headline">¶</a></h2>
<p>This state diagram shows the possible state transitions for the MDS/rank. The legend is as follows:</p>
<div class="section" id="color">
<h3>Color<a class="headerlink" href="#color" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Green: MDS is active.</li>
<li>Orange: MDS is in transient state trying to become active.</li>
<li>Red: MDS is indicating a state that causes the rank to be marked failed.</li>
<li>Purple: MDS and rank is stopping.</li>
<li>Red: MDS is indicating a state that causes the rank to be marked damaged.</li>
</ul>
</div>
<div class="section" id="shape">
<h3>Shape<a class="headerlink" href="#shape" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Circle: an MDS holds this state.</li>
<li>Hexagon: no MDS holds this state (it is applied to the rank).</li>
</ul>
</div>
<div class="section" id="lines">
<h3>Lines<a class="headerlink" href="#lines" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>A double-lined shape indicates the rank is “in”.</li>
</ul>
<img alt="../../_images/mds-state-diagram.svg" src="../../_images/mds-state-diagram.svg" /></div>
</div>
</div>



          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../start/intro/">Intro to Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../start/">Installation (ceph-deploy)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/">Installation (Manual)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../start/kube-helm/">Installation (Kubernetes + Helm)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rados/">Ceph Storage Cluster</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">Ceph Filesystem</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../#using-cephfs">Using CephFS</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../add-remove-mds/">Add/Remove MDS(s)</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">MDS states</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#state-descriptions">State Descriptions</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#common-states">Common states</a></li>
<li class="toctree-l5"><a class="reference internal" href="#less-common-or-transitory-states">Less common or transitory states</a></li>
<li class="toctree-l5"><a class="reference internal" href="#failed-states">Failed states</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#state-diagram">State Diagram</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#color">Color</a></li>
<li class="toctree-l5"><a class="reference internal" href="#shape">Shape</a></li>
<li class="toctree-l5"><a class="reference internal" href="#lines">Lines</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../standby/">Terminology</a></li>
<li class="toctree-l3"><a class="reference internal" href="../standby/#referring-to-mds-daemons">Referring to MDS daemons</a></li>
<li class="toctree-l3"><a class="reference internal" href="../standby/#managing-failover">Managing failover</a></li>
<li class="toctree-l3"><a class="reference internal" href="../standby/#configuring-standby-daemons">Configuring standby daemons</a></li>
<li class="toctree-l3"><a class="reference internal" href="../standby/#examples">Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mds-config-ref/">MDS Configuration Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../client-config-ref/">Client Configuration Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../journaler/">Journaler Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../man/8/ceph-mds/">Manpage ceph-mds</a></li>
<li class="toctree-l3"><a class="reference internal" href="../createfs/">Create CephFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../kernel/">Mount CephFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fuse/">Mount CephFS as FUSE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fstab/">Mount CephFS in fstab</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cephfs-shell/">Use the CephFS Shell</a></li>
<li class="toctree-l3"><a class="reference internal" href="../kernel-features/">Supported Features of Kernel Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../man/8/ceph-fuse/">Manpage ceph-fuse</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../man/8/mount.ceph/">Manpage mount.ceph</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../man/8/mount.fuse.ceph/">Manpage mount.fuse.ceph</a></li>
<li class="toctree-l3"><a class="reference internal" href="../best-practices/">Deployment best practices</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">MDS States</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#state-descriptions">State Descriptions</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#common-states">Common states</a></li>
<li class="toctree-l5"><a class="reference internal" href="#less-common-or-transitory-states">Less common or transitory states</a></li>
<li class="toctree-l5"><a class="reference internal" href="#failed-states">Failed states</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#state-diagram">State Diagram</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#color">Color</a></li>
<li class="toctree-l5"><a class="reference internal" href="#shape">Shape</a></li>
<li class="toctree-l5"><a class="reference internal" href="#lines">Lines</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../administration/">Administrative commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cache-size-limits/">Understanding MDS Cache Size Limits</a></li>
<li class="toctree-l3"><a class="reference internal" href="../posix/">POSIX compatibility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../experimental-features/">Experimental Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../experimental-features/#previously-experimental-features">Previously experimental features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quota/">CephFS Quotas</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hadoop/">Using Ceph with Hadoop</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cephfs-journal-tool/">cephfs-journal-tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../file-layouts/">File layouts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../eviction/">Client eviction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../full/">Handling full filesystems</a></li>
<li class="toctree-l3"><a class="reference internal" href="../health-messages/">Health messages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting/">Troubleshooting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../disaster-recovery/">Disaster recovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="../client-auth/">Client authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../upgrading/">Upgrading the MDS Cluster</a></li>
<li class="toctree-l3"><a class="reference internal" href="../upgrading/#upgrading-pre-firefly-filesystems-past-jewel">Upgrading pre-Firefly filesystems past Jewel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dirfrags/">Configuring directory fragmentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../multimds/">Configuring multiple active MDS daemons</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nfs/">Export over NFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app-best-practices/">Application best practices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../disaster-recovery-experts/"> Advanced: Metadata repair</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../#for-developers">For developers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../rbd/">Ceph Block Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../radosgw/">Ceph Object Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mgr/">Ceph Manager Daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture/">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/internals/">Ceph Internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../governance/">Governance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ceph-volume/">ceph-volume</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/">Ceph Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary/">Glossary</a></li>
</ul>


<!-- ugly kludge to make genindex look like it's part of the toc -->
<ul style="margin-top: -10px"><li class="toctree-l1"><a class="reference internal" href="../../genindex/">Index</a></li></ul>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../standby/" title="Terminology"
             >next</a> |</li>
        <li class="right" >
          <a href="../add-remove-mds/" title="Add/Remove Metadata Server"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">Ceph Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../" >Ceph Filesystem</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Red Hat, Inc, and contributors. Licensed under Creative Commons Attribution Share Alike 3.0 (CC-BY-SA-3.0).
    </div>
  </body>
</html>