
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>File layouts &mdash; Ceph Documentation</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     'dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Ceph Documentation" href="../../" />
    <link rel="up" title="Ceph Filesystem" href="../" />
    <link rel="next" title="Ceph filesystem client eviction" href="../eviction/" />
    <link rel="prev" title="cephfs-journal-tool" href="../cephfs-journal-tool/" />
    <script type="text/javascript" src="http://ayni.ceph.com/public/js/ceph.js"></script>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../eviction/" title="Ceph filesystem client eviction"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../cephfs-journal-tool/" title="cephfs-journal-tool"
             accesskey="P">previous</a> |</li>
        <li><a href="../../">Ceph Documentation</a> &raquo;</li>
          <li><a href="../" accesskey="U">Ceph Filesystem</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="file-layouts">
<h1>File layouts<a class="headerlink" href="#file-layouts" title="Permalink to this headline">¶</a></h1>
<p>The layout of a file controls how its contents are mapped to Ceph RADOS objects.  You can
read and write a file&#8217;s layout using <em>virtual extended attributes</em> or xattrs.</p>
<p>The name of the layout xattrs depends on whether a file is a regular file or a directory.  Regular
files&#8217; layout xattrs are called <tt class="docutils literal"><span class="pre">ceph.file.layout</span></tt>, whereas directories&#8217; layout xattrs are called
<tt class="docutils literal"><span class="pre">ceph.dir.layout</span></tt>.  Where subsequent examples refer to <tt class="docutils literal"><span class="pre">ceph.file.layout</span></tt>, substitute <tt class="docutils literal"><span class="pre">dir</span></tt> as appropriate
when dealing with directories.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Your linux distribution may not ship with commands for manipulating xattrs by default,
the required package is usually called <tt class="docutils literal"><span class="pre">attr</span></tt>.</p>
</div>
<div class="section" id="layout-fields">
<h2>Layout fields<a class="headerlink" href="#layout-fields" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>pool</dt>
<dd>String, giving ID or name.  Which RADOS pool a file&#8217;s data objects will be stored in.</dd>
<dt>pool_namespace</dt>
<dd>String.  Within the data pool, which RADOS namespace the objects will
be written to.  Empty by default (i.e. default namespace).</dd>
<dt>stripe_unit</dt>
<dd>Integer in bytes.  The size (in bytes) of a block of data used in the RAID 0 distribution of a file. All stripe units for a file have equal size. The last stripe unit is typically incomplete–i.e. it represents the data at the end of the file as well as unused “space” beyond it up to the end of the fixed stripe unit size.</dd>
<dt>stripe_count</dt>
<dd>Integer.  The number of consecutive stripe units that constitute a RAID 0 “stripe” of file data.</dd>
<dt>object_size</dt>
<dd>Integer in bytes.  File data is chunked into RADOS objects of this size.</dd>
</dl>
</div>
<div class="section" id="reading-layouts-with-getfattr">
<h2>Reading layouts with <tt class="docutils literal"><span class="pre">getfattr</span></tt><a class="headerlink" href="#reading-layouts-with-getfattr" title="Permalink to this headline">¶</a></h2>
<p>Read the layout information as a single string:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ touch file
$ getfattr -n ceph.file.layout file
<span class="c1"># file: file</span>
ceph.file.layout<span class="o">=</span><span class="s2">&quot;stripe_unit=4194304 stripe_count=1 object_size=4194304 pool=cephfs_data&quot;</span>
</pre></div>
</div>
<p>Read individual layout fields:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ getfattr -n ceph.file.layout.pool file
<span class="c1"># file: file</span>
ceph.file.layout.pool<span class="o">=</span><span class="s2">&quot;cephfs_data&quot;</span>
$ getfattr -n ceph.file.layout.stripe_unit file
<span class="c1"># file: file</span>
ceph.file.layout.stripe_unit<span class="o">=</span><span class="s2">&quot;4194304&quot;</span>
$ getfattr -n ceph.file.layout.stripe_count file
<span class="c1"># file: file</span>
ceph.file.layout.stripe_count<span class="o">=</span><span class="s2">&quot;1&quot;</span>
$ getfattr -n ceph.file.layout.object_size file
<span class="c1"># file: file</span>
ceph.file.layout.object_size<span class="o">=</span><span class="s2">&quot;4194304&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When reading layouts, the pool will usually be indicated by name.  However, in
rare cases when pools have only just been created, the ID may be output instead.</p>
</div>
<p>Directories do not have an explicit layout until it is customized.  Attempts to read
the layout will fail if it has never been modified: this indicates that layout of the
next ancestor directory with an explicit layout will be used.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ mkdir dir
$ getfattr -n ceph.dir.layout dir
dir: ceph.dir.layout: No such attribute
$ setfattr -n ceph.dir.layout.stripe_count -v <span class="m">2</span> dir
$ getfattr -n ceph.dir.layout dir
<span class="c1"># file: dir</span>
ceph.dir.layout<span class="o">=</span><span class="s2">&quot;stripe_unit=4194304 stripe_count=2 object_size=4194304 pool=cephfs_data&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="writing-layouts-with-setfattr">
<h2>Writing layouts with <tt class="docutils literal"><span class="pre">setfattr</span></tt><a class="headerlink" href="#writing-layouts-with-setfattr" title="Permalink to this headline">¶</a></h2>
<p>Layout fields are modified using <tt class="docutils literal"><span class="pre">setfattr</span></tt>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ ceph osd lspools
<span class="m">0</span> rbd,1 cephfs_data,2 cephfs_metadata,

$ setfattr -n ceph.file.layout.stripe_unit -v <span class="m">1048576</span> file2
$ setfattr -n ceph.file.layout.stripe_count -v <span class="m">8</span> file2
$ setfattr -n ceph.file.layout.object_size -v <span class="m">10485760</span> file2
$ setfattr -n ceph.file.layout.pool -v <span class="m">1</span> file2  <span class="c1"># Setting pool by ID</span>
$ setfattr -n ceph.file.layout.pool -v cephfs_data file2  <span class="c1"># Setting pool by name</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When the layout fields of a file are modified using <tt class="docutils literal"><span class="pre">setfattr</span></tt>, this file must be empty, otherwise an error will occur.</p>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># touch an empty file</span>
$ touch file1
<span class="c1"># modify layout field successfully</span>
$ setfattr -n ceph.file.layout.stripe_count -v <span class="m">3</span> file1

<span class="c1"># write something to file1</span>
$ <span class="nb">echo</span> <span class="s2">&quot;hello world&quot;</span> &gt; file1
$ setfattr -n ceph.file.layout.stripe_count -v <span class="m">4</span> file1
setfattr: file1: Directory not empty
</pre></div>
</div>
</div>
<div class="section" id="clearing-layouts">
<h2>Clearing layouts<a class="headerlink" href="#clearing-layouts" title="Permalink to this headline">¶</a></h2>
<p>If you wish to remove an explicit layout from a directory, to revert to
inherting the layout of its ancestor, you can do so:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>setfattr -x ceph.dir.layout mydir
</pre></div>
</div>
<p>Similarly, if you have set the <tt class="docutils literal"><span class="pre">pool_namespace</span></tt> attribute and wish
to modify the layout to use the default namespace instead:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># Create a dir and set a namespace on it</span>
mkdir mydir
setfattr -n ceph.dir.layout.pool_namespace -v foons mydir
getfattr -n ceph.dir.layout mydir
ceph.dir.layout<span class="o">=</span><span class="s2">&quot;stripe_unit=4194304 stripe_count=1 object_size=4194304 pool=cephfs_data_a pool_namespace=foons&quot;</span>

<span class="c1"># Clear the namespace from the directory&#39;s layout</span>
setfattr -x ceph.dir.layout.pool_namespace mydir
getfattr -n ceph.dir.layout mydir
ceph.dir.layout<span class="o">=</span><span class="s2">&quot;stripe_unit=4194304 stripe_count=1 object_size=4194304 pool=cephfs_data_a&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="inheritance-of-layouts">
<h2>Inheritance of layouts<a class="headerlink" href="#inheritance-of-layouts" title="Permalink to this headline">¶</a></h2>
<p>Files inherit the layout of their parent directory at creation time.  However, subsequent
changes to the parent directory&#8217;s layout do not affect children.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ getfattr -n ceph.dir.layout dir
<span class="c1"># file: dir</span>
ceph.dir.layout<span class="o">=</span><span class="s2">&quot;stripe_unit=4194304 stripe_count=2 object_size=4194304 pool=cephfs_data&quot;</span>

<span class="c1"># Demonstrate file1 inheriting its parent&#39;s layout</span>
$ touch dir/file1
$ getfattr -n ceph.file.layout dir/file1
<span class="c1"># file: dir/file1</span>
ceph.file.layout<span class="o">=</span><span class="s2">&quot;stripe_unit=4194304 stripe_count=2 object_size=4194304 pool=cephfs_data&quot;</span>

<span class="c1"># Now update the layout of the directory before creating a second file</span>
$ setfattr -n ceph.dir.layout.stripe_count -v <span class="m">4</span> dir
$ touch dir/file2

<span class="c1"># Demonstrate that file1&#39;s layout is unchanged</span>
$ getfattr -n ceph.file.layout dir/file1
<span class="c1"># file: dir/file1</span>
ceph.file.layout<span class="o">=</span><span class="s2">&quot;stripe_unit=4194304 stripe_count=2 object_size=4194304 pool=cephfs_data&quot;</span>

<span class="c1"># ...while file2 has the parent directory&#39;s new layout</span>
$ getfattr -n ceph.file.layout dir/file2
<span class="c1"># file: dir/file2</span>
ceph.file.layout<span class="o">=</span><span class="s2">&quot;stripe_unit=4194304 stripe_count=4 object_size=4194304 pool=cephfs_data&quot;</span>
</pre></div>
</div>
<p>Files created as descendents of the directory also inherit the layout, if the intermediate
directories do not have layouts set:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ getfattr -n ceph.dir.layout dir
<span class="c1"># file: dir</span>
ceph.dir.layout<span class="o">=</span><span class="s2">&quot;stripe_unit=4194304 stripe_count=4 object_size=4194304 pool=cephfs_data&quot;</span>
$ mkdir dir/childdir
$ getfattr -n ceph.dir.layout dir/childdir
dir/childdir: ceph.dir.layout: No such attribute
$ touch dir/childdir/grandchild
$ getfattr -n ceph.file.layout dir/childdir/grandchild
<span class="c1"># file: dir/childdir/grandchild</span>
ceph.file.layout<span class="o">=</span><span class="s2">&quot;stripe_unit=4194304 stripe_count=4 object_size=4194304 pool=cephfs_data&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-a-data-pool-to-the-mds">
<h2>Adding a data pool to the MDS<a class="headerlink" href="#adding-a-data-pool-to-the-mds" title="Permalink to this headline">¶</a></h2>
<p>Before you can use a pool with CephFS you have to add it to the Metadata Servers.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ ceph fs add_data_pool cephfs cephfs_data_ssd
<span class="c1"># Pool should now show up</span>
$ ceph fs ls
.... data pools: <span class="o">[</span>cephfs_data cephfs_data_ssd <span class="o">]</span>
</pre></div>
</div>
<p>Make sure that your cephx keys allows the client to access this new pool.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../start/intro/">Intro to Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../start/">Installation (Quick)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/">Installation (Manual)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rados/">Ceph Storage Cluster</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">Ceph Filesystem</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../#using-cephfs">Using CephFS</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../rados/deployment/ceph-deploy-mds/">Add/Remove MDS(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../standby/">Terminology</a></li>
<li class="toctree-l3"><a class="reference internal" href="../standby/#referring-to-mds-daemons">Referring to MDS daemons</a></li>
<li class="toctree-l3"><a class="reference internal" href="../standby/#managing-failover">Managing failover</a></li>
<li class="toctree-l3"><a class="reference internal" href="../standby/#configuring-standby-daemons">Configuring standby daemons</a></li>
<li class="toctree-l3"><a class="reference internal" href="../standby/#examples">Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mds-config-ref/">MDS Configuration Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../client-config-ref/">Client Configuration Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../journaler/">Journaler Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../man/8/ceph-mds/">Manpage ceph-mds</a></li>
<li class="toctree-l3"><a class="reference internal" href="../createfs/">Create CephFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../kernel/">Mount CephFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fuse/">Mount CephFS as FUSE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fstab/">Mount CephFS in fstab</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../man/8/ceph-fuse/">Manpage ceph-fuse</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../man/8/mount.ceph/">Manpage mount.ceph</a></li>
<li class="toctree-l3"><a class="reference internal" href="../best-practices/">Deployment best practices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../administration/">Administrative commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../posix/">POSIX compatibility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../experimental-features/">Experimental Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../experimental-features/#previously-experimental-features">Previously experimental features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quota/">CephFS Quotas</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hadoop/">Using Ceph with Hadoop</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cephfs-journal-tool/">cephfs-journal-tool</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">File layouts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#layout-fields">Layout fields</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reading-layouts-with-getfattr">Reading layouts with <tt class="docutils literal"><span class="pre">getfattr</span></tt></a></li>
<li class="toctree-l4"><a class="reference internal" href="#writing-layouts-with-setfattr">Writing layouts with <tt class="docutils literal"><span class="pre">setfattr</span></tt></a></li>
<li class="toctree-l4"><a class="reference internal" href="#clearing-layouts">Clearing layouts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#inheritance-of-layouts">Inheritance of layouts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-a-data-pool-to-the-mds">Adding a data pool to the MDS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../eviction/">Client eviction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../full/">Handling full filesystems</a></li>
<li class="toctree-l3"><a class="reference internal" href="../health-messages/">Health messages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting/">Troubleshooting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../disaster-recovery/">Disaster recovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="../client-auth/">Client authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../upgrading/">Upgrading old filesystems</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dirfrags/">Configuring directory fragmentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../multimds/">Configuring multiple active MDS daemons</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../#for-developers">For developers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../rbd/rbd/">Ceph Block Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../radosgw/">Ceph Object Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mgr/">Ceph Manager Daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture/">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/">Ceph Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary/">Glossary</a></li>
</ul>


<!-- ugly kludge to make genindex look like it's part of the toc -->
<ul style="margin-top: -10px"><li class="toctree-l1"><a class="reference internal" href="../../genindex/">Index</a></li></ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../eviction/" title="Ceph filesystem client eviction"
             >next</a> |</li>
        <li class="right" >
          <a href="../cephfs-journal-tool/" title="cephfs-journal-tool"
             >previous</a> |</li>
        <li><a href="../../">Ceph Documentation</a> &raquo;</li>
          <li><a href="../" >Ceph Filesystem</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2016, Red Hat, Inc, and contributors. Licensed under Creative Commons BY-SA.
    </div>
  </body>
</html>