

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Pacific &mdash; Ceph Documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/ceph.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="Octopus" href="../octopus/" />
    <link rel="prev" title="Ceph 版本（索引）" href="../" /> 
</head>

<body class="wy-body-for-nav">

   
  <header class="top-bar">
    

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../">Ceph 版本（索引）</a> &raquo;</li>
        
      <li>Pacific</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/releases/pacific.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
  </header>
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #eee" >
          

          
            <a href="../../">
          

          
            
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../start/intro/">Ceph 简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/">安装 Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cephadm/">Cephadm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rados/">Ceph 存储集群</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cephfs/">Ceph 文件系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rbd/">Ceph 块设备</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../radosgw/">Ceph 对象网关</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mgr/">Ceph 管理器守护进程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mgr/dashboard/">Ceph 仪表盘</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/">API 文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture/">体系结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/developer_guide/">开发者指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/internals/">Ceph 内幕</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../governance/">项目管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../foundation/">Ceph 基金会</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ceph-volume/">ceph-volume</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general/">Ceph 版本（总目录）</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">Ceph 版本（索引）</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../#active-releases">活跃版本</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Pacific (v16.2.*)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#v16-2-6-pacific">v16.2.6 Pacific</a></li>
<li class="toctree-l4"><a class="reference internal" href="#v16-2-5-pacific">v16.2.5 Pacific</a></li>
<li class="toctree-l4"><a class="reference internal" href="#v16-2-4-pacific">v16.2.4 Pacific</a></li>
<li class="toctree-l4"><a class="reference internal" href="#v16-2-3-pacific">v16.2.3 Pacific</a></li>
<li class="toctree-l4"><a class="reference internal" href="#v16-2-2-pacific">v16.2.2 Pacific</a></li>
<li class="toctree-l4"><a class="reference internal" href="#v16-2-1-pacific">v16.2.1 Pacific</a></li>
<li class="toctree-l4"><a class="reference internal" href="#v16-2-0-pacific">v16.2.0 Pacific</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../octopus/">Octopus (v15.2.*)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nautilus/">Nautilus (v14.2.*)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../#id2">归档版本</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../security/">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary/">Ceph 术语</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../jaegertracing/">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../translation_cn/">中文版翻译资源</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../">Ceph</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
<div id="dev-warning" class="admonition note">
  <p class="first admonition-title">Notice</p>
  <p class="last">This document is for a development version of Ceph.</p>
</div>
  <div id="docubetter" align="right" style="padding: 5px; font-weight: bold;">
    <a href="https://pad.ceph.com/p/Report_Documentation_Bugs">Report a Documentation Bug</a>
  </div>

  
  <div class="section" id="pacific">
<h1>Pacific<a class="headerlink" href="#pacific" title="Permalink to this headline">¶</a></h1>
<p>Pacific is the 16th stable release of Ceph.  It is named after the
giant pacific octopus (Enteroctopus dofleini).</p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>DATE: 01 NOV 2021.</p>
<p>DO NOT UPGRADE TO CEPH PACIFIC FROM AN OLDER VERSION.</p>
<p>A recently-discovered bug (<a class="reference external" href="https://tracker.ceph.com/issues/53062">https://tracker.ceph.com/issues/53062</a>) can cause
data corruption. This bug occurs during OMAP format conversion for
clusters that are updated to Pacific. New clusters are not affected by this
bug.</p>
<p>The trigger for this bug is BlueStore’s repair/quick-fix functionality. This
bug can be triggered in two known ways:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>manually via the ceph-bluestore-tool, or</p></li>
<li><p>automatically, by OSD if <code class="docutils literal notranslate"><span class="pre">bluestore_fsck_quick_fix_on_mount</span></code> is set
to true.</p></li>
</ol>
</div></blockquote>
<p>The fix for this bug is expected to be available in Ceph v16.2.7.</p>
<p>DO NOT set <code class="docutils literal notranslate"><span class="pre">bluestore_quick_fix_on_mount</span></code> to true. If it is currently
set to true in your configuration, immediately set it to false.</p>
<p>DO NOT run <code class="docutils literal notranslate"><span class="pre">ceph-bluestore-tool</span></code>’s repair/quick-fix commands.</p>
</div>
<div class="section" id="v16-2-6-pacific">
<h2>v16.2.6 Pacific<a class="headerlink" href="#v16-2-6-pacific" title="Permalink to this headline">¶</a></h2>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>DATE: 01 NOV 2021.</p>
<p>DO NOT UPGRADE TO CEPH PACIFIC FROM AN OLDER VERSION.</p>
<p>A recently-discovered bug (<a class="reference external" href="https://tracker.ceph.com/issues/53062">https://tracker.ceph.com/issues/53062</a>) can cause
data corruption. This bug occurs during OMAP format conversion for
clusters that are updated to Pacific. New clusters are not affected by this
bug.</p>
<p>The trigger for this bug is BlueStore’s repair/quick-fix functionality. This
bug can be triggered in two known ways:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>manually via the ceph-bluestore-tool, or</p></li>
<li><p>automatically, by OSD if <code class="docutils literal notranslate"><span class="pre">bluestore_fsck_quick_fix_on_mount</span></code> is set
to true.</p></li>
</ol>
</div></blockquote>
<p>The fix for this bug is expected to be available in Ceph v16.2.7.</p>
<p>DO NOT set <code class="docutils literal notranslate"><span class="pre">bluestore_quick_fix_on_mount</span></code> to true. If it is currently
set to true in your configuration, immediately set it to false.</p>
<p>DO NOT run <code class="docutils literal notranslate"><span class="pre">ceph-bluestore-tool</span></code>’s repair/quick-fix commands.</p>
</div>
<p>This is the sixth backport release in the Pacific series.</p>
<div class="section" id="notable-changes">
<h3>Notable Changes<a class="headerlink" href="#notable-changes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>MGR: The pg_autoscaler has a new default ‘scale-down’ profile which provides more
performance from the start for new pools (for newly created clusters).
Existing clusters will retain the old behavior, now called the ‘scale-up’ profile.
For more details, see:
<a class="reference external" href="https://docs.ceph.com/en/latest/rados/operations/placement-groups/">https://docs.ceph.com/en/latest/rados/operations/placement-groups/</a></p></li>
<li><p>CephFS: the upgrade procedure for CephFS is now simpler. It is no longer
necessary to stop all MDS before upgrading the sole active MDS. After
disabling standby-replay, reducing max_mds to 1, and waiting for the file
systems to become stable (each fs with 1 active and 0 stopping daemons), a
rolling upgrade of all MDS daemons can be performed.</p></li>
<li><p>Dashboard: now allows users to set up and display a custom message (MOTD, warning,
etc.) in a sticky banner at the top of the page. For more details, see:
<a class="reference external" href="https://docs.ceph.com/en/pacific/mgr/dashboard/#message-of-the-day-motd">https://docs.ceph.com/en/pacific/mgr/dashboard/#message-of-the-day-motd</a></p></li>
<li><p>Several fixes in BlueStore, including a fix for the deferred write regression,
which led to excessive RocksDB flushes and compactions. Previously, when
<cite>bluestore_prefer_deferred_size_hdd</cite> was equal to or more than
<cite>bluestore_max_blob_size_hdd</cite> (both set to 64K), all the data was deferred,
which led to increased consumption of the column family used to store
deferred writes in RocksDB. Now, the <cite>bluestore_prefer_deferred_size</cite> parameter
independently controls deferred writes, and only writes smaller than
this size use the deferred write path.</p></li>
<li><p>The default value of <cite>osd_client_message_cap</cite> has been set to 256, to provide
better flow control by limiting maximum number of in-flight client requests.</p></li>
<li><p>PGs no longer show a <cite>active+clean+scrubbing+deep+repair</cite> state when
<cite>osd_scrub_auto_repair</cite> is set to true, for regular deep-scrubs with no repair
required.</p></li>
<li><p><cite>ceph-mgr-modules-core</cite> debian package does not recommend <cite>ceph-mgr-rook</cite>
anymore. As the latter depends on <cite>python3-numpy</cite> which cannot be imported in
different Python sub-interpreters multi-times if the version of
<cite>python3-numpy</cite> is older than 1.19. Since <cite>apt-get</cite> installs the <cite>Recommends</cite>
packages by default, <cite>ceph-mgr-rook</cite> was always installed along with
<cite>ceph-mgr</cite> debian package as an indirect dependency. If your workflow depends
on this behavior, you might want to install <cite>ceph-mgr-rook</cite> separately.</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>This is the first release built for Debian Bullseye.</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="changelog">
<h3>Changelog<a class="headerlink" href="#changelog" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>bind on loopback address if no other addresses are available (<a class="reference external" href="https://github.com/ceph/ceph/pull/42477">pr#42477</a>, Kefu Chai)</p></li>
<li><p>ceph-monstore-tool: use a large enough paxos/{first,last}_committed (<a class="reference external" href="http://tracker.ceph.com/issues/38219">issue#38219</a>, <a class="reference external" href="https://github.com/ceph/ceph/pull/42411">pr#42411</a>, Kefu Chai)</p></li>
<li><p>ceph-volume/tests: retry when destroying osd (<a class="reference external" href="https://github.com/ceph/ceph/pull/42546">pr#42546</a>, Guillaume Abrioux)</p></li>
<li><p>ceph-volume/tests: update ansible environment variables in tox (<a class="reference external" href="https://github.com/ceph/ceph/pull/42490">pr#42490</a>, Dimitri Savineau)</p></li>
<li><p>ceph-volume: Consider /dev/root as mounted (<a class="reference external" href="https://github.com/ceph/ceph/pull/42755">pr#42755</a>, David Caro)</p></li>
<li><p>ceph-volume: fix lvm activate arguments (<a class="reference external" href="https://github.com/ceph/ceph/pull/43116">pr#43116</a>, Dimitri Savineau)</p></li>
<li><p>ceph-volume: fix lvm migrate without args (<a class="reference external" href="https://github.com/ceph/ceph/pull/43110">pr#43110</a>, Dimitri Savineau)</p></li>
<li><p>ceph-volume: fix raw list with logical partition (<a class="reference external" href="https://github.com/ceph/ceph/pull/43087">pr#43087</a>, Guillaume Abrioux, Dimitri Savineau)</p></li>
<li><p>ceph-volume: implement bluefs volume migration (<a class="reference external" href="https://github.com/ceph/ceph/pull/42219">pr#42219</a>, Kefu Chai, Igor Fedotov)</p></li>
<li><p>ceph-volume: lvm batch: fast_allocations(): avoid ZeroDivisionError (<a class="reference external" href="https://github.com/ceph/ceph/pull/42493">pr#42493</a>, Jonas Zeiger)</p></li>
<li><p>ceph-volume: pvs –noheadings replace pvs –no-heading (<a class="reference external" href="https://github.com/ceph/ceph/pull/43076">pr#43076</a>, FengJiankui)</p></li>
<li><p>ceph-volume: remove –all ref from deactivate help (<a class="reference external" href="https://github.com/ceph/ceph/pull/43098">pr#43098</a>, Dimitri Savineau)</p></li>
<li><p>ceph-volume: support no_systemd with lvm migrate (<a class="reference external" href="https://github.com/ceph/ceph/pull/43091">pr#43091</a>, Dimitri Savineau)</p></li>
<li><p>ceph-volume: work around phantom atari partitions (<a class="reference external" href="https://github.com/ceph/ceph/pull/42753">pr#42753</a>, Blaine Gardner)</p></li>
<li><p>ceph.spec.in: drop gdbm from build deps (<a class="reference external" href="https://github.com/ceph/ceph/pull/43000">pr#43000</a>, Kefu Chai)</p></li>
<li><p>cephadm: August batch 1 (<a class="reference external" href="https://github.com/ceph/ceph/pull/42736">pr#42736</a>, Sage Weil, Dimitri Savineau, Guillaume Abrioux, Sebastian Wagner, Varsha Rao, Zac Dover, Adam King, Cory Snyder, Michael Fritch, Asbjørn Sannes, “Wang,Fei”, Javier Cacheiro, 胡玮文, Daniel Pivonka)</p></li>
<li><p>cephadm: September batch 1 (<a class="reference external" href="http://tracker.ceph.com/issues/52038">issue#52038</a>, <a class="reference external" href="https://github.com/ceph/ceph/pull/43029">pr#43029</a>, Sebastian Wagner, Dimitri Savineau, Paul Cuzner, Oleander Reis, Adam King, Yuxiang Zhu, Zac Dover, Alfonso Martínez, Sage Weil, Daniel Pivonka)</p></li>
<li><p>cephadm: use quay, not docker (<a class="reference external" href="https://github.com/ceph/ceph/pull/42534">pr#42534</a>, Sage Weil)</p></li>
<li><p>cephfs-mirror: record directory path cancel in DirRegistry (<a class="reference external" href="http://tracker.ceph.com/issues/51666">issue#51666</a>, <a class="reference external" href="https://github.com/ceph/ceph/pull/42458">pr#42458</a>, Venky Shankar)</p></li>
<li><p>client: flush the mdlog in unsafe requests’ relevant and auth MDSes only (<a class="reference external" href="https://github.com/ceph/ceph/pull/42925">pr#42925</a>, Xiubo Li)</p></li>
<li><p>client: make sure only to update dir dist from auth mds (<a class="reference external" href="https://github.com/ceph/ceph/pull/42937">pr#42937</a>, Xue Yantao)</p></li>
<li><p>cls/cmpomap: empty values are 0 in U64 comparisons (<a class="reference external" href="https://github.com/ceph/ceph/pull/42908">pr#42908</a>, Casey Bodley)</p></li>
<li><p>cmake, ceph.spec.in: build with header only fmt on RHEL (<a class="reference external" href="https://github.com/ceph/ceph/pull/42472">pr#42472</a>, Kefu Chai)</p></li>
<li><p>cmake: build static libs if they are internal ones (<a class="reference external" href="https://github.com/ceph/ceph/pull/39902">pr#39902</a>, Kefu Chai)</p></li>
<li><p>cmake: exclude “grafonnet-lib” target from “all” (<a class="reference external" href="https://github.com/ceph/ceph/pull/42898">pr#42898</a>, Kefu Chai)</p></li>
<li><p>cmake: link bundled fmt statically (<a class="reference external" href="https://github.com/ceph/ceph/pull/42692">pr#42692</a>, Kefu Chai)</p></li>
<li><p>cmake: Replace boost download url (<a class="reference external" href="https://github.com/ceph/ceph/pull/42693">pr#42693</a>, Rafał Wądołowski)</p></li>
<li><p>common/buffer: fix SIGABRT in  rebuild_aligned_size_and_memory (<a class="reference external" href="https://github.com/ceph/ceph/pull/42976">pr#42976</a>, Yin Congmin)</p></li>
<li><p>common/Formatter: include used header (<a class="reference external" href="https://github.com/ceph/ceph/pull/42233">pr#42233</a>, Kefu Chai)</p></li>
<li><p>common/options: Set osd_client_message_cap to 256 (<a class="reference external" href="https://github.com/ceph/ceph/pull/42615">pr#42615</a>, Mark Nelson)</p></li>
<li><p>compression/snappy: use uint32_t to be compatible with 1.1.9 (<a class="reference external" href="https://github.com/ceph/ceph/pull/42542">pr#42542</a>, Kefu Chai, Nathan Cutler)</p></li>
<li><p>debian/control: ceph-mgr-modules-core does not Recommend ceph-mgr-roo… (<a class="reference external" href="https://github.com/ceph/ceph/pull/42300">pr#42300</a>, Kefu Chai)</p></li>
<li><p>debian/control: dh-systemd is part of debhelper now (<a class="reference external" href="https://github.com/ceph/ceph/pull/43151">pr#43151</a>, David Galloway)</p></li>
<li><p>debian/control: remove cython from Build-Depends (<a class="reference external" href="https://github.com/ceph/ceph/pull/43131">pr#43131</a>, Kefu Chai)</p></li>
<li><p>doc/ceph-volume: add lvm migrate/new-db/new-wal (<a class="reference external" href="https://github.com/ceph/ceph/pull/43089">pr#43089</a>, Dimitri Savineau)</p></li>
<li><p>doc/rados/operations: s/max_misplaced/target_max_misplaced_ratio/ (<a class="reference external" href="https://github.com/ceph/ceph/pull/42250">pr#42250</a>, Paul Reece, Kefu Chai)</p></li>
<li><p>doc/releases/pacific.rst: remove notes about autoscaler (<a class="reference external" href="https://github.com/ceph/ceph/pull/42265">pr#42265</a>, Neha Ojha)</p></li>
<li><p>Don’t persist report data (<a class="reference external" href="https://github.com/ceph/ceph/pull/42888">pr#42888</a>, Brad Hubbard)</p></li>
<li><p>krbd: escape udev_enumerate_add_match_sysattr values (<a class="reference external" href="https://github.com/ceph/ceph/pull/42969">pr#42969</a>, Ilya Dryomov)</p></li>
<li><p>kv/RocksDBStore: Add handling of block_cache option for resharding (<a class="reference external" href="https://github.com/ceph/ceph/pull/42844">pr#42844</a>, Adam Kupczyk)</p></li>
<li><p>kv/RocksDBStore: enrich debug message (<a class="reference external" href="https://github.com/ceph/ceph/pull/42544">pr#42544</a>, Toshikuni Fukaya, Satoru Takeuchi)</p></li>
<li><p>librgw/notifications: initialize kafka and amqp (<a class="reference external" href="https://github.com/ceph/ceph/pull/42648">pr#42648</a>, Yuval Lifshitz)</p></li>
<li><p>mds: add debugging when rejecting mksnap with EPERM (<a class="reference external" href="https://github.com/ceph/ceph/pull/42935">pr#42935</a>, Patrick Donnelly)</p></li>
<li><p>mds: create file system with specific ID (<a class="reference external" href="https://github.com/ceph/ceph/pull/42900">pr#42900</a>, Ramana Raja)</p></li>
<li><p>mds: MDCache.cc:5319 FAILED ceph_assert(rejoin_ack_gather.count(mds-&gt;get_nodeid())) (<a class="reference external" href="https://github.com/ceph/ceph/pull/42938">pr#42938</a>, chencan)</p></li>
<li><p>mds: META_POP_READDIR, META_POP_FETCH, META_POP_STORE, and cache_hit_rate are not updated (<a class="reference external" href="https://github.com/ceph/ceph/pull/42939">pr#42939</a>, Yongseok Oh)</p></li>
<li><p>mds: to print the unknow type value (<a class="reference external" href="https://github.com/ceph/ceph/pull/42088">pr#42088</a>, Xiubo Li, Jos Collin)</p></li>
<li><p>MDSMonitor: monitor crash after upgrade from ceph 15.2.13 to 16.2.4 (<a class="reference external" href="https://github.com/ceph/ceph/pull/42536">pr#42536</a>, Patrick Donnelly)</p></li>
<li><p>mgr/DaemonServer: skip redundant update of pgp_num_actual (<a class="reference external" href="https://github.com/ceph/ceph/pull/42223">pr#42223</a>, Dan van der Ster)</p></li>
<li><p>mgr/dashboard/api: set a UTF-8 locale when running pip (<a class="reference external" href="https://github.com/ceph/ceph/pull/42829">pr#42829</a>, Kefu Chai)</p></li>
<li><p>mgr/dashboard: Add configurable MOTD or wall notification (<a class="reference external" href="https://github.com/ceph/ceph/pull/42414">pr#42414</a>, Volker Theile)</p></li>
<li><p>mgr/dashboard: cephadm e2e start script: add –expanded option (<a class="reference external" href="https://github.com/ceph/ceph/pull/42789">pr#42789</a>, Alfonso Martínez)</p></li>
<li><p>mgr/dashboard: cephadm-e2e job script: improvements (<a class="reference external" href="https://github.com/ceph/ceph/pull/42585">pr#42585</a>, Alfonso Martínez)</p></li>
<li><p>mgr/dashboard: disable create snapshot with subvolumes (<a class="reference external" href="https://github.com/ceph/ceph/pull/42819">pr#42819</a>, Pere Diaz Bou)</p></li>
<li><p>mgr/dashboard: don’t notify for suppressed alerts (<a class="reference external" href="https://github.com/ceph/ceph/pull/42974">pr#42974</a>, Tatjana Dehler)</p></li>
<li><p>mgr/dashboard: fix Accept-Language header parsing (<a class="reference external" href="https://github.com/ceph/ceph/pull/42297">pr#42297</a>, 胡玮文)</p></li>
<li><p>mgr/dashboard: fix rename inventory to disks (<a class="reference external" href="https://github.com/ceph/ceph/pull/42810">pr#42810</a>, Navin Barnwal)</p></li>
<li><p>mgr/dashboard: fix ssl cert validation for rgw service creation (<a class="reference external" href="https://github.com/ceph/ceph/pull/42628">pr#42628</a>, Avan Thakkar)</p></li>
<li><p>mgr/dashboard: Fix test_error force maintenance dashboard check (<a class="reference external" href="https://github.com/ceph/ceph/pull/42354">pr#42354</a>, Nizamudeen A)</p></li>
<li><p>mgr/dashboard: monitoring: replace Grafana JSON with Grafonnet based code (<a class="reference external" href="https://github.com/ceph/ceph/pull/42812">pr#42812</a>, Aashish Sharma)</p></li>
<li><p>mgr/dashboard: Refresh button on the iscsi targets page (<a class="reference external" href="https://github.com/ceph/ceph/pull/42817">pr#42817</a>, Nizamudeen A)</p></li>
<li><p>mgr/dashboard: remove usage of ‘rgw_frontend_ssl_key’ (<a class="reference external" href="https://github.com/ceph/ceph/pull/42316">pr#42316</a>, Avan Thakkar)</p></li>
<li><p>mgr/dashboard: show perf. counters for rgw svc. on Cluster &gt; Hosts (<a class="reference external" href="https://github.com/ceph/ceph/pull/42629">pr#42629</a>, Alfonso Martínez)</p></li>
<li><p>mgr/dashboard: stats=false not working when listing buckets (<a class="reference external" href="https://github.com/ceph/ceph/pull/42889">pr#42889</a>, Avan Thakkar)</p></li>
<li><p>mgr/dashboard: tox.ini: delete useless env. ‘apidocs’ (<a class="reference external" href="https://github.com/ceph/ceph/pull/42788">pr#42788</a>, Alfonso Martínez)</p></li>
<li><p>mgr/dashboard: update translations for pacific (<a class="reference external" href="https://github.com/ceph/ceph/pull/42606">pr#42606</a>, Tatjana Dehler)</p></li>
<li><p>mgr/mgr_util: switch using unshared cephfs connections whenever possible (<a class="reference external" href="http://tracker.ceph.com/issues/51256">issue#51256</a>, <a class="reference external" href="https://github.com/ceph/ceph/pull/42083">pr#42083</a>, Venky Shankar)</p></li>
<li><p>mgr/pg_autoscaler: Introduce autoscaler scale-down feature (<a class="reference external" href="https://github.com/ceph/ceph/pull/42428">pr#42428</a>, Kamoltat, Kefu Chai)</p></li>
<li><p>mgr/rook: Add timezone info (<a class="reference external" href="https://github.com/ceph/ceph/pull/39834">pr#39834</a>, Varsha Rao, Sebastian Wagner)</p></li>
<li><p>mgr/telemetry: pass leaderboard flag even w/o ident (<a class="reference external" href="https://github.com/ceph/ceph/pull/42228">pr#42228</a>, Sage Weil)</p></li>
<li><p>mgr/volumes: Add config to insert delay at the beginning of the clone (<a class="reference external" href="https://github.com/ceph/ceph/pull/42086">pr#42086</a>, Kotresh HR)</p></li>
<li><p>mgr/volumes: use dedicated libcephfs handles for subvolume calls and … (<a class="reference external" href="http://tracker.ceph.com/issues/51271">issue#51271</a>, <a class="reference external" href="https://github.com/ceph/ceph/pull/42914">pr#42914</a>, Venky Shankar)</p></li>
<li><p>mgr: set debug_mgr=2/5 (so INFO goes to mgr log by default) (<a class="reference external" href="https://github.com/ceph/ceph/pull/42225">pr#42225</a>, Sage Weil)</p></li>
<li><p>mon/MDSMonitor: do not pointlessly kill standbys that are incompatible with current CompatSet (<a class="reference external" href="https://github.com/ceph/ceph/pull/42578">pr#42578</a>, Patrick Donnelly, Zhi Zhang)</p></li>
<li><p>mon/OSDMonitor: resize oversized Lec::epoch_by_pg, after PG merging, preventing osdmap trimming (<a class="reference external" href="https://github.com/ceph/ceph/pull/42224">pr#42224</a>, Dan van der Ster)</p></li>
<li><p>mon/PGMap: remove DIRTY field in ceph df detail when cache tiering is not in use (<a class="reference external" href="https://github.com/ceph/ceph/pull/42860">pr#42860</a>, Deepika Upadhyay)</p></li>
<li><p>mon: return -EINVAL when handling unknown option in ‘ceph osd pool get’ (<a class="reference external" href="https://github.com/ceph/ceph/pull/42229">pr#42229</a>, Zhao Cuicui)</p></li>
<li><p>mon: Sanely set the default CRUSH rule when creating pools in stretch… (<a class="reference external" href="https://github.com/ceph/ceph/pull/42909">pr#42909</a>, Greg Farnum)</p></li>
<li><p>monitoring/grafana/build/Makefile: revamp for arm64 builds, pushes to docker and quay, jenkins (<a class="reference external" href="https://github.com/ceph/ceph/pull/42211">pr#42211</a>, Dan Mick)</p></li>
<li><p>monitoring/grafana/cluster: use per-unit max and limit values (<a class="reference external" href="https://github.com/ceph/ceph/pull/42679">pr#42679</a>, David Caro)</p></li>
<li><p>monitoring: Clean up Grafana dashboards (<a class="reference external" href="https://github.com/ceph/ceph/pull/42299">pr#42299</a>, Patrick Seidensal)</p></li>
<li><p>monitoring: fix Physical Device Latency unit (<a class="reference external" href="https://github.com/ceph/ceph/pull/42298">pr#42298</a>, Seena Fallah)</p></li>
<li><p>msg: active_connections regression (<a class="reference external" href="https://github.com/ceph/ceph/pull/42936">pr#42936</a>, Sage Weil)</p></li>
<li><p>nfs backport June (<a class="reference external" href="https://github.com/ceph/ceph/pull/42096">pr#42096</a>, Varsha Rao)</p></li>
<li><p>os/bluestore: accept undecodable multi-block bluefs transactions on log (<a class="reference external" href="https://github.com/ceph/ceph/pull/43023">pr#43023</a>, Igor Fedotov)</p></li>
<li><p>os/bluestore: cap omap naming scheme upgrade transaction (<a class="reference external" href="https://github.com/ceph/ceph/pull/42956">pr#42956</a>, Igor Fedotov)</p></li>
<li><p>os/bluestore: compact db after bulk omap naming upgrade (<a class="reference external" href="https://github.com/ceph/ceph/pull/42426">pr#42426</a>, Igor Fedotov)</p></li>
<li><p>os/bluestore: fix bluefs migrate command (<a class="reference external" href="https://github.com/ceph/ceph/pull/43100">pr#43100</a>, Igor Fedotov)</p></li>
<li><p>os/bluestore: fix erroneous SharedBlob record removal during repair (<a class="reference external" href="https://github.com/ceph/ceph/pull/42423">pr#42423</a>, Igor Fedotov)</p></li>
<li><p>os/bluestore: fix using incomplete bluefs log when dumping it (<a class="reference external" href="https://github.com/ceph/ceph/pull/43007">pr#43007</a>, Igor Fedotov)</p></li>
<li><p>os/bluestore: make deferred writes less aggressive for large writes (<a class="reference external" href="https://github.com/ceph/ceph/pull/42773">pr#42773</a>, Igor Fedotov, Adam Kupczyk)</p></li>
<li><p>os/bluestore: Remove possibility of replay log and file inconsistency (<a class="reference external" href="https://github.com/ceph/ceph/pull/42424">pr#42424</a>, Adam Kupczyk)</p></li>
<li><p>os/bluestore: respect bluestore_warn_on_spurious_read_errors setting (<a class="reference external" href="https://github.com/ceph/ceph/pull/42897">pr#42897</a>, Igor Fedotov)</p></li>
<li><p>osd/scrub: separate between PG state flags and internal scrubber operation (<a class="reference external" href="https://github.com/ceph/ceph/pull/42398">pr#42398</a>, Ronen Friedman)</p></li>
<li><p>osd: log snaptrim message to dout (<a class="reference external" href="https://github.com/ceph/ceph/pull/42482">pr#42482</a>, Arthur Outhenin-Chalandre)</p></li>
<li><p>osd: move down peers out from peer_purged (<a class="reference external" href="https://github.com/ceph/ceph/pull/42238">pr#42238</a>, Mykola Golub)</p></li>
<li><p>pybind/mgr/stats: validate cmdtag (<a class="reference external" href="https://github.com/ceph/ceph/pull/42702">pr#42702</a>, Jos Collin)</p></li>
<li><p>pybind/mgr: Fix IPv6 url generation (<a class="reference external" href="https://github.com/ceph/ceph/pull/42990">pr#42990</a>, Sebastian Wagner)</p></li>
<li><p>pybind/rbd: fix mirror_image_get_status (<a class="reference external" href="https://github.com/ceph/ceph/pull/42972">pr#42972</a>, Ilya Dryomov, Will Smith)</p></li>
<li><p>qa/*/test_envlibrados_for_rocksdb.sh: install libarchive-3.3.3 (<a class="reference external" href="https://github.com/ceph/ceph/pull/42344">pr#42344</a>, Neha Ojha)</p></li>
<li><p>qa/cephadm: centos_8.x_container_tools_3.0.yaml (<a class="reference external" href="https://github.com/ceph/ceph/pull/42868">pr#42868</a>, Sebastian Wagner)</p></li>
<li><p>qa/rgw: move ignore-pg-availability.yaml out of suites/rgw (<a class="reference external" href="https://github.com/ceph/ceph/pull/40694">pr#40694</a>, Casey Bodley)</p></li>
<li><p>qa/standalone: Add missing cleanups after completion of a subset of osd and scrub tests (<a class="reference external" href="https://github.com/ceph/ceph/pull/42258">pr#42258</a>, Sridhar Seshasayee)</p></li>
<li><p>qa/tests: advanced pacific version to reflect the latest 16.2.5 point (<a class="reference external" href="https://github.com/ceph/ceph/pull/42264">pr#42264</a>, Yuri Weinstein)</p></li>
<li><p>qa/workunits/mon/test_mon_config_key: use subprocess.run() instead of proc.communicate() (<a class="reference external" href="https://github.com/ceph/ceph/pull/42221">pr#42221</a>, Kefu Chai)</p></li>
<li><p>qa: FileNotFoundError: [Errno 2] No such file or directory: ‘/sys/kernel/debug/ceph/3fab6bea-f243-47a4-a956-8c03a62b61b5.client4721/mds_sessions’ (<a class="reference external" href="https://github.com/ceph/ceph/pull/42165">pr#42165</a>, Patrick Donnelly)</p></li>
<li><p>qa: increase the pg_num for cephfs_data/metadata pools (<a class="reference external" href="https://github.com/ceph/ceph/pull/42923">pr#42923</a>, Xiubo Li)</p></li>
<li><p>qa: test_ls_H_prints_human_readable_file_size failure (<a class="reference external" href="https://github.com/ceph/ceph/pull/42166">pr#42166</a>, Patrick Donnelly)</p></li>
<li><p>radosgw-admin: skip GC init on read-only admin ops (<a class="reference external" href="https://github.com/ceph/ceph/pull/42655">pr#42655</a>, Mark Kogan)</p></li>
<li><p>radosgw: include realm_{id,name} in service map (<a class="reference external" href="https://github.com/ceph/ceph/pull/42213">pr#42213</a>, Sage Weil)</p></li>
<li><p>rbd-mirror: add perf counters to snapshot replayer (<a class="reference external" href="https://github.com/ceph/ceph/pull/42987">pr#42987</a>, Arthur Outhenin-Chalandre)</p></li>
<li><p>rbd-mirror: fix potential async op tracker leak in start_image_replayers (<a class="reference external" href="https://github.com/ceph/ceph/pull/42979">pr#42979</a>, Mykola Golub)</p></li>
<li><p>rbd: fix default pool handling for nbd map/unmap (<a class="reference external" href="https://github.com/ceph/ceph/pull/42980">pr#42980</a>, Sunny Kumar)</p></li>
<li><p>Remove dependency on lsb_release (<a class="reference external" href="https://github.com/ceph/ceph/pull/43001">pr#43001</a>, Ken Dreyer)</p></li>
<li><p>RGW - Bucket Remove Op: Pass in user (<a class="reference external" href="https://github.com/ceph/ceph/pull/42135">pr#42135</a>, Daniel Gryniewicz)</p></li>
<li><p>RGW - Don’t move attrs before setting them (<a class="reference external" href="https://github.com/ceph/ceph/pull/42320">pr#42320</a>, Daniel Gryniewicz)</p></li>
<li><p>rgw : add check empty for sync url (<a class="reference external" href="https://github.com/ceph/ceph/pull/42653">pr#42653</a>, caolei)</p></li>
<li><p>rgw : add check for tenant provided in RGWCreateRole (<a class="reference external" href="https://github.com/ceph/ceph/pull/42637">pr#42637</a>, caolei)</p></li>
<li><p>rgw : modfiy error XML for deleterole (<a class="reference external" href="https://github.com/ceph/ceph/pull/42639">pr#42639</a>, caolei)</p></li>
<li><p>rgw multisite: metadata sync treats all errors as ‘transient’ for retry (<a class="reference external" href="https://github.com/ceph/ceph/pull/42656">pr#42656</a>, Casey Bodley)</p></li>
<li><p>RGW Zipper - Make sure bucket list progresses (<a class="reference external" href="https://github.com/ceph/ceph/pull/42625">pr#42625</a>, Daniel Gryniewicz)</p></li>
<li><p>rgw/amqp/test: fix mock prototype for librabbitmq-0.11.0 (<a class="reference external" href="https://github.com/ceph/ceph/pull/42649">pr#42649</a>, Yuval Lifshitz)</p></li>
<li><p>rgw/http/notifications: support content type in HTTP POST messages (<a class="reference external" href="https://github.com/ceph/ceph/pull/42644">pr#42644</a>, Yuval Lifshitz)</p></li>
<li><p>rgw/multisite: return correct error code when op fails (<a class="reference external" href="https://github.com/ceph/ceph/pull/42646">pr#42646</a>, Yuval Lifshitz)</p></li>
<li><p>rgw/notification: add exception handling for persistent notification thread (<a class="reference external" href="https://github.com/ceph/ceph/pull/42647">pr#42647</a>, Yuval Lifshitz)</p></li>
<li><p>rgw/notification: fix persistent notification hang when ack-levl=none (<a class="reference external" href="https://github.com/ceph/ceph/pull/40696">pr#40696</a>, Yuval Lifshitz)</p></li>
<li><p>rgw/notification: fixing the “persistent=false” flag (<a class="reference external" href="https://github.com/ceph/ceph/pull/40695">pr#40695</a>, Yuval Lifshitz)</p></li>
<li><p>rgw/notifications: delete bucket notification object when empty (<a class="reference external" href="https://github.com/ceph/ceph/pull/42631">pr#42631</a>, Yuval Lifshitz)</p></li>
<li><p>rgw/notifications: support metadata filter in CompleteMultipartUpload and Copy events (<a class="reference external" href="https://github.com/ceph/ceph/pull/42321">pr#42321</a>, Yuval Lifshitz)</p></li>
<li><p>rgw/notifications: support metadata filter in CompleteMultipartUploa… (<a class="reference external" href="https://github.com/ceph/ceph/pull/42566">pr#42566</a>, Yuval Lifshitz)</p></li>
<li><p>rgw/rgw_file: Fix the return value of read() and readlink() (<a class="reference external" href="https://github.com/ceph/ceph/pull/42654">pr#42654</a>, Dai zhiwei, luo rixin)</p></li>
<li><p>rgw/sts: correcting the evaluation of session policies (<a class="reference external" href="https://github.com/ceph/ceph/pull/42632">pr#42632</a>, Pritha Srivastava)</p></li>
<li><p>rgw/sts: read_obj_policy() consults iam_user_policies on ENOENT (<a class="reference external" href="https://github.com/ceph/ceph/pull/42650">pr#42650</a>, Casey Bodley)</p></li>
<li><p>rgw: allow rgw-orphan-list to process multiple data pools (<a class="reference external" href="https://github.com/ceph/ceph/pull/42635">pr#42635</a>, J. Eric Ivancich)</p></li>
<li><p>rgw: allow to set ssl options and ciphers for beast frontend (<a class="reference external" href="https://github.com/ceph/ceph/pull/42363">pr#42363</a>, Mykola Golub)</p></li>
<li><p>rgw: avoid infinite loop when deleting a bucket (<a class="reference external" href="http://tracker.ceph.com/issues/49206">issue#49206</a>, <a class="reference external" href="https://github.com/ceph/ceph/pull/42230">pr#42230</a>, Jeegn Chen)</p></li>
<li><p>rgw: avoid occuring radosgw daemon crash when access a conditionally … (<a class="reference external" href="https://github.com/ceph/ceph/pull/42626">pr#42626</a>, xiangrui meng, yupeng chen)</p></li>
<li><p>rgw: Backport of 51674 to Pacific (<a class="reference external" href="https://github.com/ceph/ceph/pull/42346">pr#42346</a>, Adam C. Emerson)</p></li>
<li><p>rgw: deprecate the civetweb frontend (<a class="reference external" href="https://github.com/ceph/ceph/pull/41367">pr#41367</a>, Casey Bodley)</p></li>
<li><p>rgw: Don’t segfault on datalog trim (<a class="reference external" href="https://github.com/ceph/ceph/pull/42336">pr#42336</a>, Adam C. Emerson)</p></li>
<li><p>rgw: during reshard lock contention, adjust logging (<a class="reference external" href="https://github.com/ceph/ceph/pull/42641">pr#42641</a>, J. Eric Ivancich)</p></li>
<li><p>rgw: extending existing ssl support for vault KMS (<a class="reference external" href="https://github.com/ceph/ceph/pull/42093">pr#42093</a>, Jiffin Tony Thottan)</p></li>
<li><p>rgw: fail as expected when set/delete-bucket-website attempted on a non-exis… (<a class="reference external" href="https://github.com/ceph/ceph/pull/42642">pr#42642</a>, xiangrui meng)</p></li>
<li><p>rgw: fix bucket object listing when marker matches prefix (<a class="reference external" href="https://github.com/ceph/ceph/pull/42638">pr#42638</a>, J. Eric Ivancich)</p></li>
<li><p>rgw: fix for mfa resync crash when supplied with only one totp_pin (<a class="reference external" href="https://github.com/ceph/ceph/pull/42652">pr#42652</a>, Pritha Srivastava)</p></li>
<li><p>rgw: fix segfault related to explicit object manifest handling (<a class="reference external" href="https://github.com/ceph/ceph/pull/42633">pr#42633</a>, Mark Kogan)</p></li>
<li><p>rgw: Improve error message on email id reuse (<a class="reference external" href="https://github.com/ceph/ceph/pull/41783">pr#41783</a>, Ponnuvel Palaniyappan)</p></li>
<li><p>rgw: objectlock: improve client error messages (<a class="reference external" href="https://github.com/ceph/ceph/pull/40693">pr#40693</a>, Matt Benjamin)</p></li>
<li><p>rgw: parse tenant name out of rgwx-bucket-instance (<a class="reference external" href="https://github.com/ceph/ceph/pull/42231">pr#42231</a>, Casey Bodley)</p></li>
<li><p>rgw: radosgw-admin errors if marker not specified on data/mdlog trim (<a class="reference external" href="https://github.com/ceph/ceph/pull/42640">pr#42640</a>, Adam C. Emerson)</p></li>
<li><p>rgw: remove quota soft threshold (<a class="reference external" href="https://github.com/ceph/ceph/pull/42634">pr#42634</a>, Zulai Wang)</p></li>
<li><p>rgw: require bucket name in bucket chown (<a class="reference external" href="https://github.com/ceph/ceph/pull/42323">pr#42323</a>, Zulai Wang)</p></li>
<li><p>rgw: when deleted obj removed in versioned bucket, extra del-marker added (<a class="reference external" href="https://github.com/ceph/ceph/pull/42645">pr#42645</a>, J. Eric Ivancich)</p></li>
<li><p>rpm/luarocks: simplify conditional and support Leap 15.3 (<a class="reference external" href="https://github.com/ceph/ceph/pull/42561">pr#42561</a>, Nathan Cutler)</p></li>
<li><p>rpm: drop use of $FIRST_ARG in ceph-immutable-object-cache (<a class="reference external" href="https://github.com/ceph/ceph/pull/42480">pr#42480</a>, Nathan Cutler)</p></li>
<li><p>run-make-check.sh: Increase failure output log size (<a class="reference external" href="https://github.com/ceph/ceph/pull/42850">pr#42850</a>, David Galloway)</p></li>
<li><p>SimpleRADOSStriper: use debug_cephsqlite (<a class="reference external" href="https://github.com/ceph/ceph/pull/42659">pr#42659</a>, Patrick Donnelly)</p></li>
<li><p>src/pybind/mgr/mirroring/fs/snapshot_mirror.py: do not assume a cephf… (<a class="reference external" href="https://github.com/ceph/ceph/pull/42226">pr#42226</a>, Sébastien Han)</p></li>
<li><p>test/rgw: fix use of poll() with timers in unittest_rgw_dmclock_scheduler (<a class="reference external" href="https://github.com/ceph/ceph/pull/42651">pr#42651</a>, Casey Bodley)</p></li>
<li><p>Warning Cleanup and Clang Compile Fix (<a class="reference external" href="https://github.com/ceph/ceph/pull/40692">pr#40692</a>, Adam C. Emerson)</p></li>
<li><p>workunits/rgw: semicolon terminates perl statements (<a class="reference external" href="https://github.com/ceph/ceph/pull/43168">pr#43168</a>, Matt Benjamin)</p></li>
</ul>
</div>
</div>
<div class="section" id="v16-2-5-pacific">
<h2>v16.2.5 Pacific<a class="headerlink" href="#v16-2-5-pacific" title="Permalink to this headline">¶</a></h2>
<p>This is the fifth backport release in the Pacific series. We recommend all
users update to this release.</p>
<div class="section" id="id1">
<h3>Notable Changes<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><cite>ceph-mgr-modules-core</cite> debian package does not recommend <cite>ceph-mgr-rook</cite>
anymore. As the latter depends on <cite>python3-numpy</cite> which cannot be imported in
different Python sub-interpreters multi-times if the version of
<cite>python3-numpy</cite> is older than 1.19. Since <cite>apt-get</cite> installs the <cite>Recommends</cite>
packages by default, <cite>ceph-mgr-rook</cite> was always installed along with
<cite>ceph-mgr</cite> debian package as an indirect dependency. If your workflow depends
on this behavior, you might want to install <cite>ceph-mgr-rook</cite> separately.</p></li>
<li><p>mgr/nfs: <code class="docutils literal notranslate"><span class="pre">nfs</span></code> module is moved out of volumes plugin. Prior using the
<code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">nfs</span></code> commands, <code class="docutils literal notranslate"><span class="pre">nfs</span></code> mgr module must be enabled.</p></li>
<li><p>volumes/nfs: The <code class="docutils literal notranslate"><span class="pre">cephfs</span></code> cluster type has been removed from the
<code class="docutils literal notranslate"><span class="pre">nfs</span> <span class="pre">cluster</span> <span class="pre">create</span></code> subcommand. Clusters deployed by cephadm can
support an NFS export of both <code class="docutils literal notranslate"><span class="pre">rgw</span></code> and <code class="docutils literal notranslate"><span class="pre">cephfs</span></code> from a single
NFS cluster instance.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">nfs</span> <span class="pre">cluster</span> <span class="pre">update</span></code> command has been removed.  You can modify
the placement of an existing NFS service (and/or its associated
ingress service) using <code class="docutils literal notranslate"><span class="pre">orch</span> <span class="pre">ls</span> <span class="pre">--export</span></code> and <code class="docutils literal notranslate"><span class="pre">orch</span> <span class="pre">apply</span> <span class="pre">-i</span>
<span class="pre">...</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">orch</span> <span class="pre">apply</span> <span class="pre">nfs</span></code> command no longer requires a pool or
namespace argument. We strongly encourage users to use the defaults
so that the <code class="docutils literal notranslate"><span class="pre">nfs</span> <span class="pre">cluster</span> <span class="pre">ls</span></code> and related commands will work
properly.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">nfs</span> <span class="pre">cluster</span> <span class="pre">delete</span></code> and <code class="docutils literal notranslate"><span class="pre">nfs</span> <span class="pre">export</span> <span class="pre">delete</span></code> commands are
deprecated and will be removed in a future release.  Please use
<code class="docutils literal notranslate"><span class="pre">nfs</span> <span class="pre">cluster</span> <span class="pre">rm</span></code> and <code class="docutils literal notranslate"><span class="pre">nfs</span> <span class="pre">export</span> <span class="pre">rm</span></code> instead.</p></li>
<li><p>A long-standing bug that prevented 32-bit and 64-bit client/server
interoperability under msgr v2 has been fixed.  In particular, mixing armv7l
(armhf) and x86_64 or aarch64 servers in the same cluster now works.</p></li>
</ul>
</div>
<div class="section" id="id2">
<h3>Changelog<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>.github/labeler: add api-change label (<a class="reference external" href="https://github.com/ceph/ceph/pull/41818">pr#41818</a>, Ernesto Puerta)</p></li>
<li><p>Improve mon location handling for stretch clusters (<a class="reference external" href="https://github.com/ceph/ceph/pull/40484">pr#40484</a>, Greg Farnum)</p></li>
<li><p>MDS heartbeat timed out between during executing MDCache::start_files_to_recover() (<a class="reference external" href="https://github.com/ceph/ceph/pull/42061">pr#42061</a>, Yongseok Oh)</p></li>
<li><p>MDS slow request lookupino #0x100 on rank 1 block forever on dispatched (<a class="reference external" href="https://github.com/ceph/ceph/pull/40856">pr#40856</a>, Xiubo Li, Patrick Donnelly)</p></li>
<li><p>MDSMonitor: crash when attempting to mount cephfs (<a class="reference external" href="https://github.com/ceph/ceph/pull/42068">pr#42068</a>, Patrick Donnelly)</p></li>
<li><p>Pacific stretch mon state [Merge after 40484] (<a class="reference external" href="https://github.com/ceph/ceph/pull/41130">pr#41130</a>, Greg Farnum)</p></li>
<li><p>Pacific: Add DoutPrefixProvider for RGW Log Messages in Pacfic (<a class="reference external" href="https://github.com/ceph/ceph/pull/40054">pr#40054</a>, Ali Maredia, Kalpesh Pandya, Casey Bodley)</p></li>
<li><p>Pacific: Direct MMonJoin messages to leader, not first rank [Merge after 41130] (<a class="reference external" href="https://github.com/ceph/ceph/pull/41131">pr#41131</a>, Greg Farnum)</p></li>
<li><p>Revert “pacific: mgr/dashboard: Generate NPM dependencies manifest” (<a class="reference external" href="https://github.com/ceph/ceph/pull/41549">pr#41549</a>, Nizamudeen A)</p></li>
<li><p>Update boost url, fixing windows build (<a class="reference external" href="https://github.com/ceph/ceph/pull/41259">pr#41259</a>, Lucian Petrut)</p></li>
<li><p>bluestore: use string_view and strip trailing slash for dir listing (<a class="reference external" href="https://github.com/ceph/ceph/pull/41755">pr#41755</a>, Jonas Jelten, Kefu Chai)</p></li>
<li><p>build(deps): bump node-notifier from 8.0.0 to 8.0.1 in /src/pybind/mgr/dashboard/frontend (<a class="reference external" href="https://github.com/ceph/ceph/pull/40813">pr#40813</a>, Ernesto Puerta, dependabot[bot])</p></li>
<li><p>ceph-volume: fix batch report and respect ceph.conf config values (<a class="reference external" href="https://github.com/ceph/ceph/pull/41714">pr#41714</a>, Andrew Schoen)</p></li>
<li><p>ceph_test_rados_api_service: more retries for servicemkap (<a class="reference external" href="https://github.com/ceph/ceph/pull/41182">pr#41182</a>, Sage Weil)</p></li>
<li><p>cephadm june final batch (<a class="reference external" href="https://github.com/ceph/ceph/pull/42117">pr#42117</a>, Kefu Chai, Sage Weil, Zac Dover, Sebastian Wagner, Varsha Rao, Sandro Bonazzola, Juan Miguel Olmo Martínez)</p></li>
<li><p>cephadm: batch backport for May (2) (<a class="reference external" href="https://github.com/ceph/ceph/pull/41219">pr#41219</a>, Adam King, Sage Weil, Zac Dover, Dennis Körner, jianglong01, Avan Thakkar, Juan Miguel Olmo Martínez)</p></li>
<li><p>cephadm: june batch 1 (<a class="reference external" href="https://github.com/ceph/ceph/pull/41684">pr#41684</a>, Sage Weil, Paul Cuzner, Juan Miguel Olmo Martínez, VasishtaShastry, Zac Dover, Sebastian Wagner, Adam King, Michael Fritch, Daniel Pivonka, sunilkumarn417)</p></li>
<li><p>cephadm: june batch 2 (<a class="reference external" href="https://github.com/ceph/ceph/pull/41815">pr#41815</a>, Sebastian Wagner, Daniel Pivonka, Zac Dover, Michael Fritch)</p></li>
<li><p>cephadm: june batch 3 (<a class="reference external" href="https://github.com/ceph/ceph/pull/41913">pr#41913</a>, Zac Dover, Adam King, Michael Fritch, Patrick Donnelly, Sage Weil, Juan Miguel Olmo Martínez, jianglong01)</p></li>
<li><p>cephadm: may batch 1 (<a class="reference external" href="https://github.com/ceph/ceph/pull/41151">pr#41151</a>, Juan Miguel Olmo Martínez, Sage Weil, Zac Dover, Daniel Pivonka, Adam King, Stanislav Datskevych, jianglong01, Kefu Chai, Deepika Upadhyay, Joao Eduardo Luis)</p></li>
<li><p>cephadm: may batch 3 (<a class="reference external" href="https://github.com/ceph/ceph/pull/41463">pr#41463</a>, Sage Weil, Michael Fritch, Adam King, Patrick Seidensal, Juan Miguel Olmo Martínez, Dimitri Savineau, Zac Dover, Sebastian Wagner)</p></li>
<li><p>cephfs-mirror backports (<a class="reference external" href="http://tracker.ceph.com/issues/50523">issue#50523</a>, <a class="reference external" href="http://tracker.ceph.com/issues/50035">issue#50035</a>, <a class="reference external" href="http://tracker.ceph.com/issues/50266">issue#50266</a>, <a class="reference external" href="http://tracker.ceph.com/issues/50442">issue#50442</a>, <a class="reference external" href="http://tracker.ceph.com/issues/50581">issue#50581</a>, <a class="reference external" href="http://tracker.ceph.com/issues/50229">issue#50229</a>, <a class="reference external" href="http://tracker.ceph.com/issues/49939">issue#49939</a>, <a class="reference external" href="http://tracker.ceph.com/issues/50224">issue#50224</a>, <a class="reference external" href="http://tracker.ceph.com/issues/50298">issue#50298</a>, <a class="reference external" href="https://github.com/ceph/ceph/pull/41475">pr#41475</a>, Venky Shankar, Lucian Petrut)</p></li>
<li><p>cephfs-mirror: backports (<a class="reference external" href="http://tracker.ceph.com/issues/50447">issue#50447</a>, <a class="reference external" href="http://tracker.ceph.com/issues/50867">issue#50867</a>, <a class="reference external" href="http://tracker.ceph.com/issues/51204">issue#51204</a>, <a class="reference external" href="https://github.com/ceph/ceph/pull/41947">pr#41947</a>, Venky Shankar)</p></li>
<li><p>cephfs-mirror: reopen logs on SIGHUP (<a class="reference external" href="http://tracker.ceph.com/issues/51413">issue#51413</a>, <a class="reference external" href="http://tracker.ceph.com/issues/51318">issue#51318</a>, <a class="reference external" href="https://github.com/ceph/ceph/pull/42097">pr#42097</a>, Venky Shankar)</p></li>
<li><p>cephfs-top: self-adapt the display according the window size (<a class="reference external" href="https://github.com/ceph/ceph/pull/41053">pr#41053</a>, Xiubo Li)</p></li>
<li><p>client: Fix executeable access check for the root user (<a class="reference external" href="https://github.com/ceph/ceph/pull/41294">pr#41294</a>, Kotresh HR)</p></li>
<li><p>client: fix the opened inodes counter increasing (<a class="reference external" href="https://github.com/ceph/ceph/pull/40685">pr#40685</a>, Xiubo Li)</p></li>
<li><p>client: make Inode to inherit from RefCountedObject (<a class="reference external" href="https://github.com/ceph/ceph/pull/41052">pr#41052</a>, Xiubo Li)</p></li>
<li><p>cls/rgw: look for plain entries in non-ascii plain namespace too (<a class="reference external" href="https://github.com/ceph/ceph/pull/41774">pr#41774</a>, Mykola Golub)</p></li>
<li><p>common/buffer: adjust align before calling posix_memalign() (<a class="reference external" href="https://github.com/ceph/ceph/pull/41249">pr#41249</a>, Ilya Dryomov)</p></li>
<li><p>common/mempool: only fail tests if sharding is very bad (<a class="reference external" href="https://github.com/ceph/ceph/pull/40566">pr#40566</a>, singuliere)</p></li>
<li><p>common/options/global.yaml.in: increase default value of bluestore_cache_trim_max_skip_pinned (<a class="reference external" href="https://github.com/ceph/ceph/pull/40918">pr#40918</a>, Neha Ojha)</p></li>
<li><p>crush/crush: ensure alignof(crush_work_bucket) is 1 (<a class="reference external" href="https://github.com/ceph/ceph/pull/41983">pr#41983</a>, Kefu Chai)</p></li>
<li><p>debian,cmake,cephsqlite: hide non-public symbols (<a class="reference external" href="https://github.com/ceph/ceph/pull/40689">pr#40689</a>, Kefu Chai)</p></li>
<li><p>debian/control: ceph-mgr-modules-core does not Recommend ceph-mgr-rook (<a class="reference external" href="https://github.com/ceph/ceph/pull/41877">pr#41877</a>, Kefu Chai)</p></li>
<li><p>doc: pacific updates (<a class="reference external" href="https://github.com/ceph/ceph/pull/42066">pr#42066</a>, Patrick Donnelly)</p></li>
<li><p>librbd/cache/pwl: fix parsing of cache_type in create_image_cache_state() (<a class="reference external" href="https://github.com/ceph/ceph/pull/41244">pr#41244</a>, Ilya Dryomov)</p></li>
<li><p>librbd/mirror/snapshot: avoid UnlinkPeerRequest with a unlinked peer (<a class="reference external" href="https://github.com/ceph/ceph/pull/41304">pr#41304</a>, Arthur Outhenin-Chalandre)</p></li>
<li><p>librbd: don’t stop at the first unremovable image when purging (<a class="reference external" href="https://github.com/ceph/ceph/pull/41664">pr#41664</a>, Ilya Dryomov)</p></li>
<li><p>make-dist: refuse to run if script path contains a colon (<a class="reference external" href="https://github.com/ceph/ceph/pull/41086">pr#41086</a>, Nathan Cutler)</p></li>
<li><p>mds: “FAILED ceph_assert(r == 0 || r == -2)” (<a class="reference external" href="https://github.com/ceph/ceph/pull/42072">pr#42072</a>, Xiubo Li)</p></li>
<li><p>mds: “cluster [ERR]   Error recovering journal 0x203: (2) No such file or directory” in cluster log” (<a class="reference external" href="https://github.com/ceph/ceph/pull/42059">pr#42059</a>, Xiubo Li)</p></li>
<li><p>mds: Add full caps to avoid osd full check (<a class="reference external" href="https://github.com/ceph/ceph/pull/41691">pr#41691</a>, Patrick Donnelly, Kotresh HR)</p></li>
<li><p>mds: CephFS kclient gets stuck when getattr() on a certain file (<a class="reference external" href="https://github.com/ceph/ceph/pull/42062">pr#42062</a>, “Yan, Zheng”, Xiubo Li)</p></li>
<li><p>mds: Error ENOSYS: mds.a started profiler (<a class="reference external" href="https://github.com/ceph/ceph/pull/42056">pr#42056</a>, Xiubo Li)</p></li>
<li><p>mds: MDSLog::journaler pointer maybe crash with use-after-free (<a class="reference external" href="https://github.com/ceph/ceph/pull/42060">pr#42060</a>, Xiubo Li)</p></li>
<li><p>mds: avoid journaling overhead for setxattr(“ceph.dir.subvolume”) for no-op case (<a class="reference external" href="https://github.com/ceph/ceph/pull/41995">pr#41995</a>, Patrick Donnelly)</p></li>
<li><p>mds: do not assert when receiving a unknow metric type (<a class="reference external" href="https://github.com/ceph/ceph/pull/41596">pr#41596</a>, Patrick Donnelly, Xiubo Li)</p></li>
<li><p>mds: journal recovery thread is possibly asserting with mds_lock not locked (<a class="reference external" href="https://github.com/ceph/ceph/pull/42058">pr#42058</a>, Xiubo Li)</p></li>
<li><p>mds: mkdir on ephemerally pinned directory sometimes blocked on journal flush (<a class="reference external" href="https://github.com/ceph/ceph/pull/42071">pr#42071</a>, Xiubo Li)</p></li>
<li><p>mds: scrub error on inode 0x1 (<a class="reference external" href="https://github.com/ceph/ceph/pull/41685">pr#41685</a>, Milind Changire)</p></li>
<li><p>mds: standby-replay only trims cache when it reaches the end of the replay log (<a class="reference external" href="https://github.com/ceph/ceph/pull/40855">pr#40855</a>, Xiubo Li, Patrick Donnelly)</p></li>
<li><p>mgr/DaemonServer.cc: prevent mgr crashes caused by integer underflow that is triggered by large increases to pg_num/pgp_num (<a class="reference external" href="https://github.com/ceph/ceph/pull/41862">pr#41862</a>, Cory Snyder)</p></li>
<li><p>mgr/Dashboard: Remove erroneous elements in hosts-overview Grafana dashboard (<a class="reference external" href="https://github.com/ceph/ceph/pull/40982">pr#40982</a>, Malcolm Holmes)</p></li>
<li><p>mgr/dashboard: API Version changes do not apply to pre-defined methods (list, create etc.) (<a class="reference external" href="https://github.com/ceph/ceph/pull/41675">pr#41675</a>, Aashish Sharma)</p></li>
<li><p>mgr/dashboard: Alertmanager fails to POST alerts (<a class="reference external" href="https://github.com/ceph/ceph/pull/41987">pr#41987</a>, Avan Thakkar)</p></li>
<li><p>mgr/dashboard: Fix 500 error while exiting out of maintenance (<a class="reference external" href="https://github.com/ceph/ceph/pull/41915">pr#41915</a>, Nizamudeen A)</p></li>
<li><p>mgr/dashboard: Fix bucket name input allowing space in the value (<a class="reference external" href="https://github.com/ceph/ceph/pull/42119">pr#42119</a>, Nizamudeen A)</p></li>
<li><p>mgr/dashboard: Fix for query params resetting on change-password (<a class="reference external" href="https://github.com/ceph/ceph/pull/41440">pr#41440</a>, Nizamudeen A)</p></li>
<li><p>mgr/dashboard: Generate NPM dependencies manifest (<a class="reference external" href="https://github.com/ceph/ceph/pull/41204">pr#41204</a>, Nizamudeen A)</p></li>
<li><p>mgr/dashboard: Host Maintenance Follow ups (<a class="reference external" href="https://github.com/ceph/ceph/pull/41056">pr#41056</a>, Nizamudeen A)</p></li>
<li><p>mgr/dashboard: Include Network address and labels on Host Creation form (<a class="reference external" href="https://github.com/ceph/ceph/pull/42027">pr#42027</a>, Nizamudeen A)</p></li>
<li><p>mgr/dashboard: OSDs placement text is unreadable (<a class="reference external" href="https://github.com/ceph/ceph/pull/41096">pr#41096</a>, Aashish Sharma)</p></li>
<li><p>mgr/dashboard: RGW buckets async validator performance enhancement and name constraints (<a class="reference external" href="https://github.com/ceph/ceph/pull/41296">pr#41296</a>, Nizamudeen A)</p></li>
<li><p>mgr/dashboard: User database migration has been cut out (<a class="reference external" href="https://github.com/ceph/ceph/pull/42140">pr#42140</a>, Volker Theile)</p></li>
<li><p>mgr/dashboard: avoid data processing in crush-map component (<a class="reference external" href="https://github.com/ceph/ceph/pull/41203">pr#41203</a>, Avan Thakkar)</p></li>
<li><p>mgr/dashboard: bucket details: show lock retention period only in days (<a class="reference external" href="https://github.com/ceph/ceph/pull/41948">pr#41948</a>, Alfonso Martínez)</p></li>
<li><p>mgr/dashboard: crushmap tree doesn’t display crush type other than root (<a class="reference external" href="https://github.com/ceph/ceph/pull/42007">pr#42007</a>, Kefu Chai, Avan Thakkar)</p></li>
<li><p>mgr/dashboard: disable NFSv3 support in dashboard (<a class="reference external" href="https://github.com/ceph/ceph/pull/41200">pr#41200</a>, Volker Theile)</p></li>
<li><p>mgr/dashboard: drop container image name and id from services list (<a class="reference external" href="https://github.com/ceph/ceph/pull/41505">pr#41505</a>, Avan Thakkar)</p></li>
<li><p>mgr/dashboard: fix API docs link (<a class="reference external" href="https://github.com/ceph/ceph/pull/41507">pr#41507</a>, Avan Thakkar)</p></li>
<li><p>mgr/dashboard: fix ESOCKETTIMEDOUT E2E failure (<a class="reference external" href="https://github.com/ceph/ceph/pull/41427">pr#41427</a>, Avan Thakkar)</p></li>
<li><p>mgr/dashboard: fix HAProxy (now called ingress) (<a class="reference external" href="https://github.com/ceph/ceph/pull/41298">pr#41298</a>, Avan Thakkar)</p></li>
<li><p>mgr/dashboard: fix OSD out count (<a class="reference external" href="https://github.com/ceph/ceph/pull/42153">pr#42153</a>, 胡玮文)</p></li>
<li><p>mgr/dashboard: fix OSDs Host details/overview grafana graphs (<a class="reference external" href="http://tracker.ceph.com/issues/49769">issue#49769</a>, <a class="reference external" href="https://github.com/ceph/ceph/pull/41324">pr#41324</a>, Alfonso Martínez, Michael Wodniok)</p></li>
<li><p>mgr/dashboard: fix base-href (<a class="reference external" href="https://github.com/ceph/ceph/pull/41634">pr#41634</a>, Avan Thakkar)</p></li>
<li><p>mgr/dashboard: fix base-href: revert it to previous approach (<a class="reference external" href="https://github.com/ceph/ceph/pull/41251">pr#41251</a>, Avan Thakkar)</p></li>
<li><p>mgr/dashboard: fix bucket objects and size calculations (<a class="reference external" href="https://github.com/ceph/ceph/pull/41646">pr#41646</a>, Avan Thakkar)</p></li>
<li><p>mgr/dashboard: fix bucket versioning when locking is enabled (<a class="reference external" href="https://github.com/ceph/ceph/pull/41197">pr#41197</a>, Avan Thakkar)</p></li>
<li><p>mgr/dashboard: fix for right sidebar nav icon not clickable (<a class="reference external" href="https://github.com/ceph/ceph/pull/42008">pr#42008</a>, Aaryan Porwal)</p></li>
<li><p>mgr/dashboard: fix set-ssl-certificate{,-key} commands (<a class="reference external" href="https://github.com/ceph/ceph/pull/41170">pr#41170</a>, Alfonso Martínez)</p></li>
<li><p>mgr/dashboard: fix typo: Filesystems to File Systems (<a class="reference external" href="https://github.com/ceph/ceph/pull/42016">pr#42016</a>, Navin Barnwal)</p></li>
<li><p>mgr/dashboard: ingress service creation follow-up (<a class="reference external" href="https://github.com/ceph/ceph/pull/41428">pr#41428</a>, Avan Thakkar)</p></li>
<li><p>mgr/dashboard: pass Grafana datasource in URL (<a class="reference external" href="https://github.com/ceph/ceph/pull/41633">pr#41633</a>, Ernesto Puerta)</p></li>
<li><p>mgr/dashboard: provide the service events when showing a service in the UI (<a class="reference external" href="https://github.com/ceph/ceph/pull/41494">pr#41494</a>, Aashish Sharma)</p></li>
<li><p>mgr/dashboard: run cephadm-backend e2e tests with KCLI (<a class="reference external" href="https://github.com/ceph/ceph/pull/42156">pr#42156</a>, Alfonso Martínez)</p></li>
<li><p>mgr/dashboard: set required env. variables in run-backend-api-tests.sh (<a class="reference external" href="https://github.com/ceph/ceph/pull/41069">pr#41069</a>, Alfonso Martínez)</p></li>
<li><p>mgr/dashboard: show RGW tenant user id correctly in ‘NFS create export’ form (<a class="reference external" href="https://github.com/ceph/ceph/pull/41528">pr#41528</a>, Alfonso Martínez)</p></li>
<li><p>mgr/dashboard: show partially deleted RBDs (<a class="reference external" href="https://github.com/ceph/ceph/pull/41891">pr#41891</a>, Tatjana Dehler)</p></li>
<li><p>mgr/dashboard: simplify object locking fields in ‘Bucket Creation’ form (<a class="reference external" href="https://github.com/ceph/ceph/pull/41777">pr#41777</a>, Alfonso Martínez)</p></li>
<li><p>mgr/dashboard: update frontend deps due to security vulnerabilities (<a class="reference external" href="https://github.com/ceph/ceph/pull/41402">pr#41402</a>, Alfonso Martínez)</p></li>
<li><p>mgr/dashboard:include compression stats on pool dashboard (<a class="reference external" href="https://github.com/ceph/ceph/pull/41577">pr#41577</a>, Ernesto Puerta, Paul Cuzner)</p></li>
<li><p>mgr/nfs: do not depend on cephadm.utils (<a class="reference external" href="https://github.com/ceph/ceph/pull/41842">pr#41842</a>, Sage Weil)</p></li>
<li><p>mgr/progress: ensure progress stays between [0,1] (<a class="reference external" href="https://github.com/ceph/ceph/pull/41312">pr#41312</a>, Dan van der Ster)</p></li>
<li><p>mgr/prometheus:Improve the pool metadata (<a class="reference external" href="https://github.com/ceph/ceph/pull/40804">pr#40804</a>, Paul Cuzner)</p></li>
<li><p>mgr/pybind/snap_schedule: do not fail when no fs snapshots are available (<a class="reference external" href="https://github.com/ceph/ceph/pull/41044">pr#41044</a>, Sébastien Han)</p></li>
<li><p>mgr/volumes/nfs: drop type param during cluster create (<a class="reference external" href="https://github.com/ceph/ceph/pull/41005">pr#41005</a>, Michael Fritch)</p></li>
<li><p>mon,doc: deprecate min_compat_client (<a class="reference external" href="https://github.com/ceph/ceph/pull/41468">pr#41468</a>, Patrick Donnelly)</p></li>
<li><p>mon/MonClient: reset authenticate_err in _reopen_session() (<a class="reference external" href="https://github.com/ceph/ceph/pull/41019">pr#41019</a>, Ilya Dryomov)</p></li>
<li><p>mon/MonClient: tolerate a rotating key that is slightly out of date (<a class="reference external" href="https://github.com/ceph/ceph/pull/41450">pr#41450</a>, Ilya Dryomov)</p></li>
<li><p>mon/OSDMonitor: drop stale failure_info after a grace period (<a class="reference external" href="https://github.com/ceph/ceph/pull/41090">pr#41090</a>, Kefu Chai)</p></li>
<li><p>mon/OSDMonitor: drop stale failure_info even if can_mark_down() (<a class="reference external" href="https://github.com/ceph/ceph/pull/41982">pr#41982</a>, Kefu Chai)</p></li>
<li><p>mon: load stashed map before mkfs monmap (<a class="reference external" href="https://github.com/ceph/ceph/pull/41768">pr#41768</a>, Dan van der Ster)</p></li>
<li><p>nfs backport May (<a class="reference external" href="https://github.com/ceph/ceph/pull/41389">pr#41389</a>, Varsha Rao)</p></li>
<li><p>os/FileStore: fix to handle readdir error correctly (<a class="reference external" href="https://github.com/ceph/ceph/pull/41236">pr#41236</a>, Misono Tomohiro)</p></li>
<li><p>os/bluestore: fix unexpected ENOSPC in Avl/Hybrid allocators (<a class="reference external" href="https://github.com/ceph/ceph/pull/41655">pr#41655</a>, Igor Fedotov, Neha Ojha)</p></li>
<li><p>os/bluestore: introduce multithreading sync for bluestore’s repairer (<a class="reference external" href="https://github.com/ceph/ceph/pull/41752">pr#41752</a>, Igor Fedotov)</p></li>
<li><p>os/bluestore: tolerate zero length for allocators’ init_[add/rm]_free() (<a class="reference external" href="https://github.com/ceph/ceph/pull/41753">pr#41753</a>, Igor Fedotov)</p></li>
<li><p>osd/PG.cc: handle removal of pgmeta object (<a class="reference external" href="https://github.com/ceph/ceph/pull/41680">pr#41680</a>, Neha Ojha)</p></li>
<li><p>osd/osd_type: use f-&gt;dump_unsigned() when appropriate (<a class="reference external" href="https://github.com/ceph/ceph/pull/42045">pr#42045</a>, Kefu Chai)</p></li>
<li><p>osd/scrub: replace a ceph_assert() with a test (<a class="reference external" href="https://github.com/ceph/ceph/pull/41944">pr#41944</a>, Ronen Friedman)</p></li>
<li><p>osd: Override recovery, backfill and sleep related config options during OSD and mclock scheduler initialization (<a class="reference external" href="https://github.com/ceph/ceph/pull/41125">pr#41125</a>, Sridhar Seshasayee, Zac Dover)</p></li>
<li><p>osd: clear data digest when write_trunc (<a class="reference external" href="https://github.com/ceph/ceph/pull/42019">pr#42019</a>, Zengran Zhang)</p></li>
<li><p>osd: compute OSD’s space usage ratio via raw space utilization (<a class="reference external" href="https://github.com/ceph/ceph/pull/41113">pr#41113</a>, Igor Fedotov)</p></li>
<li><p>osd: don’t assert in-flight backfill is always in recovery list (<a class="reference external" href="https://github.com/ceph/ceph/pull/41320">pr#41320</a>, Mykola Golub)</p></li>
<li><p>osd: fix scrub reschedule bug (<a class="reference external" href="https://github.com/ceph/ceph/pull/41971">pr#41971</a>, wencong wan)</p></li>
<li><p>pacific: client: abort after MDS blocklist (<a class="reference external" href="http://tracker.ceph.com/issues/50530">issue#50530</a>, <a class="reference external" href="https://github.com/ceph/ceph/pull/42070">pr#42070</a>, Venky Shankar)</p></li>
<li><p>pybind/ceph_volume_client: use cephfs mkdirs api (<a class="reference external" href="https://github.com/ceph/ceph/pull/42159">pr#42159</a>, Patrick Donnelly)</p></li>
<li><p>pybind/mgr/devicehealth: scrape-health-metrics command accidentally renamed to scrape-daemon-health-metrics (<a class="reference external" href="https://github.com/ceph/ceph/pull/41089">pr#41089</a>, Patrick Donnelly)</p></li>
<li><p>pybind/mgr/progress: Disregard unreported pgs (<a class="reference external" href="https://github.com/ceph/ceph/pull/41872">pr#41872</a>, Kamoltat)</p></li>
<li><p>pybind/mgr/snap_schedule: Invalid command: Unexpected argument ‘fs=cephfs’ (<a class="reference external" href="https://github.com/ceph/ceph/pull/42064">pr#42064</a>, Patrick Donnelly)</p></li>
<li><p>qa/config/rados: add dispatch delay testing params (<a class="reference external" href="https://github.com/ceph/ceph/pull/41136">pr#41136</a>, Deepika Upadhyay)</p></li>
<li><p>qa/distros/podman: preserve registries.conf (<a class="reference external" href="https://github.com/ceph/ceph/pull/40729">pr#40729</a>, Sage Weil)</p></li>
<li><p>qa/suites/rados/standalone: remove mon_election symlink (<a class="reference external" href="https://github.com/ceph/ceph/pull/41212">pr#41212</a>, Neha Ojha)</p></li>
<li><p>qa/suites/rados: add simultaneous scrubs to the thrasher (<a class="reference external" href="https://github.com/ceph/ceph/pull/42120">pr#42120</a>, Ronen Friedman)</p></li>
<li><p>qa/tasks/qemu: precise repos have been archived (<a class="reference external" href="https://github.com/ceph/ceph/pull/41643">pr#41643</a>, Ilya Dryomov)</p></li>
<li><p>qa/tests: corrected point versions to reflect latest releases (<a class="reference external" href="https://github.com/ceph/ceph/pull/41313">pr#41313</a>, Yuri Weinstein)</p></li>
<li><p>qa/tests: initial checkin for pacific-p2p suite (2) (<a class="reference external" href="https://github.com/ceph/ceph/pull/41208">pr#41208</a>, Yuri Weinstein)</p></li>
<li><p>qa/tests: replaced ubuntu_latest.yaml with ubuntu 20.04 (<a class="reference external" href="https://github.com/ceph/ceph/pull/41460">pr#41460</a>, Patrick Donnelly, Kefu Chai)</p></li>
<li><p>qa/upgrade: conditionally disable update_features tests (<a class="reference external" href="https://github.com/ceph/ceph/pull/41629">pr#41629</a>, Deepika)</p></li>
<li><p>qa/workunits/rbd: use bionic version of qemu-iotests for focal (<a class="reference external" href="https://github.com/ceph/ceph/pull/41195">pr#41195</a>, Ilya Dryomov)</p></li>
<li><p>qa: AttributeError: ‘RemoteProcess’ object has no attribute ‘split’ (<a class="reference external" href="https://github.com/ceph/ceph/pull/41811">pr#41811</a>, Patrick Donnelly)</p></li>
<li><p>qa: add async dirops testing (<a class="reference external" href="https://github.com/ceph/ceph/pull/41823">pr#41823</a>, Patrick Donnelly)</p></li>
<li><p>qa: check mounts attribute in ctx (<a class="reference external" href="https://github.com/ceph/ceph/pull/40634">pr#40634</a>, Jos Collin)</p></li>
<li><p>qa: convert some legacy Filesystem.rados calls (<a class="reference external" href="https://github.com/ceph/ceph/pull/40996">pr#40996</a>, Patrick Donnelly)</p></li>
<li><p>qa: drop the distro~HEAD directory from the fs suite (<a class="reference external" href="https://github.com/ceph/ceph/pull/41169">pr#41169</a>, Radoslaw Zarzynski)</p></li>
<li><p>qa: fs:bugs does not specify distro (<a class="reference external" href="https://github.com/ceph/ceph/pull/42063">pr#42063</a>, Patrick Donnelly)</p></li>
<li><p>qa: fs:upgrade uses teuthology default distro (<a class="reference external" href="https://github.com/ceph/ceph/pull/42067">pr#42067</a>, Patrick Donnelly)</p></li>
<li><p>qa: scrub code does not join scrubopts with comma (<a class="reference external" href="https://github.com/ceph/ceph/pull/42065">pr#42065</a>, Kefu Chai, Patrick Donnelly)</p></li>
<li><p>qa: test_data_scan.TestDataScan.test_pg_files AssertionError: Items in the second set but not the first (<a class="reference external" href="https://github.com/ceph/ceph/pull/42069">pr#42069</a>, Xiubo Li)</p></li>
<li><p>qa: test_ephemeral_pin_distribution failure (<a class="reference external" href="https://github.com/ceph/ceph/pull/41659">pr#41659</a>, Patrick Donnelly)</p></li>
<li><p>qa: update RHEL to 8.4 (<a class="reference external" href="https://github.com/ceph/ceph/pull/41822">pr#41822</a>, Patrick Donnelly)</p></li>
<li><p>rbd-mirror: fix segfault in snapshot replayer shutdown (<a class="reference external" href="https://github.com/ceph/ceph/pull/41503">pr#41503</a>, Arthur Outhenin-Chalandre)</p></li>
<li><p>rbd: –source-spec-file should be –source-spec-path (<a class="reference external" href="https://github.com/ceph/ceph/pull/41122">pr#41122</a>, Ilya Dryomov)</p></li>
<li><p>rbd: don’t attempt to interpret image cache state json (<a class="reference external" href="https://github.com/ceph/ceph/pull/41281">pr#41281</a>, Ilya Dryomov)</p></li>
<li><p>rgw: Simplify log shard probing and err on the side of omap (<a class="reference external" href="https://github.com/ceph/ceph/pull/41576">pr#41576</a>, Adam C. Emerson)</p></li>
<li><p>rgw: completion of multipart upload leaves delete marker (<a class="reference external" href="https://github.com/ceph/ceph/pull/41769">pr#41769</a>, J. Eric Ivancich)</p></li>
<li><p>rgw: crash on multipart upload to bucket with policy (<a class="reference external" href="https://github.com/ceph/ceph/pull/41893">pr#41893</a>, Or Friedmann)</p></li>
<li><p>rgw: radosgw_admin remove bucket not purging past 1,000 objects (<a class="reference external" href="https://github.com/ceph/ceph/pull/41863">pr#41863</a>, J. Eric Ivancich)</p></li>
<li><p>rgw: radoslist incomplete multipart parts marker (<a class="reference external" href="https://github.com/ceph/ceph/pull/40819">pr#40819</a>, J. Eric Ivancich)</p></li>
<li><p>rocksdb: pickup fix to detect PMULL instruction (<a class="reference external" href="https://github.com/ceph/ceph/pull/41079">pr#41079</a>, Kefu Chai)</p></li>
<li><p>session dump includes completed_requests twice, once as an integer and once as a list (<a class="reference external" href="https://github.com/ceph/ceph/pull/42057">pr#42057</a>, Dan van der Ster)</p></li>
<li><p>systemd: remove <cite>ProtectClock=true</cite> for <cite>ceph-osd&#64;.service</cite> (<a class="reference external" href="https://github.com/ceph/ceph/pull/41232">pr#41232</a>, Wong Hoi Sing Edison)</p></li>
<li><p>test/librbd: use really invalid domain (<a class="reference external" href="https://github.com/ceph/ceph/pull/42010">pr#42010</a>, Mykola Golub)</p></li>
<li><p>win32*.sh: disable libcephsqlite when targeting Windows (<a class="reference external" href="https://github.com/ceph/ceph/pull/40557">pr#40557</a>, Lucian Petrut)</p></li>
</ul>
</div>
</div>
<div class="section" id="v16-2-4-pacific">
<h2>v16.2.4 Pacific<a class="headerlink" href="#v16-2-4-pacific" title="Permalink to this headline">¶</a></h2>
<p>This is a hotfix release addressing a number of security issues and regressions. We recommend all users update to this release.</p>
<div class="section" id="id3">
<h3>Changelog<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>mgr/dashboard: fix base-href: revert it to previous approach (<a class="reference external" href="https://tracker.ceph.com/issues/50684">issue#50684</a>, Avan Thakkar)</p></li>
<li><p>mgr/dashboard: fix cookie injection issue (<a class="reference internal" href="../../security/CVE-2021-3509/#cve-2021-3509"><span class="std std-ref">CVE-2021-3509: Dashboard XSS via token cookie</span></a>, Ernesto Puerta)</p></li>
<li><p>mgr/dashboard: fix set-ssl-certificate{,-key} commands (<a class="reference external" href="https://tracker.ceph.com/issues/50519">issue#50519</a>, Alfonso Martínez)</p></li>
<li><p>rgw: RGWSwiftWebsiteHandler::is_web_dir checks empty subdir_name (<a class="reference internal" href="../../security/CVE-2021-3531/#cve-2021-3531"><span class="std std-ref">CVE-2021-3531: Swift API denial of service</span></a>, Felix Huettner)</p></li>
<li><p>rgw: sanitize r in s3 CORSConfiguration’s ExposeHeader (<a class="reference internal" href="../../security/CVE-2021-3524/#cve-2021-3524"><span class="std std-ref">CVE-2021-3524: HTTP header injects via CORS in RGW</span></a>, Sergey Bobrov, Casey Bodley)</p></li>
<li><p>systemd: remove ProtectClock=true for ceph-osd&#64;.service (<a class="reference external" href="https://tracker.ceph.com/issues/50347">issue#50347</a>, Wong Hoi Sing Edison)</p></li>
</ul>
</div>
</div>
<div class="section" id="v16-2-3-pacific">
<h2>v16.2.3 Pacific<a class="headerlink" href="#v16-2-3-pacific" title="Permalink to this headline">¶</a></h2>
<p>This is the third backport release in the Pacific series.  We recommend all users
update to this release.</p>
<div class="section" id="id4">
<h3>Notable Changes<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>This release fixes a cephadm upgrade bug that caused some systems to get stuck in a loop
restarting the first mgr daemon.</p></li>
</ul>
</div>
</div>
<div class="section" id="v16-2-2-pacific">
<h2>v16.2.2 Pacific<a class="headerlink" href="#v16-2-2-pacific" title="Permalink to this headline">¶</a></h2>
<p>This is the second backport release in the Pacific series. We recommend all
users update to this release.</p>
<div class="section" id="id5">
<h3>Notable Changes<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Cephadm now supports an <em>ingress</em> service type that provides load
balancing and HA (via haproxy and keepalived on a virtual IP) for
RGW service (see <a class="reference internal" href="../../cephadm/services/rgw/#orchestrator-haproxy-service-spec"><span class="std std-ref">High availability service for RGW</span></a>).  (The experimental
<em>rgw-ha</em> service has been removed.)</p></li>
</ul>
</div>
<div class="section" id="id6">
<h3>Changelog<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>ceph-fuse: src/include/buffer.h: 1187: FAILED ceph_assert(_num &lt;= 1024) (<a class="reference external" href="https://github.com/ceph/ceph/pull/40628">pr#40628</a>, Yanhu Cao)</p></li>
<li><p>ceph-volume: fix “device” output (<a class="reference external" href="https://github.com/ceph/ceph/pull/41054">pr#41054</a>, Sébastien Han)</p></li>
<li><p>ceph-volume: fix raw listing when finding OSDs from different clusters (<a class="reference external" href="https://github.com/ceph/ceph/pull/40985">pr#40985</a>, Sébastien Han)</p></li>
<li><p>ceph.spec.in: Enable tcmalloc on IBM Power and Z (<a class="reference external" href="https://github.com/ceph/ceph/pull/39488">pr#39488</a>, Nathan Cutler, Yaakov Selkowitz)</p></li>
<li><p>cephadm april batch 3 (<a class="reference external" href="http://tracker.ceph.com/issues/49737">issue#49737</a>, <a class="reference external" href="https://github.com/ceph/ceph/pull/40922">pr#40922</a>, Adam King, Sage Weil, Daniel Pivonka, Shreyaa Sharma, Sebastian Wagner, Juan Miguel Olmo Martínez, Zac Dover, Jeff Layton, Guillaume Abrioux, 胡玮文, Melissa Li, Nathan Cutler, Yaakov Selkowitz)</p></li>
<li><p>cephadm: april batch 1 (<a class="reference external" href="https://github.com/ceph/ceph/pull/40544">pr#40544</a>, Sage Weil, Daniel Pivonka, Joao Eduardo Luis, Adam King)</p></li>
<li><p>cephadm: april batch backport 2 (<a class="reference external" href="https://github.com/ceph/ceph/pull/40746">pr#40746</a>, Guillaume Abrioux, Sage Weil, Paul Cuzner)</p></li>
<li><p>cephadm: specify addr on bootstrap’s host add (<a class="reference external" href="https://github.com/ceph/ceph/pull/40554">pr#40554</a>, Joao Eduardo Luis)</p></li>
<li><p>cephfs: minor ceph-dokan improvements (<a class="reference external" href="https://github.com/ceph/ceph/pull/40627">pr#40627</a>, Lucian Petrut)</p></li>
<li><p>client: items pinned in cache preventing unmount (<a class="reference external" href="https://github.com/ceph/ceph/pull/40629">pr#40629</a>, Xiubo Li)</p></li>
<li><p>client: only check pool permissions for regular files (<a class="reference external" href="https://github.com/ceph/ceph/pull/40686">pr#40686</a>, Xiubo Li)</p></li>
<li><p>cmake: define BOOST_ASIO_USE_TS_EXECUTOR_AS_DEFAULT globally (<a class="reference external" href="https://github.com/ceph/ceph/pull/40706">pr#40706</a>, Kefu Chai)</p></li>
<li><p>cmake: pass unparsed args to add_ceph_test() (<a class="reference external" href="https://github.com/ceph/ceph/pull/40523">pr#40523</a>, Kefu Chai)</p></li>
<li><p>cmake: use –smp 1 –memory 256M to crimson tests (<a class="reference external" href="https://github.com/ceph/ceph/pull/40568">pr#40568</a>, Kefu Chai)</p></li>
<li><p>crush/CrushLocation: do not print logging message in constructor (<a class="reference external" href="https://github.com/ceph/ceph/pull/40679">pr#40679</a>, Alex Wu)</p></li>
<li><p>doc/cephfs/nfs: add user id, fs name and key to FSAL block (<a class="reference external" href="https://github.com/ceph/ceph/pull/40687">pr#40687</a>, Varsha Rao)</p></li>
<li><p>include/librados: fix doxygen syntax for docs build (<a class="reference external" href="https://github.com/ceph/ceph/pull/40805">pr#40805</a>, Josh Durgin)</p></li>
<li><p>mds: “cluster [WRN] Scrub error on inode 0x1000000039d (/client.0/tmp/blogbench-1.0/src/blogtest_in) see mds.a log and <cite>damage ls</cite> output for details” (<a class="reference external" href="https://github.com/ceph/ceph/pull/40825">pr#40825</a>, Milind Changire)</p></li>
<li><p>mds: skip the buffer in UnknownPayload::decode() (<a class="reference external" href="https://github.com/ceph/ceph/pull/40682">pr#40682</a>, Xiubo Li)</p></li>
<li><p>mgr/PyModule: put mgr_module_path before Py_GetPath() (<a class="reference external" href="https://github.com/ceph/ceph/pull/40517">pr#40517</a>, Kefu Chai)</p></li>
<li><p>mgr/dashboard: Device health status is not getting listed under hosts section (<a class="reference external" href="https://github.com/ceph/ceph/pull/40494">pr#40494</a>, Aashish Sharma)</p></li>
<li><p>mgr/dashboard: Fix for alert notification message being undefined (<a class="reference external" href="https://github.com/ceph/ceph/pull/40588">pr#40588</a>, Nizamudeen A)</p></li>
<li><p>mgr/dashboard: Fix for broken User management role cloning (<a class="reference external" href="https://github.com/ceph/ceph/pull/40398">pr#40398</a>, Nizamudeen A)</p></li>
<li><p>mgr/dashboard: Improve descriptions in some parts of the dashboard (<a class="reference external" href="https://github.com/ceph/ceph/pull/40545">pr#40545</a>, Nizamudeen A)</p></li>
<li><p>mgr/dashboard: Remove username and password from request body (<a class="reference external" href="https://github.com/ceph/ceph/pull/40981">pr#40981</a>, Nizamudeen A)</p></li>
<li><p>mgr/dashboard: Remove username, password fields from Manager Modules/dashboard,influx (<a class="reference external" href="https://github.com/ceph/ceph/pull/40489">pr#40489</a>, Aashish Sharma)</p></li>
<li><p>mgr/dashboard: Revoke read-only user’s access to Manager modules (<a class="reference external" href="https://github.com/ceph/ceph/pull/40648">pr#40648</a>, Nizamudeen A)</p></li>
<li><p>mgr/dashboard: Unable to login to ceph dashboard until clearing cookies manually (<a class="reference external" href="https://github.com/ceph/ceph/pull/40586">pr#40586</a>, Avan Thakkar)</p></li>
<li><p>mgr/dashboard: debug nodeenv hangs (<a class="reference external" href="https://github.com/ceph/ceph/pull/40815">pr#40815</a>, Ernesto Puerta)</p></li>
<li><p>mgr/dashboard: filesystem pool size should use stored stat (<a class="reference external" href="https://github.com/ceph/ceph/pull/40980">pr#40980</a>, Avan Thakkar)</p></li>
<li><p>mgr/dashboard: fix broken feature toggles (<a class="reference external" href="https://github.com/ceph/ceph/pull/40474">pr#40474</a>, Ernesto Puerta)</p></li>
<li><p>mgr/dashboard: fix duplicated rows when creating NFS export (<a class="reference external" href="https://github.com/ceph/ceph/pull/40990">pr#40990</a>, Alfonso Martínez)</p></li>
<li><p>mgr/dashboard: fix errors when creating NFS export (<a class="reference external" href="https://github.com/ceph/ceph/pull/40822">pr#40822</a>, Alfonso Martínez)</p></li>
<li><p>mgr/dashboard: improve telemetry opt-in reminder notification message (<a class="reference external" href="https://github.com/ceph/ceph/pull/40887">pr#40887</a>, Waad Alkhoury)</p></li>
<li><p>mgr/dashboard: test prometheus rules through promtool (<a class="reference external" href="https://github.com/ceph/ceph/pull/40929">pr#40929</a>, Aashish Sharma, Kefu Chai)</p></li>
<li><p>mon: Modifying trim logic to change paxos_service_trim_max dynamically (<a class="reference external" href="https://github.com/ceph/ceph/pull/40691">pr#40691</a>, Aishwarya Mathuria)</p></li>
<li><p>monmaptool: Don’t call set_port on an invalid address (<a class="reference external" href="https://github.com/ceph/ceph/pull/40690">pr#40690</a>, Brad Hubbard, Kefu Chai)</p></li>
<li><p>os/FileStore: don’t propagate split/merge error to “create”/”remove” (<a class="reference external" href="https://github.com/ceph/ceph/pull/40989">pr#40989</a>, Mykola Golub)</p></li>
<li><p>os/bluestore/BlueFS: do not _flush_range deleted files (<a class="reference external" href="https://github.com/ceph/ceph/pull/40677">pr#40677</a>, weixinwei)</p></li>
<li><p>osd/PeeringState: fix acting_set_writeable min_size check (<a class="reference external" href="https://github.com/ceph/ceph/pull/40759">pr#40759</a>, Samuel Just)</p></li>
<li><p>packaging: require ceph-common for immutable object cache daemon (<a class="reference external" href="https://github.com/ceph/ceph/pull/40665">pr#40665</a>, Ilya Dryomov)</p></li>
<li><p>pybind/mgr/volumes: deadlock on async job hangs finisher thread (<a class="reference external" href="https://github.com/ceph/ceph/pull/40630">pr#40630</a>, Kefu Chai, Patrick Donnelly)</p></li>
<li><p>qa/suites/krbd: don’t require CEPHX_V2 for unmap subsuite (<a class="reference external" href="https://github.com/ceph/ceph/pull/40826">pr#40826</a>, Ilya Dryomov)</p></li>
<li><p>qa/suites/rados/cephadm: stop testing on broken focal kubic podman (<a class="reference external" href="https://github.com/ceph/ceph/pull/40512">pr#40512</a>, Sage Weil)</p></li>
<li><p>qa/tasks/ceph.conf: shorten cephx TTL for testing (<a class="reference external" href="https://github.com/ceph/ceph/pull/40663">pr#40663</a>, Sage Weil)</p></li>
<li><p>qa/tasks/cephfs: create enough subvolumes (<a class="reference external" href="https://github.com/ceph/ceph/pull/40688">pr#40688</a>, Ramana Raja)</p></li>
<li><p>qa/tasks/vstart_runner.py: start max required mgrs (<a class="reference external" href="https://github.com/ceph/ceph/pull/40612">pr#40612</a>, Alfonso Martínez)</p></li>
<li><p>qa/tasks: Add wait_for_clean() check prior to initiating scrubbing (<a class="reference external" href="https://github.com/ceph/ceph/pull/40461">pr#40461</a>, Sridhar Seshasayee)</p></li>
<li><p>qa: “AttributeError: ‘NoneType’ object has no attribute ‘mon_manager’” (<a class="reference external" href="https://github.com/ceph/ceph/pull/40645">pr#40645</a>, Rishabh Dave)</p></li>
<li><p>qa: “log [ERR] : error reading sessionmap ‘mds2_sessionmap’” (<a class="reference external" href="https://github.com/ceph/ceph/pull/40852">pr#40852</a>, Patrick Donnelly)</p></li>
<li><p>qa: fix ino_release_cb racy behavior (<a class="reference external" href="https://github.com/ceph/ceph/pull/40683">pr#40683</a>, Patrick Donnelly)</p></li>
<li><p>qa: fs:cephadm mount does not wait for mds to be created (<a class="reference external" href="https://github.com/ceph/ceph/pull/40528">pr#40528</a>, Patrick Donnelly)</p></li>
<li><p>qa: test standby_replay in workloads (<a class="reference external" href="https://github.com/ceph/ceph/pull/40853">pr#40853</a>, Patrick Donnelly)</p></li>
<li><p>rbd-mirror: fix UB while registering perf counters (<a class="reference external" href="https://github.com/ceph/ceph/pull/40680">pr#40680</a>, Arthur Outhenin-Chalandre)</p></li>
<li><p>rgw: add latency to the request summary of an op (<a class="reference external" href="https://github.com/ceph/ceph/pull/40448">pr#40448</a>, Ali Maredia)</p></li>
<li><p>rgw: Backport of datalog improvements to Pacific (<a class="reference external" href="https://github.com/ceph/ceph/pull/40559">pr#40559</a>, Yuval Lifshitz, Adam C. Emerson)</p></li>
<li><p>test: disable mgr/mirroring for <cite>test_mirroring_init_failure_with_recovery</cite> test (<a class="reference external" href="http://tracker.ceph.com/issues/50020">issue#50020</a>, <a class="reference external" href="https://github.com/ceph/ceph/pull/40684">pr#40684</a>, Venky Shankar)</p></li>
<li><p>tools/cephfs_mirror/PeerReplayer.cc: add missing include (<a class="reference external" href="https://github.com/ceph/ceph/pull/40678">pr#40678</a>, Duncan Bellamy)</p></li>
<li><p>vstart.sh: disable “auth_allow_insecure_global_id_reclaim” (<a class="reference external" href="https://github.com/ceph/ceph/pull/40957">pr#40957</a>, Kefu Chai)</p></li>
</ul>
</div>
</div>
<div class="section" id="v16-2-1-pacific">
<h2>v16.2.1 Pacific<a class="headerlink" href="#v16-2-1-pacific" title="Permalink to this headline">¶</a></h2>
<p>This is the first bugfix release in the Pacific stable series.  It addresses a
security vulnerability in the Ceph authentication framework.</p>
<p>We recommend all Pacific users upgrade.</p>
<div class="section" id="security-fixes">
<h3>Security fixes<a class="headerlink" href="#security-fixes" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>This release includes a security fix that ensures the global_id
value (a numeric value that should be unique for every authenticated
client or daemon in the cluster) is reclaimed after a network
disconnect or ticket renewal in a secure fashion.  Two new health
alerts may appear during the upgrade indicating that there are
clients or daemons that are not yet patched with the appropriate
fix.</p>
<p>To temporarily mute the health alerts around insecure clients for the duration of the
upgrade, you may want to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">health</span> <span class="n">mute</span> <span class="n">AUTH_INSECURE_GLOBAL_ID_RECLAIM</span> <span class="mi">1</span><span class="n">h</span>
<span class="n">ceph</span> <span class="n">health</span> <span class="n">mute</span> <span class="n">AUTH_INSECURE_GLOBAL_ID_RECLAIM_ALLOWED</span> <span class="mi">1</span><span class="n">h</span>
</pre></div>
</div>
<p>For more information, see <a class="reference internal" href="../../security/CVE-2021-20288/#cve-2021-20288"><span class="std std-ref">CVE-2021-20288: Unauthorized global_id reuse in cephx</span></a>.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="v16-2-0-pacific">
<h2>v16.2.0 Pacific<a class="headerlink" href="#v16-2-0-pacific" title="Permalink to this headline">¶</a></h2>
<p>This is the first stable release of Ceph Pacific.</p>
<div class="section" id="major-changes-from-octopus">
<h3>Major Changes from Octopus<a class="headerlink" href="#major-changes-from-octopus" title="Permalink to this headline">¶</a></h3>
<div class="section" id="general">
<h4>General<a class="headerlink" href="#general" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p>Cephadm can automatically upgrade an Octopus cluster to Pacific with a single
command to start the process.</p></li>
<li><p>Cephadm has improved significantly over the past year, with improved
support for RGW (standalone and multisite), and new support for NFS
and iSCSI.  Most of these changes have already been backported to
recent Octopus point releases, but with the Pacific release we will
switch to backporting bug fixes only.</p></li>
<li><p><a class="reference internal" href="../../install/get-packages/#packages"><span class="std std-ref">Packages</span></a> are built for the following distributions:</p>
<ul class="simple">
<li><p>CentOS 8</p></li>
<li><p>Ubuntu 20.04 (Focal)</p></li>
<li><p>Ubuntu 18.04 (Bionic)</p></li>
<li><p>Debian Buster</p></li>
<li><p><a class="reference internal" href="../../install/containers/#containers"><span class="std std-ref">Container image</span></a> (based on CentOS 8)</p></li>
</ul>
<p>With the exception of Debian Buster, packages and containers are
built for both x86_64 and aarch64 (arm64) architectures.</p>
<p>Note that cephadm clusters may work on many other distributions,
provided Python 3 and a recent version of Docker or Podman is
available to manage containers.  For more information, see
<a class="reference internal" href="../../cephadm/install/#cephadm-host-requirements"><span class="std std-ref">准备事项</span></a>.</p>
</li>
</ul>
</div>
<div class="section" id="dashboard">
<h4>Dashboard<a class="headerlink" href="#dashboard" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference internal" href="../../mgr/dashboard/#mgr-dashboard"><span class="std std-ref">Ceph 仪表盘</span></a> brings improvements in the following management areas:</p>
<ul class="simple">
<li><p>Orchestrator/Cephadm:</p>
<ul>
<li><p>Host management: maintenance mode, labels.</p></li>
<li><p>Services: display placement specification.</p></li>
<li><p>OSD: disk replacement, display status of ongoing deletion, and improved
health/SMART diagnostics reporting.</p></li>
</ul>
</li>
<li><p>Official <a class="reference internal" href="../../mgr/ceph_api/#mgr-ceph-api"><span class="std std-ref">Ceph RESTful API</span></a>:</p>
<ul>
<li><p>OpenAPI v3 compliant.</p></li>
<li><p>Stability commitment starting from Pacific release.</p></li>
<li><p>Versioned via HTTP <code class="docutils literal notranslate"><span class="pre">Accept</span></code> header (starting with v1.0).</p></li>
<li><p>Thoroughly tested (&gt;90% coverage and per Pull Request validation).</p></li>
<li><p>Fully documented.</p></li>
</ul>
</li>
<li><p>RGW:</p>
<ul>
<li><p>Multi-site synchronization monitoring.</p></li>
<li><p>Management of multiple RGW daemons and their resources (buckets and users).</p></li>
<li><p>Bucket and user quota usage visualization.</p></li>
<li><p>Improved configuration of S3 tenanted users.</p></li>
</ul>
</li>
<li><p>Security (multiple enhancements and fixes resulting from a pen testing conducted by IBM):</p>
<ul>
<li><p>Account lock-out after a configurable number of failed log-in attempts.</p></li>
<li><p>Improved cookie policies to mitigate XSS/CSRF attacks.</p></li>
<li><p>Reviewed and improved security in HTTP headers.</p></li>
<li><p>Sensitive information reviewed and removed from logs and error messages.</p></li>
<li><p>TLS 1.0 and 1.1 support disabled.</p></li>
<li><p>Debug mode when enabled triggers HEALTH_WARN.</p></li>
</ul>
</li>
<li><p>Pools:</p>
<ul>
<li><p>Improved visualization of replication and erasure coding modes.</p></li>
<li><p>CLAY erasure code plugin supported.</p></li>
</ul>
</li>
<li><p>Alerts and notifications:</p>
<ul>
<li><p>Alert triggered on MTU mismatches in the cluster network.</p></li>
<li><p>Favicon changes according cluster status.</p></li>
</ul>
</li>
<li><p>Other:</p>
<ul>
<li><p>Landing page: improved charts and visualization.</p></li>
<li><p>Telemetry configuration wizard.</p></li>
<li><p>OSDs: management of individual OSD flags.</p></li>
<li><p>RBD: per-RBD image Grafana dashboards.</p></li>
<li><p>CephFS: Dirs and Caps displayed.</p></li>
<li><p>NFS: v4 support only (v3 backward compatibility planned).</p></li>
<li><p>Front-end: Angular 10 update.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="rados">
<h4>RADOS<a class="headerlink" href="#rados" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Pacific introduces <a class="reference internal" href="../../rados/configuration/bluestore-config-ref/#bluestore-rocksdb-sharding"><span class="std std-ref">RocksDB Sharding</span></a>, which reduces disk space requirements.</p></li>
<li><p>Ceph now provides QoS between client I/O and background operations via the
mclock scheduler.</p></li>
<li><p>The balancer is now on by default in upmap mode to improve distribution of
PGs across OSDs.</p></li>
<li><p>The output of <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">-s</span></code> has been improved to show recovery progress in
one progress bar. More detailed progress bars are visible via the
<code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">progress</span></code> command.</p></li>
</ul>
</div>
<div class="section" id="rbd-block-storage">
<h4>RBD block storage<a class="headerlink" href="#rbd-block-storage" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Image live-migration feature has been extended to support external data
sources.  Images can now be instantly imported from local files, remote
files served over HTTP(S) or remote S3 buckets in <code class="docutils literal notranslate"><span class="pre">raw</span></code> (<code class="docutils literal notranslate"><span class="pre">rbd</span> <span class="pre">export</span> <span class="pre">v1</span></code>)
or basic <code class="docutils literal notranslate"><span class="pre">qcow</span></code> and <code class="docutils literal notranslate"><span class="pre">qcow2</span></code> formats.  Support for <code class="docutils literal notranslate"><span class="pre">rbd</span> <span class="pre">export</span> <span class="pre">v2</span></code>
format, advanced QCOW features and <code class="docutils literal notranslate"><span class="pre">rbd</span> <span class="pre">export-diff</span></code> snapshot differentials
is expected in future releases.</p></li>
<li><p>Initial support for client-side encryption has been added.  This is based
on LUKS and in future releases will allow using per-image encryption keys
while maintaining snapshot and clone functionality – so that parent image
and potentially multiple clone images can be encrypted with different keys.</p></li>
<li><p>A new persistent write-back cache is available.  The cache operates in
a log-structured manner, providing full point-in-time consistency for the
backing image.  It should be particularly suitable for PMEM devices.</p></li>
<li><p>A Windows client is now available in the form of <code class="docutils literal notranslate"><span class="pre">librbd.dll</span></code> and
<code class="docutils literal notranslate"><span class="pre">rbd-wnbd</span></code> (Windows Network Block Device) daemon.  It allows mapping,
unmapping and manipulating images similar to <code class="docutils literal notranslate"><span class="pre">rbd-nbd</span></code>.</p></li>
<li><p>librbd API now offers quiesce/unquiesce hooks, allowing for coordinated
snapshot creation.</p></li>
</ul>
</div>
<div class="section" id="rgw-object-storage">
<h4>RGW object storage<a class="headerlink" href="#rgw-object-storage" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Initial support for S3 Select. See <a class="reference internal" href="../../radosgw/s3select/#s3-select-feature-table"><span class="std std-ref">Features Support</span></a> for supported queries.</p></li>
<li><p>Bucket notification topics can be configured as <code class="docutils literal notranslate"><span class="pre">persistent</span></code>, where events
are recorded in rados for reliable delivery.</p></li>
<li><p>Bucket notifications can be delivered to SSL-enabled AMQP endpoints.</p></li>
<li><p>Lua scripts can be run during requests and access their metadata.</p></li>
<li><p>SSE-KMS now supports KMIP as a key management service.</p></li>
<li><p>Multisite data logs can now be deployed on <code class="docutils literal notranslate"><span class="pre">cls_fifo</span></code> to avoid large omap
cluster warnings and make their trimming cheaper. See <code class="docutils literal notranslate"><span class="pre">rgw_data_log_backing</span></code>.</p></li>
</ul>
</div>
<div class="section" id="cephfs-distributed-file-system">
<h4>CephFS distributed file system<a class="headerlink" href="#cephfs-distributed-file-system" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>The CephFS MDS modifies on-RADOS metadata such that the new format is no
longer backwards compatible. It is not possible to downgrade a file system from
Pacific (or later) to an older release.</p></li>
<li><p>Multiple file systems in a single Ceph cluster is now stable. New Ceph
clusters enable support for multiple file systems by default. Existing clusters
must still set the “enable_multiple” flag on the FS. See also
<a class="reference internal" href="../../cephfs/multifs/#cephfs-multifs"><span class="std std-ref">Multiple Ceph File Systems</span></a>.</p></li>
<li><p>A new <code class="docutils literal notranslate"><span class="pre">mds_autoscaler</span></code> <code class="docutils literal notranslate"><span class="pre">ceph-mgr</span></code> plugin is available for automatically
deploying MDS daemons in response to changes to the <code class="docutils literal notranslate"><span class="pre">max_mds</span></code> configuration.
Expect further enhancements in the future to simplify and automate MDS scaling.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cephfs-top</span></code> is a new utility for looking at performance metrics from CephFS
clients. It is development preview quality and will have bugs. For more
information, see <a class="reference internal" href="../../cephfs/cephfs-top/#cephfs-top"><span class="std std-ref">CephFS Top Utility</span></a>.</p></li>
<li><p>A new <code class="docutils literal notranslate"><span class="pre">snap_schedule</span></code> <code class="docutils literal notranslate"><span class="pre">ceph-mgr</span></code> plugin provides a command toolset for
scheduling snapshots on a CephFS file system. For more information, see
<a class="reference internal" href="../../cephfs/snap-schedule/#snap-schedule"><span class="std std-ref">Snapshot Scheduling Module</span></a>.</p></li>
<li><p>First class NFS gateway support in Ceph is here! It’s now possible to create
scale-out (“active-active”) NFS gateway clusters that export CephFS using
a few commands. The gateways are deployed via cephadm (or Rook, in the future).
For more information, see <a class="reference internal" href="../../mgr/nfs/#mgr-nfs"><span class="std std-ref">CephFS &amp; RGW Exports over NFS</span></a>.</p></li>
<li><p>Multiple active MDS file system scrub is now stable. It is no longer necessary
to set <code class="docutils literal notranslate"><span class="pre">max_mds</span></code> to 1 and wait for non-zero ranks to stop. Scrub commands
can only be sent to rank 0: <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">tell</span> <span class="pre">mds.&lt;fs_name&gt;:0</span> <span class="pre">scrub</span> <span class="pre">start</span> <span class="pre">/path</span> <span class="pre">...</span></code>.
For more information, see <a class="reference internal" href="../../cephfs/scrub/#mds-scrub"><span class="std std-ref">Ceph 文件系统洗刷</span></a>.</p></li>
<li><p>Ephemeral pinning – policy based subtree pinning – is considered stable.
<code class="docutils literal notranslate"><span class="pre">mds_export_ephemeral_random</span></code> and <code class="docutils literal notranslate"><span class="pre">mds_export_ephemeral_distributed</span></code> now
default to true. For more information, see <a class="reference internal" href="../../cephfs/multimds/#cephfs-ephemeral-pinning"><span class="std std-ref">Setting subtree partitioning policies</span></a>.</p></li>
<li><p>A new <code class="docutils literal notranslate"><span class="pre">cephfs-mirror</span></code> daemon is available to mirror CephFS file systems to
a remote Ceph cluster. For more information, see <a class="reference internal" href="../../cephfs/cephfs-mirroring/#cephfs-mirroring"><span class="std std-ref">CephFS Snapshot Mirroring</span></a>.</p></li>
<li><p>A Windows client is now available for connecting to CephFS. This is offered
through a new <code class="docutils literal notranslate"><span class="pre">ceph-dokan</span></code> utility which operates via the Dokan userspace
API, similar to FUSE. For more information, see <a class="reference internal" href="../../cephfs/ceph-dokan/#ceph-dokan"><span class="std std-ref">Mount CephFS on Windows</span></a>.</p></li>
</ul>
</div>
</div>
<div class="section" id="upgrading-from-octopus-or-nautilus">
<h3>Upgrading from Octopus or Nautilus<a class="headerlink" href="#upgrading-from-octopus-or-nautilus" title="Permalink to this headline">¶</a></h3>
<p>Before starting, make sure your cluster is stable and healthy (no down or
recovering OSDs).  (This is optional, but recommended.)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>WARNING: Please do not set <cite>bluestore_fsck_quick_fix_on_mount</cite> to true or
run <cite>ceph-bluestore-tool</cite> repair or quick-fix commands in Pacific versions
&lt;= 16.2.6, because this can lead to data corruption, details in
<a class="reference external" href="https://tracker.ceph.com/issues/53062">https://tracker.ceph.com/issues/53062</a>.</p>
</div>
<div class="section" id="upgrading-cephadm-clusters">
<h4>Upgrading cephadm clusters<a class="headerlink" href="#upgrading-cephadm-clusters" title="Permalink to this headline">¶</a></h4>
<p>If your cluster is deployed with cephadm (first introduced in Octopus), then
the upgrade process is entirely automated.  To initiate the upgrade,</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><style type="text/css">
span.prompt1:before {
  content: "# ";
}
</style><span class="prompt1">ceph orch upgrade start --ceph-version <span class="m">16</span>.2.0</span>
</pre></div></div></div></blockquote>
<p>The same process is used to upgrade to future minor releases.</p>
<p>Upgrade progress can be monitored with <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">-s</span></code> (which provides a simple
progress bar) or more verbosely with</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph -W cephadm</span>
</pre></div></div></div></blockquote>
<p>The upgrade can be paused or resumed with</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph orch upgrade pause   <span class="c1"># to pause</span></span>
<span class="prompt1">ceph orch upgrade resume  <span class="c1"># to resume</span></span>
</pre></div></div></div></blockquote>
<p>or canceled with</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph orch upgrade stop</span>
</pre></div></div></div></blockquote>
<p>Note that canceling the upgrade simply stops the process; there is no ability to
downgrade back to Octopus.</p>
</div>
<div class="section" id="upgrading-non-cephadm-clusters">
<h4>Upgrading non-cephadm clusters<a class="headerlink" href="#upgrading-non-cephadm-clusters" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you cluster is running Octopus (15.2.x), you might choose
to first convert it to use cephadm so that the upgrade to Pacific
is automated (see above).  For more information, see
<a class="reference internal" href="../../cephadm/adoption/#cephadm-adoption"><span class="std std-ref">现有集群切换到 cephadm</span></a>.</p>
</div>
<ol class="arabic">
<li><p>Set the <code class="docutils literal notranslate"><span class="pre">noout</span></code> flag for the duration of the upgrade. (Optional,
but recommended.):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ceph osd set noout</span>
</pre></div>
</div>
</li>
<li><p>Upgrade monitors by installing the new packages and restarting the
monitor daemons.  For example, on each monitor host,:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># systemctl restart ceph-mon.target</span>
</pre></div>
</div>
<p>Once all monitors are up, verify that the monitor upgrade is
complete by looking for the <code class="docutils literal notranslate"><span class="pre">octopus</span></code> string in the mon
map.  The command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ceph mon dump | grep min_mon_release</span>
</pre></div>
</div>
<p>should report:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">min_mon_release</span> <span class="mi">16</span> <span class="p">(</span><span class="n">pacific</span><span class="p">)</span>
</pre></div>
</div>
<p>If it doesn’t, that implies that one or more monitors hasn’t been
upgraded and restarted and/or the quorum does not include all monitors.</p>
</li>
<li><p>Upgrade <code class="docutils literal notranslate"><span class="pre">ceph-mgr</span></code> daemons by installing the new packages and
restarting all manager daemons.  For example, on each manager host,:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># systemctl restart ceph-mgr.target</span>
</pre></div>
</div>
<p>Verify the <code class="docutils literal notranslate"><span class="pre">ceph-mgr</span></code> daemons are running by checking <code class="docutils literal notranslate"><span class="pre">ceph</span>
<span class="pre">-s</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ceph -s</span>

<span class="o">...</span>
  <span class="n">services</span><span class="p">:</span>
   <span class="n">mon</span><span class="p">:</span> <span class="mi">3</span> <span class="n">daemons</span><span class="p">,</span> <span class="n">quorum</span> <span class="n">foo</span><span class="p">,</span><span class="n">bar</span><span class="p">,</span><span class="n">baz</span>
   <span class="n">mgr</span><span class="p">:</span> <span class="n">foo</span><span class="p">(</span><span class="n">active</span><span class="p">),</span> <span class="n">standbys</span><span class="p">:</span> <span class="n">bar</span><span class="p">,</span> <span class="n">baz</span>
<span class="o">...</span>
</pre></div>
</div>
</li>
<li><p>Upgrade all OSDs by installing the new packages and restarting the
ceph-osd daemons on all OSD hosts:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># systemctl restart ceph-osd.target</span>
</pre></div>
</div>
<p>Note that if you are upgrading from Nautilus, the first time each
OSD starts, it will do a format conversion to improve the
accounting for “omap” data.  This may take a few minutes to as much
as a few hours (for an HDD with lots of omap data).  You can
disable this automatic conversion with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ceph config set osd bluestore_fsck_quick_fix_on_mount false</span>
</pre></div>
</div>
<p>You can monitor the progress of the OSD upgrades with the
<code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">versions</span></code> or <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">osd</span> <span class="pre">versions</span></code> commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ceph osd versions</span>
<span class="p">{</span>
   <span class="s2">&quot;ceph version 14.2.5 (...) nautilus (stable)&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
   <span class="s2">&quot;ceph version 16.2.0 (...) pacific (stable)&quot;</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Upgrade all CephFS MDS daemons. For each CephFS file system,</p>
<ol class="arabic simple">
<li><p>Disable standby_replay:</p></li>
</ol>
<p># ceph fs set &lt;fs_name&gt; allow_standby_replay false</p>
<ol class="arabic">
<li><p>Reduce the number of ranks to 1.  (Make note of the original
number of MDS daemons first if you plan to restore it later.):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ceph status</span>
<span class="c1"># ceph fs set &lt;fs_name&gt; max_mds 1</span>
</pre></div>
</div>
</li>
<li><p>Wait for the cluster to deactivate any non-zero ranks by
periodically checking the status:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ceph status</span>
</pre></div>
</div>
</li>
<li><p>Take all standby MDS daemons offline on the appropriate hosts with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># systemctl stop ceph-mds@&lt;daemon_name&gt;</span>
</pre></div>
</div>
</li>
<li><p>Confirm that only one MDS is online and is rank 0 for your FS:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ceph status</span>
</pre></div>
</div>
</li>
<li><p>Upgrade the last remaining MDS daemon by installing the new
packages and restarting the daemon:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># systemctl restart ceph-mds.target</span>
</pre></div>
</div>
</li>
<li><p>Restart all standby MDS daemons that were taken offline:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># systemctl start ceph-mds.target</span>
</pre></div>
</div>
</li>
<li><p>Restore the original value of <code class="docutils literal notranslate"><span class="pre">max_mds</span></code> for the volume:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ceph fs set &lt;fs_name&gt; max_mds &lt;original_max_mds&gt;</span>
</pre></div>
</div>
</li>
</ol>
</li>
<li><p>Upgrade all radosgw daemons by upgrading packages and restarting
daemons on all hosts:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># systemctl restart ceph-radosgw.target</span>
</pre></div>
</div>
</li>
<li><p>Complete the upgrade by disallowing pre-Pacific OSDs and enabling
all new Pacific-only functionality:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ceph osd require-osd-release pacific</span>
</pre></div>
</div>
</li>
<li><p>If you set <code class="docutils literal notranslate"><span class="pre">noout</span></code> at the beginning, be sure to clear it with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ceph osd unset noout</span>
</pre></div>
</div>
</li>
<li><p>Consider transitioning your cluster to use the cephadm deployment
and orchestration framework to simplify cluster management and
future upgrades.  For more information on converting an existing
cluster to cephadm, see <a class="reference internal" href="../../cephadm/adoption/#cephadm-adoption"><span class="std std-ref">现有集群切换到 cephadm</span></a>.</p></li>
</ol>
</div>
<div class="section" id="post-upgrade">
<h4>Post-upgrade<a class="headerlink" href="#post-upgrade" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p>Verify the cluster is healthy with <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">health</span></code>.</p>
<p>If your CRUSH tunables are older than Hammer, Ceph will now issue a
health warning.  If you see a health alert to that effect, you can
revert this change with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">config</span> <span class="nb">set</span> <span class="n">mon</span> <span class="n">mon_crush_min_required_version</span> <span class="n">firefly</span>
</pre></div>
</div>
<p>If Ceph does not complain, however, then we recommend you also
switch any existing CRUSH buckets to straw2, which was added back
in the Hammer release.  If you have any ‘straw’ buckets, this will
result in a modest amount of data movement, but generally nothing
too severe.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">osd</span> <span class="n">getcrushmap</span> <span class="o">-</span><span class="n">o</span> <span class="n">backup</span><span class="o">-</span><span class="n">crushmap</span>
<span class="n">ceph</span> <span class="n">osd</span> <span class="n">crush</span> <span class="nb">set</span><span class="o">-</span><span class="nb">all</span><span class="o">-</span><span class="n">straw</span><span class="o">-</span><span class="n">buckets</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">straw2</span>
</pre></div>
</div>
<p>If there are problems, you can easily revert with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">osd</span> <span class="n">setcrushmap</span> <span class="o">-</span><span class="n">i</span> <span class="n">backup</span><span class="o">-</span><span class="n">crushmap</span>
</pre></div>
</div>
<p>Moving to ‘straw2’ buckets will unlock a few recent features, like
the <cite>crush-compat</cite> <a class="reference internal" href="../../rados/operations/balancer/#balancer"><span class="std std-ref">balancer</span></a> mode added back in Luminous.</p>
</li>
<li><p>If you did not already do so when upgrading from Mimic, we
recommened you enable the new <a class="reference internal" href="../../rados/configuration/msgr2/#msgr2"><span class="std std-ref">v2 network protocol</span></a>,
issue the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">mon</span> <span class="n">enable</span><span class="o">-</span><span class="n">msgr2</span>
</pre></div>
</div>
<p>This will instruct all monitors that bind to the old default port
6789 for the legacy v1 protocol to also bind to the new 3300 v2
protocol port.  To see if all monitors have been updated,:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">mon</span> <span class="n">dump</span>
</pre></div>
</div>
<p>and verify that each monitor has both a <code class="docutils literal notranslate"><span class="pre">v2:</span></code> and <code class="docutils literal notranslate"><span class="pre">v1:</span></code> address
listed.</p>
</li>
<li><p>Consider enabling the <a class="reference internal" href="../../mgr/telemetry/#telemetry"><span class="std std-ref">telemetry module</span></a> to send
anonymized usage statistics and crash information to the Ceph
upstream developers.  To see what would be reported (without actually
sending any information to anyone),:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">mgr</span> <span class="n">module</span> <span class="n">enable</span> <span class="n">telemetry</span>
<span class="n">ceph</span> <span class="n">telemetry</span> <span class="n">show</span>
</pre></div>
</div>
<p>If you are comfortable with the data that is reported, you can opt-in to
automatically report the high-level cluster metadata with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">telemetry</span> <span class="n">on</span>
</pre></div>
</div>
<p>The public dashboard that aggregates Ceph telemetry can be found at
<a class="reference external" href="https://telemetry-public.ceph.com/">https://telemetry-public.ceph.com/</a>.</p>
<p>For more information about the telemetry module, see <a class="reference internal" href="../../mgr/telemetry/#telemetry"><span class="std std-ref">the
documentation</span></a>.</p>
</li>
</ol>
</div>
</div>
<div class="section" id="upgrade-from-pre-nautilus-releases-like-mimic-or-luminous">
<h3>Upgrade from pre-Nautilus releases (like Mimic or Luminous)<a class="headerlink" href="#upgrade-from-pre-nautilus-releases-like-mimic-or-luminous" title="Permalink to this headline">¶</a></h3>
<p>You must first upgrade to Nautilus (14.2.z) or Octopus (15.2.z) before
upgrading to Pacific.</p>
</div>
<div class="section" id="id7">
<h3>Notable Changes<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>A new library is available, libcephsqlite. It provides a SQLite Virtual File
System (VFS) on top of RADOS. The database and journals are striped over
RADOS across multiple objects for virtually unlimited scaling and throughput
only limited by the SQLite client. Applications using SQLite may change to
the Ceph VFS with minimal changes, usually just by specifying the alternate
VFS. We expect the library to be most impactful and useful for applications
that were storing state in RADOS omap, especially without striping which
limits scalability.</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">bluestore_rocksdb_options_annex</span></code> config parameter. Complements
<code class="docutils literal notranslate"><span class="pre">bluestore_rocksdb_options</span></code> and allows setting rocksdb options without
repeating the existing defaults.</p></li>
<li><p>$pid expansion in config paths like <code class="docutils literal notranslate"><span class="pre">admin_socket</span></code> will now properly expand
to the daemon pid for commands like <code class="docutils literal notranslate"><span class="pre">ceph-mds</span></code> or <code class="docutils literal notranslate"><span class="pre">ceph-osd</span></code>. Previously
only <code class="docutils literal notranslate"><span class="pre">ceph-fuse</span></code>/<code class="docutils literal notranslate"><span class="pre">rbd-nbd</span></code> expanded <code class="docutils literal notranslate"><span class="pre">$pid</span></code> with the actual daemon pid.</p></li>
<li><p>The allowable options for some <code class="docutils literal notranslate"><span class="pre">radosgw-admin</span></code> commands have been changed.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">mdlog-list</span></code>, <code class="docutils literal notranslate"><span class="pre">datalog-list</span></code>, <code class="docutils literal notranslate"><span class="pre">sync-error-list</span></code> no longer accepts
start and end dates, but does accept a single optional start marker.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mdlog-trim</span></code>, <code class="docutils literal notranslate"><span class="pre">datalog-trim</span></code>, <code class="docutils literal notranslate"><span class="pre">sync-error-trim</span></code> only accept a
single marker giving the end of the trimmed range.</p></li>
<li><p>Similarly the date ranges and marker ranges have been removed on
the RESTful DATALog and MDLog list and trim operations.</p></li>
</ul>
</li>
<li><p>ceph-volume: The <code class="docutils literal notranslate"><span class="pre">lvm</span> <span class="pre">batch</span></code> subcommand received a major rewrite. This
closed a number of bugs and improves usability in terms of size specification
and calculation, as well as idempotency behaviour and disk replacement
process.
Please refer to <a class="reference external" href="https://docs.ceph.com/en/latest/ceph-volume/lvm/batch/">https://docs.ceph.com/en/latest/ceph-volume/lvm/batch/</a> for
more detailed information.</p></li>
<li><p>Configuration variables for permitted scrub times have changed.  The legal
values for <code class="docutils literal notranslate"><span class="pre">osd_scrub_begin_hour</span></code> and <code class="docutils literal notranslate"><span class="pre">osd_scrub_end_hour</span></code> are 0 - 23.
The use of 24 is now illegal.  Specifying <code class="docutils literal notranslate"><span class="pre">0</span></code> for both values causes every
hour to be allowed.  The legal values for <code class="docutils literal notranslate"><span class="pre">osd_scrub_begin_week_day</span></code> and
<code class="docutils literal notranslate"><span class="pre">osd_scrub_end_week_day</span></code> are 0 - 6.  The use of 7 is now illegal.
Specifying <code class="docutils literal notranslate"><span class="pre">0</span></code> for both values causes every day of the week to be allowed.</p></li>
<li><p>volume/nfs: Recently “ganesha-” prefix from cluster id and nfs-ganesha common
config object was removed, to ensure consistent namespace across different
orchestrator backends. Please delete any existing nfs-ganesha clusters prior
to upgrading and redeploy new clusters after upgrading to Pacific.</p></li>
<li><p>A new health check, DAEMON_OLD_VERSION, will warn if different versions of Ceph are running
on daemons. It will generate a health error if multiple versions are detected.
This condition must exist for over mon_warn_older_version_delay (set to 1 week by default) in order for the
health condition to be triggered.  This allows most upgrades to proceed
without falsely seeing the warning.  If upgrade is paused for an extended
time period, health mute can be used like this
“ceph health mute DAEMON_OLD_VERSION –sticky”.  In this case after
upgrade has finished use “ceph health unmute DAEMON_OLD_VERSION”.</p></li>
<li><p>MGR: progress module can now be turned on/off, using the commands:
<code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">progress</span> <span class="pre">on</span></code> and <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">progress</span> <span class="pre">off</span></code>.</p></li>
<li><p>An AWS-compliant API: “GetTopicAttributes” was added to replace the existing “GetTopic” API. The new API
should be used to fetch information about topics used for bucket notifications.</p></li>
<li><p>librbd: The shared, read-only parent cache’s config option <code class="docutils literal notranslate"><span class="pre">immutable_object_cache_watermark</span></code> now has been updated
to property reflect the upper cache utilization before space is reclaimed. The default <code class="docutils literal notranslate"><span class="pre">immutable_object_cache_watermark</span></code>
now is <code class="docutils literal notranslate"><span class="pre">0.9</span></code>. If the capacity reaches 90% the daemon will delete cold cache.</p></li>
<li><p>OSD: the option <code class="docutils literal notranslate"><span class="pre">osd_fast_shutdown_notify_mon</span></code> has been introduced to allow
the OSD to notify the monitor it is shutting down even if <code class="docutils literal notranslate"><span class="pre">osd_fast_shutdown</span></code>
is enabled. This helps with the monitor logs on larger clusters, that may get
many ‘osd.X reported immediately failed by osd.Y’ messages, and confuse tools.</p></li>
<li><p>The mclock scheduler has been refined. A set of built-in profiles are now available that
provide QoS between the internal and external clients of Ceph. To enable the mclock
scheduler, set the config option “osd_op_queue” to “mclock_scheduler”. The
“high_client_ops” profile is enabled by default, and allocates more OSD bandwidth to
external client operations than to internal client operations (such as background recovery
and scrubs). Other built-in profiles include “high_recovery_ops” and “balanced”. These
built-in profiles optimize the QoS provided to clients of mclock scheduler.</p></li>
<li><p>The balancer is now on by default in upmap mode. Since upmap mode requires
<code class="docutils literal notranslate"><span class="pre">require_min_compat_client</span></code> luminous, new clusters will only support luminous
and newer clients by default. Existing clusters can enable upmap support by running
<code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">osd</span> <span class="pre">set-require-min-compat-client</span> <span class="pre">luminous</span></code>. It is still possible to turn
the balancer off using the <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">balancer</span> <span class="pre">off</span></code> command. In earlier versions,
the balancer was included in the <code class="docutils literal notranslate"><span class="pre">always_on_modules</span></code> list, but needed to be
turned on explicitly using the <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">balancer</span> <span class="pre">on</span></code> command.</p></li>
<li><p>Version 2 of the cephx authentication protocol (<code class="docutils literal notranslate"><span class="pre">CEPHX_V2</span></code> feature bit) is
now required by default.  It was introduced in 2018, adding replay attack
protection for authorizers and making msgr v1 message signatures stronger
(CVE-2018-1128 and CVE-2018-1129).  Support is present in Jewel 10.2.11,
Luminous 12.2.6, Mimic 13.2.1, Nautilus 14.2.0 and later; upstream kernels
4.9.150, 4.14.86, 4.19 and later; various distribution kernels, in particular
CentOS 7.6 and later.  To enable older clients, set <code class="docutils literal notranslate"><span class="pre">cephx_require_version</span></code>
and <code class="docutils literal notranslate"><span class="pre">cephx_service_require_version</span></code> config options to 1.</p></li>
<li><p><cite>blacklist</cite> has been replaced with <cite>blocklist</cite> throughout.  The following commands have changed:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">osd</span> <span class="pre">blacklist</span> <span class="pre">...</span></code> are now <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">osd</span> <span class="pre">blocklist</span> <span class="pre">...</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">&lt;tell|daemon&gt;</span> <span class="pre">osd.&lt;NNN&gt;</span> <span class="pre">dump_blacklist</span></code> is now <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">&lt;tell|daemon&gt;</span> <span class="pre">osd.&lt;NNN&gt;</span> <span class="pre">dump_blocklist</span></code></p></li>
</ul>
</li>
<li><p>The following config options have changed:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">mon</span> <span class="pre">osd</span> <span class="pre">blacklist</span> <span class="pre">default</span> <span class="pre">expire</span></code> is now <code class="docutils literal notranslate"><span class="pre">mon</span> <span class="pre">osd</span> <span class="pre">blocklist</span> <span class="pre">default</span> <span class="pre">expire</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mon</span> <span class="pre">mds</span> <span class="pre">blacklist</span> <span class="pre">interval</span></code> is now <code class="docutils literal notranslate"><span class="pre">mon</span> <span class="pre">mds</span> <span class="pre">blocklist</span> <span class="pre">interval</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mon</span> <span class="pre">mgr</span> <span class="pre">blacklist</span> <span class="pre">interval</span></code> is now ‘’mon mgr blocklist interval``</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rbd</span> <span class="pre">blacklist</span> <span class="pre">on</span> <span class="pre">break</span> <span class="pre">lock</span></code> is now <code class="docutils literal notranslate"><span class="pre">rbd</span> <span class="pre">blocklist</span> <span class="pre">on</span> <span class="pre">break</span> <span class="pre">lock</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rbd</span> <span class="pre">blacklist</span> <span class="pre">expire</span> <span class="pre">seconds</span></code> is now <code class="docutils literal notranslate"><span class="pre">rbd</span> <span class="pre">blocklist</span> <span class="pre">expire</span> <span class="pre">seconds</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mds</span> <span class="pre">session</span> <span class="pre">blacklist</span> <span class="pre">on</span> <span class="pre">timeout</span></code> is now <code class="docutils literal notranslate"><span class="pre">mds</span> <span class="pre">session</span> <span class="pre">blocklist</span> <span class="pre">on</span> <span class="pre">timeout</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mds</span> <span class="pre">session</span> <span class="pre">blacklist</span> <span class="pre">on</span> <span class="pre">evict</span></code> is now <code class="docutils literal notranslate"><span class="pre">mds</span> <span class="pre">session</span> <span class="pre">blocklist</span> <span class="pre">on</span> <span class="pre">evict</span></code></p></li>
</ul>
</li>
<li><p>The following librados API calls have changed:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">rados_blacklist_add</span></code> is now <code class="docutils literal notranslate"><span class="pre">rados_blocklist_add</span></code>; the former will issue a deprecation warning and be removed in a future release.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rados.blacklist_add</span></code> is now <code class="docutils literal notranslate"><span class="pre">rados.blocklist_add</span></code> in the C++ API.</p></li>
</ul>
</li>
<li><p>The JSON output for the following commands now shows <code class="docutils literal notranslate"><span class="pre">blocklist</span></code> instead of <code class="docutils literal notranslate"><span class="pre">blacklist</span></code>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">osd</span> <span class="pre">dump</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">&lt;tell|daemon&gt;</span> <span class="pre">osd.&lt;N&gt;</span> <span class="pre">dump_blocklist</span></code></p></li>
</ul>
</li>
<li><p>Monitors now have config option <code class="docutils literal notranslate"><span class="pre">mon_allow_pool_size_one</span></code>, which is disabled
by default. However, if enabled, user now have to pass the
<code class="docutils literal notranslate"><span class="pre">--yes-i-really-mean-it</span></code> flag to <code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">pool</span> <span class="pre">set</span> <span class="pre">size</span> <span class="pre">1</span></code>, if they are really
sure of configuring pool size 1.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">pg</span> <span class="pre">#.#</span> <span class="pre">list_unfound</span></code> output has been enhanced to provide
might_have_unfound information which indicates which OSDs may
contain the unfound objects.</p></li>
<li><p>OSD: A new configuration option <code class="docutils literal notranslate"><span class="pre">osd_compact_on_start</span></code> has been added which triggers
an OSD compaction on start. Setting this option to <code class="docutils literal notranslate"><span class="pre">true</span></code> and restarting an OSD
will result in an offline compaction of the OSD prior to booting.</p></li>
<li><p>OSD: the option named <code class="docutils literal notranslate"><span class="pre">bdev_nvme_retry_count</span></code> has been removed. Because
in SPDK v20.07, there is no easy access to bdev_nvme options, and this
option is hardly used, so it was removed.</p></li>
<li><p>Alpine build related script, documentation and test have been removed since
the most updated APKBUILD script of Ceph is already included by Alpine Linux’s
aports repository.</p></li>
</ul>
</div>
</div>
</div>



           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../octopus/" class="btn btn-neutral float-right" title="Octopus" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../" class="btn btn-neutral float-left" title="Ceph 版本（索引）" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2016, Ceph authors and contributors. Licensed under Creative Commons Attribution Share Alike 3.0 (CC-BY-SA-3.0).

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>