

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Bobtail &mdash; Ceph Documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/ceph.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="Argonaut" href="../argonaut/" />
    <link rel="prev" title="Cuttlefish" href="../cuttlefish/" /> 
</head>

<body class="wy-body-for-nav">

   
  <header class="top-bar">
    

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../">Ceph 版本（索引）</a> &raquo;</li>
        
      <li>Bobtail</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/releases/bobtail.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
  </header>
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #eee" >
          

          
            <a href="../../">
          

          
            
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../start/intro/">Ceph 简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/">安装 Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cephadm/">Cephadm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rados/">Ceph 存储集群</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cephfs/">Ceph 文件系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rbd/">Ceph 块设备</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../radosgw/">Ceph 对象网关</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mgr/">Ceph 管理器守护进程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mgr/dashboard/">Ceph 仪表盘</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/">API 文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture/">体系结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/developer_guide/">开发者指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/internals/">Ceph 内幕</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../governance/">项目管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../foundation/">Ceph 基金会</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ceph-volume/">ceph-volume</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general/">Ceph 版本（总目录）</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">Ceph 版本（索引）</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../#active-releases">活跃版本</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../#id2">归档版本</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../mimic/">Mimic (v13.2.*)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../luminous/">Luminous (v12.2.*)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../kraken/">Kraken (v11.2.*)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jewel/">Jewel (v10.2.*)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infernalis/">Infernalis (v9.2.*)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hammer/">Hammer (v0.94.*)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../giant/">Giant (v0.87.*)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../firefly/">Firefly (v0.80.*)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../emperor/">Emperor (v0.72.*)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dumpling/">Dumpling (v0.67.*)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cuttlefish/">Cuttlefish (v0.61.*)</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Bobtail (v0.56.*)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#v0-56-7-bobtail">v0.56.7 “bobtail”</a></li>
<li class="toctree-l4"><a class="reference internal" href="#v0-56-6-bobtail">v0.56.6 “bobtail”</a></li>
<li class="toctree-l4"><a class="reference internal" href="#v0-56-5-bobtail">v0.56.5 “bobtail”</a></li>
<li class="toctree-l4"><a class="reference internal" href="#v0-56-4-bobtail">v0.56.4 “bobtail”</a></li>
<li class="toctree-l4"><a class="reference internal" href="#v0-56-3-bobtail">v0.56.3 “bobtail”</a></li>
<li class="toctree-l4"><a class="reference internal" href="#v0-56-2-bobtail">v0.56.2 “bobtail”</a></li>
<li class="toctree-l4"><a class="reference internal" href="#v0-56-1-bobtail">v0.56.1 “bobtail”</a></li>
<li class="toctree-l4"><a class="reference internal" href="#v0-56-bobtail">v0.56 “bobtail”</a></li>
<li class="toctree-l4"><a class="reference internal" href="#v0-54">v0.54</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../argonaut/">Argonaut (v0.48.*)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../#id3">发布时间表</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../security/">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary/">Ceph 术语</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../jaegertracing/">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../translation_cn/">中文版翻译资源</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../">Ceph</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
<div id="dev-warning" class="admonition note">
  <p class="first admonition-title">Notice</p>
  <p class="last">This document is for a development version of Ceph.</p>
</div>
  <div id="docubetter" align="right" style="padding: 5px; font-weight: bold;">
    <a href="https://pad.ceph.com/p/Report_Documentation_Bugs">Report a Documentation Bug</a>
  </div>

  
  <div class="section" id="bobtail">
<h1>Bobtail<a class="headerlink" href="#bobtail" title="Permalink to this headline">¶</a></h1>
<p>Bobtail is the second stable release of Ceph.  It is named after the
bobtail squid (order Sepiolida), a group of cephalopods closely related to cuttlefish.</p>
<div class="section" id="v0-56-7-bobtail">
<h2>v0.56.7 “bobtail”<a class="headerlink" href="#v0-56-7-bobtail" title="Permalink to this headline">¶</a></h2>
<p>This bobtail update fixes a range of radosgw bugs (including an easily
triggered crash from multi-delete), a possible data corruption issue
with power failure on XFS, and several OSD problems, including a
memory “leak” that will affect aged clusters.</p>
<div class="section" id="notable-changes">
<h3>Notable changes<a class="headerlink" href="#notable-changes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>ceph-fuse: create finisher flags after fork()</p></li>
<li><p>debian: fix prerm/postinst hooks; do not restart daemons on upgrade</p></li>
<li><p>librados: fix async aio completion wakeup (manifests as rbd hang)</p></li>
<li><p>librados: fix hang when osd becomes full and then not full</p></li>
<li><p>librados: fix locking for aio completion refcounting</p></li>
<li><p>librbd python bindings: fix stripe_unit, stripe_count</p></li>
<li><p>librbd: make image creation default configurable</p></li>
<li><p>mon: fix validation of mds ids in mon commands</p></li>
<li><p>osd: avoid excessive disk updates during peering</p></li>
<li><p>osd: avoid excessive memory usage on scrub</p></li>
<li><p>osd: avoid heartbeat failure/suicide when scrubbing</p></li>
<li><p>osd: misc minor bug fixes</p></li>
<li><p>osd: use fdatasync instead of sync_file_range (may avoid xfs power-loss corruption)</p></li>
<li><p>rgw: escape prefix correctly when listing objects</p></li>
<li><p>rgw: fix copy attrs</p></li>
<li><p>rgw: fix crash on multi delete</p></li>
<li><p>rgw: fix locking/crash when using ops log socket</p></li>
<li><p>rgw: fix usage logging</p></li>
<li><p>rgw: handle deep uri resources</p></li>
</ul>
<p>For more detailed information, see <a class="reference download internal" download="" href="../../_downloads/20493ab90eb7559e6bdb4f28848a42a1/v0.56.7.txt"><code class="xref download docutils literal notranslate"><span class="pre">the</span> <span class="pre">complete</span> <span class="pre">changelog</span></code></a>.</p>
</div>
</div>
<div class="section" id="v0-56-6-bobtail">
<h2>v0.56.6 “bobtail”<a class="headerlink" href="#v0-56-6-bobtail" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>Notable changes<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>rgw: fix garbage collection</p></li>
<li><p>rpm: fix package dependencies</p></li>
</ul>
<p>For more detailed information, see <a class="reference download internal" download="" href="../../_downloads/85f47f6ff08b3ff79f1eb5fc44554003/v0.56.6.txt"><code class="xref download docutils literal notranslate"><span class="pre">the</span> <span class="pre">complete</span> <span class="pre">changelog</span></code></a>.</p>
</div>
</div>
<div class="section" id="v0-56-5-bobtail">
<h2>v0.56.5 “bobtail”<a class="headerlink" href="#v0-56-5-bobtail" title="Permalink to this headline">¶</a></h2>
<div class="section" id="upgrading">
<h3>Upgrading<a class="headerlink" href="#upgrading" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>ceph-disk[-prepare,-activate] behavior has changed in various ways.
There should not be any compatibility issues, but chef users should
be aware.</p></li>
</ul>
</div>
<div class="section" id="id2">
<h3>Notable changes<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>mon: fix recording of quorum feature set (important for argonaut -&gt; bobtail -&gt; cuttlefish mon upgrades)</p></li>
<li><p>osd: minor peering bug fixes</p></li>
<li><p>osd: fix a few bugs when pools are renamed</p></li>
<li><p>osd: fix occasionally corrupted pg stats</p></li>
<li><p>osd: fix behavior when broken v0.56[.0] clients connect</p></li>
<li><p>rbd: avoid FIEMAP ioctl on import (it is broken on some kernels)</p></li>
<li><p>librbd: fixes for several request/reply ordering bugs</p></li>
<li><p>librbd: only set STRIPINGV2 feature on new images when needed</p></li>
<li><p>librbd: new async flush method to resolve qemu hangs (requires QEMU update as well)</p></li>
<li><p>librbd: a few fixes to flatten</p></li>
<li><p>ceph-disk: support for dm-crypt</p></li>
<li><p>ceph-disk: many backports to allow bobtail deployments with ceph-deploy, chef</p></li>
<li><p>sysvinit: do not stop starting daemons on first failure</p></li>
<li><p>udev: fixed rules for redhat-based distros</p></li>
<li><p>build fixes for raring</p></li>
</ul>
<p>For more detailed information, see <a class="reference download internal" download="" href="../../_downloads/e639796a3708ca3b8f5ed93858b730f9/v0.56.5.txt"><code class="xref download docutils literal notranslate"><span class="pre">the</span> <span class="pre">complete</span> <span class="pre">changelog</span></code></a>.</p>
</div>
</div>
<div class="section" id="v0-56-4-bobtail">
<h2>v0.56.4 “bobtail”<a class="headerlink" href="#v0-56-4-bobtail" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id3">
<h3>Upgrading<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>There is a fix in the syntax for the output of ‘ceph osd tree –format=json’.</p></li>
<li><p>The MDS disk format has changed from prior releases <em>and</em> from v0.57.  In particular,
upgrades to v0.56.4 are safe, but you cannot move from v0.56.4 to v0.57 if you are using
the MDS for CephFS; you must upgrade directly to v0.58 (or later) instead.</p></li>
</ul>
</div>
<div class="section" id="id4">
<h3>Notable changes<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>mon: fix bug in bringup with IPv6</p></li>
<li><p>reduce default memory utilization by internal logging (all daemons)</p></li>
<li><p>rgw: fix for bucket removal</p></li>
<li><p>rgw: reopen logs after log rotation</p></li>
<li><p>rgw: fix multipat upload listing</p></li>
<li><p>rgw: don’t copy object when copied onto self</p></li>
<li><p>osd: fix caps parsing for pools with - or _</p></li>
<li><p>osd: allow pg log trimming when degraded, scrubbing, recoverying (reducing memory consumption)</p></li>
<li><p>osd: fix potential deadlock when ‘journal aio = true’</p></li>
<li><p>osd: various fixes for collection creation/removal, rename, temp collections</p></li>
<li><p>osd: various fixes for PG split</p></li>
<li><p>osd: deep-scrub omap key/value data</p></li>
<li><p>osd: fix rare bug in journal replay</p></li>
<li><p>osd: misc fixes for snapshot tracking</p></li>
<li><p>osd: fix leak in recovery reservations on pool deletion</p></li>
<li><p>osd: fix bug in connection management</p></li>
<li><p>osd: fix for op ordering when rebalancing</p></li>
<li><p>ceph-fuse: report file system size with correct units</p></li>
<li><p>mds: get and set directory layout policies via virtual xattrs</p></li>
<li><p>mds: on-disk format revision (see upgrading note above)</p></li>
<li><p>mkcephfs, init-ceph: close potential security issues with predictable filenames</p></li>
</ul>
<p>For more detailed information, see <a class="reference download internal" download="" href="../../_downloads/588d1668de94072e1873b572af523b03/v0.56.4.txt"><code class="xref download docutils literal notranslate"><span class="pre">the</span> <span class="pre">complete</span> <span class="pre">changelog</span></code></a>.</p>
</div>
</div>
<div class="section" id="v0-56-3-bobtail">
<h2>v0.56.3 “bobtail”<a class="headerlink" href="#v0-56-3-bobtail" title="Permalink to this headline">¶</a></h2>
<p>This release has several bug fixes surrounding OSD stability.  Most
significantly, an issue with OSDs being unresponsive shortly after
startup (and occasionally crashing due to an internal heartbeat check)
is resolved.  Please upgrade.</p>
<div class="section" id="id5">
<h3>Upgrading<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>A bug was fixed in which the OSDMap epoch for PGs without any IO
requests was not recorded.  If there are pools in the cluster that
are completely idle (for example, the <code class="docutils literal notranslate"><span class="pre">data</span></code> and <code class="docutils literal notranslate"><span class="pre">metadata</span></code>
pools normally used by CephFS), and a large number of OSDMap epochs
have elapsed since the <code class="docutils literal notranslate"><span class="pre">ceph-osd</span></code> daemon was last restarted, those
maps will get reprocessed when the daemon restarts.  This process
can take a while if there are a lot of maps.  A workaround is to
‘touch’ any idle pools with IO prior to restarting the daemons after
packages are upgraded:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rados</span> <span class="n">bench</span> <span class="mi">10</span> <span class="n">write</span> <span class="o">-</span><span class="n">t</span> <span class="mi">1</span> <span class="o">-</span><span class="n">b</span> <span class="mi">4096</span> <span class="o">-</span><span class="n">p</span> <span class="p">{</span><span class="n">POOLNAME</span><span class="p">}</span>
</pre></div>
</div>
<p>This will typically generate enough IO to touch every PG in the pool
without generating significant cluster load, and also cleans up any
temporary objects it creates.</p>
</li>
</ul>
</div>
<div class="section" id="id6">
<h3>Notable changes<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>osd: flush peering work queue prior to start</p></li>
<li><p>osd: persist osdmap epoch for idle PGs</p></li>
<li><p>osd: fix and simplify connection handling for heartbeats</p></li>
<li><p>osd: avoid crash on invalid admin command</p></li>
<li><p>mon: fix rare races with monitor elections and commands</p></li>
<li><p>mon: enforce that OSD reweights be between 0 and 1 (NOTE: not CRUSH weights)</p></li>
<li><p>mon: approximate client, recovery bandwidth logging</p></li>
<li><p>radosgw: fixed some XML formatting to conform to Swift API inconsistency</p></li>
<li><p>radosgw: fix usage accounting bug; add repair tool</p></li>
<li><p>radosgw: make fallback URI configurable (necessary on some web servers)</p></li>
<li><p>librbd: fix handling for interrupted ‘unprotect’ operations</p></li>
<li><p>mds, ceph-fuse: allow file and directory layouts to be modified via virtual xattrs</p></li>
</ul>
<p>For more detailed information, see <a class="reference download internal" download="" href="../../_downloads/920588e83d81b078a76f99236ec626a3/v0.56.3.txt"><code class="xref download docutils literal notranslate"><span class="pre">the</span> <span class="pre">complete</span> <span class="pre">changelog</span></code></a>.</p>
</div>
</div>
<div class="section" id="v0-56-2-bobtail">
<h2>v0.56.2 “bobtail”<a class="headerlink" href="#v0-56-2-bobtail" title="Permalink to this headline">¶</a></h2>
<p>This release has a wide range of bug fixes, stability improvements, and some performance improvements.  Please upgrade.</p>
<div class="section" id="id7">
<h3>Upgrading<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The meaning of the ‘osd scrub min interval’ and ‘osd scrub max
interval’ has changed slightly.  The min interval used to be
meaningless, while the max interval would only trigger a scrub if
the load was sufficiently low.  Now, the min interval option works
the way the old max interval did (it will trigger a scrub after this
amount of time if the load is low), while the max interval will
force a scrub regardless of load.  The default options have been
adjusted accordingly.  If you have customized these in ceph.conf,
please review their values when upgrading.</p></li>
<li><p>CRUSH maps that are generated by default when calling <code class="docutils literal notranslate"><span class="pre">ceph-mon</span>
<span class="pre">--mkfs</span></code> directly now distribute replicas across hosts instead of
across OSDs.  Any provisioning tools that are being used by Ceph may
be affected, although probably for the better, as distributing across
hosts is a much more commonly sought behavior.  If you use
<code class="docutils literal notranslate"><span class="pre">mkcephfs</span></code> to create the cluster, the default CRUSH rule is still
inferred by the number of hosts and/or racks in the initial ceph.conf.</p></li>
</ul>
</div>
<div class="section" id="id8">
<h3>Notable changes<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>osd: snapshot trimming fixes</p></li>
<li><p>osd: scrub snapshot metadata</p></li>
<li><p>osd: fix osdmap trimming</p></li>
<li><p>osd: misc peering fixes</p></li>
<li><p>osd: stop heartbeating with peers if internal threads are stuck/hung</p></li>
<li><p>osd: PG removal is friendlier to other workloads</p></li>
<li><p>osd: fix recovery start delay (was causing very slow recovery)</p></li>
<li><p>osd: fix scheduling of explicitly requested scrubs</p></li>
<li><p>osd: fix scrub interval config options</p></li>
<li><p>osd: improve recovery vs client io tuning</p></li>
<li><p>osd: improve ‘slow request’ warning detail for better diagnosis</p></li>
<li><p>osd: default CRUSH map now distributes across hosts, not OSDs</p></li>
<li><p>osd: fix crash on 32-bit hosts triggered by librbd clients</p></li>
<li><p>librbd: fix error handling when talking to older OSDs</p></li>
<li><p>mon: fix a few rare crashes</p></li>
<li><p>ceph command: ability to easily adjust CRUSH tunables</p></li>
<li><p>radosgw: object copy does not copy source ACLs</p></li>
<li><p>rados command: fix omap command usage</p></li>
<li><p>sysvinit script: set ulimit -n properly on remote hosts</p></li>
<li><p>msgr: fix narrow race with message queuing</p></li>
<li><p>fixed compilation on some old distros (e.g., RHEL 5.x)</p></li>
</ul>
<p>For more detailed information, see <a class="reference download internal" download="" href="../../_downloads/97ae37a664927ccf324b378fdf9c98fe/v0.56.2.txt"><code class="xref download docutils literal notranslate"><span class="pre">the</span> <span class="pre">complete</span> <span class="pre">changelog</span></code></a>.</p>
</div>
</div>
<div class="section" id="v0-56-1-bobtail">
<h2>v0.56.1 “bobtail”<a class="headerlink" href="#v0-56-1-bobtail" title="Permalink to this headline">¶</a></h2>
<p>This release has two critical fixes.  Please upgrade.</p>
<div class="section" id="id9">
<h3>Upgrading<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>There is a protocol compatibility problem between v0.56 and any
other version that is now fixed.  If your radosgw or RBD clients are
running v0.56, they will need to be upgraded too.  If they are
running a version prior to v0.56, they can be left as is.</p></li>
</ul>
</div>
<div class="section" id="id10">
<h3>Notable changes<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>osd: fix commit sequence for XFS, ext4 (or any other non-btrfs) to prevent data loss on power cycle or kernel panic</p></li>
<li><p>osd: fix compatibility for CALL operation</p></li>
<li><p>osd: process old osdmaps prior to joining cluster (fixes slow startup)</p></li>
<li><p>osd: fix a couple of recovery-related crashes</p></li>
<li><p>osd: fix large io requests when journal is in (non-default) aio mode</p></li>
<li><p>log: fix possible deadlock in logging code</p></li>
</ul>
<p>For more detailed information, see <a class="reference download internal" download="" href="../../_downloads/9e2489dd0cac9a366e37206d5d42a440/v0.56.1.txt"><code class="xref download docutils literal notranslate"><span class="pre">the</span> <span class="pre">complete</span> <span class="pre">changelog</span></code></a>.</p>
</div>
</div>
<div class="section" id="v0-56-bobtail">
<h2>v0.56 “bobtail”<a class="headerlink" href="#v0-56-bobtail" title="Permalink to this headline">¶</a></h2>
<p>Bobtail is the second stable release of Ceph, named in honor of the
<cite>Bobtail Squid</cite>: <a class="reference external" href="https://en.wikipedia.org/wiki/Bobtail_squid">https://en.wikipedia.org/wiki/Bobtail_squid</a>.</p>
<div class="section" id="key-features-since-v0-48-argonaut">
<h3>Key features since v0.48 “argonaut”<a class="headerlink" href="#key-features-since-v0-48-argonaut" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Object Storage Daemon (OSD): improved threading, small-io performance, and performance during recovery</p></li>
<li><p>Object Storage Daemon (OSD): regular “deep” scrubbing of all stored data to detect latent disk errors</p></li>
<li><p>RADOS Block Device (RBD): support for copy-on-write clones of images.</p></li>
<li><p>RADOS Block Device (RBD): better client-side caching.</p></li>
<li><p>RADOS Block Device (RBD): advisory image locking</p></li>
<li><p>Rados Gateway (RGW): support for efficient usage logging/scraping (for billing purposes)</p></li>
<li><p>Rados Gateway (RGW): expanded S3 and Swift API coverage (e.g., POST, multi-object delete)</p></li>
<li><p>Rados Gateway (RGW): improved striping for large objects</p></li>
<li><p>Rados Gateway (RGW): OpenStack Keystone integration</p></li>
<li><p>RPM packages for Fedora, RHEL/CentOS, OpenSUSE, and SLES</p></li>
<li><p>mkcephfs: support for automatically formatting and mounting XFS and ext4 (in addition to btrfs)</p></li>
</ul>
</div>
<div class="section" id="id11">
<h3>Upgrading<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>Please refer to the document <a class="reference external" href="../install/upgrading-ceph/#upgrading-from-argonaut-to-bobtail">Upgrading from Argonaut to Bobtail</a> for details.</p>
<ul>
<li><p>Cephx authentication is now enabled by default (since v0.55).
Upgrading a cluster without adjusting the Ceph configuration will
likely prevent the system from starting up on its own.  We recommend
first modifying the configuration to indicate that authentication is
disabled, and only then upgrading to the latest version:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">auth</span> <span class="n">client</span> <span class="n">required</span> <span class="o">=</span> <span class="n">none</span>
<span class="n">auth</span> <span class="n">service</span> <span class="n">required</span> <span class="o">=</span> <span class="n">none</span>
<span class="n">auth</span> <span class="n">cluster</span> <span class="n">required</span> <span class="o">=</span> <span class="n">none</span>
</pre></div>
</div>
</li>
<li><p>Ceph daemons can be upgraded one-by-one while the cluster is online
and in service.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">ceph-osd</span></code> daemons must be upgraded and restarted <em>before</em> any
<code class="docutils literal notranslate"><span class="pre">radosgw</span></code> daemons are restarted, as they depend on some new
ceph-osd functionality.  (The <code class="docutils literal notranslate"><span class="pre">ceph-mon</span></code>, <code class="docutils literal notranslate"><span class="pre">ceph-osd</span></code>, and
<code class="docutils literal notranslate"><span class="pre">ceph-mds</span></code> daemons can be upgraded and restarted in any order.)</p></li>
<li><p>Once each individual daemon has been upgraded and restarted, it
cannot be downgraded.</p></li>
<li><p>The cluster of <code class="docutils literal notranslate"><span class="pre">ceph-mon</span></code> daemons will migrate to a new internal
on-wire protocol once all daemons in the quorum have been upgraded.
Upgrading only a majority of the nodes (e.g., two out of three) may
expose the cluster to a situation where a single additional failure
may compromise availability (because the non-upgraded daemon cannot
participate in the new protocol).  We recommend not waiting for an
extended period of time between <code class="docutils literal notranslate"><span class="pre">ceph-mon</span></code> upgrades.</p></li>
<li><p>The ops log and usage log for radosgw are now off by default.  If
you need these logs (e.g., for billing purposes), you must enable
them explicitly.  For logging of all operations to objects in the
<code class="docutils literal notranslate"><span class="pre">.log</span></code> pool (see <code class="docutils literal notranslate"><span class="pre">radosgw-admin</span> <span class="pre">log</span> <span class="pre">...</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rgw</span> <span class="n">enable</span> <span class="n">ops</span> <span class="n">log</span> <span class="o">=</span> <span class="n">true</span>
</pre></div>
</div>
<p>For usage logging of aggregated bandwidth usage (see <code class="docutils literal notranslate"><span class="pre">radosgw-admin</span>
<span class="pre">usage</span> <span class="pre">...</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rgw</span> <span class="n">enable</span> <span class="n">usage</span> <span class="n">log</span> <span class="o">=</span> <span class="n">true</span>
</pre></div>
</div>
</li>
<li><p>You should not create or use “format 2” RBD images until after all
<code class="docutils literal notranslate"><span class="pre">ceph-osd</span></code> daemons have been upgraded.  Note that “format 1” is
still the default.  You can use the new <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">osd</span> <span class="pre">ls</span></code> and
<code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">tell</span> <span class="pre">osd.N</span> <span class="pre">version</span></code> commands to doublecheck your cluster.
<code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">osd</span> <span class="pre">ls</span></code> will give a list of all OSD IDs that are part of the
cluster, and you can use that to write a simple shell loop to display
all the OSD version strings:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>for i in $(ceph osd ls); do
    ceph tell osd.${i} version
done
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="compatibility-changes">
<h3>Compatibility changes<a class="headerlink" href="#compatibility-changes" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>The ‘ceph osd create [&lt;uuid&gt;]’ command now rejects an argument that
is not a UUID.  (Previously it would take take an optional integer
OSD id.)  This correct syntax has been ‘ceph osd create [&lt;uuid&gt;]’
since v0.47, but the older calling convention was being silently
ignored.</p></li>
<li><p>The CRUSH map root nodes now have type <code class="docutils literal notranslate"><span class="pre">root</span></code> instead of type
<code class="docutils literal notranslate"><span class="pre">pool</span></code>.  This avoids confusion with RADOS pools, which are not
directly related.  Any scripts or tools that use the <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">osd</span>
<span class="pre">crush</span> <span class="pre">...</span></code> commands may need to be adjusted accordingly.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">osd</span> <span class="pre">pool</span> <span class="pre">create</span> <span class="pre">&lt;poolname&gt;</span> <span class="pre">&lt;pgnum&gt;</span></code> command now requires
the <code class="docutils literal notranslate"><span class="pre">pgnum</span></code> argument. Previously this was optional, and would
default to 8, which was almost never a good number.</p></li>
<li><p>Degraded mode (when there fewer than the desired number of replicas)
is now more configurable on a per-pool basis, with the min_size
parameter. By default, with min_size 0, this allows I/O to objects
with N - floor(N/2) replicas, where N is the total number of
expected copies. Argonaut behavior was equivalent to having min_size
= 1, so I/O would always be possible if any completely up to date
copy remained. min_size = 1 could result in lower overall
availability in certain cases, such as flapping network partitions.</p></li>
<li><p>The sysvinit start/stop script now defaults to adjusting the max
open files ulimit to 16384.  On most systems the default is 1024, so
this is an increase and won’t break anything.  If some system has a
higher initial value, however, this change will lower the limit.
The value can be adjusted explicitly by adding an entry to the
<code class="docutils literal notranslate"><span class="pre">ceph.conf</span></code> file in the appropriate section.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="k">global</span><span class="p">]</span>
        <span class="nb">max</span> <span class="nb">open</span> <span class="n">files</span> <span class="o">=</span> <span class="mi">32768</span>
</pre></div>
</div>
</li>
<li><p>‘rbd lock list’ and ‘rbd showmapped’ no longer use tabs as
separators in their output.</p></li>
<li><p>There is configurable limit on the number of PGs when creating a new
pool, to prevent a user from accidentally specifying a ridiculous
number for pg_num.  It can be adjusted via the ‘mon max pool pg num’
option on the monitor, and defaults to 65536 (the current max
supported by the Linux kernel client).</p></li>
<li><p>The osd capabilities associated with a rados user have changed
syntax since 0.48 argonaut. The new format is mostly backwards
compatible, but there are two backwards-incompatible changes:</p>
<ul class="simple">
<li><p>specifying a list of pools in one grant, i.e.
‘allow r pool=foo,bar’ is now done in separate grants, i.e.
‘allow r pool=foo, allow r pool=bar’.</p></li>
<li><p>restricting pool access by pool owner (‘allow r uid=foo’) is
removed. This feature was not very useful and unused in practice.</p></li>
</ul>
<p>The new format is documented in the ceph-authtool man page.</p>
</li>
<li><p>‘rbd cp’ and ‘rbd rename’ use rbd as the default destination pool,
regardless of what pool the source image is in. Previously they
would default to the same pool as the source image.</p></li>
<li><p>‘rbd export’ no longer prints a message for each object written. It
just reports percent complete like other long-lasting operations.</p></li>
<li><p>‘ceph osd tree’ now uses 4 decimal places for weight so output is
nicer for humans</p></li>
<li><p>Several monitor operations are now idempotent:</p>
<ul class="simple">
<li><p>ceph osd pool create</p></li>
<li><p>ceph osd pool delete</p></li>
<li><p>ceph osd pool mksnap</p></li>
<li><p>ceph osd rm</p></li>
<li><p>ceph pg &lt;pgid&gt; revert</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id12">
<h3>Notable changes<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>auth: enable cephx by default</p></li>
<li><p>auth: expanded authentication settings for greater flexibility</p></li>
<li><p>auth: sign messages when using cephx</p></li>
<li><p>build fixes for Fedora 18, CentOS/RHEL 6</p></li>
<li><p>ceph: new ‘osd ls’ and ‘osd tell &lt;osd.N&gt; version’ commands</p></li>
<li><p>ceph-debugpack: misc improvements</p></li>
<li><p>ceph-disk-prepare: creates and labels GPT partitions</p></li>
<li><p>ceph-disk-prepare: support for external journals, default mount/mkfs options, etc.</p></li>
<li><p>ceph-fuse/libcephfs: many misc fixes, admin socket debugging</p></li>
<li><p>ceph-fuse: fix handling for .. in root directory</p></li>
<li><p>ceph-fuse: many fixes (including memory leaks, hangs)</p></li>
<li><p>ceph-fuse: mount helper (mount.fuse.ceph) for use with /etc/fstab</p></li>
<li><p>ceph.spec: misc packaging fixes</p></li>
<li><p>common: thread pool sizes can now be adjusted at runtime</p></li>
<li><p>config: $pid is now available as a metavariable</p></li>
<li><p>crush: default root of tree type is now ‘root’ instead of ‘pool’ (to avoid confusiong wrt rados pools)</p></li>
<li><p>crush: fixed retry behavior with chooseleaf via tunable</p></li>
<li><p>crush: tunables documented; feature bit now present and enforced</p></li>
<li><p>libcephfs: java wrapper</p></li>
<li><p>librados: several bug fixes (rare races, locking errors)</p></li>
<li><p>librados: some locking fixes</p></li>
<li><p>librados: watch/notify fixes, misc memory leaks</p></li>
<li><p>librbd: a few fixes to ‘discard’ support</p></li>
<li><p>librbd: fine-grained striping feature</p></li>
<li><p>librbd: fixed memory leaks</p></li>
<li><p>librbd: fully functional and documented image cloning</p></li>
<li><p>librbd: image (advisory) locking</p></li>
<li><p>librbd: improved caching (of object non-existence)</p></li>
<li><p>librbd: ‘flatten’ command to sever clone parent relationship</p></li>
<li><p>librbd: ‘protect’/’unprotect’ commands to prevent clone parent from being deleted</p></li>
<li><p>librbd: clip requests past end-of-image.</p></li>
<li><p>librbd: fixes an issue with some windows guests running in qemu (remove floating point usage)</p></li>
<li><p>log: fix in-memory buffering behavior (to only write log messages on crash)</p></li>
<li><p>mds: fix ino release on abort session close, relative getattr path, mds shutdown, other misc items</p></li>
<li><p>mds: misc fixes</p></li>
<li><p>mkcephfs: fix for default keyring, osd data/journal locations</p></li>
<li><p>mkcephfs: support for formatting xfs, ext4 (as well as btrfs)</p></li>
<li><p>init: support for automatically mounting xfs and ext4 osd data directories</p></li>
<li><p>mon, radosgw, ceph-fuse: fixed memory leaks</p></li>
<li><p>mon: improved ENOSPC, fs error checking</p></li>
<li><p>mon: less-destructive ceph-mon –mkfs behavior</p></li>
<li><p>mon: misc fixes</p></li>
<li><p>mon: more informative info about stuck PGs in ‘health detail’</p></li>
<li><p>mon: information about recovery and backfill in ‘pg &lt;pgid&gt; query’</p></li>
<li><p>mon: new ‘osd crush create-or-move …’ command</p></li>
<li><p>mon: new ‘osd crush move …’ command lets you rearrange your CRUSH hierarchy</p></li>
<li><p>mon: optionally dump ‘osd tree’ in json</p></li>
<li><p>mon: configurable cap on maximum osd number (mon max osd)</p></li>
<li><p>mon: many bug fixes (various races causing ceph-mon crashes)</p></li>
<li><p>mon: new on-disk metadata to facilitate future mon changes (post-bobtail)</p></li>
<li><p>mon: election bug fixes</p></li>
<li><p>mon: throttle client messages (limit memory consumption)</p></li>
<li><p>mon: throttle osd flapping based on osd history (limits osdmap ΄thrashing’ on overloaded or unhappy clusters)</p></li>
<li><p>mon: ‘report’ command for dumping detailed cluster status (e.g., for use when reporting bugs)</p></li>
<li><p>mon: osdmap flags like noup, noin now cause a health warning</p></li>
<li><p>msgr: improved failure handling code</p></li>
<li><p>msgr: many bug fixes</p></li>
<li><p>osd, mon: honor new ‘nobackfill’ and ‘norecover’ osdmap flags</p></li>
<li><p>osd, mon: use feature bits to lock out clients lacking CRUSH tunables when they are in use</p></li>
<li><p>osd: backfill reservation framework (to avoid flooding new osds with backfill data)</p></li>
<li><p>osd: backfill target reservations (improve performance during recovery)</p></li>
<li><p>osd: better tracking of recent slow operations</p></li>
<li><p>osd: capability grammar improvements, bug fixes</p></li>
<li><p>osd: client vs recovery io prioritization</p></li>
<li><p>osd: crush performance improvements</p></li>
<li><p>osd: default journal size to 5 GB</p></li>
<li><p>osd: experimental support for PG “splitting” (pg_num adjustment for existing pools)</p></li>
<li><p>osd: fix memory leak on certain error paths</p></li>
<li><p>osd: fixed detection of EIO errors from fs on read</p></li>
<li><p>osd: major refactor of PG peering and threading</p></li>
<li><p>osd: many bug fixes</p></li>
<li><p>osd: more/better dump info about in-progress operations</p></li>
<li><p>osd: new caps structure (see compatibility notes)</p></li>
<li><p>osd: new ‘deep scrub’ will compare object content across replicas (once per week by default)</p></li>
<li><p>osd: new ‘lock’ rados class for generic object locking</p></li>
<li><p>osd: optional ‘min’ pg size</p></li>
<li><p>osd: recovery reservations</p></li>
<li><p>osd: scrub efficiency improvement</p></li>
<li><p>osd: several out of order reply bug fixes</p></li>
<li><p>osd: several rare peering cases fixed</p></li>
<li><p>osd: some performance improvements related to request queuing</p></li>
<li><p>osd: use entire device if journal is a block device</p></li>
<li><p>osd: use syncfs(2) when kernel supports it, even if glibc does not</p></li>
<li><p>osd: various fixes for out-of-order op replies</p></li>
<li><p>rados: ability to copy, rename pools</p></li>
<li><p>rados: bench command now cleans up after itself</p></li>
<li><p>rados: ‘cppool’ command to copy rados pools</p></li>
<li><p>rados: ‘rm’ now accepts a list of objects to be removed</p></li>
<li><p>radosgw: POST support</p></li>
<li><p>radosgw: REST API for managing usage stats</p></li>
<li><p>radosgw: fix bug in bucket stat updates</p></li>
<li><p>radosgw: fix copy-object vs attributes</p></li>
<li><p>radosgw: fix range header for large objects, ETag quoting, GMT dates, other compatibility fixes</p></li>
<li><p>radosgw: improved garbage collection framework</p></li>
<li><p>radosgw: many small fixes, cleanups</p></li>
<li><p>radosgw: openstack keystone integration</p></li>
<li><p>radosgw: stripe large (non-multipart) objects</p></li>
<li><p>radosgw: support for multi-object deletes</p></li>
<li><p>radosgw: support for swift manifest objects</p></li>
<li><p>radosgw: vanity bucket dns names</p></li>
<li><p>radosgw: various API compatibility fixes</p></li>
<li><p>rbd: import from stdin, export to stdout</p></li>
<li><p>rbd: new ‘ls -l’ option to view images with metadata</p></li>
<li><p>rbd: use generic id and keyring options for ‘rbd map’</p></li>
<li><p>rbd: don’t issue usage on errors</p></li>
<li><p>udev: fix symlink creation for rbd images containing partitions</p></li>
<li><p>upstart: job files for all daemon types (not enabled by default)</p></li>
<li><p>wireshark: ceph protocol dissector patch updated</p></li>
</ul>
</div>
</div>
<div class="section" id="v0-54">
<h2>v0.54<a class="headerlink" href="#v0-54" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id13">
<h3>Upgrading<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>The osd capabilities associated with a rados user have changed
syntax since 0.48 argonaut. The new format is mostly backwards
compatible, but there are two backwards-incompatible changes:</p>
<ul class="simple">
<li><p>specifying a list of pools in one grant, i.e.
‘allow r pool=foo,bar’ is now done in separate grants, i.e.
‘allow r pool=foo, allow r pool=bar’.</p></li>
<li><p>restricting pool access by pool owner (‘allow r uid=foo’) is
removed. This feature was not very useful and unused in practice.</p></li>
</ul>
<p>The new format is documented in the ceph-authtool man page.</p>
</li>
<li><p>Bug fixes to the new osd capability format parsing properly validate
the allowed operations. If an existing rados user gets permissions
errors after upgrading, its capabilities were probably
misconfigured. See the ceph-authtool man page for details on osd
capabilities.</p></li>
<li><p>‘rbd lock list’ and ‘rbd showmapped’ no longer use tabs as
separators in their output.</p></li>
</ul>
</div>
</div>
</div>



           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../argonaut/" class="btn btn-neutral float-right" title="Argonaut" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../cuttlefish/" class="btn btn-neutral float-left" title="Cuttlefish" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2016, Ceph authors and contributors. Licensed under Creative Commons Attribution Share Alike 3.0 (CC-BY-SA-3.0).

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>