
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>ceph-mgr orchestrator 模块 &#8212; Ceph Documentation</title>
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/js/ceph.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="Ceph 仪表盘" href="../dashboard/" />
    <link rel="prev" title="ceph-mgr 模块开发指南" href="../modules/" />
    <script type="text/javascript" src="http://ayni.ceph.com/public/js/ceph.js"></script>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../dashboard/" title="Ceph 仪表盘"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../modules/" title="ceph-mgr 模块开发指南"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">Ceph Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../" accesskey="U">Ceph 管理器守护进程</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            

<div id="dev-warning" class="admonition note" style="display:none;">
  <p class="first admonition-title">Notice</p>
  <p class="last">This document is for a development version of Ceph.</p>
</div>

<div id="eol-warning" class="admonition warning" style="display:none;">
  <p class="first admonition-title">Warning</p>
  <p class="last">This document is for an unsupported version of Ceph.</p>
</div>
  <div id="docubetter" align="right" style="display:none; padding: 15px; font-weight: bold;">
    <a id="edit-on-github" href="https://github.com/ceph/ceph/edit/master/doc/mgr/orchestrator_modules.rst" rel="nofollow">Edit on GitHub</a> | <a href="https://pad.ceph.com/p/Report_Documentation_Bugs">Report a Documentation Bug</a>
  </div>

  
  <div class="section" id="ceph-mgr-orchestrator">
<span id="orchestrator-modules"></span><h1>ceph-mgr orchestrator 模块<a class="headerlink" href="#ceph-mgr-orchestrator" title="Permalink to this headline">¶</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>这是开发者文档，描述的是 Ceph 内部机制，仅适用于编写
ceph-mgr orchestrator 模块的人们。</p>
</div>
<p>In this context, <em>orchestrator</em> refers to some external service that
provides the ability to discover devices and create Ceph services.  This
includes external projects such as ceph-ansible, DeepSea, and Rook.</p>
<p>An <em>orchestrator module</em> is a ceph-mgr module (<a class="reference internal" href="../modules/#mgr-module-dev"><span class="std std-ref">ceph-mgr 模块开发指南</span></a>)
which implements common management operations using a particular
orchestrator.</p>
<p>Orchestrator modules subclass the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> class: this class is
an interface, it only provides method definitions to be implemented
by subclasses.  The purpose of defining this common interface
for different orchestrators is to enable common UI code, such as
the dashboard, to work with various different backends.</p>
<div class="graphviz"><object data="../../_images/graphviz-916e7b6d045e22cc22a73f2eead5c9c7a07d870c.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph G {
    subgraph cluster_1 {
        volumes [label=&quot;mgr/volumes&quot;]
        rook [label=&quot;mgr/rook&quot;]
        dashboard [label=&quot;mgr/dashboard&quot;]
        orchestrator_cli [label=&quot;mgr/orchestrator_cli&quot;]
        orchestrator [label=&quot;Orchestrator Interface&quot;]
        ansible [label=&quot;mgr/ansible&quot;]
        ssh [label=&quot;mgr/ssh&quot;]
        deepsea [label=&quot;mgr/deepsea&quot;]

        label = &quot;ceph-mgr&quot;;
    }

    volumes -&gt; orchestrator
    dashboard -&gt; orchestrator
    orchestrator_cli -&gt; orchestrator
    orchestrator -&gt; rook -&gt; rook_io
    orchestrator -&gt; ansible -&gt; ceph_ansible
    orchestrator -&gt; deepsea -&gt; suse_deepsea
    orchestrator -&gt; ssh


    rook_io [label=&quot;Rook&quot;]
    ceph_ansible [label=&quot;ceph-ansible&quot;]
    suse_deepsea [label=&quot;DeepSea&quot;]

    rankdir=&quot;TB&quot;;
}</p></object></div>
<p>Behind all the abstraction, the purpose of orchestrator modules is simple:
enable Ceph to do things like discover available hardware, create and
destroy OSDs, and run MDS and RGW services.</p>
<p>A tutorial is not included here: for full and concrete examples, see
the existing implemented orchestrator modules in the Ceph source tree.</p>
<div class="section" id="id1">
<h2>术语<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<dl class="simple">
<dt>Stateful service</dt><dd><p>a daemon that uses local storage, such as OSD or mon.</p>
</dd>
<dt>Stateless service</dt><dd><p>a daemon that doesn’t use any local storage, such
as an MDS, RGW, nfs-ganesha, iSCSI gateway.</p>
</dd>
<dt>Label</dt><dd><p>arbitrary string tags that may be applied by administrators
to nodes.  Typically administrators use labels to indicate
which nodes should run which kinds of service.  Labels are
advisory (from human input) and do not guarantee that nodes
have particular physical capabilities.</p>
</dd>
<dt>Drive group</dt><dd><p>collection of block devices with common/shared OSD
formatting (typically one or more SSDs acting as
journals/dbs for a group of HDDs).</p>
</dd>
<dt>Placement</dt><dd><p>choice of which node is used to run a service.</p>
</dd>
</dl>
</div>
<div class="section" id="id2">
<h2>关键概念<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>The underlying orchestrator remains the source of truth for information
about whether a service is running, what is running where, which
nodes are available, etc.  Orchestrator modules should avoid taking
any internal copies of this information, and read it directly from
the orchestrator backend as much as possible.</p>
<p>Bootstrapping nodes and adding them to the underlying orchestration
system is outside the scope of Ceph’s orchestrator interface.  Ceph
can only work on nodes when the orchestrator is already aware of them.</p>
<p>Calls to orchestrator modules are all asynchronous, and return <em>completion</em>
objects (see below) rather than returning values immediately.</p>
<p>Where possible, placement of stateless services should be left up to the
orchestrator.</p>
</div>
<div class="section" id="completions-and-batching">
<h2>Completions and batching<a class="headerlink" href="#completions-and-batching" title="Permalink to this headline">¶</a></h2>
<p>All methods that read or modify the state of the system can potentially
be long running.  To handle that, all such methods return a <em>completion</em>
object (a <em>ReadCompletion</em> or a <em>WriteCompletion</em>).  Orchestrator modules
must implement the <em>wait</em> method: this takes a list of completions, and
is responsible for checking if they’re finished, and advancing the underlying
operations as needed.</p>
<p>Each orchestrator module implements its own underlying mechanisms
for completions.  This might involve running the underlying operations
in threads, or batching the operations up before later executing
in one go in the background.  If implementing such a batching pattern, the
module would do no work on any operation until it appeared in a list
of completions passed into <em>wait</em>.</p>
<p><em>WriteCompletion</em> objects have a two-stage execution.  First they become
<em>persistent</em>, meaning that the write has made it to the orchestrator
itself, and been persisted there (e.g. a manifest file has been updated).
If ceph-mgr crashed at this point, the operation would still eventually take
effect.  Second, the completion becomes <em>effective</em>, meaning that the operation has really happened (e.g. a service has actually been started).</p>
</div>
<div class="section" id="id3">
<h2>归置<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>In general, stateless services do not require any specific placement
rules, as they can run anywhere that sufficient system resources
are available.  However, some orchestrators may not include the
functionality to choose a location in this way, so we can optionally
specify a location when creating a stateless service.</p>
<p>OSD services generally require a specific placement choice, as this
will determine which storage devices are used.</p>
</div>
<div class="section" id="id4">
<h2>错误处理<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>The main goal of error handling within orchestrator modules is to provide debug information to
assist users when dealing with deployment errors.</p>
<dl class="class">
<dt id="orchestrator.OrchestratorError">
<em class="property">class </em><code class="sig-prename descclassname">orchestrator.</code><code class="sig-name descname">OrchestratorError</code><a class="headerlink" href="#orchestrator.OrchestratorError" title="Permalink to this definition">¶</a></dt>
<dd><p>General orchestrator specific error.</p>
<p>Used for deployment, configuration or user errors.</p>
<p>It’s not intended for programming errors or orchestrator internal errors.</p>
</dd></dl>

<dl class="class">
<dt id="orchestrator.NoOrchestrator">
<em class="property">class </em><code class="sig-prename descclassname">orchestrator.</code><code class="sig-name descname">NoOrchestrator</code><span class="sig-paren">(</span><em class="sig-param">msg='No orchestrator configured (try `ceph orch set backend`)'</em><span class="sig-paren">)</span><a class="headerlink" href="#orchestrator.NoOrchestrator" title="Permalink to this definition">¶</a></dt>
<dd><p>No orchestrator in configured.</p>
</dd></dl>

<dl class="class">
<dt id="orchestrator.OrchestratorValidationError">
<em class="property">class </em><code class="sig-prename descclassname">orchestrator.</code><code class="sig-name descname">OrchestratorValidationError</code><a class="headerlink" href="#orchestrator.OrchestratorValidationError" title="Permalink to this definition">¶</a></dt>
<dd><p>Raised when an orchestrator doesn’t support a specific feature.</p>
</dd></dl>

<p>In detail, orchestrators need to explicitly deal with different kinds of errors:</p>
<ol class="arabic">
<li><p>No orchestrator configured</p>
<p>See <a class="reference internal" href="#orchestrator.NoOrchestrator" title="orchestrator.NoOrchestrator"><code class="xref py py-class docutils literal notranslate"><span class="pre">NoOrchestrator</span></code></a>.</p>
</li>
<li><p>An orchestrator doesn’t implement a specific method.</p>
<p>For example, an Orchestrator doesn’t support <code class="docutils literal notranslate"><span class="pre">add_host</span></code>.</p>
<p>In this case, a <code class="docutils literal notranslate"><span class="pre">NotImplementedError</span></code> is raised.</p>
</li>
<li><p>Missing features within implemented methods.</p>
<p>E.g. optional parameters to a command that are not supported by the
backend (e.g. the hosts field in <code class="xref py py-func docutils literal notranslate"><span class="pre">Orchestrator.update_mons()</span></code> command with the rook backend).</p>
<p>See <a class="reference internal" href="#orchestrator.OrchestratorValidationError" title="orchestrator.OrchestratorValidationError"><code class="xref py py-class docutils literal notranslate"><span class="pre">OrchestratorValidationError</span></code></a>.</p>
</li>
<li><p>Input validation errors</p>
<p>The <code class="docutils literal notranslate"><span class="pre">orchestrator_cli</span></code> module and other calling modules are supposed to
provide meaningful error messages.</p>
<p>See <a class="reference internal" href="#orchestrator.OrchestratorValidationError" title="orchestrator.OrchestratorValidationError"><code class="xref py py-class docutils literal notranslate"><span class="pre">OrchestratorValidationError</span></code></a>.</p>
</li>
<li><p>Errors when actually executing commands</p>
<p>The resulting Completion should contain an error string that assists in understanding the
problem. In addition, <code class="xref py py-func docutils literal notranslate"><span class="pre">_Completion.is_errored()</span></code> is set to <code class="docutils literal notranslate"><span class="pre">True</span></code></p>
</li>
<li><p>Invalid configuration in the orchestrator modules</p>
<p>This can be tackled similar to 5.</p>
</li>
</ol>
<p>All other errors are unexpected orchestrator issues and thus should raise an exception that are then
logged into the mgr log file. If there is a completion object at that point,
<code class="xref py py-func docutils literal notranslate"><span class="pre">_Completion.result()</span></code> may contain an error message.</p>
</div>
<div class="section" id="id5">
<h2>排除的功能<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Ceph’s orchestrator interface is not a general purpose framework for
managing linux servers – it is deliberately constrained to manage
the Ceph cluster’s services only.</p></li>
<li><p>Multipathed storage is not handled (multipathing is unnecessary for
Ceph clusters).  Each drive is assumed to be visible only on
a single node.</p></li>
</ul>
</div>
<div class="section" id="id6">
<h2>主机管理<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="orchestrator.Orchestrator.add_host">
<code class="sig-prename descclassname">Orchestrator.</code><code class="sig-name descname">add_host</code><span class="sig-paren">(</span><em class="sig-param">host_spec: orchestrator._interface.HostSpec</em><span class="sig-paren">)</span> &#x2192; orchestrator._interface.Completion<a class="headerlink" href="#orchestrator.Orchestrator.add_host" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a host to the orchestrator inventory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>host</strong> – hostname</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="orchestrator.Orchestrator.remove_host">
<code class="sig-prename descclassname">Orchestrator.</code><code class="sig-name descname">remove_host</code><span class="sig-paren">(</span><em class="sig-param">host: str</em><span class="sig-paren">)</span> &#x2192; orchestrator._interface.Completion<a class="headerlink" href="#orchestrator.Orchestrator.remove_host" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove a host from the orchestrator inventory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>host</strong> – hostname</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="orchestrator.Orchestrator.get_hosts">
<code class="sig-prename descclassname">Orchestrator.</code><code class="sig-name descname">get_hosts</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; orchestrator._interface.Completion<a class="headerlink" href="#orchestrator.Orchestrator.get_hosts" title="Permalink to this definition">¶</a></dt>
<dd><p>Report the hosts in the cluster.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>list of HostSpec</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="id7">
<h2>余量和状态<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="orchestrator.Orchestrator.get_inventory">
<code class="sig-prename descclassname">Orchestrator.</code><code class="sig-name descname">get_inventory</code><span class="sig-paren">(</span><em class="sig-param">host_filter: Optional[orchestrator._interface.InventoryFilter] = None</em>, <em class="sig-param">refresh: bool = False</em><span class="sig-paren">)</span> &#x2192; orchestrator._interface.Completion<a class="headerlink" href="#orchestrator.Orchestrator.get_inventory" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns something that was created by <cite>ceph-volume inventory</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>list of InventoryHost</p>
</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="orchestrator.InventoryFilter">
<em class="property">class </em><code class="sig-prename descclassname">orchestrator.</code><code class="sig-name descname">InventoryFilter</code><span class="sig-paren">(</span><em class="sig-param">labels: Optional[List[str]] = None</em>, <em class="sig-param">hosts: Optional[List[str]] = None</em><span class="sig-paren">)</span><a class="headerlink" href="#orchestrator.InventoryFilter" title="Permalink to this definition">¶</a></dt>
<dd><p>When fetching inventory, use this filter to avoid unnecessarily
scanning the whole estate.</p>
<dl class="simple">
<dt>Typical use: filter by host when presenting UI workflow for configuring</dt><dd><p>a particular server.
filter by label when not all of estate is Ceph servers,
and we want to only learn about the Ceph servers.
filter by label when we are interested particularly
in e.g. OSD servers.</p>
</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="ceph.deployment.inventory.Devices">
<em class="property">class </em><code class="sig-prename descclassname">ceph.deployment.inventory.</code><code class="sig-name descname">Devices</code><span class="sig-paren">(</span><em class="sig-param">devices: List[ceph.deployment.inventory.Device]</em><span class="sig-paren">)</span><a class="headerlink" href="#ceph.deployment.inventory.Devices" title="Permalink to this definition">¶</a></dt>
<dd><p>A container for Device instances with reporting</p>
</dd></dl>

<dl class="class">
<dt id="ceph.deployment.inventory.Device">
<em class="property">class </em><code class="sig-prename descclassname">ceph.deployment.inventory.</code><code class="sig-name descname">Device</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">sys_api=None</em>, <em class="sig-param">available=None</em>, <em class="sig-param">rejected_reasons=None</em>, <em class="sig-param">lvs=None</em>, <em class="sig-param">device_id=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ceph.deployment.inventory.Device" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="orchestrator.Orchestrator.describe_service">
<code class="sig-prename descclassname">Orchestrator.</code><code class="sig-name descname">describe_service</code><span class="sig-paren">(</span><em class="sig-param">service_type: Optional[str] = None</em>, <em class="sig-param">service_name: Optional[str] = None</em>, <em class="sig-param">refresh: bool = False</em><span class="sig-paren">)</span> &#x2192; orchestrator._interface.Completion<a class="headerlink" href="#orchestrator.Orchestrator.describe_service" title="Permalink to this definition">¶</a></dt>
<dd><p>Describe a service (of any kind) that is already configured in
the orchestrator.  For example, when viewing an OSD in the dashboard
we might like to also display information about the orchestrator’s
view of the service (like the kubernetes pod ID).</p>
<p>When viewing a CephFS filesystem in the dashboard, we would use this
to display the pods being currently run for MDS daemons.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>list of ServiceDescription objects.</p>
</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="orchestrator.ServiceDescription">
<em class="property">class </em><code class="sig-prename descclassname">orchestrator.</code><code class="sig-name descname">ServiceDescription</code><span class="sig-paren">(</span><em class="sig-param">container_image_id=None</em>, <em class="sig-param">container_image_name=None</em>, <em class="sig-param">service_name=None</em>, <em class="sig-param">rados_config_location=None</em>, <em class="sig-param">service_url=None</em>, <em class="sig-param">last_refresh=None</em>, <em class="sig-param">size=0</em>, <em class="sig-param">running=0</em><span class="sig-paren">)</span><a class="headerlink" href="#orchestrator.ServiceDescription" title="Permalink to this definition">¶</a></dt>
<dd><p>For responding to queries about the status of a particular service,
stateful or stateless.</p>
<p>This is not about health or performance monitoring of services: it’s
about letting the orchestrator tell Ceph whether and where a
service is scheduled in the cluster.  When an orchestrator tells
Ceph “it’s running on host123”, that’s not a promise that the process
is literally up this second, it’s a description of where the orchestrator
has decided the service should run.</p>
</dd></dl>

</div>
<div class="section" id="service-actions">
<h2>Service Actions<a class="headerlink" href="#service-actions" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="orchestrator.Orchestrator.service_action">
<code class="sig-prename descclassname">Orchestrator.</code><code class="sig-name descname">service_action</code><span class="sig-paren">(</span><em class="sig-param">action: str</em>, <em class="sig-param">service_name: str</em><span class="sig-paren">)</span> &#x2192; orchestrator._interface.Completion<a class="headerlink" href="#orchestrator.Orchestrator.service_action" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform an action (start/stop/reload) on a service (i.e., all daemons
providing the logical service).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>action</strong> – one of “start”, “stop”, “restart”, “redeploy”, “reconfig”</p></li>
<li><p><strong>service_type</strong> – e.g. “mds”, “rgw”, …</p></li>
<li><p><strong>service_name</strong> – name of logical service (“cephfs”, “us-east”, …)</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>Completion</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="osd">
<h2>OSD 管理<a class="headerlink" href="#osd" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="orchestrator.Orchestrator.create_osds">
<code class="sig-prename descclassname">Orchestrator.</code><code class="sig-name descname">create_osds</code><span class="sig-paren">(</span><em class="sig-param">drive_groups: List[ceph.deployment.drive_group.DriveGroupSpec]</em><span class="sig-paren">)</span> &#x2192; orchestrator._interface.Completion<a class="headerlink" href="#orchestrator.Orchestrator.create_osds" title="Permalink to this definition">¶</a></dt>
<dd><p>Create one or more OSDs within a single Drive Group.</p>
<p>The principal argument here is the drive_group member
of OsdSpec: other fields are advisory/extensible for any
finer-grained OSD feature enablement (choice of backing store,
compression/encryption, etc).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>drive_groups</strong> – a list of DriveGroupSpec</p></li>
<li><p><strong>all_hosts</strong> – TODO, this is required because the orchestrator methods are not composable
Probably this parameter can be easily removed because each orchestrator can use
the “get_inventory” method and the “drive_group.host_pattern” attribute
to obtain the list of hosts where to apply the operation</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="orchestrator.Orchestrator.remove_osds">
<code class="sig-prename descclassname">Orchestrator.</code><code class="sig-name descname">remove_osds</code><span class="sig-paren">(</span><em class="sig-param">osd_ids: List[str], replace: bool = False, force: bool = False</em><span class="sig-paren">)</span> &#x2192; orchestrator._interface.Completion<a class="headerlink" href="#orchestrator.Orchestrator.remove_osds" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>osd_ids</strong> – list of OSD IDs</p></li>
<li><p><strong>replace</strong> – marks the OSD as being destroyed. See <a class="reference internal" href="#orchestrator-osd-replace"><span class="std std-ref">OSD 替换</span></a></p></li>
<li><p><strong>force</strong> – Forces the OSD removal process without waiting for the data to be drained first.</p></li>
</ul>
</dd>
</dl>
<p>Note that this can only remove OSDs that were successfully
created (i.e. got an OSD ID).</p>
</dd></dl>

<dl class="class">
<dt id="ceph.deployment.drive_group.DeviceSelection">
<em class="property">class </em><code class="sig-prename descclassname">ceph.deployment.drive_group.</code><code class="sig-name descname">DeviceSelection</code><span class="sig-paren">(</span><em class="sig-param">paths=None</em>, <em class="sig-param">model=None</em>, <em class="sig-param">size=None</em>, <em class="sig-param">rotational=None</em>, <em class="sig-param">limit=None</em>, <em class="sig-param">vendor=None</em>, <em class="sig-param">all=False</em><span class="sig-paren">)</span><a class="headerlink" href="#ceph.deployment.drive_group.DeviceSelection" title="Permalink to this definition">¶</a></dt>
<dd><p>Used within <a class="reference internal" href="#ceph.deployment.drive_group.DriveGroupSpec" title="ceph.deployment.drive_group.DriveGroupSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">ceph.deployment.drive_group.DriveGroupSpec</span></code></a> to specify the devices
used by the Drive Group.</p>
<p>Any attributes (even none) can be included in the device
specification structure.</p>
<dl class="attribute">
<dt id="ceph.deployment.drive_group.DeviceSelection.all">
<code class="sig-name descname">all</code><em class="property"> = None</em><a class="headerlink" href="#ceph.deployment.drive_group.DeviceSelection.all" title="Permalink to this definition">¶</a></dt>
<dd><p>Matches all devices. Can only be used for data devices</p>
</dd></dl>

<dl class="attribute">
<dt id="ceph.deployment.drive_group.DeviceSelection.limit">
<code class="sig-name descname">limit</code><em class="property"> = None</em><a class="headerlink" href="#ceph.deployment.drive_group.DeviceSelection.limit" title="Permalink to this definition">¶</a></dt>
<dd><p>Limit the number of devices added to this Drive Group. Devices
are used from top to bottom in the output of <code class="docutils literal notranslate"><span class="pre">ceph-volume</span> <span class="pre">inventory</span></code></p>
</dd></dl>

<dl class="attribute">
<dt id="ceph.deployment.drive_group.DeviceSelection.model">
<code class="sig-name descname">model</code><em class="property"> = None</em><a class="headerlink" href="#ceph.deployment.drive_group.DeviceSelection.model" title="Permalink to this definition">¶</a></dt>
<dd><p>A wildcard string. e.g: “SDD*” or “SanDisk SD8SN8U5”</p>
</dd></dl>

<dl class="attribute">
<dt id="ceph.deployment.drive_group.DeviceSelection.paths">
<code class="sig-name descname">paths</code><em class="property">: List[Device]</em><em class="property"> = None</em><a class="headerlink" href="#ceph.deployment.drive_group.DeviceSelection.paths" title="Permalink to this definition">¶</a></dt>
<dd><p>List of Device objects for devices paths.</p>
</dd></dl>

<dl class="attribute">
<dt id="ceph.deployment.drive_group.DeviceSelection.rotational">
<code class="sig-name descname">rotational</code><em class="property"> = None</em><a class="headerlink" href="#ceph.deployment.drive_group.DeviceSelection.rotational" title="Permalink to this definition">¶</a></dt>
<dd><p>is the drive rotating or not</p>
</dd></dl>

<dl class="attribute">
<dt id="ceph.deployment.drive_group.DeviceSelection.size">
<code class="sig-name descname">size</code><em class="property"> = None</em><a class="headerlink" href="#ceph.deployment.drive_group.DeviceSelection.size" title="Permalink to this definition">¶</a></dt>
<dd><p>Size specification of format LOW:HIGH.
Can also take the the form :HIGH, LOW:
or an exact value (as ceph-volume inventory reports)</p>
</dd></dl>

<dl class="attribute">
<dt id="ceph.deployment.drive_group.DeviceSelection.vendor">
<code class="sig-name descname">vendor</code><em class="property"> = None</em><a class="headerlink" href="#ceph.deployment.drive_group.DeviceSelection.vendor" title="Permalink to this definition">¶</a></dt>
<dd><p>Match on the VENDOR property of the drive</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ceph.deployment.drive_group.DriveGroupSpec">
<em class="property">class </em><code class="sig-prename descclassname">ceph.deployment.drive_group.</code><code class="sig-name descname">DriveGroupSpec</code><span class="sig-paren">(</span><em class="sig-param">host_pattern=None</em>, <em class="sig-param">name=None</em>, <em class="sig-param">data_devices=None</em>, <em class="sig-param">db_devices=None</em>, <em class="sig-param">wal_devices=None</em>, <em class="sig-param">journal_devices=None</em>, <em class="sig-param">data_directories=None</em>, <em class="sig-param">osds_per_device=None</em>, <em class="sig-param">objectstore='bluestore'</em>, <em class="sig-param">encrypted=False</em>, <em class="sig-param">db_slots=None</em>, <em class="sig-param">wal_slots=None</em>, <em class="sig-param">osd_id_claims=None</em>, <em class="sig-param">block_db_size=None</em>, <em class="sig-param">block_wal_size=None</em>, <em class="sig-param">journal_size=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ceph.deployment.drive_group.DriveGroupSpec" title="Permalink to this definition">¶</a></dt>
<dd><p>Describe a drive group in the same form that ceph-volume
understands.</p>
<dl class="attribute">
<dt id="ceph.deployment.drive_group.DriveGroupSpec.block_db_size">
<code class="sig-name descname">block_db_size</code><em class="property"> = None</em><a class="headerlink" href="#ceph.deployment.drive_group.DriveGroupSpec.block_db_size" title="Permalink to this definition">¶</a></dt>
<dd><p>Set (or override) the “bluestore_block_db_size” value, in bytes</p>
</dd></dl>

<dl class="attribute">
<dt id="ceph.deployment.drive_group.DriveGroupSpec.block_wal_size">
<code class="sig-name descname">block_wal_size</code><em class="property"> = None</em><a class="headerlink" href="#ceph.deployment.drive_group.DriveGroupSpec.block_wal_size" title="Permalink to this definition">¶</a></dt>
<dd><p>Set (or override) the “bluestore_block_wal_size” value, in bytes</p>
</dd></dl>

<dl class="attribute">
<dt id="ceph.deployment.drive_group.DriveGroupSpec.data_devices">
<code class="sig-name descname">data_devices</code><em class="property"> = None</em><a class="headerlink" href="#ceph.deployment.drive_group.DriveGroupSpec.data_devices" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="#ceph.deployment.drive_group.DeviceSelection" title="ceph.deployment.drive_group.DeviceSelection"><code class="xref py py-class docutils literal notranslate"><span class="pre">ceph.deployment.drive_group.DeviceSelection</span></code></a></p>
</dd></dl>

<dl class="attribute">
<dt id="ceph.deployment.drive_group.DriveGroupSpec.data_directories">
<code class="sig-name descname">data_directories</code><em class="property"> = None</em><a class="headerlink" href="#ceph.deployment.drive_group.DriveGroupSpec.data_directories" title="Permalink to this definition">¶</a></dt>
<dd><p>A list of strings, containing paths which should back OSDs</p>
</dd></dl>

<dl class="attribute">
<dt id="ceph.deployment.drive_group.DriveGroupSpec.db_devices">
<code class="sig-name descname">db_devices</code><em class="property"> = None</em><a class="headerlink" href="#ceph.deployment.drive_group.DriveGroupSpec.db_devices" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="#ceph.deployment.drive_group.DeviceSelection" title="ceph.deployment.drive_group.DeviceSelection"><code class="xref py py-class docutils literal notranslate"><span class="pre">ceph.deployment.drive_group.DeviceSelection</span></code></a></p>
</dd></dl>

<dl class="attribute">
<dt id="ceph.deployment.drive_group.DriveGroupSpec.db_slots">
<code class="sig-name descname">db_slots</code><em class="property"> = None</em><a class="headerlink" href="#ceph.deployment.drive_group.DriveGroupSpec.db_slots" title="Permalink to this definition">¶</a></dt>
<dd><p>How many OSDs per DB device</p>
</dd></dl>

<dl class="attribute">
<dt id="ceph.deployment.drive_group.DriveGroupSpec.encrypted">
<code class="sig-name descname">encrypted</code><em class="property"> = None</em><a class="headerlink" href="#ceph.deployment.drive_group.DriveGroupSpec.encrypted" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">false</span></code></p>
</dd></dl>

<dl class="attribute">
<dt id="ceph.deployment.drive_group.DriveGroupSpec.host_pattern">
<code class="sig-name descname">host_pattern</code><em class="property"> = None</em><a class="headerlink" href="#ceph.deployment.drive_group.DriveGroupSpec.host_pattern" title="Permalink to this definition">¶</a></dt>
<dd><p>An fnmatch pattern to select hosts. Can also be a single host.</p>
</dd></dl>

<dl class="attribute">
<dt id="ceph.deployment.drive_group.DriveGroupSpec.journal_devices">
<code class="sig-name descname">journal_devices</code><em class="property"> = None</em><a class="headerlink" href="#ceph.deployment.drive_group.DriveGroupSpec.journal_devices" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="#ceph.deployment.drive_group.DeviceSelection" title="ceph.deployment.drive_group.DeviceSelection"><code class="xref py py-class docutils literal notranslate"><span class="pre">ceph.deployment.drive_group.DeviceSelection</span></code></a></p>
</dd></dl>

<dl class="attribute">
<dt id="ceph.deployment.drive_group.DriveGroupSpec.journal_size">
<code class="sig-name descname">journal_size</code><em class="property"> = None</em><a class="headerlink" href="#ceph.deployment.drive_group.DriveGroupSpec.journal_size" title="Permalink to this definition">¶</a></dt>
<dd><p>set journal_size is bytes</p>
</dd></dl>

<dl class="attribute">
<dt id="ceph.deployment.drive_group.DriveGroupSpec.objectstore">
<code class="sig-name descname">objectstore</code><em class="property"> = None</em><a class="headerlink" href="#ceph.deployment.drive_group.DriveGroupSpec.objectstore" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">filestore</span></code> or <code class="docutils literal notranslate"><span class="pre">bluestore</span></code></p>
</dd></dl>

<dl class="attribute">
<dt id="ceph.deployment.drive_group.DriveGroupSpec.osd_id_claims">
<code class="sig-name descname">osd_id_claims</code><em class="property"> = None</em><a class="headerlink" href="#ceph.deployment.drive_group.DriveGroupSpec.osd_id_claims" title="Permalink to this definition">¶</a></dt>
<dd><p>Optional: mapping of OSD id to DeviceSelection, used when the
created OSDs are meant to replace previous OSDs on
the same node. See <a class="reference internal" href="#orchestrator-osd-replace"><span class="std std-ref">OSD 替换</span></a></p>
</dd></dl>

<dl class="attribute">
<dt id="ceph.deployment.drive_group.DriveGroupSpec.osds_per_device">
<code class="sig-name descname">osds_per_device</code><em class="property"> = None</em><a class="headerlink" href="#ceph.deployment.drive_group.DriveGroupSpec.osds_per_device" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of osd daemons per “DATA” device.
To fully utilize nvme devices multiple osds are required.</p>
</dd></dl>

<dl class="attribute">
<dt id="ceph.deployment.drive_group.DriveGroupSpec.wal_devices">
<code class="sig-name descname">wal_devices</code><em class="property"> = None</em><a class="headerlink" href="#ceph.deployment.drive_group.DriveGroupSpec.wal_devices" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="#ceph.deployment.drive_group.DeviceSelection" title="ceph.deployment.drive_group.DeviceSelection"><code class="xref py py-class docutils literal notranslate"><span class="pre">ceph.deployment.drive_group.DeviceSelection</span></code></a></p>
</dd></dl>

<dl class="attribute">
<dt id="ceph.deployment.drive_group.DriveGroupSpec.wal_slots">
<code class="sig-name descname">wal_slots</code><em class="property"> = None</em><a class="headerlink" href="#ceph.deployment.drive_group.DriveGroupSpec.wal_slots" title="Permalink to this definition">¶</a></dt>
<dd><p>How many OSDs per WAL device</p>
</dd></dl>

</dd></dl>

<div class="section" id="orchestrator-osd-replace">
<span id="id8"></span><h3>OSD 替换<a class="headerlink" href="#orchestrator-osd-replace" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference internal" href="../../rados/operations/add-or-rm-osds/#rados-replacing-an-osd"><span class="std std-ref">替换一个 OSD</span></a> for the underlying process.</p>
<p>Replacing OSDs is fundamentally a two-staged process, as users need to
physically replace drives. The orchestrator therefor exposes this two-staged process.</p>
<p>Phase one is a call to <a class="reference internal" href="#orchestrator.Orchestrator.remove_osds" title="orchestrator.Orchestrator.remove_osds"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Orchestrator.remove_osds()</span></code></a> with <code class="docutils literal notranslate"><span class="pre">destroy=True</span></code> in order to mark
the OSD as destroyed.</p>
<p>Phase two is a call to  <a class="reference internal" href="#orchestrator.Orchestrator.create_osds" title="orchestrator.Orchestrator.create_osds"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Orchestrator.create_osds()</span></code></a> with a Drive Group with</p>
<p><a class="reference internal" href="#ceph.deployment.drive_group.DriveGroupSpec.osd_id_claims" title="ceph.deployment.drive_group.DriveGroupSpec.osd_id_claims"><code class="xref py py-attr docutils literal notranslate"><span class="pre">DriveGroupSpec.osd_id_claims</span></code></a> set to the destroyed OSD ids.</p>
</div>
</div>
<div class="section" id="id9">
<h2>无状态服务<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="orchestrator.Orchestrator.add_mds">
<code class="sig-prename descclassname">Orchestrator.</code><code class="sig-name descname">add_mds</code><span class="sig-paren">(</span><em class="sig-param">spec: orchestrator._interface.ServiceSpec</em><span class="sig-paren">)</span> &#x2192; orchestrator._interface.Completion<a class="headerlink" href="#orchestrator.Orchestrator.add_mds" title="Permalink to this definition">¶</a></dt>
<dd><p>Create MDS daemon(s)</p>
</dd></dl>

<dl class="method">
<dt id="orchestrator.Orchestrator.add_rgw">
<code class="sig-prename descclassname">Orchestrator.</code><code class="sig-name descname">add_rgw</code><span class="sig-paren">(</span><em class="sig-param">spec: orchestrator._interface.RGWSpec</em><span class="sig-paren">)</span> &#x2192; orchestrator._interface.Completion<a class="headerlink" href="#orchestrator.Orchestrator.add_rgw" title="Permalink to this definition">¶</a></dt>
<dd><p>Create RGW daemon(s)</p>
</dd></dl>

<dl class="class">
<dt id="orchestrator.NFSServiceSpec">
<em class="property">class </em><code class="sig-prename descclassname">orchestrator.</code><code class="sig-name descname">NFSServiceSpec</code><span class="sig-paren">(</span><em class="sig-param">name</em>, <em class="sig-param">pool=None</em>, <em class="sig-param">namespace=None</em>, <em class="sig-param">placement=None</em><span class="sig-paren">)</span><a class="headerlink" href="#orchestrator.NFSServiceSpec" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="orchestrator.Orchestrator.add_nfs">
<code class="sig-prename descclassname">Orchestrator.</code><code class="sig-name descname">add_nfs</code><span class="sig-paren">(</span><em class="sig-param">spec: orchestrator._interface.NFSServiceSpec</em><span class="sig-paren">)</span> &#x2192; orchestrator._interface.Completion<a class="headerlink" href="#orchestrator.Orchestrator.add_nfs" title="Permalink to this definition">¶</a></dt>
<dd><p>Create NFS daemon(s)</p>
</dd></dl>

</div>
<div class="section" id="id10">
<h2>升级<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="orchestrator.Orchestrator.upgrade_available">
<code class="sig-prename descclassname">Orchestrator.</code><code class="sig-name descname">upgrade_available</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; orchestrator._interface.Completion<a class="headerlink" href="#orchestrator.Orchestrator.upgrade_available" title="Permalink to this definition">¶</a></dt>
<dd><p>Report on what versions are available to upgrade to</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>List of strings</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="orchestrator.Orchestrator.upgrade_start">
<code class="sig-prename descclassname">Orchestrator.</code><code class="sig-name descname">upgrade_start</code><span class="sig-paren">(</span><em class="sig-param">image: Optional[str], version: Optional[str]</em><span class="sig-paren">)</span> &#x2192; orchestrator._interface.Completion<a class="headerlink" href="#orchestrator.Orchestrator.upgrade_start" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="orchestrator.Orchestrator.upgrade_status">
<code class="sig-prename descclassname">Orchestrator.</code><code class="sig-name descname">upgrade_status</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; orchestrator._interface.Completion<a class="headerlink" href="#orchestrator.Orchestrator.upgrade_status" title="Permalink to this definition">¶</a></dt>
<dd><p>If an upgrade is currently underway, report on where
we are in the process, or if some error has occurred.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>UpgradeStatusSpec instance</p>
</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="orchestrator.UpgradeStatusSpec">
<em class="property">class </em><code class="sig-prename descclassname">orchestrator.</code><code class="sig-name descname">UpgradeStatusSpec</code><a class="headerlink" href="#orchestrator.UpgradeStatusSpec" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="id11">
<h2>工具<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="orchestrator.Orchestrator.available">
<code class="sig-prename descclassname">Orchestrator.</code><code class="sig-name descname">available</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; Tuple[bool, str]<a class="headerlink" href="#orchestrator.Orchestrator.available" title="Permalink to this definition">¶</a></dt>
<dd><p>Report whether we can talk to the orchestrator.  This is the
place to give the user a meaningful message if the orchestrator
isn’t running or can’t be contacted.</p>
<p>This method may be called frequently (e.g. every page load
to conditionally display a warning banner), so make sure it’s
not too expensive.  It’s okay to give a slightly stale status
(e.g. based on a periodic background ping of the orchestrator)
if that’s necessary to make this method fast.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><cite>True</cite> doesn’t mean that the desired functionality
is actually available in the orchestrator. I.e. this
won’t work as expected:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">OrchestratorClientMixin</span><span class="p">()</span><span class="o">.</span><span class="n">available</span><span class="p">()[</span><span class="mi">0</span><span class="p">]:</span>  <span class="c1"># wrong.</span>
<span class="gp">... </span>    <span class="n">OrchestratorClientMixin</span><span class="p">()</span><span class="o">.</span><span class="n">get_hosts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>two-tuple of boolean, string</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="orchestrator.Orchestrator.get_feature_set">
<code class="sig-prename descclassname">Orchestrator.</code><code class="sig-name descname">get_feature_set</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#orchestrator.Orchestrator.get_feature_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Describes which methods this orchestrator implements</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><cite>True</cite> doesn’t mean that the desired functionality
is actually possible in the orchestrator. I.e. this
won’t work as expected:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">api</span> <span class="o">=</span> <span class="n">OrchestratorClientMixin</span><span class="p">()</span>
<span class="gp">... </span><span class="k">if</span> <span class="n">api</span><span class="o">.</span><span class="n">get_feature_set</span><span class="p">()[</span><span class="s1">&#39;get_hosts&#39;</span><span class="p">][</span><span class="s1">&#39;available&#39;</span><span class="p">]:</span>  <span class="c1"># wrong.</span>
<span class="gp">... </span>    <span class="n">api</span><span class="o">.</span><span class="n">get_hosts</span><span class="p">()</span>
</pre></div>
</div>
<p>It’s better to ask for forgiveness instead:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">OrchestratorClientMixin</span><span class="p">()</span><span class="o">.</span><span class="n">get_hosts</span><span class="p">()</span>
<span class="gp">... </span><span class="k">except</span> <span class="p">(</span><span class="n">OrchestratorError</span><span class="p">,</span> <span class="ne">NotImplementedError</span><span class="p">):</span>
<span class="gp">... </span>    <span class="o">...</span>
</pre></div>
</div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Dict of API method names to <code class="docutils literal notranslate"><span class="pre">{'available':</span> <span class="pre">True</span> <span class="pre">or</span> <span class="pre">False}</span></code></p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="id12">
<h2>客户端模块<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="orchestrator.OrchestratorClientMixin">
<em class="property">class </em><code class="sig-prename descclassname">orchestrator.</code><code class="sig-name descname">OrchestratorClientMixin</code><a class="headerlink" href="#orchestrator.OrchestratorClientMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>A module that inherents from <cite>OrchestratorClientMixin</cite> can directly call
all <code class="xref py py-class docutils literal notranslate"><span class="pre">Orchestrator</span></code> methods without manually calling remote.</p>
<p>Every interface method from <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> is converted into a stub method that internally
calls <code class="xref py py-func docutils literal notranslate"><span class="pre">OrchestratorClientMixin._oremote()</span></code></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyModule</span><span class="p">(</span><span class="n">OrchestratorClientMixin</span><span class="p">):</span>
<span class="gp">... </span>   <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>       <span class="n">completion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_host</span><span class="p">(</span><span class="s1">&#39;somehost&#39;</span><span class="p">)</span>  <span class="c1"># calls `_oremote()`</span>
<span class="gp">... </span>       <span class="bp">self</span><span class="o">.</span><span class="n">_orchestrator_wait</span><span class="p">([</span><span class="n">completion</span><span class="p">])</span>
<span class="gp">... </span>       <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">completion</span><span class="o">.</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Orchestrator implementations should not inherit from <cite>OrchestratorClientMixin</cite>.
Reason is, that OrchestratorClientMixin magically redirects all methods to the
“real” implementation of the orchestrator.</p>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">mgr_module</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyImplentation</span><span class="p">(</span><span class="n">mgr_module</span><span class="o">.</span><span class="n">MgrModule</span><span class="p">,</span> <span class="n">Orchestrator</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">...</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">orch_client</span> <span class="o">=</span> <span class="n">OrchestratorClientMixin</span><span class="p">()</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">orch_client</span><span class="o">.</span><span class="n">set_mgr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mgr</span><span class="p">))</span>
</pre></div>
</div>
<dl class="method">
<dt id="orchestrator.OrchestratorClientMixin.set_mgr">
<code class="sig-name descname">set_mgr</code><span class="sig-paren">(</span><em class="sig-param">mgr: mgr_module.MgrModule</em><span class="sig-paren">)</span> &#x2192; None<a class="headerlink" href="#orchestrator.OrchestratorClientMixin.set_mgr" title="Permalink to this definition">¶</a></dt>
<dd><p>Useable in the Dashbord that uses a global <code class="docutils literal notranslate"><span class="pre">mgr</span></code></p>
</dd></dl>

</dd></dl>

</div>
</div>



          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../start/intro/">Ceph 简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../start/">安装（ ceph-deploy ）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/">安装（手动）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../start/kube-helm/">安装（ Kubernetes + Helm ）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rados/">Ceph 存储集群</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cephfs/">Ceph 文件系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rbd/">Ceph 块设备</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../radosgw/">Ceph 对象网关</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">Ceph 管理器守护进程</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../administrator/">安装和配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/">模块编程</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">编写 orchestrator 插件</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">术语</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">关键概念</a></li>
<li class="toctree-l3"><a class="reference internal" href="#completions-and-batching">Completions and batching</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">归置</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">错误处理</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">排除的功能</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">主机管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">余量和状态</a></li>
<li class="toctree-l3"><a class="reference internal" href="#service-actions">Service Actions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#osd">OSD 管理</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#orchestrator-osd-replace">OSD 替换</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id9">无状态服务</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">升级</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">工具</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id12">客户端模块</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dashboard/">仪表盘模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../diskprediction/">DiskPrediction 模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../localpool/">localpool 模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../restful/">REST 风格模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../zabbix/">Zabbix 模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../prometheus/">Prometheus 模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../influx/">Influx 模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hello/">Hello 模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../telegraf/">Telegraf 模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../telemetry/">Telemetry 模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iostat/">Iostat 模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../crash/">Crash 模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../orchestrator_cli/">Orchestrator CLI 模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rook/">Rook 模块</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/">API 文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture/">体系结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/developer_guide/">开发者指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/internals/">Ceph 内幕</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../governance/">项目管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ceph-volume/">ceph-volume</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/">Ceph 版本</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary/">Ceph 术语</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../translation_cn/">中文版翻译资源</a></li>
</ul>


<!-- ugly kludge to make genindex look like it's part of the toc -->
<ul style="margin-top: -10px"><li class="toctree-l1"><a class="reference internal" href="../../genindex/">Index</a></li></ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../dashboard/" title="Ceph 仪表盘"
             >next</a> |</li>
        <li class="right" >
          <a href="../modules/" title="ceph-mgr 模块开发指南"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">Ceph Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../" >Ceph 管理器守护进程</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Ceph authors and contributors. Licensed under Creative Commons Attribution Share Alike 3.0 (CC-BY-SA-3.0).
    </div>
  </body>
</html>