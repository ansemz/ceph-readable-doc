
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>ceph-mgr orchestrator modules &#8212; Ceph Documentation</title>
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/js/ceph.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="Ceph Manager Dashboard" href="../dashboard/" />
    <link rel="prev" title="ceph-mgr module developer’s guide" href="../plugins/" />
    <script type="text/javascript" src="http://ayni.ceph.com/public/js/ceph.js"></script>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../dashboard/" title="Ceph Manager Dashboard"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../plugins/" title="ceph-mgr module developer’s guide"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">Ceph Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../" accesskey="U">Ceph Manager Daemon</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            

<div id="dev-warning" class="admonition note" style="display:none;">
  <p class="first admonition-title">Notice</p>
  <p class="last">This document is for a development version of Ceph.</p>
</div>

<div id="eol-warning" class="admonition warning" style="display:none;">
  <p class="first admonition-title">Warning</p>
  <p class="last">This document is for an unsupported version of Ceph.</p>
</div>
  <div id="docubetter" align="right" style="display:none; padding: 15px; font-weight: bold;">
    <a id="edit-on-github" href="https://github.com/ceph/ceph/edit/master/doc/mgr/orchestrator_modules.rst" rel="nofollow">Edit on GitHub</a> | <a href="https://github.com/ceph/ceph/projects/4">Report a Documentation Bug</a>
  </div>

  
  <div class="section" id="ceph-mgr-orchestrator-modules">
<span id="orchestrator-modules"></span><h1>ceph-mgr orchestrator modules<a class="headerlink" href="#ceph-mgr-orchestrator-modules" title="Permalink to this headline">¶</a></h1>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This is developer documentation, describing Ceph internals that
are only relevant to people writing ceph-mgr orchestrator modules.</p>
</div>
<p>In this context, <em>orchestrator</em> refers to some external service that
provides the ability to discover devices and create Ceph services.  This
includes external projects such as ceph-ansible, DeepSea, and Rook.</p>
<p>An <em>orchestrator module</em> is a ceph-mgr module (<a class="reference internal" href="../plugins/#mgr-module-dev"><span class="std std-ref">ceph-mgr module developer’s guide</span></a>)
which implements common management operations using a particular
orchestrator.</p>
<p>Orchestrator modules subclass the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> class: this class is
an interface, it only provides method definitions to be implemented
by subclasses.  The purpose of defining this common interface
for different orchestrators is to enable common UI code, such as
the dashboard, to work with various different backends.</p>
<div class="graphviz"><object data="../../_images/graphviz-916e7b6d045e22cc22a73f2eead5c9c7a07d870c.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph G {
    subgraph cluster_1 {
        volumes [label=&quot;mgr/volumes&quot;]
        rook [label=&quot;mgr/rook&quot;]
        dashboard [label=&quot;mgr/dashboard&quot;]
        orchestrator_cli [label=&quot;mgr/orchestrator_cli&quot;]
        orchestrator [label=&quot;Orchestrator Interface&quot;]
        ansible [label=&quot;mgr/ansible&quot;]
        ssh [label=&quot;mgr/ssh&quot;]
        deepsea [label=&quot;mgr/deepsea&quot;]

        label = &quot;ceph-mgr&quot;;
    }

    volumes -&gt; orchestrator
    dashboard -&gt; orchestrator
    orchestrator_cli -&gt; orchestrator
    orchestrator -&gt; rook -&gt; rook_io
    orchestrator -&gt; ansible -&gt; ceph_ansible
    orchestrator -&gt; deepsea -&gt; suse_deepsea
    orchestrator -&gt; ssh


    rook_io [label=&quot;Rook&quot;]
    ceph_ansible [label=&quot;ceph-ansible&quot;]
    suse_deepsea [label=&quot;DeepSea&quot;]

    rankdir=&quot;TB&quot;;
}</p></object></div>
<p>Behind all the abstraction, the purpose of orchestrator modules is simple:
enable Ceph to do things like discover available hardware, create and
destroy OSDs, and run MDS and RGW services.</p>
<p>A tutorial is not included here: for full and concrete examples, see
the existing implemented orchestrator modules in the Ceph source tree.</p>
<div class="section" id="glossary">
<h2>Glossary<a class="headerlink" href="#glossary" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>Stateful service</dt>
<dd>a daemon that uses local storage, such as OSD or mon.</dd>
<dt>Stateless service</dt>
<dd>a daemon that doesn’t use any local storage, such
as an MDS, RGW, nfs-ganesha, iSCSI gateway.</dd>
<dt>Label</dt>
<dd>arbitrary string tags that may be applied by administrators
to nodes.  Typically administrators use labels to indicate
which nodes should run which kinds of service.  Labels are
advisory (from human input) and do not guarantee that nodes
have particular physical capabilities.</dd>
<dt>Drive group</dt>
<dd>collection of block devices with common/shared OSD
formatting (typically one or more SSDs acting as
journals/dbs for a group of HDDs).</dd>
<dt>Placement</dt>
<dd>choice of which node is used to run a service.</dd>
</dl>
</div>
<div class="section" id="key-concepts">
<h2>Key Concepts<a class="headerlink" href="#key-concepts" title="Permalink to this headline">¶</a></h2>
<p>The underlying orchestrator remains the source of truth for information
about whether a service is running, what is running where, which
nodes are available, etc.  Orchestrator modules should avoid taking
any internal copies of this information, and read it directly from
the orchestrator backend as much as possible.</p>
<p>Bootstrapping nodes and adding them to the underlying orchestration
system is outside the scope of Ceph’s orchestrator interface.  Ceph
can only work on nodes when the orchestrator is already aware of them.</p>
<p>Calls to orchestrator modules are all asynchronous, and return <em>completion</em>
objects (see below) rather than returning values immediately.</p>
<p>Where possible, placement of stateless services should be left up to the
orchestrator.</p>
</div>
<div class="section" id="completions-and-batching">
<h2>Completions and batching<a class="headerlink" href="#completions-and-batching" title="Permalink to this headline">¶</a></h2>
<p>All methods that read or modify the state of the system can potentially
be long running.  To handle that, all such methods return a <em>completion</em>
object (a <em>ReadCompletion</em> or a <em>WriteCompletion</em>).  Orchestrator modules
must implement the <em>wait</em> method: this takes a list of completions, and
is responsible for checking if they’re finished, and advancing the underlying
operations as needed.</p>
<p>Each orchestrator module implements its own underlying mechanisms
for completions.  This might involve running the underlying operations
in threads, or batching the operations up before later executing
in one go in the background.  If implementing such a batching pattern, the
module would do no work on any operation until it appeared in a list
of completions passed into <em>wait</em>.</p>
<p><em>WriteCompletion</em> objects have a two-stage execution.  First they become
<em>persistent</em>, meaning that the write has made it to the orchestrator
itself, and been persisted there (e.g. a manifest file has been updated).
If ceph-mgr crashed at this point, the operation would still eventually take
effect.  Second, the completion becomes <em>effective</em>, meaning that the operation has really happened (e.g. a service has actually been started).</p>
<dl class="method">
<dt id="orchestrator.Orchestrator.wait">
<code class="descclassname">Orchestrator.</code><code class="descname">wait</code><span class="sig-paren">(</span><em>completions</em><span class="sig-paren">)</span><a class="headerlink" href="#orchestrator.Orchestrator.wait" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a list of Completion instances, progress any which are
incomplete.  Return a true if everything is done.</p>
<p>Callers should inspect the detail of each completion to identify
partial completion/progress information, and present that information
to the user.</p>
<p>For fast operations (e.g. reading from a database), implementations
may choose to do blocking IO in this call.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">bool</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="orchestrator.ReadCompletion">
<em class="property">class </em><code class="descclassname">orchestrator.</code><code class="descname">ReadCompletion</code><a class="headerlink" href="#orchestrator.ReadCompletion" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> implementations should inherit from this
class to implement their own handles to operations in progress, and
return an instance of their subclass from calls into methods.</p>
</dd></dl>

<dl class="class">
<dt id="orchestrator.WriteCompletion">
<em class="property">class </em><code class="descclassname">orchestrator.</code><code class="descname">WriteCompletion</code><a class="headerlink" href="#orchestrator.WriteCompletion" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> implementations should inherit from this
class to implement their own handles to operations in progress, and
return an instance of their subclass from calls into methods.</p>
</dd></dl>

</div>
<div class="section" id="placement">
<h2>Placement<a class="headerlink" href="#placement" title="Permalink to this headline">¶</a></h2>
<p>In general, stateless services do not require any specific placement
rules, as they can run anywhere that sufficient system resources
are available.  However, some orchestrators may not include the
functionality to choose a location in this way, so we can optionally
specify a location when creating a stateless service.</p>
<p>OSD services generally require a specific placement choice, as this
will determine which storage devices are used.</p>
</div>
<div class="section" id="excluded-functionality">
<h2>Excluded functionality<a class="headerlink" href="#excluded-functionality" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Ceph’s orchestrator interface is not a general purpose framework for
managing linux servers – it is deliberately constrained to manage
the Ceph cluster’s services only.</li>
<li>Multipathed storage is not handled (multipathing is unnecessary for
Ceph clusters).  Each drive is assumed to be visible only on
a single node.</li>
</ul>
</div>
<div class="section" id="host-management">
<h2>Host management<a class="headerlink" href="#host-management" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="orchestrator.Orchestrator.add_host">
<code class="descclassname">Orchestrator.</code><code class="descname">add_host</code><span class="sig-paren">(</span><em>host</em><span class="sig-paren">)</span><a class="headerlink" href="#orchestrator.Orchestrator.add_host" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a host to the orchestrator inventory.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>host</strong> – hostname</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="orchestrator.Orchestrator.remote_host">
<code class="descclassname">Orchestrator.</code><code class="descname">remote_host</code><span class="sig-paren">(</span><em>host</em><span class="sig-paren">)</span><a class="headerlink" href="#orchestrator.Orchestrator.remote_host" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove a host from the orchestrator inventory.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>host</strong> – hostname</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="orchestrator.Orchestrator.get_hosts">
<code class="descclassname">Orchestrator.</code><code class="descname">get_hosts</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#orchestrator.Orchestrator.get_hosts" title="Permalink to this definition">¶</a></dt>
<dd><p>Report the hosts in the cluster.</p>
<p>The default implementation is extra slow.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">list of InventoryNodes</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="inventory-and-status">
<h2>Inventory and status<a class="headerlink" href="#inventory-and-status" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="orchestrator.Orchestrator.get_inventory">
<code class="descclassname">Orchestrator.</code><code class="descname">get_inventory</code><span class="sig-paren">(</span><em>node_filter=None</em><span class="sig-paren">)</span><a class="headerlink" href="#orchestrator.Orchestrator.get_inventory" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns something that was created by <cite>ceph-volume inventory</cite>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">list of InventoryNode</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="orchestrator.InventoryFilter">
<em class="property">class </em><code class="descclassname">orchestrator.</code><code class="descname">InventoryFilter</code><span class="sig-paren">(</span><em>labels=None</em>, <em>nodes=None</em><span class="sig-paren">)</span><a class="headerlink" href="#orchestrator.InventoryFilter" title="Permalink to this definition">¶</a></dt>
<dd><p>When fetching inventory, use this filter to avoid unnecessarily
scanning the whole estate.</p>
<dl class="docutils">
<dt>Typical use: filter by node when presenting UI workflow for configuring</dt>
<dd>a particular server.
filter by label when not all of estate is Ceph servers,
and we want to only learn about the Ceph servers.
filter by label when we are interested particularly
in e.g. OSD servers.</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="orchestrator.InventoryNode">
<em class="property">class </em><code class="descclassname">orchestrator.</code><code class="descname">InventoryNode</code><span class="sig-paren">(</span><em>name</em>, <em>devices</em><span class="sig-paren">)</span><a class="headerlink" href="#orchestrator.InventoryNode" title="Permalink to this definition">¶</a></dt>
<dd><p>When fetching inventory, all Devices are groups inside of an
InventoryNode.</p>
</dd></dl>

<dl class="class">
<dt id="orchestrator.InventoryDevice">
<em class="property">class </em><code class="descclassname">orchestrator.</code><code class="descname">InventoryDevice</code><span class="sig-paren">(</span><em>blank=False</em>, <em>type=None</em>, <em>id=None</em>, <em>size=None</em>, <em>rotates=False</em>, <em>available=False</em>, <em>dev_id=None</em>, <em>extended=None</em>, <em>metadata_space_free=None</em><span class="sig-paren">)</span><a class="headerlink" href="#orchestrator.InventoryDevice" title="Permalink to this definition">¶</a></dt>
<dd><p>When fetching inventory, block devices are reported in this format.</p>
<p>Note on device identifiers: the format of this is up to the orchestrator,
but the same identifier must also work when passed into StatefulServiceSpec.
The identifier should be something meaningful like a device WWID or
stable device node path – not something made up by the orchestrator.</p>
<p>“Extended” is for reporting any special configuration that may have
already been done out of band on the block device.  For example, if
the device has already been configured for encryption, report that
here so that it can be indicated to the user.  The set of
extended properties may differ between orchestrators.  An orchestrator
is permitted to support no extended properties (only normal block
devices)</p>
<dl class="attribute">
<dt id="orchestrator.InventoryDevice.available">
<code class="descname">available</code><em class="property"> = None</em><a class="headerlink" href="#orchestrator.InventoryDevice.available" title="Permalink to this definition">¶</a></dt>
<dd><p>can be used to create a new OSD?</p>
</dd></dl>

<dl class="attribute">
<dt id="orchestrator.InventoryDevice.dev_id">
<code class="descname">dev_id</code><em class="property"> = None</em><a class="headerlink" href="#orchestrator.InventoryDevice.dev_id" title="Permalink to this definition">¶</a></dt>
<dd><p>vendor/model</p>
</dd></dl>

<dl class="attribute">
<dt id="orchestrator.InventoryDevice.extended">
<code class="descname">extended</code><em class="property"> = None</em><a class="headerlink" href="#orchestrator.InventoryDevice.extended" title="Permalink to this definition">¶</a></dt>
<dd><p>arbitrary JSON-serializable object</p>
</dd></dl>

<dl class="attribute">
<dt id="orchestrator.InventoryDevice.id">
<code class="descname">id</code><em class="property"> = None</em><a class="headerlink" href="#orchestrator.InventoryDevice.id" title="Permalink to this definition">¶</a></dt>
<dd><p>unique within a node (or globally if you like).</p>
</dd></dl>

<dl class="method">
<dt id="orchestrator.InventoryDevice.pretty_print">
<code class="descname">pretty_print</code><span class="sig-paren">(</span><em>only_header=False</em><span class="sig-paren">)</span><a class="headerlink" href="#orchestrator.InventoryDevice.pretty_print" title="Permalink to this definition">¶</a></dt>
<dd><p>Print a human friendly line with the information of the device</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>only_header</strong> – Print only the name of the device attributes</td>
</tr>
</tbody>
</table>
<p>Ex:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Device</span> <span class="n">Path</span>           <span class="n">Type</span>       <span class="n">Size</span>    <span class="n">Rotates</span>  <span class="n">Available</span> <span class="n">Model</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sdc</span>            <span class="n">hdd</span>   <span class="mf">50.00</span> <span class="n">GB</span>       <span class="kc">True</span>       <span class="kc">True</span> <span class="n">ATA</span><span class="o">/</span><span class="n">QEMU</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="orchestrator.InventoryDevice.rotates">
<code class="descname">rotates</code><em class="property"> = None</em><a class="headerlink" href="#orchestrator.InventoryDevice.rotates" title="Permalink to this definition">¶</a></dt>
<dd><p>indicates if it is a spinning disk</p>
</dd></dl>

<dl class="attribute">
<dt id="orchestrator.InventoryDevice.size">
<code class="descname">size</code><em class="property"> = None</em><a class="headerlink" href="#orchestrator.InventoryDevice.size" title="Permalink to this definition">¶</a></dt>
<dd><p>byte integer.</p>
</dd></dl>

<dl class="attribute">
<dt id="orchestrator.InventoryDevice.type">
<code class="descname">type</code><em class="property"> = None</em><a class="headerlink" href="#orchestrator.InventoryDevice.type" title="Permalink to this definition">¶</a></dt>
<dd><p>‘ssd’, ‘hdd’, ‘nvme’</p>
</dd></dl>

</dd></dl>

<dl class="method">
<dt id="orchestrator.Orchestrator.describe_service">
<code class="descclassname">Orchestrator.</code><code class="descname">describe_service</code><span class="sig-paren">(</span><em>service_type=None</em>, <em>service_id=None</em>, <em>node_name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#orchestrator.Orchestrator.describe_service" title="Permalink to this definition">¶</a></dt>
<dd><p>Describe a service (of any kind) that is already configured in
the orchestrator.  For example, when viewing an OSD in the dashboard
we might like to also display information about the orchestrator’s
view of the service (like the kubernetes pod ID).</p>
<p>When viewing a CephFS filesystem in the dashboard, we would use this
to display the pods being currently run for MDS daemons.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">list of ServiceDescription objects.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="orchestrator.ServiceDescription">
<em class="property">class </em><code class="descclassname">orchestrator.</code><code class="descname">ServiceDescription</code><a class="headerlink" href="#orchestrator.ServiceDescription" title="Permalink to this definition">¶</a></dt>
<dd><p>For responding to queries about the status of a particular service,
stateful or stateless.</p>
<p>This is not about health or performance monitoring of services: it’s
about letting the orchestrator tell Ceph whether and where a
service is scheduled in the cluster.  When an orchestrator tells
Ceph “it’s running on node123”, that’s not a promise that the process
is literally up this second, it’s a description of where the orchestrator
has decided the service should run.</p>
</dd></dl>

</div>
<div class="section" id="service-actions">
<h2>Service Actions<a class="headerlink" href="#service-actions" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="orchestrator.Orchestrator.service_action">
<code class="descclassname">Orchestrator.</code><code class="descname">service_action</code><span class="sig-paren">(</span><em>action</em>, <em>service_type</em>, <em>service_name=None</em>, <em>service_id=None</em><span class="sig-paren">)</span><a class="headerlink" href="#orchestrator.Orchestrator.service_action" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform an action (start/stop/reload) on a service.</p>
<p>Either service_name or service_id must be specified:</p>
<ul class="simple">
<li>If using service_name, perform the action on that entire logical
service (i.e. all daemons providing that named service).</li>
<li>If using service_id, perform the action on a single specific daemon
instance.</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>action</strong> – one of “start”, “stop”, “reload”</li>
<li><strong>service_type</strong> – e.g. “mds”, “rgw”, …</li>
<li><strong>service_name</strong> – name of logical service (“cephfs”, “us-east”, …)</li>
<li><strong>service_id</strong> – service daemon instance (usually a short hostname)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#orchestrator.WriteCompletion" title="orchestrator.WriteCompletion">WriteCompletion</a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="osd-management">
<h2>OSD management<a class="headerlink" href="#osd-management" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="orchestrator.Orchestrator.create_osds">
<code class="descclassname">Orchestrator.</code><code class="descname">create_osds</code><span class="sig-paren">(</span><em>drive_group</em>, <em>all_hosts</em><span class="sig-paren">)</span><a class="headerlink" href="#orchestrator.Orchestrator.create_osds" title="Permalink to this definition">¶</a></dt>
<dd><p>Create one or more OSDs within a single Drive Group.</p>
<p>The principal argument here is the drive_group member
of OsdSpec: other fields are advisory/extensible for any
finer-grained OSD feature enablement (choice of backing store,
compression/encryption, etc).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>drive_group</strong> – DriveGroupSpec</li>
<li><strong>all_hosts</strong> – TODO, this is required because the orchestrator methods are not composable
Probably this parameter can be easily removed because each orchestrator can use
the “get_inventory” method and the “drive_group.host_pattern” attribute
to obtain the list of hosts where to apply the operation</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="orchestrator.Orchestrator.replace_osds">
<code class="descclassname">Orchestrator.</code><code class="descname">replace_osds</code><span class="sig-paren">(</span><em>drive_group</em><span class="sig-paren">)</span><a class="headerlink" href="#orchestrator.Orchestrator.replace_osds" title="Permalink to this definition">¶</a></dt>
<dd><p>Like create_osds, but the osd_id_claims must be fully
populated.</p>
</dd></dl>

<dl class="method">
<dt id="orchestrator.Orchestrator.remove_osds">
<code class="descclassname">Orchestrator.</code><code class="descname">remove_osds</code><span class="sig-paren">(</span><em>osd_ids</em><span class="sig-paren">)</span><a class="headerlink" href="#orchestrator.Orchestrator.remove_osds" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>osd_ids</strong> – list of OSD IDs</td>
</tr>
</tbody>
</table>
<p>Note that this can only remove OSDs that were successfully
created (i.e. got an OSD ID).</p>
</dd></dl>

<dl class="class">
<dt id="orchestrator.DeviceSelection">
<em class="property">class </em><code class="descclassname">orchestrator.</code><code class="descname">DeviceSelection</code><span class="sig-paren">(</span><em>paths=None</em>, <em>id_model=None</em>, <em>size=None</em>, <em>rotates=None</em>, <em>count=None</em><span class="sig-paren">)</span><a class="headerlink" href="#orchestrator.DeviceSelection" title="Permalink to this definition">¶</a></dt>
<dd><p>Used within <code class="xref py py-class docutils literal notranslate"><span class="pre">myclass.DriveGroupSpec</span></code> to specify the devices
used by the Drive Group.</p>
<p>Any attributes (even none) can be included in the device
specification structure.</p>
<dl class="attribute">
<dt id="orchestrator.DeviceSelection.count">
<code class="descname">count</code><em class="property"> = None</em><a class="headerlink" href="#orchestrator.DeviceSelection.count" title="Permalink to this definition">¶</a></dt>
<dd><p>if this is present limit the number of drives to this number.</p>
</dd></dl>

<dl class="attribute">
<dt id="orchestrator.DeviceSelection.id_model">
<code class="descname">id_model</code><em class="property"> = None</em><a class="headerlink" href="#orchestrator.DeviceSelection.id_model" title="Permalink to this definition">¶</a></dt>
<dd><p>A wildcard string. e.g: “SDD*”</p>
</dd></dl>

<dl class="attribute">
<dt id="orchestrator.DeviceSelection.paths">
<code class="descname">paths</code><em class="property"> = None</em><a class="headerlink" href="#orchestrator.DeviceSelection.paths" title="Permalink to this definition">¶</a></dt>
<dd><p>List of absolute paths to the devices.</p>
</dd></dl>

<dl class="attribute">
<dt id="orchestrator.DeviceSelection.rotates">
<code class="descname">rotates</code><em class="property"> = None</em><a class="headerlink" href="#orchestrator.DeviceSelection.rotates" title="Permalink to this definition">¶</a></dt>
<dd><p>is the drive rotating or not</p>
</dd></dl>

<dl class="attribute">
<dt id="orchestrator.DeviceSelection.size">
<code class="descname">size</code><em class="property"> = None</em><a class="headerlink" href="#orchestrator.DeviceSelection.size" title="Permalink to this definition">¶</a></dt>
<dd><p>Size specification of format LOW:HIGH.
Can also take the the form :HIGH, LOW:
or an exact value (as ceph-volume inventory reports)</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="orchestrator.DriveGroupSpec">
<em class="property">class </em><code class="descclassname">orchestrator.</code><code class="descname">DriveGroupSpec</code><span class="sig-paren">(</span><em>host_pattern</em>, <em>data_devices</em>, <em>db_devices=None</em>, <em>wal_devices=None</em>, <em>journal_devices=None</em>, <em>osds_per_device=None</em>, <em>objectstore='bluestore'</em>, <em>encrypted=False</em>, <em>db_slots=None</em>, <em>wal_slots=None</em><span class="sig-paren">)</span><a class="headerlink" href="#orchestrator.DriveGroupSpec" title="Permalink to this definition">¶</a></dt>
<dd><p>Describe a drive group in the same form that ceph-volume
understands.</p>
<dl class="attribute">
<dt id="orchestrator.DriveGroupSpec.data_devices">
<code class="descname">data_devices</code><em class="property"> = None</em><a class="headerlink" href="#orchestrator.DriveGroupSpec.data_devices" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="#orchestrator.DeviceSelection" title="orchestrator.DeviceSelection"><code class="xref py py-class docutils literal notranslate"><span class="pre">orchestrator.DeviceSelection</span></code></a></p>
</dd></dl>

<dl class="attribute">
<dt id="orchestrator.DriveGroupSpec.db_devices">
<code class="descname">db_devices</code><em class="property"> = None</em><a class="headerlink" href="#orchestrator.DriveGroupSpec.db_devices" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="#orchestrator.DeviceSelection" title="orchestrator.DeviceSelection"><code class="xref py py-class docutils literal notranslate"><span class="pre">orchestrator.DeviceSelection</span></code></a></p>
</dd></dl>

<dl class="attribute">
<dt id="orchestrator.DriveGroupSpec.db_slots">
<code class="descname">db_slots</code><em class="property"> = None</em><a class="headerlink" href="#orchestrator.DriveGroupSpec.db_slots" title="Permalink to this definition">¶</a></dt>
<dd><p>How many OSDs per DB device</p>
</dd></dl>

<dl class="attribute">
<dt id="orchestrator.DriveGroupSpec.encrypted">
<code class="descname">encrypted</code><em class="property"> = None</em><a class="headerlink" href="#orchestrator.DriveGroupSpec.encrypted" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">false</span></code></p>
</dd></dl>

<dl class="attribute">
<dt id="orchestrator.DriveGroupSpec.host_pattern">
<code class="descname">host_pattern</code><em class="property"> = None</em><a class="headerlink" href="#orchestrator.DriveGroupSpec.host_pattern" title="Permalink to this definition">¶</a></dt>
<dd><p>An fnmatch pattern to select hosts. Can also be a single host.</p>
</dd></dl>

<dl class="attribute">
<dt id="orchestrator.DriveGroupSpec.journal_devices">
<code class="descname">journal_devices</code><em class="property"> = None</em><a class="headerlink" href="#orchestrator.DriveGroupSpec.journal_devices" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="#orchestrator.DeviceSelection" title="orchestrator.DeviceSelection"><code class="xref py py-class docutils literal notranslate"><span class="pre">orchestrator.DeviceSelection</span></code></a></p>
</dd></dl>

<dl class="attribute">
<dt id="orchestrator.DriveGroupSpec.objectstore">
<code class="descname">objectstore</code><em class="property"> = None</em><a class="headerlink" href="#orchestrator.DriveGroupSpec.objectstore" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">filestore</span></code> or <code class="docutils literal notranslate"><span class="pre">bluestore</span></code></p>
</dd></dl>

<dl class="attribute">
<dt id="orchestrator.DriveGroupSpec.osd_id_claims">
<code class="descname">osd_id_claims</code><em class="property"> = None</em><a class="headerlink" href="#orchestrator.DriveGroupSpec.osd_id_claims" title="Permalink to this definition">¶</a></dt>
<dd><p>Optional: mapping of drive to OSD ID, used when the
created OSDs are meant to replace previous OSDs on
the same node.</p>
</dd></dl>

<dl class="attribute">
<dt id="orchestrator.DriveGroupSpec.osds_per_device">
<code class="descname">osds_per_device</code><em class="property"> = None</em><a class="headerlink" href="#orchestrator.DriveGroupSpec.osds_per_device" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of osd daemons per “DATA” device.
To fully utilize nvme devices multiple osds are required.</p>
</dd></dl>

<dl class="attribute">
<dt id="orchestrator.DriveGroupSpec.wal_devices">
<code class="descname">wal_devices</code><em class="property"> = None</em><a class="headerlink" href="#orchestrator.DriveGroupSpec.wal_devices" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="#orchestrator.DeviceSelection" title="orchestrator.DeviceSelection"><code class="xref py py-class docutils literal notranslate"><span class="pre">orchestrator.DeviceSelection</span></code></a></p>
</dd></dl>

<dl class="attribute">
<dt id="orchestrator.DriveGroupSpec.wal_slots">
<code class="descname">wal_slots</code><em class="property"> = None</em><a class="headerlink" href="#orchestrator.DriveGroupSpec.wal_slots" title="Permalink to this definition">¶</a></dt>
<dd><p>How many OSDs per WAL device</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="stateless-services">
<h2>Stateless Services<a class="headerlink" href="#stateless-services" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="orchestrator.Orchestrator.add_stateless_service">
<code class="descclassname">Orchestrator.</code><code class="descname">add_stateless_service</code><span class="sig-paren">(</span><em>service_type</em>, <em>spec</em><span class="sig-paren">)</span><a class="headerlink" href="#orchestrator.Orchestrator.add_stateless_service" title="Permalink to this definition">¶</a></dt>
<dd><p>Installing and adding a completely new service to the cluster.</p>
<p>This is not about starting services.</p>
</dd></dl>

<dl class="method">
<dt id="orchestrator.Orchestrator.update_stateless_service">
<code class="descclassname">Orchestrator.</code><code class="descname">update_stateless_service</code><span class="sig-paren">(</span><em>service_type</em>, <em>id_</em>, <em>spec</em><span class="sig-paren">)</span><a class="headerlink" href="#orchestrator.Orchestrator.update_stateless_service" title="Permalink to this definition">¶</a></dt>
<dd><p>This is about changing / redeploying existing services. Like for
example changing the number of service instances.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#orchestrator.WriteCompletion" title="orchestrator.WriteCompletion">WriteCompletion</a></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="orchestrator.Orchestrator.remove_stateless_service">
<code class="descclassname">Orchestrator.</code><code class="descname">remove_stateless_service</code><span class="sig-paren">(</span><em>service_type</em>, <em>id_</em><span class="sig-paren">)</span><a class="headerlink" href="#orchestrator.Orchestrator.remove_stateless_service" title="Permalink to this definition">¶</a></dt>
<dd><p>Uninstalls an existing service from the cluster.</p>
<p>This is not about stopping services.</p>
</dd></dl>

</div>
<div class="section" id="upgrades">
<h2>Upgrades<a class="headerlink" href="#upgrades" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="orchestrator.Orchestrator.upgrade_available">
<code class="descclassname">Orchestrator.</code><code class="descname">upgrade_available</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#orchestrator.Orchestrator.upgrade_available" title="Permalink to this definition">¶</a></dt>
<dd><p>Report on what versions are available to upgrade to</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">List of strings</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="orchestrator.Orchestrator.upgrade_start">
<code class="descclassname">Orchestrator.</code><code class="descname">upgrade_start</code><span class="sig-paren">(</span><em>upgrade_spec</em><span class="sig-paren">)</span><a class="headerlink" href="#orchestrator.Orchestrator.upgrade_start" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="orchestrator.Orchestrator.upgrade_status">
<code class="descclassname">Orchestrator.</code><code class="descname">upgrade_status</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#orchestrator.Orchestrator.upgrade_status" title="Permalink to this definition">¶</a></dt>
<dd><p>If an upgrade is currently underway, report on where
we are in the process, or if some error has occurred.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">UpgradeStatusSpec instance</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="orchestrator.UpgradeSpec">
<em class="property">class </em><code class="descclassname">orchestrator.</code><code class="descname">UpgradeSpec</code><a class="headerlink" href="#orchestrator.UpgradeSpec" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="orchestrator.UpgradeStatusSpec">
<em class="property">class </em><code class="descclassname">orchestrator.</code><code class="descname">UpgradeStatusSpec</code><a class="headerlink" href="#orchestrator.UpgradeStatusSpec" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="utility">
<h2>Utility<a class="headerlink" href="#utility" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="orchestrator.Orchestrator.available">
<code class="descclassname">Orchestrator.</code><code class="descname">available</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#orchestrator.Orchestrator.available" title="Permalink to this definition">¶</a></dt>
<dd><p>Report whether we can talk to the orchestrator.  This is the
place to give the user a meaningful message if the orchestrator
isn’t running or can’t be contacted.</p>
<p>This method may be called frequently (e.g. every page load
to conditionally display a warning banner), so make sure it’s
not too expensive.  It’s okay to give a slightly stale status
(e.g. based on a periodic background ping of the orchestrator)
if that’s necessary to make this method fast.</p>
<p>Do not override this method if you don’t have a meaningful
status to return: the default None, None return value is used
to indicate that a module is unable to indicate its availability.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">two-tuple of boolean, string</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>



          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../start/intro/">Intro to Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../start/">Installation (ceph-deploy)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/">Installation (Manual)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../start/kube-helm/">Installation (Kubernetes + Helm)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rados/">Ceph Storage Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cephfs/">Ceph Filesystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rbd/">Ceph Block Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../radosgw/">Ceph Object Gateway</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">Ceph Manager Daemon</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../administrator/">Installation and Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins/">Writing plugins</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Writing orchestrator plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#glossary">Glossary</a></li>
<li class="toctree-l3"><a class="reference internal" href="#key-concepts">Key Concepts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#completions-and-batching">Completions and batching</a></li>
<li class="toctree-l3"><a class="reference internal" href="#placement">Placement</a></li>
<li class="toctree-l3"><a class="reference internal" href="#excluded-functionality">Excluded functionality</a></li>
<li class="toctree-l3"><a class="reference internal" href="#host-management">Host management</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inventory-and-status">Inventory and status</a></li>
<li class="toctree-l3"><a class="reference internal" href="#service-actions">Service Actions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#osd-management">OSD management</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stateless-services">Stateless Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="#upgrades">Upgrades</a></li>
<li class="toctree-l3"><a class="reference internal" href="#utility">Utility</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dashboard/">Dashboard plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../diskprediction/">DiskPrediction plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../localpool/">Local pool plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../restful/">RESTful plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../zabbix/">Zabbix plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../prometheus/">Prometheus plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../influx/">Influx plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hello/">Hello plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../telegraf/">Telegraf plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../telemetry/">Telemetry plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iostat/">Iostat plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../crash/">Crash plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../orchestrator_cli/">Orchestrator CLI plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rook/">Rook plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deepsea/">DeepSea plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../insights/">Insights plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ansible/">Ansible plugin</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture/">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/internals/">Ceph Internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../governance/">Governance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ceph-volume/">ceph-volume</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/">Ceph Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary/">Glossary</a></li>
</ul>


<!-- ugly kludge to make genindex look like it's part of the toc -->
<ul style="margin-top: -10px"><li class="toctree-l1"><a class="reference internal" href="../../genindex/">Index</a></li></ul>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../dashboard/" title="Ceph Manager Dashboard"
             >next</a> |</li>
        <li class="right" >
          <a href="../plugins/" title="ceph-mgr module developer’s guide"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">Ceph Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../" >Ceph Manager Daemon</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Red Hat, Inc, and contributors. Licensed under Creative Commons Attribution Share Alike 3.0 (CC-BY-SA-3.0).
    </div>
  </body>
</html>