
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Orchestrator CLI &#8212; Ceph Documentation</title>
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/js/ceph.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="OSD Service Specification" href="../../cephadm/drivegroups/" />
    <link rel="prev" title="Cephadm Operations" href="../../cephadm/operations/" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../cephadm/drivegroups/" title="OSD Service Specification"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../../cephadm/operations/" title="Cephadm Operations"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">Ceph Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../cephadm/" accesskey="U">Cephadm</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            

<div id="dev-warning" class="admonition note" style="display:none;">
  <p class="first admonition-title">Notice</p>
  <p class="last">This document is for a development version of Ceph.</p>
</div>

<div id="eol-warning" class="admonition warning" style="display:none;">
  <p class="first admonition-title">Warning</p>
  <p class="last">This document is for an unsupported version of Ceph.</p>
</div>
  <div id="docubetter" align="right" style="display:none; padding: 15px; font-weight: bold;">
    <a id="edit-on-github" href="https://github.com/ceph/ceph/edit/master/doc/mgr/orchestrator.rst" rel="nofollow">Edit on GitHub</a> | <a href="https://pad.ceph.com/p/Report_Documentation_Bugs">Report a Documentation Bug</a>
  </div>

  
  <div class="section" id="orchestrator-cli">
<span id="orchestrator-cli-module"></span><h1>Orchestrator CLI<a class="headerlink" href="#orchestrator-cli" title="Permalink to this headline">¶</a></h1>
<p>This module provides a command line interface (CLI) to orchestrator
modules (ceph-mgr modules which interface with external orchestration services).</p>
<p>As the orchestrator CLI unifies different external orchestrators, a common nomenclature
for the orchestrator module is needed.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 49%" />
<col style="width: 51%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><em>host</em></p></td>
<td><p>hostname (not DNS name) of the
physical host. Not the podname,
container name, or hostname inside
the container.</p></td>
</tr>
<tr class="row-even"><td><p><em>service type</em></p></td>
<td><p>The type of the service. e.g., nfs,
mds, osd, mon, rgw, mgr, iscsi</p></td>
</tr>
<tr class="row-odd"><td><p><em>service</em></p></td>
<td><p>A logical service, Typically
comprised of multiple service
instances on multiple hosts for HA</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fs_name</span></code> for mds type</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rgw_zone</span></code> for rgw type</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ganesha_cluster_id</span></code> for nfs type</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p><em>daemon</em></p></td>
<td><p>A single instance of a service.
Usually a daemon, but maybe not
(e.g., might be a kernel service
like LIO or knfsd or whatever)</p>
<p>This identifier should
uniquely identify the instance</p>
</td>
</tr>
</tbody>
</table>
<p>The relation between the names is the following:</p>
<ul class="simple">
<li><p>A <em>service</em> has a specfic <em>service type</em></p></li>
<li><p>A <em>daemon</em> is a physical instance of a <em>service type</em></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Orchestrator modules may only implement a subset of the commands listed below.
Also, the implementation of the commands are orchestrator module dependent and will
differ between implementations.</p>
</div>
<div class="section" id="status">
<h2>Status<a class="headerlink" href="#status" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">orch</span> <span class="n">status</span>
</pre></div>
</div>
<p>Show current orchestrator mode and high-level status (whether the module able
to talk to it)</p>
<p>Also show any in-progress actions.</p>
</div>
<div class="section" id="host-management">
<h2>Host Management<a class="headerlink" href="#host-management" title="Permalink to this headline">¶</a></h2>
<p>List hosts associated with the cluster:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">orch</span> <span class="n">host</span> <span class="n">ls</span>
</pre></div>
</div>
<p>Add and remove hosts:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">orch</span> <span class="n">host</span> <span class="n">add</span> <span class="o">&lt;</span><span class="n">hostname</span><span class="o">&gt;</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">addr</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">labels</span><span class="o">&gt;...</span><span class="p">]</span>
<span class="n">ceph</span> <span class="n">orch</span> <span class="n">host</span> <span class="n">rm</span> <span class="o">&lt;</span><span class="n">hostname</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For cephadm, see also <a class="reference internal" href="../../cephadm/concepts/#cephadm-fqdn"><span class="std std-ref">全资域名 vs 裸主机名</span></a>.</p>
<div class="section" id="host-specification">
<h3>Host Specification<a class="headerlink" href="#host-specification" title="Permalink to this headline">¶</a></h3>
<p>Many hosts can be added at once using
<code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">orch</span> <span class="pre">apply</span> <span class="pre">-i</span></code> by submitting a multi-document YAML file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">service_type</span><span class="p">:</span> <span class="n">host</span>
<span class="n">addr</span><span class="p">:</span> <span class="n">node</span><span class="o">-</span><span class="mi">00</span>
<span class="n">hostname</span><span class="p">:</span> <span class="n">node</span><span class="o">-</span><span class="mi">00</span>
<span class="n">labels</span><span class="p">:</span>
<span class="o">-</span> <span class="n">example1</span>
<span class="o">-</span> <span class="n">example2</span>
<span class="o">---</span>
<span class="n">service_type</span><span class="p">:</span> <span class="n">host</span>
<span class="n">addr</span><span class="p">:</span> <span class="n">node</span><span class="o">-</span><span class="mi">01</span>
<span class="n">hostname</span><span class="p">:</span> <span class="n">node</span><span class="o">-</span><span class="mi">01</span>
<span class="n">labels</span><span class="p">:</span>
<span class="o">-</span> <span class="n">grafana</span>
<span class="o">---</span>
<span class="n">service_type</span><span class="p">:</span> <span class="n">host</span>
<span class="n">addr</span><span class="p">:</span> <span class="n">node</span><span class="o">-</span><span class="mi">02</span>
<span class="n">hostname</span><span class="p">:</span> <span class="n">node</span><span class="o">-</span><span class="mi">02</span>
</pre></div>
</div>
<p>This can be combined with service specifications (below) to create a cluster spec file to deploy a whole cluster in one command.  see <code class="docutils literal notranslate"><span class="pre">cephadm</span> <span class="pre">bootstrap</span> <span class="pre">--apply-spec</span></code> also to do this during bootstrap. Cluster SSH Keys must be copied to hosts prior.</p>
</div>
</div>
<div class="section" id="osd-management">
<h2>OSD Management<a class="headerlink" href="#osd-management" title="Permalink to this headline">¶</a></h2>
<div class="section" id="list-devices">
<h3>List Devices<a class="headerlink" href="#list-devices" title="Permalink to this headline">¶</a></h3>
<p>Print a list of discovered devices, grouped by host and optionally
filtered to a particular host:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">orch</span> <span class="n">device</span> <span class="n">ls</span> <span class="p">[</span><span class="o">--</span><span class="n">host</span><span class="o">=...</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">refresh</span><span class="p">]</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">HOST</span>    <span class="n">PATH</span>      <span class="n">TYPE</span>   <span class="n">SIZE</span>  <span class="n">DEVICE</span>  <span class="n">AVAIL</span>  <span class="n">REJECT</span> <span class="n">REASONS</span>
<span class="n">master</span>  <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vda</span>  <span class="n">hdd</span>   <span class="mf">42.0</span><span class="n">G</span>          <span class="kc">False</span>  <span class="n">locked</span>
<span class="n">node1</span>   <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vda</span>  <span class="n">hdd</span>   <span class="mf">42.0</span><span class="n">G</span>          <span class="kc">False</span>  <span class="n">locked</span>
<span class="n">node1</span>   <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vdb</span>  <span class="n">hdd</span>   <span class="mi">8192</span><span class="n">M</span>  <span class="mi">387836</span>  <span class="kc">False</span>  <span class="n">locked</span><span class="p">,</span> <span class="n">LVM</span> <span class="n">detected</span><span class="p">,</span> <span class="n">Insufficient</span> <span class="n">space</span> <span class="p">(</span><span class="o">&lt;</span><span class="mi">5</span><span class="n">GB</span><span class="p">)</span> <span class="n">on</span> <span class="n">vgs</span>
<span class="n">node1</span>   <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vdc</span>  <span class="n">hdd</span>   <span class="mi">8192</span><span class="n">M</span>  <span class="mi">450575</span>  <span class="kc">False</span>  <span class="n">locked</span><span class="p">,</span> <span class="n">LVM</span> <span class="n">detected</span><span class="p">,</span> <span class="n">Insufficient</span> <span class="n">space</span> <span class="p">(</span><span class="o">&lt;</span><span class="mi">5</span><span class="n">GB</span><span class="p">)</span> <span class="n">on</span> <span class="n">vgs</span>
<span class="n">node3</span>   <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vda</span>  <span class="n">hdd</span>   <span class="mf">42.0</span><span class="n">G</span>          <span class="kc">False</span>  <span class="n">locked</span>
<span class="n">node3</span>   <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vdb</span>  <span class="n">hdd</span>   <span class="mi">8192</span><span class="n">M</span>  <span class="mi">395145</span>  <span class="kc">False</span>  <span class="n">LVM</span> <span class="n">detected</span><span class="p">,</span> <span class="n">locked</span><span class="p">,</span> <span class="n">Insufficient</span> <span class="n">space</span> <span class="p">(</span><span class="o">&lt;</span><span class="mi">5</span><span class="n">GB</span><span class="p">)</span> <span class="n">on</span> <span class="n">vgs</span>
<span class="n">node3</span>   <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vdc</span>  <span class="n">hdd</span>   <span class="mi">8192</span><span class="n">M</span>  <span class="mi">165562</span>  <span class="kc">False</span>  <span class="n">LVM</span> <span class="n">detected</span><span class="p">,</span> <span class="n">locked</span><span class="p">,</span> <span class="n">Insufficient</span> <span class="n">space</span> <span class="p">(</span><span class="o">&lt;</span><span class="mi">5</span><span class="n">GB</span><span class="p">)</span> <span class="n">on</span> <span class="n">vgs</span>
<span class="n">node2</span>   <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vda</span>  <span class="n">hdd</span>   <span class="mf">42.0</span><span class="n">G</span>          <span class="kc">False</span>  <span class="n">locked</span>
<span class="n">node2</span>   <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vdb</span>  <span class="n">hdd</span>   <span class="mi">8192</span><span class="n">M</span>  <span class="mi">672147</span>  <span class="kc">False</span>  <span class="n">LVM</span> <span class="n">detected</span><span class="p">,</span> <span class="n">Insufficient</span> <span class="n">space</span> <span class="p">(</span><span class="o">&lt;</span><span class="mi">5</span><span class="n">GB</span><span class="p">)</span> <span class="n">on</span> <span class="n">vgs</span><span class="p">,</span> <span class="n">locked</span>
<span class="n">node2</span>   <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vdc</span>  <span class="n">hdd</span>   <span class="mi">8192</span><span class="n">M</span>  <span class="mi">228094</span>  <span class="kc">False</span>  <span class="n">LVM</span> <span class="n">detected</span><span class="p">,</span> <span class="n">Insufficient</span> <span class="n">space</span> <span class="p">(</span><span class="o">&lt;</span><span class="mi">5</span><span class="n">GB</span><span class="p">)</span> <span class="n">on</span> <span class="n">vgs</span><span class="p">,</span> <span class="n">locked</span>
</pre></div>
</div>
</div>
<div class="section" id="erase-devices-zap-devices">
<h3>Erase Devices (Zap Devices)<a class="headerlink" href="#erase-devices-zap-devices" title="Permalink to this headline">¶</a></h3>
<p>Erase (zap) a device so that it can be resued. <code class="docutils literal notranslate"><span class="pre">zap</span></code> calls <code class="docutils literal notranslate"><span class="pre">ceph-volume</span> <span class="pre">zap</span></code> on the remote host.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">orch</span> <span class="n">device</span> <span class="n">zap</span> <span class="o">&lt;</span><span class="n">hostname</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">path</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Example command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">orch</span> <span class="n">device</span> <span class="n">zap</span> <span class="n">my_hostname</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sdx</span>
</pre></div>
</div>
</div>
<div class="section" id="create-osds">
<h3>Create OSDs<a class="headerlink" href="#create-osds" title="Permalink to this headline">¶</a></h3>
<p>Create OSDs on a group of devices on a single host:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">orch</span> <span class="n">daemon</span> <span class="n">add</span> <span class="n">osd</span> <span class="o">&lt;</span><span class="n">host</span><span class="o">&gt;</span><span class="p">:</span><span class="n">device1</span><span class="p">,</span><span class="n">device2</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">orch</span> <span class="n">apply</span> <span class="n">osd</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">json_file</span><span class="o">/</span><span class="n">yaml_file</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">orch</span> <span class="n">apply</span> <span class="n">osd</span> <span class="o">--</span><span class="nb">all</span><span class="o">-</span><span class="n">available</span><span class="o">-</span><span class="n">devices</span>
</pre></div>
</div>
<p>For a more in-depth guide to DriveGroups please refer to <a class="reference internal" href="../../cephadm/drivegroups/#drivegroups"><span class="std std-ref">OSD Service Specification</span></a></p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ceph orch daemon add osd node1:/dev/vdd</span>
<span class="n">Created</span> <span class="n">osd</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="mi">6</span> <span class="n">on</span> <span class="n">host</span> <span class="s1">&#39;node1&#39;</span>
</pre></div>
</div>
<p>If the ‘apply’ method is used. You will be presented with a preview of what will happen.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ceph orch apply osd --all-available-devices</span>
<span class="n">NAME</span>                  <span class="n">HOST</span>  <span class="n">DATA</span>     <span class="n">DB</span> <span class="n">WAL</span>
<span class="nb">all</span><span class="o">-</span><span class="n">available</span><span class="o">-</span><span class="n">devices</span> <span class="n">node1</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vdb</span> <span class="o">-</span>  <span class="o">-</span>
<span class="nb">all</span><span class="o">-</span><span class="n">available</span><span class="o">-</span><span class="n">devices</span> <span class="n">node2</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vdc</span> <span class="o">-</span>  <span class="o">-</span>
<span class="nb">all</span><span class="o">-</span><span class="n">available</span><span class="o">-</span><span class="n">devices</span> <span class="n">node3</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vdd</span> <span class="o">-</span>  <span class="o">-</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Output form Cephadm orchestrator</p>
</div>
</div>
<div class="section" id="remove-an-osd">
<h3>Remove an OSD<a class="headerlink" href="#remove-an-osd" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">orch</span> <span class="n">osd</span> <span class="n">rm</span> <span class="o">&lt;</span><span class="n">svc_id</span><span class="o">&gt;...</span> <span class="p">[</span><span class="o">--</span><span class="n">replace</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">force</span><span class="p">]</span>
</pre></div>
</div>
<p>Removes one or more OSDs from the cluster.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ceph orch osd rm 4</span>
<span class="n">Scheduled</span> <span class="n">OSD</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">removal</span>
</pre></div>
</div>
<p>OSDs that are not safe-to-destroy will be rejected.</p>
<p>You can query the state of the operation with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ceph orch osd rm status</span>
<span class="n">NAME</span>  <span class="n">HOST</span>  <span class="n">PGS</span> <span class="n">STARTED_AT</span>
<span class="n">osd</span><span class="o">.</span><span class="mi">7</span> <span class="n">node1</span> <span class="mi">55</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">22</span> <span class="mi">19</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">38.785761</span>
<span class="n">osd</span><span class="o">.</span><span class="mi">5</span> <span class="n">node3</span> <span class="mi">3</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">22</span> <span class="mi">19</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">34.201685</span>
<span class="n">osd</span><span class="o">.</span><span class="mi">3</span> <span class="n">node2</span> <span class="mi">0</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">22</span> <span class="mi">19</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">34.201695</span>
</pre></div>
</div>
<p>When no PGs are left on the osd, it will be decommissioned and removed from the cluster.</p>
</div>
<div class="section" id="replace-an-osd">
<h3>Replace an OSD<a class="headerlink" href="#replace-an-osd" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">orch</span> <span class="n">osd</span> <span class="n">rm</span> <span class="o">&lt;</span><span class="n">svc_id</span><span class="o">&gt;...</span> <span class="o">--</span><span class="n">replace</span> <span class="p">[</span><span class="o">--</span><span class="n">force</span><span class="p">]</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ceph orch osd rm 4 --replace</span>
<span class="n">Scheduled</span> <span class="n">OSD</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">replacement</span>
</pre></div>
</div>
<p>This follows the same procedure as the “Remove OSD” part with the exception that the OSD is not permanently removed
from the crush hierarchy, but is assigned a ‘destroyed’ flag.</p>
<p><strong>Preserving the OSD ID</strong></p>
<p>The previously set the ‘destroyed’ flag is used to determined osd ids that will be reused in the next osd deployment.</p>
<p>If you use OSDSpecs for osd deployment, your newly added disks will be assigned with the osd ids of their replaced
counterpart, granted the new disk still match the OSDSpecs.</p>
<p>For assistance in this process you can use the ‘preview’ feature:</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">orch</span> <span class="n">apply</span> <span class="n">osd</span> <span class="o">--</span><span class="n">service</span><span class="o">-</span><span class="n">name</span> <span class="o">&lt;</span><span class="n">name_of_osd_spec</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">preview</span>
<span class="n">NAME</span>                  <span class="n">HOST</span>  <span class="n">DATA</span>     <span class="n">DB</span> <span class="n">WAL</span>
<span class="o">&lt;</span><span class="n">name_of_osd_spec</span><span class="o">&gt;</span>    <span class="n">node1</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vdb</span> <span class="o">-</span>  <span class="o">-</span>
</pre></div>
</div>
<p>Tip: The name of your OSDSpec can be retrieved from <strong>ceph orch ls</strong></p>
<p>Alternatively, you can use your OSDSpec file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">orch</span> <span class="n">apply</span> <span class="n">osd</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">osd_spec_file</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">preview</span>
<span class="n">NAME</span>                  <span class="n">HOST</span>  <span class="n">DATA</span>     <span class="n">DB</span> <span class="n">WAL</span>
<span class="o">&lt;</span><span class="n">name_of_osd_spec</span><span class="o">&gt;</span>    <span class="n">node1</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vdb</span> <span class="o">-</span>  <span class="o">-</span>
</pre></div>
</div>
<p>If this matches your anticipated behavior, just omit the –preview flag to execute the deployment.</p>
</div>
</div>
<div class="section" id="monitor-and-manager-management">
<h2>Monitor and manager management<a class="headerlink" href="#monitor-and-manager-management" title="Permalink to this headline">¶</a></h2>
<p>Creates or removes MONs or MGRs from the cluster. Orchestrator may return an
error if it doesn’t know how to do this transition.</p>
<p>Update the number of monitor hosts:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">orch</span> <span class="n">apply</span> <span class="n">mon</span> <span class="o">&lt;</span><span class="n">num</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">host</span><span class="p">,</span> <span class="n">host</span><span class="p">:</span><span class="n">network</span><span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<p>Each host can optionally specify a network for the monitor to listen on.</p>
<p>Update the number of manager hosts:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">orch</span> <span class="n">apply</span> <span class="n">mgr</span> <span class="o">&lt;</span><span class="n">num</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">host</span><span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="service-status">
<h2>Service Status<a class="headerlink" href="#service-status" title="Permalink to this headline">¶</a></h2>
<p>Print a list of services known to the orchestrator. The list can be limited to
services on a particular host with the optional –host parameter and/or
services of a particular type via optional –type parameter
(mon, osd, mgr, mds, rgw):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">orch</span> <span class="n">ls</span> <span class="p">[</span><span class="o">--</span><span class="n">service_type</span> <span class="nb">type</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">service_name</span> <span class="n">name</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">export</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="nb">format</span> <span class="n">f</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">refresh</span><span class="p">]</span>
</pre></div>
</div>
<p>Discover the status of a particular service or daemons:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">orch</span> <span class="n">ls</span> <span class="o">--</span><span class="n">service_type</span> <span class="nb">type</span> <span class="o">--</span><span class="n">service_name</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span> <span class="p">[</span><span class="o">--</span><span class="n">refresh</span><span class="p">]</span>
</pre></div>
</div>
<p>Export the service specs known to the orchestrator as yaml in format
that is compatible to <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">orch</span> <span class="pre">apply</span> <span class="pre">-i</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">orch</span> <span class="n">ls</span> <span class="o">--</span><span class="n">export</span>
</pre></div>
</div>
</div>
<div class="section" id="daemon-status">
<h2>Daemon Status<a class="headerlink" href="#daemon-status" title="Permalink to this headline">¶</a></h2>
<p>Print a list of all daemons known to the orchestrator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">orch</span> <span class="n">ps</span> <span class="p">[</span><span class="o">--</span><span class="n">hostname</span> <span class="n">host</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">daemon_type</span> <span class="nb">type</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">service_name</span> <span class="n">name</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">daemon_id</span> <span class="nb">id</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="nb">format</span> <span class="n">f</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">refresh</span><span class="p">]</span>
</pre></div>
</div>
<p>Query the status of a particular service instance (mon, osd, mds, rgw).  For OSDs
the id is the numeric OSD ID, for MDS services it is the file system name:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">orch</span> <span class="n">ps</span> <span class="o">--</span><span class="n">daemon_type</span> <span class="n">osd</span> <span class="o">--</span><span class="n">daemon_id</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="depoying-cephfs">
<span id="orchestrator-cli-cephfs"></span><h2>Depoying CephFS<a class="headerlink" href="#depoying-cephfs" title="Permalink to this headline">¶</a></h2>
<p>In order to set up a <a class="reference internal" href="../../glossary/#term-cephfs"><span class="xref std std-term">CephFS</span></a>, execute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">fs</span> <span class="n">volume</span> <span class="n">create</span> <span class="o">&lt;</span><span class="n">fs_name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">placement</span> <span class="n">spec</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">name</span></code> is the name of the CephFS, <code class="docutils literal notranslate"><span class="pre">placement</span></code> is a
<a class="reference internal" href="#orchestrator-cli-placement-spec"><span class="std std-ref">Placement Specification</span></a>.</p>
<p>This command will create the required Ceph pools, create the new
CephFS, and deploy mds servers.</p>
</div>
<div class="section" id="stateless-services-mds-rgw-nfs-rbd-mirror-iscsi">
<h2>Stateless services (MDS/RGW/NFS/rbd-mirror/iSCSI)<a class="headerlink" href="#stateless-services-mds-rgw-nfs-rbd-mirror-iscsi" title="Permalink to this headline">¶</a></h2>
<p>The orchestrator is not responsible for configuring the services. Please look into the corresponding
documentation for details.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">name</span></code> parameter is an identifier of the group of instances:</p>
<ul class="simple">
<li><p>a CephFS file system for a group of MDS daemons,</p></li>
<li><p>a zone name for a group of RGWs</p></li>
</ul>
<p>Creating/growing/shrinking/removing services:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">orch</span> <span class="n">apply</span> <span class="n">mds</span> <span class="o">&lt;</span><span class="n">fs_name</span><span class="o">&gt;</span> <span class="p">[</span><span class="o">--</span><span class="n">placement</span><span class="o">=&lt;</span><span class="n">placement</span><span class="o">&gt;</span><span class="p">]</span>
<span class="n">ceph</span> <span class="n">orch</span> <span class="n">apply</span> <span class="n">rgw</span> <span class="o">&lt;</span><span class="n">realm</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">zone</span><span class="o">&gt;</span> <span class="p">[</span><span class="o">--</span><span class="n">subcluster</span><span class="o">=&lt;</span><span class="n">subcluster</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">port</span><span class="o">=&lt;</span><span class="n">port</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">ssl</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">placement</span><span class="o">=&lt;</span><span class="n">placement</span><span class="o">&gt;</span><span class="p">]</span>
<span class="n">ceph</span> <span class="n">orch</span> <span class="n">apply</span> <span class="n">nfs</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">pool</span><span class="o">&gt;</span> <span class="p">[</span><span class="o">--</span><span class="n">namespace</span><span class="o">=&lt;</span><span class="n">namespace</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">placement</span><span class="o">=&lt;</span><span class="n">placement</span><span class="o">&gt;</span><span class="p">]</span>
<span class="n">ceph</span> <span class="n">orch</span> <span class="n">rm</span> <span class="o">&lt;</span><span class="n">service_name</span><span class="o">&gt;</span> <span class="p">[</span><span class="o">--</span><span class="n">force</span><span class="p">]</span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">placement</span></code> is a <a class="reference internal" href="#orchestrator-cli-placement-spec"><span class="std std-ref">Placement Specification</span></a>.</p>
<p>e.g., <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">orch</span> <span class="pre">apply</span> <span class="pre">mds</span> <span class="pre">myfs</span> <span class="pre">--placement=&quot;3</span> <span class="pre">host1</span> <span class="pre">host2</span> <span class="pre">host3&quot;</span></code></p>
<p>Service Commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">orch</span> <span class="o">&lt;</span><span class="n">start</span><span class="o">|</span><span class="n">stop</span><span class="o">|</span><span class="n">restart</span><span class="o">|</span><span class="n">redeploy</span><span class="o">|</span><span class="n">reconfig</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">service_name</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="service-specification">
<span id="orchestrator-cli-service-spec"></span><h2>Service Specification<a class="headerlink" href="#service-specification" title="Permalink to this headline">¶</a></h2>
<p>As <em>Service Specification</em> is a data structure often represented as YAML
to specify the deployment of services. For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">service_type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rgw</span>
<span class="nt">service_id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">realm.zone</span>
<span class="nt">placement</span><span class="p">:</span>
  <span class="nt">hosts</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">host1</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">host2</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">host3</span>
<span class="nt">spec</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nt">unmanaged</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>
</div>
<p>Where the properties of a service specification are the following:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">service_type</span></code> is the type of the service. Needs to be either a Ceph</dt><dd><p>service (<code class="docutils literal notranslate"><span class="pre">mon</span></code>, <code class="docutils literal notranslate"><span class="pre">crash</span></code>, <code class="docutils literal notranslate"><span class="pre">mds</span></code>, <code class="docutils literal notranslate"><span class="pre">mgr</span></code>, <code class="docutils literal notranslate"><span class="pre">osd</span></code> or
<code class="docutils literal notranslate"><span class="pre">rbd-mirror</span></code>), a gateway (<code class="docutils literal notranslate"><span class="pre">nfs</span></code> or <code class="docutils literal notranslate"><span class="pre">rgw</span></code>), or part of the
monitoring stack (<code class="docutils literal notranslate"><span class="pre">alertmanager</span></code>, <code class="docutils literal notranslate"><span class="pre">grafana</span></code>, <code class="docutils literal notranslate"><span class="pre">node-exporter</span></code> or
<code class="docutils literal notranslate"><span class="pre">prometheus</span></code>).</p>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">service_id</span></code> is the name of the service. Omit the service time</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">placement</span></code> is a <a class="reference internal" href="#orchestrator-cli-placement-spec"><span class="std std-ref">Placement Specification</span></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spec</span></code>: additional specifications for a specific service.</p></li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">unmanaged</span></code>: If set to <code class="docutils literal notranslate"><span class="pre">true</span></code>, the orchestrator will not deploy nor</dt><dd><p>remove any daemon associated with this service. Placement and all other
properties will be ignored. This is useful, if this service should not
be managed temporarily.</p>
</dd>
</dl>
</li>
</ul>
<p>Each service type can have different requirements for the spec.</p>
<p>Service specifications of type <code class="docutils literal notranslate"><span class="pre">mon</span></code>, <code class="docutils literal notranslate"><span class="pre">mgr</span></code>, and the monitoring
types do not require a <code class="docutils literal notranslate"><span class="pre">service_id</span></code></p>
<p>A service of type <code class="docutils literal notranslate"><span class="pre">nfs</span></code> requires a pool name and contain
an optional namespace:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">service_type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nfs</span>
<span class="nt">service_id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mynfs</span>
<span class="nt">placement</span><span class="p">:</span>
  <span class="nt">hosts</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">host1</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">host2</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">pool</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mypool</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mynamespace</span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">pool</span></code> is a RADOS pool where NFS client recovery data is stored
and <code class="docutils literal notranslate"><span class="pre">namespace</span></code> is a RADOS namespace where NFS client recovery
data is stored in the pool.</p>
<p>A service of type <code class="docutils literal notranslate"><span class="pre">osd</span></code> is in detail described in <a class="reference internal" href="../../cephadm/drivegroups/#drivegroups"><span class="std std-ref">OSD Service Specification</span></a></p>
<p>Many service specifications can then be applied at once using
<code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">orch</span> <span class="pre">apply</span> <span class="pre">-i</span></code> by submitting a multi-document YAML file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">&lt;&lt;</span><span class="n">EOF</span> <span class="o">|</span> <span class="n">ceph</span> <span class="n">orch</span> <span class="n">apply</span> <span class="o">-</span><span class="n">i</span> <span class="o">-</span>
<span class="n">service_type</span><span class="p">:</span> <span class="n">mon</span>
<span class="n">placement</span><span class="p">:</span>
  <span class="n">host_pattern</span><span class="p">:</span> <span class="s2">&quot;mon*&quot;</span>
<span class="o">---</span>
<span class="n">service_type</span><span class="p">:</span> <span class="n">mgr</span>
<span class="n">placement</span><span class="p">:</span>
  <span class="n">host_pattern</span><span class="p">:</span> <span class="s2">&quot;mgr*&quot;</span>
<span class="o">---</span>
<span class="n">service_type</span><span class="p">:</span> <span class="n">osd</span>
<span class="n">placement</span><span class="p">:</span>
  <span class="n">host_pattern</span><span class="p">:</span> <span class="s2">&quot;osd*&quot;</span>
<span class="n">data_devices</span><span class="p">:</span>
  <span class="nb">all</span><span class="p">:</span> <span class="n">true</span>
<span class="n">EOF</span>
</pre></div>
</div>
</div>
<div class="section" id="placement-specification">
<span id="orchestrator-cli-placement-spec"></span><h2>Placement Specification<a class="headerlink" href="#placement-specification" title="Permalink to this headline">¶</a></h2>
<p>In order to allow the orchestrator to deploy a <em>service</em>, it needs to
know how many and where it should deploy <em>daemons</em>. The orchestrator
defines a placement specification that can either be passed as a command line argument.</p>
<div class="section" id="explicit-placements">
<h3>Explicit placements<a class="headerlink" href="#explicit-placements" title="Permalink to this headline">¶</a></h3>
<p>Daemons can be explictly placed on hosts by simply specifying them:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">orch</span> <span class="n">apply</span> <span class="n">prometheus</span> <span class="s2">&quot;host1 host2 host3&quot;</span>
</pre></div>
</div>
<p>Or in yaml:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">service_type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">prometheus</span>
<span class="nt">placement</span><span class="p">:</span>
  <span class="nt">hosts</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">host1</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">host2</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">host3</span>
</pre></div>
</div>
<p>MONs and other services may require some enhanced network specifications:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">orch</span> <span class="n">daemon</span> <span class="n">add</span> <span class="n">mon</span> <span class="n">myhost</span><span class="p">:[</span><span class="n">v2</span><span class="p">:</span><span class="mf">1.2</span><span class="o">.</span><span class="mf">3.4</span><span class="p">:</span><span class="mi">3000</span><span class="p">,</span><span class="n">v1</span><span class="p">:</span><span class="mf">1.2</span><span class="o">.</span><span class="mf">3.4</span><span class="p">:</span><span class="mi">6789</span><span class="p">]</span><span class="o">=</span><span class="n">name</span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">[v2:1.2.3.4:3000,v1:1.2.3.4:6789]</span></code> is the network address of the monitor
and <code class="docutils literal notranslate"><span class="pre">=name</span></code> specifies the name of the new monitor.</p>
</div>
<div class="section" id="placement-by-labels">
<h3>Placement by labels<a class="headerlink" href="#placement-by-labels" title="Permalink to this headline">¶</a></h3>
<p>Daemons can be explictly placed on hosts that match a specifc label:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">orch</span> <span class="n">apply</span> <span class="n">prometheus</span> <span class="n">label</span><span class="p">:</span><span class="n">mylabel</span>
</pre></div>
</div>
<p>Or in yaml:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">service_type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">prometheus</span>
<span class="nt">placement</span><span class="p">:</span>
  <span class="nt">label</span><span class="p">:</span> <span class="s">&quot;mylabel&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="placement-by-pattern-matching">
<h3>Placement by pattern matching<a class="headerlink" href="#placement-by-pattern-matching" title="Permalink to this headline">¶</a></h3>
<p>Daemons can be placed on hosts as well:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">orch</span> <span class="n">apply</span> <span class="n">prometheus</span> <span class="s1">&#39;myhost[1-3]&#39;</span>
</pre></div>
</div>
<p>Or in yaml:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">service_type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">prometheus</span>
<span class="nt">placement</span><span class="p">:</span>
  <span class="nt">host_pattern</span><span class="p">:</span> <span class="s">&quot;myhost[1-3]&quot;</span>
</pre></div>
</div>
<p>To place a service on <em>all</em> hosts, use <code class="docutils literal notranslate"><span class="pre">&quot;*&quot;</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">orch</span> <span class="n">apply</span> <span class="n">crash</span> <span class="s1">&#39;*&#39;</span>
</pre></div>
</div>
<p>Or in yaml:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">service_type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">node-exporter</span>
<span class="nt">placement</span><span class="p">:</span>
  <span class="nt">host_pattern</span><span class="p">:</span> <span class="s">&quot;*&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-a-limit">
<h3>Setting a limit<a class="headerlink" href="#setting-a-limit" title="Permalink to this headline">¶</a></h3>
<p>By specifying <code class="docutils literal notranslate"><span class="pre">count</span></code>, only that number of daemons will be created:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">orch</span> <span class="n">apply</span> <span class="n">prometheus</span> <span class="mi">3</span>
</pre></div>
</div>
<p>To deploy <em>daemons</em> on a subset of hosts, also specify the count:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">orch</span> <span class="n">apply</span> <span class="n">prometheus</span> <span class="s2">&quot;2 host1 host2 host3&quot;</span>
</pre></div>
</div>
<p>If the count is bigger than the amount of hosts, cephadm still deploys two daemons:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">orch</span> <span class="n">apply</span> <span class="n">prometheus</span> <span class="s2">&quot;3 host1 host2&quot;</span>
</pre></div>
</div>
<p>Or in yaml:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">service_type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">prometheus</span>
<span class="nt">placement</span><span class="p">:</span>
  <span class="nt">count</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
</pre></div>
</div>
<p>Or with hosts:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">service_type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">prometheus</span>
<span class="nt">placement</span><span class="p">:</span>
  <span class="nt">count</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
  <span class="nt">hosts</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">host1</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">host2</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">host3</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="updating-service-specifications">
<h2>Updating Service Specifications<a class="headerlink" href="#updating-service-specifications" title="Permalink to this headline">¶</a></h2>
<p>The Ceph Orchestrator maintains a declarative state of each
service in a <code class="docutils literal notranslate"><span class="pre">ServiceSpec</span></code>. For certain operations, like updating
the RGW HTTP port, we need to update the existing
specification.</p>
<ol class="arabic">
<li><p>List the current <code class="docutils literal notranslate"><span class="pre">ServiceSpec</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">orch</span> <span class="n">ls</span> <span class="o">--</span><span class="n">service_name</span><span class="o">=&lt;</span><span class="n">service</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">export</span> <span class="o">&gt;</span> <span class="n">myservice</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
</li>
<li><p>Update the yaml file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vi</span> <span class="n">myservice</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
</li>
<li><p>Apply the new <code class="docutils literal notranslate"><span class="pre">ServiceSpec</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">orch</span> <span class="n">apply</span> <span class="o">-</span><span class="n">i</span> <span class="n">myservice</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="configuring-the-orchestrator-cli">
<h2>Configuring the Orchestrator CLI<a class="headerlink" href="#configuring-the-orchestrator-cli" title="Permalink to this headline">¶</a></h2>
<p>To enable the orchestrator, select the orchestrator module to use
with the <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">backend</span></code> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">orch</span> <span class="nb">set</span> <span class="n">backend</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example, to enable the Rook orchestrator module and use it with the CLI:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">mgr</span> <span class="n">module</span> <span class="n">enable</span> <span class="n">rook</span>
<span class="n">ceph</span> <span class="n">orch</span> <span class="nb">set</span> <span class="n">backend</span> <span class="n">rook</span>
</pre></div>
</div>
<p>Check the backend is properly configured:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">orch</span> <span class="n">status</span>
</pre></div>
</div>
<div class="section" id="disable-the-orchestrator">
<h3>Disable the Orchestrator<a class="headerlink" href="#disable-the-orchestrator" title="Permalink to this headline">¶</a></h3>
<p>To disable the orchestrator, use the empty string <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">orch</span> <span class="nb">set</span> <span class="n">backend</span> <span class="s2">&quot;&quot;</span>
<span class="n">ceph</span> <span class="n">mgr</span> <span class="n">module</span> <span class="n">disable</span> <span class="n">rook</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="current-implementation-status">
<h2>Current Implementation Status<a class="headerlink" href="#current-implementation-status" title="Permalink to this headline">¶</a></h2>
<p>This is an overview of the current implementation status of the orchestrators.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 70%" />
<col style="width: 12%" />
<col style="width: 18%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Command</p></th>
<th class="head"><p>Rook</p></th>
<th class="head"><p>Cephadm</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>apply iscsi</p></td>
<td><p>⚪</p></td>
<td><p>✔</p></td>
</tr>
<tr class="row-odd"><td><p>apply mds</p></td>
<td><p>✔</p></td>
<td><p>✔</p></td>
</tr>
<tr class="row-even"><td><p>apply mgr</p></td>
<td><p>⚪</p></td>
<td><p>✔</p></td>
</tr>
<tr class="row-odd"><td><p>apply mon</p></td>
<td><p>✔</p></td>
<td><p>✔</p></td>
</tr>
<tr class="row-even"><td><p>apply nfs</p></td>
<td><p>✔</p></td>
<td><p>✔</p></td>
</tr>
<tr class="row-odd"><td><p>apply osd</p></td>
<td><p>✔</p></td>
<td><p>✔</p></td>
</tr>
<tr class="row-even"><td><p>apply rbd-mirror</p></td>
<td><p>✔</p></td>
<td><p>✔</p></td>
</tr>
<tr class="row-odd"><td><p>apply rgw</p></td>
<td><p>⚪</p></td>
<td><p>✔</p></td>
</tr>
<tr class="row-even"><td><p>host add</p></td>
<td><p>⚪</p></td>
<td><p>✔</p></td>
</tr>
<tr class="row-odd"><td><p>host ls</p></td>
<td><p>✔</p></td>
<td><p>✔</p></td>
</tr>
<tr class="row-even"><td><p>host rm</p></td>
<td><p>⚪</p></td>
<td><p>✔</p></td>
</tr>
<tr class="row-odd"><td><p>daemon status</p></td>
<td><p>⚪</p></td>
<td><p>✔</p></td>
</tr>
<tr class="row-even"><td><p>daemon {stop,start,…}</p></td>
<td><p>⚪</p></td>
<td><p>✔</p></td>
</tr>
<tr class="row-odd"><td><p>device {ident,fault}-(on,off}</p></td>
<td><p>⚪</p></td>
<td><p>✔</p></td>
</tr>
<tr class="row-even"><td><p>device ls</p></td>
<td><p>✔</p></td>
<td><p>✔</p></td>
</tr>
<tr class="row-odd"><td><p>iscsi add</p></td>
<td><p>⚪</p></td>
<td><p>✔</p></td>
</tr>
<tr class="row-even"><td><p>mds add</p></td>
<td><p>✔</p></td>
<td><p>✔</p></td>
</tr>
<tr class="row-odd"><td><p>nfs add</p></td>
<td><p>✔</p></td>
<td><p>✔</p></td>
</tr>
<tr class="row-even"><td><p>rbd-mirror add</p></td>
<td><p>⚪</p></td>
<td><p>✔</p></td>
</tr>
<tr class="row-odd"><td><p>rgw add</p></td>
<td><p>✔</p></td>
<td><p>✔</p></td>
</tr>
<tr class="row-even"><td><p>ps</p></td>
<td><p>✔</p></td>
<td><p>✔</p></td>
</tr>
</tbody>
</table>
<p>where</p>
<ul class="simple">
<li><p>⚪ = not yet implemented</p></li>
<li><p>❌ = not applicable</p></li>
<li><p>✔ = implemented</p></li>
</ul>
</div>
</div>



          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../start/intro/">Ceph 简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/">安装 Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cephadm/">Cephadm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rados/">Ceph 存储集群</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cephfs/">Ceph 文件系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rbd/">Ceph 块设备</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../radosgw/">Ceph 对象网关</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">Ceph 管理器守护进程</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../administrator/">安装和配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/">模块编程</a></li>
<li class="toctree-l2"><a class="reference internal" href="../orchestrator_modules/">编写 orchestrator 插件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dashboard/">仪表盘模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alerts/">Alerts 模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../diskprediction/">DiskPrediction 模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../localpool/">localpool 模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../restful/">REST 风格模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../zabbix/">Zabbix 模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../prometheus/">Prometheus 模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../influx/">Influx 模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hello/">Hello 模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../telegraf/">Telegraf 模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../telemetry/">Telemetry 模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iostat/">Iostat 模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../osd_support/">OSD Support 模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../crash/">Crash 模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../insights/">Insights 模块</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Orchestrator 模块</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="#host-management">Host Management</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#host-specification">Host Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#osd-management">OSD Management</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#list-devices">List Devices</a></li>
<li class="toctree-l4"><a class="reference internal" href="#erase-devices-zap-devices">Erase Devices (Zap Devices)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-osds">Create OSDs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#remove-an-osd">Remove an OSD</a></li>
<li class="toctree-l4"><a class="reference internal" href="#replace-an-osd">Replace an OSD</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#monitor-and-manager-management">Monitor and manager management</a></li>
<li class="toctree-l3"><a class="reference internal" href="#service-status">Service Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="#daemon-status">Daemon Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="#depoying-cephfs">Depoying CephFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stateless-services-mds-rgw-nfs-rbd-mirror-iscsi">Stateless services (MDS/RGW/NFS/rbd-mirror/iSCSI)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#service-specification">Service Specification</a></li>
<li class="toctree-l3"><a class="reference internal" href="#placement-specification">Placement Specification</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#explicit-placements">Explicit placements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#placement-by-labels">Placement by labels</a></li>
<li class="toctree-l4"><a class="reference internal" href="#placement-by-pattern-matching">Placement by pattern matching</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setting-a-limit">Setting a limit</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#updating-service-specifications">Updating Service Specifications</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-the-orchestrator-cli">Configuring the Orchestrator CLI</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#disable-the-orchestrator">Disable the Orchestrator</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#current-implementation-status">Current Implementation Status</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../rook/">Rook 模块</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dashboard/">Ceph 仪表盘</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/">API 文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture/">体系结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/developer_guide/">开发者指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/internals/">Ceph 内幕</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../governance/">项目管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../foundation/">Ceph 基金会</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ceph-volume/">ceph-volume</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/general/">Ceph 版本（总目录）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/">Ceph 版本（索引）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary/">Ceph 术语</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../translation_cn/">中文版翻译资源</a></li>
</ul>


<!-- ugly kludge to make genindex look like it's part of the toc -->
<ul style="margin-top: -10px"><li class="toctree-l1"><a class="reference internal" href="../../genindex/">Index</a></li></ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../cephadm/drivegroups/" title="OSD Service Specification"
             >next</a> |</li>
        <li class="right" >
          <a href="../../cephadm/operations/" title="Cephadm Operations"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">Ceph Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../cephadm/" >Cephadm</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Ceph authors and contributors. Licensed under Creative Commons Attribution Share Alike 3.0 (CC-BY-SA-3.0).
    </div>
  </body>
</html>