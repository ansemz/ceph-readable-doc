
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>向 Ceph 贡献：开发者指南 &mdash; Ceph Documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     'dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Ceph Documentation" href="../" />
    <link rel="next" title="Release Notes" href="../release-notes/" />
    <link rel="prev" title="体系结构" href="../architecture/" />
    

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../release-notes/" title="Release Notes"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../architecture/" title="体系结构"
             accesskey="P">previous</a> |</li>
        <li><a href="../">Ceph Documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="ceph">
<h1><a class="toc-backref" href="#id47">向 Ceph 贡献：开发者指南</a><a class="headerlink" href="#ceph" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">作者:</th><td class="field-body">Loic Dachary</td>
</tr>
<tr class="field-even field"><th class="field-name">作者:</th><td class="field-body">Nathan Cutler</td>
</tr>
<tr class="field-odd field"><th class="field-name">许可证:</th><td class="field-body">Creative Commons Attribution-ShareAlike (CC BY-SA)</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">旧的 (pre-2016) 开发者文档已经挪到了 <a class="reference internal" href="index-old/"><em>内部开发者文档</em></a> 。</p>
</div>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#ceph" id="id47">向 Ceph 贡献：开发者指南</a><ul>
<li><a class="reference internal" href="#id1" id="id48">简介</a></li>
<li><a class="reference internal" href="#id2" id="id49">必备知识</a><ul>
<li><a class="reference internal" href="#id3" id="id50">项目领袖</a></li>
<li><a class="reference internal" href="#id4" id="id51">历史</a></li>
<li><a class="reference internal" href="#id5" id="id52">软件许可</a></li>
<li><a class="reference internal" href="#id6" id="id53">源代码仓库</a></li>
<li><a class="reference internal" href="#redmine" id="id54">Redmine 问题跟踪器</a></li>
<li><a class="reference internal" href="#id9" id="id55">邮件列表</a></li>
<li><a class="reference internal" href="#irc" id="id56">IRC</a></li>
<li><a class="reference internal" href="#id10" id="id57">补丁的提交</a></li>
<li><a class="reference internal" href="#id11" id="id58">从源码构建</a></li>
<li><a class="reference internal" href="#ccache" id="id59">用 ccache 加速本地构建</a></li>
<li><a class="reference internal" href="#id13" id="id60">开发模式的集群</a></li>
<li><a class="reference internal" href="#backporting" id="id61">补丁移植（ Backporting ）</a></li>
</ul>
</li>
<li><a class="reference internal" href="#what-is-merged-where-and-when" id="id62">What is merged where and when ?</a><ul>
<li><a class="reference internal" href="#x-0-z" id="id63">开发版（即 x.0.z ）</a></li>
<li><a class="reference internal" href="#x-1-z" id="id64">稳定版候选（即 x.1.z ）阶段一</a></li>
<li><a class="reference internal" href="#id18" id="id65">稳定版候选（即 x.1.z ）阶段二</a></li>
<li><a class="reference internal" href="#x-2-z" id="id66">稳定版（即 x.2.z ）</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id27" id="id67">问题跟踪</a><ul>
<li><a class="reference internal" href="#id28" id="id68">问题跟踪器惯例</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id29" id="id69">基本工作流</a><ul>
<li><a class="reference internal" href="#id30" id="id70">更新追踪器</a></li>
<li><a class="reference internal" href="#id31" id="id71">上游源码</a></li>
<li><a class="reference internal" href="#id32" id="id72">本地环境</a></li>
<li><a class="reference internal" href="#id33" id="id73">缺陷修订分支</a></li>
<li><a class="reference internal" href="#id34" id="id74">在本地修正缺陷</a></li>
<li><a class="reference internal" href="#id35" id="id75">GitHub 拉取请求</a></li>
<li><a class="reference internal" href="#pr" id="id76">全自动的 PR 校验</a></li>
<li><a class="reference internal" href="#ceph-qa-suite" id="id77">集成测试（也就是 ceph-qa-suite ）</a></li>
<li><a class="reference internal" href="#id37" id="id78">源码审核</a></li>
<li><a class="reference internal" href="#id38" id="id79">修订你的 PR</a></li>
<li><a class="reference internal" href="#id39" id="id80">合并</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id40" id="id81">测试</a></li>
<li><a class="reference internal" href="#make-check" id="id82">测试 - make check</a><ul>
<li><a class="reference internal" href="#future-sections" id="id83">Future sections</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id41" id="id84">测试 - 集成测试</a><ul>
<li><a class="reference internal" href="#teuthology-consumes-packages" id="id85">Teuthology consumes packages</a></li>
<li><a class="reference internal" href="#the-nightlies" id="id86">The nightlies</a></li>
<li><a class="reference internal" href="#suites-inventory" id="id87">Suites inventory</a></li>
<li><a class="reference internal" href="#teuthology-describe-tests" id="id88">teuthology-describe-tests</a></li>
<li><a class="reference internal" href="#id42" id="id89">集成测试是如何运作的</a></li>
<li><a class="reference internal" href="#how-integration-tests-are-defined" id="id90">如何定义集成测试</a></li>
<li><a class="reference internal" href="#reading-a-standalone-test" id="id91">Reading a standalone test</a></li>
<li><a class="reference internal" href="#test-descriptions" id="id92">Test descriptions</a></li>
<li><a class="reference internal" href="#how-are-tests-built-from-directories" id="id93">How are tests built from directories?</a></li>
<li><a class="reference internal" href="#convolution-operator" id="id94">Convolution operator</a></li>
<li><a class="reference internal" href="#concatenation-operator" id="id95">Concatenation operator</a></li>
<li><a class="reference internal" href="#filtering-tests-by-their-description" id="id96">Filtering tests by their description</a></li>
<li><a class="reference internal" href="#reducing-the-number-of-tests" id="id97">Reducing the number of tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id45" id="id98">在云端测试</a><ul>
<li><a class="reference internal" href="#assumptions-and-caveat" id="id99">Assumptions and caveat</a></li>
<li><a class="reference internal" href="#prepare-tenant" id="id100">Prepare tenant</a></li>
<li><a class="reference internal" href="#getting-ceph-workbench" id="id101">Getting ceph-workbench</a></li>
<li><a class="reference internal" href="#linking-ceph-workbench-with-your-openstack-tenant" id="id102">Linking ceph-workbench with your OpenStack tenant</a></li>
<li><a class="reference internal" href="#run-the-dummy-suite" id="id103">Run the dummy suite</a></li>
<li><a class="reference internal" href="#run-a-standalone-test" id="id104">Run a standalone test</a></li>
<li><a class="reference internal" href="#interrupt-a-running-suite" id="id105">Interrupt a running suite</a></li>
<li><a class="reference internal" href="#upload-logs-to-archive-server" id="id106">Upload logs to archive server</a></li>
<li><a class="reference internal" href="#provision-vms-ad-hoc" id="id107">Provision VMs ad hoc</a></li>
<li><a class="reference internal" href="#deploy-a-cluster-for-manual-testing" id="id108">部署用于手动测试的集群</a></li>
</ul>
</li>
<li><a class="reference internal" href="#s3" id="id109">测试——如何在本地测试 S3</a><ul>
<li><a class="reference internal" href="#step-1-build-ceph" id="id110">Step 1 - build Ceph</a></li>
<li><a class="reference internal" href="#step-2-s3-tests" id="id111">Step 2 - s3-tests</a></li>
<li><a class="reference internal" href="#step-3-vstart" id="id112">Step 3 - vstart</a></li>
<li><a class="reference internal" href="#step-4-prepare-s3-environment" id="id113">Step 4 - prepare S3 environment</a></li>
<li><a class="reference internal" href="#step-5-run-s3-tests" id="id114">Step 5 - run s3-tests</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id1">
<h2><a class="toc-backref" href="#id48">简介</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>This guide has two aims. First, it should lower the barrier to entry for
software developers who wish to get involved in the Ceph project. Second,
it should serve as a reference for Ceph developers.</p>
<p>We assume that readers are already familiar with Ceph (the distributed
object store and file system designed to provide excellent performance,
reliability and scalability). If not, please refer to the <a class="reference external" href="http://ceph.com">project website</a>
and especially the <a class="reference external" href="https://ceph.com/resources/publications/">publications list</a>.</p>
<p>Since this document is to be consumed by developers, who are assumed to
have Internet access, topics covered elsewhere, either within the Ceph
documentation or elsewhere on the web, are treated by linking. If you
notice that a link is broken or if you know of a better link, please
<a class="reference external" href="http://tracker.ceph.com/projects/ceph/issues/new">report it as a bug</a>.</p>
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id49">必备知识</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>本章包含必要信息，每个 Ceph 开发者都应该知道。</p>
<div class="section" id="id3">
<h3><a class="toc-backref" href="#id50">项目领袖</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>Ceph 项目是由 Sage Weil 领导的。另外，各主要项目组件有自己的领导，下面的表格罗列了所有领导、以及他们在 <a class="reference external" href="https://github.com/">GitHub</a> 上的昵称。</p>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="41%" />
<col width="35%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Scope</th>
<th class="head">Lead</th>
<th class="head">GitHub nick</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Ceph</td>
<td>Sage Weil</td>
<td>liewegas</td>
</tr>
<tr class="row-odd"><td>RADOS</td>
<td>Samuel Just</td>
<td>athanatos</td>
</tr>
<tr class="row-even"><td>RGW</td>
<td>Yehuda Sadeh</td>
<td>yehudasa</td>
</tr>
<tr class="row-odd"><td>RBD</td>
<td>Jason Dillaman</td>
<td>dillaman</td>
</tr>
<tr class="row-even"><td>CephFS</td>
<td>John Spray</td>
<td>jcsp</td>
</tr>
<tr class="row-odd"><td>Build/Ops</td>
<td>Ken Dreyer</td>
<td>ktdreyer</td>
</tr>
</tbody>
</table>
<p>上述表格里的 Ceph 专有缩写在 <a class="reference internal" href="../architecture/"><em>体系结构</em></a> 里面有解释。</p>
</div>
<div class="section" id="id4">
<h3><a class="toc-backref" href="#id51">历史</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>请翻阅 <a class="reference external" href="https://en.wikipedia.org/wiki/Ceph_%28software%29#History">Wikipedia 的 History 这章</a>。</p>
</div>
<div class="section" id="id5">
<h3><a class="toc-backref" href="#id52">软件许可</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>Ceph 是自由软件。</p>
<p>除非另有声明， Ceeph 的源代码会以 LGPL2.1 许可证发布。其条款位于<a class="reference external" href="https://github.com/ceph/ceph/blob/master/COPYING">源码树顶极目录下的 COPYING 文件内</a>。</p>
</div>
<div class="section" id="id6">
<h3><a class="toc-backref" href="#id53">源代码仓库</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>The source code of Ceph lives on <a class="reference external" href="https://github.com/">GitHub</a> in a number of repositories below
the <a class="reference external" href="https://github.com/ceph">Ceph &#8220;organization&#8221;</a>.</p>
<p>To make a meaningful contribution to the project as a developer, a working
knowledge of <a class="reference external" href="https://git-scm.com/documentation">git</a> is essential.</p>
<p>Although the <a class="reference external" href="https://github.com/ceph">Ceph &#8220;organization&#8221;</a> includes several software repositories,
this document covers only one: <a class="reference external" href="https://github.com/ceph/ceph">https://github.com/ceph/ceph</a>.</p>
</div>
<div class="section" id="redmine">
<h3><a class="toc-backref" href="#id54">Redmine 问题跟踪器</a><a class="headerlink" href="#redmine" title="Permalink to this headline">¶</a></h3>
<p>Although <a class="reference external" href="https://github.com/">GitHub</a> is used for code, Ceph-related issues (Bugs, Features,
Backports, Documentation, etc.) are tracked at <a class="reference external" href="http://tracker.ceph.com">http://tracker.ceph.com</a>,
which is powered by <a class="reference external" href="http://www.redmine.org">Redmine</a>.</p>
<p>The tracker has a Ceph project with a number of subprojects loosely
corresponding to the various architectural components (see
<a class="reference internal" href="../architecture/"><em>体系结构</em></a>).</p>
<p>Mere <a class="reference external" href="http://tracker.ceph.com/account/register">registration</a> in the tracker automatically grants permissions
sufficient to open new issues and comment on existing ones.</p>
<p>要报告软件缺陷或者提议新功能，请<a class="reference external" href="http://tracker.ceph.com/projects/ceph">跳转到 Ceph 项目</a>并点击 <a class="reference external" href="http://tracker.ceph.com/projects/ceph/issues/new">New issue</a> 。</p>
</div>
<div class="section" id="id9">
<h3><a class="toc-backref" href="#id55">邮件列表</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>Ceph 的开发邮件讨论是通过邮件列表 <tt class="docutils literal"><span class="pre">ceph-devel&#64;vger.kernel.org</span></tt> 进行的。这个邮件列表对所有人开放，把下面这行发送到 <tt class="docutils literal"><span class="pre">majordomo&#64;vger.kernel.org</span></tt> 即可订阅：</p>
<div class="highlight-python"><pre>subscribe ceph-devel</pre>
</div>
<p>要作为邮件正文发出。</p>
<p>There are also <a class="reference external" href="https://ceph.com/resources/mailing-list-irc/">other Ceph-related mailing lists</a>.</p>
</div>
<div class="section" id="irc">
<h3><a class="toc-backref" href="#id56">IRC</a><a class="headerlink" href="#irc" title="Permalink to this headline">¶</a></h3>
<p>In addition to mailing lists, the Ceph community also communicates in real
time using <a class="reference external" href="http://www.irchelp.org/">Internet Relay Chat</a>.</p>
<p>See <a class="reference external" href="https://ceph.com/resources/mailing-list-irc/">https://ceph.com/resources/mailing-list-irc/</a> for how to set up your IRC
client and a list of channels.</p>
</div>
<div class="section" id="id10">
<h3><a class="toc-backref" href="#id57">补丁的提交</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>The canonical instructions for submitting patches are contained in the
<a class="reference external" href="https://github.com/ceph/ceph/blob/master/CONTRIBUTING.rst">the file CONTRIBUTING.rst in the top-level directory of the source-code
tree</a>. There may be some overlap between this guide and that file.</p>
<p>All newcomers are encouraged to read that file carefully.</p>
</div>
<div class="section" id="id11">
<h3><a class="toc-backref" href="#id58">从源码构建</a><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>请参考 <a class="reference internal" href="../install/build-ceph/"><em>构建 Ceph</em></a> 。</p>
</div>
<div class="section" id="ccache">
<span id="using-ccache-to-speed-up-local-builds"></span><h3><a class="toc-backref" href="#id59">用 ccache 加速本地构建</a><a class="headerlink" href="#ccache" title="Permalink to this headline">¶</a></h3>
<p>Rebuilds of the ceph source tree can benefit significantly from use of <a class="reference external" href="https://ccache.samba.org/">ccache</a>.
Many a times while switching branches and such, one might see build failures for
certain older branches mostly due to older build artifacts. These rebuilds can
significantly benefit the use of ccache. For a full clean source tree, one could
do</p>
<div class="highlight-python"><pre>$ make clean

# note the following will nuke everything in the source tree that
# isn't tracked by git, so make sure to backup any log files /conf options

$ git clean -fdx; git submodule foreach git clean -fdx</pre>
</div>
<p>ccache is available as a package in most distros. To build ceph with ccache one
can:</p>
<div class="highlight-python"><pre>$ cmake -DWITH_CCACHE=ON ..</pre>
</div>
<p>ccache can also be used for speeding up all builds in the system. for more
details refer to the <a class="reference external" href="https://ccache.samba.org/manual.html#_run_modes">run modes</a> of the ccache manual. The default settings of
<tt class="docutils literal"><span class="pre">ccache</span></tt> can be displayed with <tt class="docutils literal"><span class="pre">ccache</span> <span class="pre">-s</span></tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is recommended to override the <tt class="docutils literal"><span class="pre">max_size</span></tt>, which is the size of
cache, defaulting to 10G, to a larger size like 25G or so. Refer to the
<a class="reference external" href="https://ccache.samba.org/manual.html#_configuration">configuration</a> section of ccache manual.</p>
</div>
</div>
<div class="section" id="id13">
<h3><a class="toc-backref" href="#id60">开发模式的集群</a><a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>参考 <a class="reference internal" href="quick_guide/"><em>开发者指南（快速）</em></a> 。</p>
</div>
<div class="section" id="backporting">
<h3><a class="toc-backref" href="#id61">补丁移植（ Backporting ）</a><a class="headerlink" href="#backporting" title="Permalink to this headline">¶</a></h3>
<p>All bugfixes should be merged to the <tt class="docutils literal"><span class="pre">master</span></tt> branch before being backported.
To flag a bugfix for backporting, make sure it has a <a class="reference external" href="http://tracker.ceph.com/">tracker issue</a>
associated with it and set the <tt class="docutils literal"><span class="pre">Backport</span></tt> field to a comma-separated list of
previous releases (e.g. &#8220;hammer,jewel&#8221;) that you think need the backport.
The rest (including the actual backporting) will be taken care of by the
<a class="reference external" href="http://tracker.ceph.com/projects/ceph-releases/wiki">Stable Releases and Backports</a> team.</p>
</div>
</div>
<div class="section" id="what-is-merged-where-and-when">
<h2><a class="toc-backref" href="#id62">What is merged where and when ?</a><a class="headerlink" href="#what-is-merged-where-and-when" title="Permalink to this headline">¶</a></h2>
<p>Commits are merged into branches according to criteria that change
during the lifecycle of a Ceph release. This chapter is the inventory
of what can be merged in which branch at a given point in time.</p>
<div class="section" id="x-0-z">
<h3><a class="toc-backref" href="#id63">开发版（即 x.0.z ）</a><a class="headerlink" href="#x-0-z" title="Permalink to this headline">¶</a></h3>
<div class="section" id="what">
<h4>What ?<a class="headerlink" href="#what" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>features</li>
<li>bug fixes</li>
</ul>
</div>
<div class="section" id="where">
<h4>Where ?<a class="headerlink" href="#where" title="Permalink to this headline">¶</a></h4>
<p>Features are merged to the master branch. Bug fixes should be merged
to the corresponding named branch (e.g. &#8220;jewel&#8221; for 10.0.z, &#8220;kraken&#8221;
for 11.0.z, etc.). However, this is not mandatory - bug fixes can be
merged to the master branch as well, since the master branch is
periodically merged to the named branch during the development
releases phase. In either case, if the bugfix is important it can also
be flagged for backport to one or more previous stable releases.</p>
</div>
<div class="section" id="when">
<h4>When ?<a class="headerlink" href="#when" title="Permalink to this headline">¶</a></h4>
<p>After the stable release candidates of the previous release enters
phase 2 (see below).  For example: the &#8220;jewel&#8221; named branch was
created when the infernalis release candidates entered phase 2. From
this point on, master was no longer associated with infernalis. As
soon as the named branch of the next stable release is created, master
starts getting periodically merged into it.</p>
</div>
<div class="section" id="branch-merges">
<h4>Branch merges<a class="headerlink" href="#branch-merges" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>The branch of the stable release is merged periodically into master.</li>
<li>The master branch is merged periodically into the branch of the
stable release.</li>
<li>The master is merged into the branch of the stable release
immediately after each development x.0.z release.</li>
</ul>
</div>
</div>
<div class="section" id="x-1-z">
<h3><a class="toc-backref" href="#id64">稳定版候选（即 x.1.z ）阶段一</a><a class="headerlink" href="#x-1-z" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id14">
<h4>What ?<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>bug fixes only</li>
</ul>
</div>
<div class="section" id="id15">
<h4>Where ?<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h4>
<p>The branch of the stable release (e.g. &#8220;jewel&#8221; for 10.0.z, &#8220;kraken&#8221;
for 11.0.z, etc.) or master.  Bug fixes should be merged to the named
branch corresponding to the stable release candidate (e.g. &#8220;jewel&#8221; for
10.1.z) or to master. During this phase, all commits to master will be
merged to the named branch, and vice versa. In other words, it makes
no difference whether a commit is merged to the named branch or to
master - it will make it into the next release candidate either way.</p>
</div>
<div class="section" id="id16">
<h4>When ?<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h4>
<p>After the first stable release candidate is published, i.e. after the
x.1.0 tag is set in the release branch.</p>
</div>
<div class="section" id="id17">
<h4>Branch merges<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>The branch of the stable release is merged periodically into master.</li>
<li>The master branch is merged periodically into the branch of the
stable release.</li>
<li>The master is merged into the branch of the stable release
immediately after each x.1.z release candidate.</li>
</ul>
</div>
</div>
<div class="section" id="id18">
<h3><a class="toc-backref" href="#id65">稳定版候选（即 x.1.z ）阶段二</a><a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id19">
<h4>What ?<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>bug fixes only</li>
</ul>
</div>
<div class="section" id="id20">
<h4>Where ?<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h4>
<p>The branch of the stable release (e.g. &#8220;jewel&#8221; for 10.0.z, &#8220;kraken&#8221;
for 11.0.z, etc.). During this phase, all commits to the named branch
will be merged into master. Cherry-picking to the named branch during
release candidate phase 2 is done manually since the official
backporting process only begins when the release is pronounced
&#8220;stable&#8221;.</p>
</div>
<div class="section" id="id21">
<h4>When ?<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h4>
<p>After Sage Weil decides it is time for phase 2 to happen.</p>
</div>
<div class="section" id="id22">
<h4>Branch merges<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>The branch of the stable release is merged periodically into master.</li>
</ul>
</div>
</div>
<div class="section" id="x-2-z">
<h3><a class="toc-backref" href="#id66">稳定版（即 x.2.z ）</a><a class="headerlink" href="#x-2-z" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id23">
<h4>What ?<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>bug fixes</li>
<li>features are sometime accepted</li>
<li>commits should be cherry-picked from master when possible</li>
<li>commits that are not cherry-picked from master must be about a bug unique to the stable release</li>
<li>see also <a class="reference external" href="http://tracker.ceph.com/projects/ceph-releases/wiki/HOWTO#HOWTO">the backport HOWTO</a></li>
</ul>
</div>
<div class="section" id="id24">
<h4>Where ?<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h4>
<p>The branch of the stable release (hammer for 0.94.x, infernalis for 9.2.x, etc.)</p>
</div>
<div class="section" id="id25">
<h4>When ?<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h4>
<p>After the stable release is published, i.e. after the &#8220;vx.2.0&#8221; tag is
set in the release branch.</p>
</div>
<div class="section" id="id26">
<h4>分支合并<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h4>
<p>不会再并入。</p>
</div>
</div>
</div>
<div class="section" id="id27">
<h2><a class="toc-backref" href="#id67">问题跟踪</a><a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h2>
<p>See <a class="reference internal" href="#redmine">Redmine 问题跟踪器</a> for a brief introduction to the Ceph Issue Tracker.</p>
<p>Ceph developers use the issue tracker to</p>
<p>1. keep track of issues - bugs, fix requests, feature requests, backport
requests, etc.</p>
<p>2. communicate with other developers and keep them informed as work
on the issues progresses.</p>
<div class="section" id="id28">
<h3><a class="toc-backref" href="#id68">问题跟踪器惯例</a><a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h3>
<p>When you start working on an existing issue, it&#8217;s nice to let the other
developers know this - to avoid duplication of labor. Typically, this is
done by changing the <tt class="code docutils literal"><span class="pre">Assignee</span></tt> field (to yourself) and changing the
<tt class="code docutils literal"><span class="pre">Status</span></tt> to <em>In progress</em>. Newcomers to the Ceph community typically do not
have sufficient privileges to update these fields, however: they can
simply update the issue with a brief note.</p>
<table border="1" class="docutils">
<caption>Meanings of some commonly used statuses</caption>
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Status</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>New</td>
<td>Initial status</td>
</tr>
<tr class="row-odd"><td>In Progress</td>
<td>Somebody is working on it</td>
</tr>
<tr class="row-even"><td>Need Review</td>
<td>Pull request is open with a fix</td>
</tr>
<tr class="row-odd"><td>Pending Backport</td>
<td>Fix has been merged, backport(s) pending</td>
</tr>
<tr class="row-even"><td>Resolved</td>
<td>Fix and backports (if any) have been merged</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id29">
<h2><a class="toc-backref" href="#id69">基本工作流</a><a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h2>
<p>The following chart illustrates basic development workflow:</p>
<p class="ditaa">
<img src="../_images/ditaa-66533dae18563f65ee41d2215c6e88c2764e32c3.png"/>
</p>
<p>Below we present an explanation of this chart. The explanation is written
with the assumption that you, the reader, are a beginning developer who
has an idea for a bugfix, but do not know exactly how to proceed.</p>
<div class="section" id="id30">
<h3><a class="toc-backref" href="#id70">更新追踪器</a><a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h3>
<p>Before you start, you should know the <a class="reference internal" href="#id27">问题跟踪</a> number of the bug
you intend to fix. If there is no tracker issue, now is the time to create
one.</p>
<p>The tracker is there to explain the issue (bug) to your fellow Ceph
developers and keep them informed as you make progress toward resolution.
To this end, then, provide a descriptive title as well as sufficient
information and details in the description.</p>
<p>If you have sufficient tracker permissions, assign the bug to yourself by
changing the <tt class="docutils literal"><span class="pre">Assignee</span></tt> field.  If your tracker permissions have not yet
been elevated, simply add a comment to the issue with a short message like
&#8220;I am working on this issue&#8221;.</p>
</div>
<div class="section" id="id31">
<h3><a class="toc-backref" href="#id71">上游源码</a><a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h3>
<p>This section, and the ones that follow, correspond to the nodes in the
above chart.</p>
<p>The upstream code lives in <a class="reference external" href="https://github.com/ceph/ceph.git">https://github.com/ceph/ceph.git</a>, which is
sometimes referred to as the &#8220;upstream repo&#8221;, or simply &#8220;upstream&#8221;. As the
chart illustrates, we will make a local copy of this code, modify it, test
our modifications, and submit the modifications back to the upstream repo
for review.</p>
<p>A local copy of the upstream code is made by</p>
<ol class="arabic simple">
<li>forking the upstream repo on GitHub, and</li>
<li>cloning your fork to make a local working copy</li>
</ol>
<p>See the <a class="reference external" href="https://help.github.com/articles/fork-a-repo/#platform-linux">the GitHub documentation</a> for
detailed instructions on forking. In short, if your GitHub username is
&#8220;mygithubaccount&#8221;, your fork of the upstream repo will show up at
<a class="reference external" href="https://github.com/mygithubaccount/ceph">https://github.com/mygithubaccount/ceph</a>. Once you have created your fork,
you clone it by doing:</p>
<div class="code highlight-python"><pre>$ git clone https://github.com/mygithubaccount/ceph</pre>
</div>
<p>While it is possible to clone the upstream repo directly, in this case you
must fork it first. Forking is what enables us to open a <a class="reference internal" href="#id35">GitHub 拉取请求</a>.</p>
<p>For more information on using GitHub, refer to <a class="reference external" href="https://help.github.com/">GitHub Help</a>.</p>
</div>
<div class="section" id="id32">
<h3><a class="toc-backref" href="#id72">本地环境</a><a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h3>
<p>In the local environment created in the previous step, you now have a
copy of the <tt class="docutils literal"><span class="pre">master</span></tt> branch in <tt class="docutils literal"><span class="pre">remotes/origin/master</span></tt>. Since the fork
(<a class="reference external" href="https://github.com/mygithubaccount/ceph.git">https://github.com/mygithubaccount/ceph.git</a>) is frozen in time and the
upstream repo (<a class="reference external" href="https://github.com/ceph/ceph.git">https://github.com/ceph/ceph.git</a>, typically abbreviated to
<tt class="docutils literal"><span class="pre">ceph/ceph.git</span></tt>) is updated frequently by other developers, you will need
to sync your fork periodically. To do this, first add the upstream repo as
a &#8220;remote&#8221; and fetch it:</p>
<div class="highlight-python"><pre>$ git remote add ceph https://github.com/ceph/ceph.git
$ git fetch ceph</pre>
</div>
<p>Fetching downloads all objects (commits, branches) that were added since
the last sync. After running these commands, all the branches from
<tt class="docutils literal"><span class="pre">ceph/ceph.git</span></tt> are downloaded to the local git repo as
<tt class="docutils literal"><span class="pre">remotes/ceph/$BRANCH_NAME</span></tt> and can be referenced as
<tt class="docutils literal"><span class="pre">ceph/$BRANCH_NAME</span></tt> in certain git commands.</p>
<p>For example, your local <tt class="docutils literal"><span class="pre">master</span></tt> branch can be reset to the upstream Ceph
<tt class="docutils literal"><span class="pre">master</span></tt> branch by doing:</p>
<div class="highlight-python"><pre>$ git fetch ceph
$ git checkout master
$ git reset --hard ceph/master</pre>
</div>
<p>Finally, the <tt class="docutils literal"><span class="pre">master</span></tt> branch of your fork can then be synced to upstream
master by:</p>
<div class="highlight-python"><pre>$ git push -u origin master</pre>
</div>
</div>
<div class="section" id="id33">
<h3><a class="toc-backref" href="#id73">缺陷修订分支</a><a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h3>
<p>Next, create a branch for the bugfix:</p>
<div class="code highlight-python"><pre>$ git checkout master
$ git checkout -b fix_1
$ git push -u origin fix_1</pre>
</div>
<p>This creates a <tt class="docutils literal"><span class="pre">fix_1</span></tt> branch locally and in our GitHub fork. At this
point, the <tt class="docutils literal"><span class="pre">fix_1</span></tt> branch is identical to the <tt class="docutils literal"><span class="pre">master</span></tt> branch, but not
for long! You are now ready to modify the code.</p>
</div>
<div class="section" id="id34">
<h3><a class="toc-backref" href="#id74">在本地修正缺陷</a><a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h3>
<p>At this point, change the status of the tracker issue to &#8220;In progress&#8221; to
communicate to the other Ceph developers that you have begun working on a
fix. If you don&#8217;t have permission to change that field, your comment that
you are working on the issue is sufficient.</p>
<p>Possibly, your fix is very simple and requires only minimal testing.
More likely, it will be an iterative process involving trial and error, not
to mention skill. An explanation of how to fix bugs is beyond the
scope of this document. Instead, we focus on the mechanics of the process
in the context of the Ceph project.</p>
<p>A detailed discussion of the tools available for validating your bugfixes,
see the <a class="reference internal" href="#id40">测试</a> chapter.</p>
<p>For now, let us just assume that you have finished work on the bugfix and
that you have tested it and believe it works. Commit the changes to your local
branch using the <tt class="docutils literal"><span class="pre">--signoff</span></tt> option:</p>
<div class="highlight-python"><pre>$ git commit -as</pre>
</div>
<p>and push the changes to your fork:</p>
<div class="highlight-python"><pre>$ git push origin fix_1</pre>
</div>
</div>
<div class="section" id="id35">
<h3><a class="toc-backref" href="#id75">GitHub 拉取请求</a><a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h3>
<p>The next step is to open a GitHub pull request. The purpose of this step is
to make your bugfix available to the community of Ceph developers.  They
will review it and may do additional testing on it.</p>
<p>In short, this is the point where you &#8220;go public&#8221; with your modifications.
Psychologically, you should be prepared to receive suggestions and
constructive criticism. Don&#8217;t worry! In our experience, the Ceph project is
a friendly place!</p>
<p>If you are uncertain how to use pull requests, you may read
<a class="reference external" href="https://help.github.com/articles/using-pull-requests/">this GitHub pull request tutorial</a>.</p>
<p>For some ideas on what constitutes a &#8220;good&#8221; pull request, see
the <a class="reference external" href="https://wiki.openstack.org/wiki/GitCommitMessages">Git 提交的实践真知</a> article at the <a class="reference external" href="https://wiki.openstack.org/wiki/Main_Page">OpenStack 项目百科</a>.</p>
<p>Once your pull request (PR) is opened, update the <a class="reference internal" href="#id27">问题跟踪</a> by
adding a comment to the bug pointing the other developers to your PR. The
update can be as simple as:</p>
<div class="highlight-python"><pre>*PR*: https://github.com/ceph/ceph/pull/$NUMBER_OF_YOUR_PULL_REQUEST</pre>
</div>
</div>
<div class="section" id="pr">
<span id="automated-pr-validation"></span><h3><a class="toc-backref" href="#id76">全自动的 PR 校验</a><a class="headerlink" href="#pr" title="Permalink to this headline">¶</a></h3>
<p>When your PR hits GitHub, the Ceph project&#8217;s <a class="reference external" href="https://en.wikipedia.org/wiki/Continuous_integration">Continuous Integration (CI)</a>
infrastructure will test it automatically. At the time of this writing
(March 2016), the automated CI testing included a test to check that the
commits in the PR are properly signed (see <a class="reference internal" href="#id10">补丁的提交</a>) and a
<tt class="docutils literal"><span class="pre">make</span> <span class="pre">check</span></tt> test.</p>
<p>The latter, <tt class="docutils literal"><span class="pre">make</span> <span class="pre">check</span></tt>, builds the PR and runs it through a battery of
tests. These tests run on machines operated by the Ceph Continuous
Integration (CI) team. When the tests complete, the result will be shown
on GitHub in the pull request itself.</p>
<p>You can (and should) also test your modifications before you open a PR.
Refer to the <a class="reference internal" href="#id40">测试</a> chapter for details.</p>
</div>
<div class="section" id="ceph-qa-suite">
<span id="integration-tests-aka-ceph-qa-suite"></span><h3><a class="toc-backref" href="#id77">集成测试（也就是 ceph-qa-suite ）</a><a class="headerlink" href="#ceph-qa-suite" title="Permalink to this headline">¶</a></h3>
<p>Since Ceph is a complex beast, it may also be necessary to test your fix to
see how it behaves on real clusters running either on real or virtual
hardware. Tests designed for this purpose live in the <a class="reference external" href="https://github.com/ceph/ceph/tree/master/qa/">ceph/qa
sub-directory</a> and are run via the <a class="reference external" href="https://github.com/ceph/teuthology">teuthology framework</a>.</p>
<p>If you have access to an OpenStack tenant, you are encouraged to run the
integration tests yourself using <a class="reference external" href="http://ceph-workbench.readthedocs.org/">ceph-workbench ceph-qa-suite</a>,
and to post the test results to the PR.</p>
<p>The Ceph community has access to the <a class="reference external" href="http://ceph.github.io/sepia/">Sepia lab</a> where integration tests can be run on
real hardware. Other developers may add tags like &#8220;needs-qa&#8221; to your PR.
This allows PRs that need testing to be merged into a single branch and
tested all at the same time. Since teuthology suites can take hours
(even days in some cases) to run, this can save a lot of time.</p>
<p>Integration testing is discussed in more detail in the <a class="reference internal" href="#id40">测试</a> chapter.</p>
</div>
<div class="section" id="id37">
<h3><a class="toc-backref" href="#id78">源码审核</a><a class="headerlink" href="#id37" title="Permalink to this headline">¶</a></h3>
<p>Once your bugfix has been thoroughly tested, or even during this process,
it will be subjected to code review by other developers. This typically
takes the form of correspondence in the PR itself, but can be supplemented
by discussions on <a class="reference internal" href="#irc">IRC</a> and the <a class="reference internal" href="#id9">邮件列表</a>.</p>
</div>
<div class="section" id="id38">
<h3><a class="toc-backref" href="#id79">修订你的 PR</a><a class="headerlink" href="#id38" title="Permalink to this headline">¶</a></h3>
<p>While your PR is going through <a class="reference internal" href="#id40">测试</a> and <a class="reference internal" href="#id37">源码审核</a>, you can
modify it at any time by editing files in your local branch.</p>
<p>After the changes are committed locally (to the <tt class="docutils literal"><span class="pre">fix_1</span></tt> branch in our
example), they need to be pushed to GitHub so they appear in the PR.</p>
<p>Modifying the PR is done by adding commits to the <tt class="docutils literal"><span class="pre">fix_1</span></tt> branch upon
which it is based, often followed by rebasing to modify the branch&#8217;s git
history. See <a class="reference external" href="https://www.atlassian.com/git/tutorials/rewriting-history">this tutorial</a> for a good
introduction to rebasing. When you are done with your modifications, you
will need to force push your branch with:</p>
<div class="code highlight-python"><pre>$ git push --force origin fix_1</pre>
</div>
</div>
<div class="section" id="id39">
<h3><a class="toc-backref" href="#id80">合并</a><a class="headerlink" href="#id39" title="Permalink to this headline">¶</a></h3>
<p>The bugfixing process culminates when one of the project leads decides to
merge your PR.</p>
<p>When this happens, it is a signal for you (or the lead who merged the PR)
to change the <a class="reference internal" href="#id27">问题跟踪</a> status to &#8220;Resolved&#8221;. Some issues may be
flagged for backporting, in which case the status should be changed to
&#8220;Pending Backport&#8221; (see the <a class="reference internal" href="#backporting">补丁移植（ Backporting ）</a> chapter for details).</p>
</div>
</div>
<div class="section" id="id40">
<h2><a class="toc-backref" href="#id81">测试</a><a class="headerlink" href="#id40" title="Permalink to this headline">¶</a></h2>
<p>Ceph has two types of tests: &#8220;make check&#8221; tests and integration tests.
The former are run via <cite>GNU Make &lt;https://www.gnu.org/software/make/&gt;</cite>,
and the latter are run via the <a class="reference external" href="https://github.com/ceph/teuthology">teuthology framework</a>. The following two
chapters examine the &#8220;make check&#8221; and integration tests in detail.</p>
</div>
<div class="section" id="make-check">
<h2><a class="toc-backref" href="#id82">测试 - make check</a><a class="headerlink" href="#make-check" title="Permalink to this headline">¶</a></h2>
<p>After compiling Ceph, the <tt class="docutils literal"><span class="pre">make</span> <span class="pre">check</span></tt> command can be used to run the
code through a battery of tests covering various aspects of Ceph. For
inclusion in &#8220;make check&#8221;, a test must:</p>
<ul class="simple">
<li>bind ports that do not conflict with other tests</li>
<li>not require root access</li>
<li>not require more than one machine to run</li>
<li>complete within a few minutes</li>
</ul>
<p>While it is possible to run <tt class="docutils literal"><span class="pre">make</span> <span class="pre">check</span></tt> directly, it can be tricky to
correctly set up your environment. Fortunately, a script is provided to
make it easier run &#8220;make check&#8221; on your code. It can be run from the
top-level directory of the Ceph source tree by doing:</p>
<div class="highlight-python"><pre>$ ./run-make-check.sh</pre>
</div>
<p>You will need a minimum of 8GB of RAM and 32GB of free disk space for this
command to complete successfully on x86_64 (other architectures may have
different constraints). Depending on your hardware, it can take from 20
minutes to three hours to complete, but it&#8217;s worth the wait.</p>
<div class="section" id="future-sections">
<h3><a class="toc-backref" href="#id83">Future sections</a><a class="headerlink" href="#future-sections" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Principles of make check tests</li>
<li>Where to find test results</li>
<li>How to interpret test results</li>
<li>Find the corresponding source code</li>
<li>Writing make check tests</li>
<li>Make check caveats</li>
</ul>
</div>
</div>
<div class="section" id="id41">
<h2><a class="toc-backref" href="#id84">测试 - 集成测试</a><a class="headerlink" href="#id41" title="Permalink to this headline">¶</a></h2>
<p>When a test requires multiple machines, root access or lasts for a
longer time (for example, to simulate a realistic Ceph deployment), it
is deemed to be an integration test. Integration tests are organized into
&#8220;suites&#8221;, which are defined in the <a class="reference external" href="https://github.com/ceph/ceph/tree/master/qa/">ceph/qa sub-directory</a> and run with
the <tt class="docutils literal"><span class="pre">teuthology-suite</span></tt> command.</p>
<p>The <tt class="docutils literal"><span class="pre">teuthology-suite</span></tt> command is part of the <a class="reference external" href="https://github.com/ceph/teuthology">teuthology framework</a>.
In the sections that follow we attempt to provide a detailed introduction
to that framework from the perspective of a beginning Ceph developer.</p>
<div class="section" id="teuthology-consumes-packages">
<h3><a class="toc-backref" href="#id85">Teuthology consumes packages</a><a class="headerlink" href="#teuthology-consumes-packages" title="Permalink to this headline">¶</a></h3>
<p>It may take some time to understand the significance of this fact, but it
is <cite>very</cite> significant. It means that automated tests can be conducted on
multiple platforms using the same packages (RPM, DEB) that can be
installed on any machine running those platforms.</p>
<p>Teuthology has a <a class="reference external" href="https://github.com/ceph/ceph/tree/master/qa/distros/supported">list of platforms that it supports</a> (as
of March 2016 the list consisted of &#8220;CentOS 7.2&#8221; and &#8220;Ubuntu 14.04&#8221;).  It
expects to be provided pre-built Ceph packages for these platforms.
Teuthology deploys these platforms on machines (bare-metal or
cloud-provisioned), installs the packages on them, and deploys Ceph
clusters on them - all as called for by the test.</p>
</div>
<div class="section" id="the-nightlies">
<h3><a class="toc-backref" href="#id86">The nightlies</a><a class="headerlink" href="#the-nightlies" title="Permalink to this headline">¶</a></h3>
<p>A number of integration tests are run on a regular basis in the <a class="reference external" href="http://ceph.github.io/sepia/">Sepia
lab</a> against the official Ceph repositories (on the <tt class="docutils literal"><span class="pre">master</span></tt> development
branch and the stable branches). Traditionally, these tests are called &#8220;the
nightlies&#8221; because the Ceph core developers used to live and work in
the same time zone and from their perspective the tests were run overnight.</p>
<p>The results of the nightlies are published at <a class="reference external" href="http://pulpito.ceph.com/">http://pulpito.ceph.com/</a> and
<a class="reference external" href="http://pulpito.ovh.sepia.ceph.com:8081/">http://pulpito.ovh.sepia.ceph.com:8081/</a>. The developer nick shows in the
test results URL and in the first column of the Pulpito dashboard.  The
results are also reported on the <a class="reference external" href="http://ceph.com/resources/mailing-list-irc/">ceph-qa mailing list</a> for analysis.</p>
</div>
<div class="section" id="suites-inventory">
<h3><a class="toc-backref" href="#id87">Suites inventory</a><a class="headerlink" href="#suites-inventory" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">suites</span></tt> directory of the <a class="reference external" href="https://github.com/ceph/ceph/tree/master/qa/">ceph/qa sub-directory</a> contains
all the integration tests, for all the Ceph components.</p>
<dl class="docutils">
<dt><a class="reference external" href="https://github.com/ceph/ceph/tree/master/qa/suites/ceph-deploy">ceph-deploy</a></dt>
<dd>install a Ceph cluster with <tt class="docutils literal"><span class="pre">ceph-deploy</span></tt> (<a class="reference external" href="../../man/8/ceph-deploy">ceph-deploy man page</a>)</dd>
<dt><a class="reference external" href="https://github.com/ceph/ceph/tree/master/qa/suites/ceph-disk">ceph-disk</a></dt>
<dd>verify init scripts (upstart etc.) and udev integration with
<tt class="docutils literal"><span class="pre">ceph-disk</span></tt> (<a class="reference external" href="../../man/8/ceph-disk">ceph-disk man page</a>), with and without <a class="reference external" href="https://gitlab.com/cryptsetup/cryptsetup/wikis/DMCrypt">dmcrypt</a> support.</dd>
<dt><a class="reference external" href="https://github.com/ceph/ceph/tree/master/qa/suites/dummy">dummy</a></dt>
<dd>get a machine, do nothing and return success (commonly used to
verify the integration testing infrastructure works as expected)</dd>
<dt><a class="reference external" href="https://github.com/ceph/ceph/tree/master/qa/suites/fs">fs</a></dt>
<dd>test CephFS</dd>
<dt><a class="reference external" href="https://github.com/ceph/ceph/tree/master/qa/suites/kcephfs">kcephfs</a></dt>
<dd>test the CephFS kernel module</dd>
<dt><a class="reference external" href="https://github.com/ceph/ceph/tree/master/qa/suites/krbd">krbd</a></dt>
<dd>test the RBD kernel module</dd>
<dt><a class="reference external" href="https://github.com/ceph/ceph/tree/master/qa/suites/powercycle">powercycle</a></dt>
<dd>verify the Ceph cluster behaves when machines are powered off
and on again</dd>
<dt><a class="reference external" href="https://github.com/ceph/ceph/tree/master/qa/suites/rados">rados</a></dt>
<dd>run Ceph clusters including OSDs and MONs, under various conditions of
stress</dd>
<dt><a class="reference external" href="https://github.com/ceph/ceph/tree/master/qa/suites/rbd">rbd</a></dt>
<dd>run RBD tests using actual Ceph clusters, with and without qemu</dd>
<dt><a class="reference external" href="https://github.com/ceph/ceph/tree/master/qa/suites/rgw">rgw</a></dt>
<dd>run RGW tests using actual Ceph clusters</dd>
<dt><a class="reference external" href="https://github.com/ceph/ceph/tree/master/qa/suites/smoke">smoke</a></dt>
<dd>run tests that exercise the Ceph API with an actual Ceph cluster</dd>
<dt><a class="reference external" href="https://github.com/ceph/ceph/tree/master/qa/suites/teuthology">teuthology</a></dt>
<dd>verify that teuthology can run integration tests, with and without OpenStack</dd>
<dt><a class="reference external" href="https://github.com/ceph/ceph/tree/master/qa/suites/upgrade">upgrade</a></dt>
<dd>for various versions of Ceph, verify that upgrades can happen
without disrupting an ongoing workload</dd>
</dl>
</div>
<div class="section" id="teuthology-describe-tests">
<h3><a class="toc-backref" href="#id88">teuthology-describe-tests</a><a class="headerlink" href="#teuthology-describe-tests" title="Permalink to this headline">¶</a></h3>
<p>In February 2016, a new feature called <tt class="docutils literal"><span class="pre">teuthology-describe-tests</span></tt> was
added to the <a class="reference external" href="https://github.com/ceph/teuthology">teuthology framework</a> to facilitate documentation and better
understanding of integration tests (<a class="reference external" href="http://article.gmane.org/gmane.comp.file-systems.ceph.devel/29287">feature announcement</a>).</p>
<p>The upshot is that tests can be documented by embedding <tt class="docutils literal"><span class="pre">meta:</span></tt>
annotations in the yaml files used to define the tests. The results can be
seen in the <a class="reference external" href="http://tracker.ceph.com/projects/ceph-qa-suite/wiki/">ceph-qa-suite wiki</a>.</p>
<p>Since this is a new feature, many yaml files have yet to be annotated.
Developers are encouraged to improve the documentation, in terms of both
coverage and quality.</p>
</div>
<div class="section" id="id42">
<h3><a class="toc-backref" href="#id89">集成测试是如何运作的</a><a class="headerlink" href="#id42" title="Permalink to this headline">¶</a></h3>
<p>Given that - as a new Ceph developer - you will typically not have access
to the <a class="reference external" href="http://ceph.github.io/sepia/">Sepia lab</a>, you may rightly ask how you can run the integration
tests in your own environment.</p>
<p>One option is to set up a teuthology cluster on bare metal. Though this is
a non-trivial task, it <cite>is</cite> possible. Here are <a class="reference external" href="http://docs.ceph.com/teuthology/docs/LAB_SETUP.html">some notes</a> to get you started
if you decide to go this route.</p>
<p>If you have access to an OpenStack tenant, you have another option: the
<a class="reference external" href="https://github.com/ceph/teuthology">teuthology framework</a> has an OpenStack backend, which is documented <a class="reference external" href="https://github.com/dachary/teuthology/tree/openstack#openstack-backend">here</a>.
This OpenStack backend can build packages from a given git commit or
branch, provision VMs, install the packages and run integration tests
on those VMs. This process is controlled using a tool called
<a class="reference external" href="http://ceph-workbench.readthedocs.org/">ceph-workbench ceph-qa-suite</a>. This tool also automates publishing of
test results at <a class="reference external" href="http://teuthology-logs.public.ceph.com">http://teuthology-logs.public.ceph.com</a>.</p>
<p>Running integration tests on your code contributions and publishing the
results allows reviewers to verify that changes to the code base do not
cause regressions, or to analyze test failures when they do occur.</p>
<p>Every teuthology cluster, whether bare-metal or cloud-provisioned, has a
so-called &#8220;teuthology machine&#8221; from which tests suites are triggered using the
<tt class="docutils literal"><span class="pre">teuthology-suite</span></tt> command.</p>
<p>A detailed and up-to-date description of each <a class="reference external" href="http://docs.ceph.com/teuthology/docs/teuthology.suite.html">teuthology-suite</a> option is
available by running the following command on the teuthology machine:</p>
<div class="highlight-python"><pre>$ teuthology-suite --help</pre>
</div>
</div>
<div class="section" id="how-integration-tests-are-defined">
<span id="id43"></span><h3><a class="toc-backref" href="#id90">如何定义集成测试</a><a class="headerlink" href="#how-integration-tests-are-defined" title="Permalink to this headline">¶</a></h3>
<p>Integration tests are defined by yaml files found in the <tt class="docutils literal"><span class="pre">suites</span></tt>
subdirectory of the <a class="reference external" href="https://github.com/ceph/ceph/tree/master/qa/">ceph/qa sub-directory</a> and implemented by python
code found in the <tt class="docutils literal"><span class="pre">tasks</span></tt> subdirectory. Some tests (&#8220;standalone tests&#8221;)
are defined in a single yaml file, while other tests are defined by a
directory tree containing yaml files that are combined, at runtime, into a
larger yaml file.</p>
</div>
<div class="section" id="reading-a-standalone-test">
<h3><a class="toc-backref" href="#id91">Reading a standalone test</a><a class="headerlink" href="#reading-a-standalone-test" title="Permalink to this headline">¶</a></h3>
<p>Let us first examine a standalone test, or &#8220;singleton&#8221;.</p>
<p>Here is a commented example using the integration test
<a class="reference external" href="https://github.com/ceph/ceph/blob/master/qa/suites/rados/singleton/all/admin-socket.yaml">rados/singleton/all/admin-socket.yaml</a></p>
<div class="highlight-python"><pre>roles:
- - mon.a
  - osd.0
  - osd.1
tasks:
- install:
- ceph:
- admin_socket:
    osd.0:
      version:
      git_version:
      help:
      config show:
      config set filestore_dump_file /tmp/foo:
      perf dump:
      perf schema:</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">roles</span></tt> array determines the composition of the cluster (how
many MONs, OSDs, etc.) on which this test is designed to run, as well
as how these roles will be distributed over the machines in the
testing cluster. In this case, there is only one element in the
top-level array: therefore, only one machine is allocated to the
test. The nested array declares that this machine shall run a MON with
id <tt class="docutils literal"><span class="pre">a</span></tt> (that is the <tt class="docutils literal"><span class="pre">mon.a</span></tt> in the list of roles) and two OSDs
(<tt class="docutils literal"><span class="pre">osd.0</span></tt> and <tt class="docutils literal"><span class="pre">osd.1</span></tt>).</p>
<p>The body of the test is in the <tt class="docutils literal"><span class="pre">tasks</span></tt> array: each element is
evaluated in order, causing the corresponding python file found in the
<tt class="docutils literal"><span class="pre">tasks</span></tt> subdirectory of the <a class="reference external" href="https://github.com/ceph/teuthology">teuthology repository</a> or
<a class="reference external" href="https://github.com/ceph/ceph/tree/master/qa/">ceph/qa sub-directory</a> to be run. &#8220;Running&#8221; in this case means calling
the <tt class="docutils literal"><span class="pre">task()</span></tt> function defined in that file.</p>
<p>In this case, the <a class="reference external" href="https://github.com/ceph/teuthology/blob/master/teuthology/task/install/__init__.py">install</a>
task comes first. It installs the Ceph packages on each machine (as
defined by the <tt class="docutils literal"><span class="pre">roles</span></tt> array). A full description of the <tt class="docutils literal"><span class="pre">install</span></tt>
task is <a class="reference external" href="https://github.com/ceph/teuthology/blob/master/teuthology/task/install/__init__.py">found in the python file</a>
(search for &#8220;def task&#8221;).</p>
<p>The <tt class="docutils literal"><span class="pre">ceph</span></tt> task, which is documented <a class="reference external" href="https://github.com/ceph/ceph/blob/master/qa/tasks/ceph.py">here</a> (again,
search for &#8220;def task&#8221;), starts OSDs and MONs (and possibly MDSs as well)
as required by the <tt class="docutils literal"><span class="pre">roles</span></tt> array. In this example, it will start one MON
(<tt class="docutils literal"><span class="pre">mon.a</span></tt>) and two OSDs (<tt class="docutils literal"><span class="pre">osd.0</span></tt> and <tt class="docutils literal"><span class="pre">osd.1</span></tt>), all on the same
machine. Control moves to the next task when the Ceph cluster reaches
<tt class="docutils literal"><span class="pre">HEALTH_OK</span></tt> state.</p>
<p>The next task is <tt class="docutils literal"><span class="pre">admin_socket</span></tt> (<a class="reference external" href="https://github.com/ceph/ceph/blob/master/qa/tasks/admin_socket.py">source code</a>).
The parameter of the <tt class="docutils literal"><span class="pre">admin_socket</span></tt> task (and any other task) is a
structure which is interpreted as documented in the task. In this example
the parameter is a set of commands to be sent to the admin socket of
<tt class="docutils literal"><span class="pre">osd.0</span></tt>. The task verifies that each of them returns on success (i.e.
exit code zero).</p>
<p>This test can be run with:</p>
<div class="highlight-python"><pre>$ teuthology-suite --suite rados/singleton/all/admin-socket.yaml fs/ext4.yaml</pre>
</div>
</div>
<div class="section" id="test-descriptions">
<h3><a class="toc-backref" href="#id92">Test descriptions</a><a class="headerlink" href="#test-descriptions" title="Permalink to this headline">¶</a></h3>
<p>Each test has a &#8220;test description&#8221;, which is similar to a directory path,
but not the same. In the case of a standalone test, like the one in
<a class="reference internal" href="#reading-a-standalone-test">Reading a standalone test</a>, the test description is identical to the
relative path (starting from the <tt class="docutils literal"><span class="pre">suites/</span></tt> directory of the
<a class="reference external" href="https://github.com/ceph/ceph/tree/master/qa/">ceph/qa sub-directory</a>) of the yaml file defining the test.</p>
<p>Much more commonly, tests are defined not by a single yaml file, but by a
<cite>directory tree of yaml files</cite>. At runtime, the tree is walked and all yaml
files (facets) are combined into larger yaml &#8220;programs&#8221; that define the
tests. A full listing of the yaml defining the test is included at the
beginning of every test log.</p>
<p>In these cases, the description of each test consists of the
subdirectory under <a class="reference external" href="https://github.com/ceph/ceph/tree/master/qa/suites">suites/</a> containing the
yaml facets, followed by an expression in curly braces (<tt class="docutils literal"><span class="pre">{}</span></tt>) consisting of
a list of yaml facets in order of concatenation. For instance the
test description:</p>
<div class="highlight-python"><pre>ceph-disk/basic/{distros/centos_7.0.yaml tasks/ceph-disk.yaml}</pre>
</div>
<p>signifies the concatenation of two files:</p>
<ul class="simple">
<li>ceph-disk/basic/distros/centos_7.0.yaml</li>
<li>ceph-disk/basic/tasks/ceph-disk.yaml</li>
</ul>
</div>
<div class="section" id="how-are-tests-built-from-directories">
<h3><a class="toc-backref" href="#id93">How are tests built from directories?</a><a class="headerlink" href="#how-are-tests-built-from-directories" title="Permalink to this headline">¶</a></h3>
<p>As noted in the previous section, most tests are not defined in a single
yaml file, but rather as a <cite>combination</cite> of files collected from a
directory tree within the <tt class="docutils literal"><span class="pre">suites/</span></tt> subdirectory of the <a class="reference external" href="https://github.com/ceph/ceph/tree/master/qa/">ceph/qa sub-directory</a>.</p>
<p>The set of all tests defined by a given subdirectory of <tt class="docutils literal"><span class="pre">suites/</span></tt> is
called an &#8220;integration test suite&#8221;, or a &#8220;teuthology suite&#8221;.</p>
<p>Combination of yaml facets is controlled by special files (<tt class="docutils literal"><span class="pre">%</span></tt> and
<tt class="docutils literal"><span class="pre">+</span></tt>) that are placed within the directory tree and can be thought of as
operators.  The <tt class="docutils literal"><span class="pre">%</span></tt> file is the &#8220;convolution&#8221; operator and <tt class="docutils literal"><span class="pre">+</span></tt>
signifies concatenation.</p>
</div>
<div class="section" id="convolution-operator">
<h3><a class="toc-backref" href="#id94">Convolution operator</a><a class="headerlink" href="#convolution-operator" title="Permalink to this headline">¶</a></h3>
<p>The convolution operator, implemented as an empty file called <tt class="docutils literal"><span class="pre">%</span></tt>, tells
teuthology to construct a test matrix from yaml facets found in
subdirectories below the directory containing the operator.</p>
<p>For example, the <a class="reference external" href="https://github.com/ceph/ceph/tree/jewel/qa/suites/ceph-disk/">ceph-disk suite</a> is
defined by the <tt class="docutils literal"><span class="pre">suites/ceph-disk/</span></tt> tree, which consists of the files and
subdirectories in the following structure:</p>
<div class="highlight-python"><pre>directory: ceph-disk/basic
    file: %
    directory: distros
       file: centos_7.0.yaml
       file: ubuntu_14.04.yaml
    directory: tasks
       file: ceph-disk.yaml</pre>
</div>
<p>This is interpreted as a 2x1 matrix consisting of two tests:</p>
<ol class="arabic simple">
<li>ceph-disk/basic/{distros/centos_7.0.yaml tasks/ceph-disk.yaml}</li>
<li>ceph-disk/basic/{distros/ubuntu_14.04.yaml tasks/ceph-disk.yaml}</li>
</ol>
<p>i.e. the concatenation of centos_7.0.yaml and ceph-disk.yaml and
the concatenation of ubuntu_14.04.yaml and ceph-disk.yaml, respectively.
In human terms, this means that the task found in <tt class="docutils literal"><span class="pre">ceph-disk.yaml</span></tt> is
intended to run on both CentOS 7.0 and Ubuntu 14.04.</p>
<p>Without the file percent, the <tt class="docutils literal"><span class="pre">ceph-disk</span></tt> tree would be interpreted as
three standalone tests:</p>
<ul class="simple">
<li>ceph-disk/basic/distros/centos_7.0.yaml</li>
<li>ceph-disk/basic/distros/ubuntu_14.04.yaml</li>
<li>ceph-disk/basic/tasks/ceph-disk.yaml</li>
</ul>
<p>(which would of course be wrong in this case).</p>
<p>Referring to the <a class="reference external" href="https://github.com/ceph/ceph/tree/master/qa/">ceph/qa sub-directory</a>, you will notice that the
<tt class="docutils literal"><span class="pre">centos_7.0.yaml</span></tt> and <tt class="docutils literal"><span class="pre">ubuntu_14.04.yaml</span></tt> files in the
<tt class="docutils literal"><span class="pre">suites/ceph-disk/basic/distros/</span></tt> directory are implemented as symlinks.
By using symlinks instead of copying, a single file can appear in multiple
suites. This eases the maintenance of the test framework as a whole.</p>
<p>All the tests generated from the <tt class="docutils literal"><span class="pre">suites/ceph-disk/</span></tt> directory tree
(also known as the &#8220;ceph-disk suite&#8221;) can be run with:</p>
<div class="highlight-python"><pre>$ teuthology-suite --suite ceph-disk</pre>
</div>
<p>An individual test from the <a class="reference external" href="https://github.com/ceph/ceph/tree/jewel/qa/suites/ceph-disk/">ceph-disk suite</a> can be run by adding the
<tt class="docutils literal"><span class="pre">--filter</span></tt> option:</p>
<div class="highlight-python"><pre>$ teuthology-suite \
    --suite ceph-disk/basic \
    --filter 'ceph-disk/basic/{distros/ubuntu_14.04.yaml tasks/ceph-disk.yaml}'</pre>
</div>
</div>
<div class="section" id="concatenation-operator">
<h3><a class="toc-backref" href="#id95">Concatenation operator</a><a class="headerlink" href="#concatenation-operator" title="Permalink to this headline">¶</a></h3>
<p>For even greater flexibility in sharing yaml files between suites, the
special file plus (<tt class="docutils literal"><span class="pre">+</span></tt>) can be used to concatenate files within a
directory. For instance, consider the <a class="reference external" href="https://github.com/ceph/ceph/tree/master/qa/suites/rbd/thrash">suites/rbd/thrash</a>
tree:</p>
<div class="highlight-python"><pre>directory: rbd/thrash
  file: %
  directory: clusters
    file: +
    file: fixed-2.yaml
    file: openstack.yaml
  directory: workloads
    file: rbd_api_tests_copy_on_read.yaml
    file: rbd_api_tests.yaml</pre>
</div>
<p>This creates two tests:</p>
<ul class="simple">
<li>rbd/thrash/{clusters/fixed-2.yaml clusters/openstack.yaml workloads/rbd_api_tests_copy_on_read.yaml}</li>
<li>rbd/thrash/{clusters/fixed-2.yaml clusters/openstack.yaml workloads/rbd_api_tests.yaml}</li>
</ul>
<p>Because the <tt class="docutils literal"><span class="pre">clusters/</span></tt> subdirectory contains the special file plus
(<tt class="docutils literal"><span class="pre">+</span></tt>), all the other files in that subdirectory (<tt class="docutils literal"><span class="pre">fixed-2.yaml</span></tt> and
<tt class="docutils literal"><span class="pre">openstack.yaml</span></tt> in this case) are concatenated together
and treated as a single file. Without the special file plus, they would
have been convolved with the files from the workloads directory to create
a 2x2 matrix:</p>
<ul class="simple">
<li>rbd/thrash/{clusters/openstack.yaml workloads/rbd_api_tests_copy_on_read.yaml}</li>
<li>rbd/thrash/{clusters/openstack.yaml workloads/rbd_api_tests.yaml}</li>
<li>rbd/thrash/{clusters/fixed-2.yaml workloads/rbd_api_tests_copy_on_read.yaml}</li>
<li>rbd/thrash/{clusters/fixed-2.yaml workloads/rbd_api_tests.yaml}</li>
</ul>
<p>The <tt class="docutils literal"><span class="pre">clusters/fixed-2.yaml</span></tt> file is shared among many suites to
define the following <tt class="docutils literal"><span class="pre">roles</span></tt>:</p>
<div class="highlight-python"><pre>roles:
- [mon.a, mon.c, osd.0, osd.1, osd.2, client.0]
- [mon.b, osd.3, osd.4, osd.5, client.1]</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">rbd/thrash</span></tt> suite as defined above, consisting of two tests,
can be run with:</p>
<div class="highlight-python"><pre>$ teuthology-suite --suite rbd/thrash</pre>
</div>
<p>A single test from the rbd/thrash suite can be run by adding the
<tt class="docutils literal"><span class="pre">--filter</span></tt> option:</p>
<div class="highlight-python"><pre>$ teuthology-suite \
    --suite rbd/thrash \
    --filter 'rbd/thrash/{clusters/fixed-2.yaml clusters/openstack.yaml workloads/rbd_api_tests_copy_on_read.yaml}'</pre>
</div>
</div>
<div class="section" id="filtering-tests-by-their-description">
<h3><a class="toc-backref" href="#id96">Filtering tests by their description</a><a class="headerlink" href="#filtering-tests-by-their-description" title="Permalink to this headline">¶</a></h3>
<p>When a few jobs fail and need to be run again, the <tt class="docutils literal"><span class="pre">--filter</span></tt> option
can be used to select tests with a matching description. For instance, if the
<tt class="docutils literal"><span class="pre">rados</span></tt> suite fails the <a class="reference external" href="https://github.com/ceph/ceph/blob/master/qa/suites/rados/singleton/all/peer.yaml">all/peer.yaml</a> test, the following will only run the tests that contain this file:</p>
<div class="highlight-python"><pre>teuthology-suite --suite rados --filter all/peer.yaml</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">--filter-out</span></tt> option does the opposite (it matches tests that do
<cite>not</cite> contain a given string), and can be combined with the <tt class="docutils literal"><span class="pre">--filter</span></tt>
option.</p>
<p>Both <tt class="docutils literal"><span class="pre">--filter</span></tt> and <tt class="docutils literal"><span class="pre">--filter-out</span></tt> take a comma-separated list of strings (which
means the comma character is implicitly forbidden in filenames found in the
<a class="reference external" href="https://github.com/ceph/ceph/tree/master/qa/">ceph/qa sub-directory</a>). For instance:</p>
<div class="highlight-python"><pre>teuthology-suite --suite rados --filter all/peer.yaml,all/rest-api.yaml</pre>
</div>
<p>will run tests that contain either
<a class="reference external" href="https://github.com/ceph/ceph/blob/master/qa/suites/rados/singleton/all/peer.yaml">all/peer.yaml</a>
or
<a class="reference external" href="https://github.com/ceph/ceph/blob/master/qa/suites/rados/singleton/all/rest-api.yaml">all/rest-api.yaml</a></p>
<p>Each string is looked up anywhere in the test description and has to
be an exact match: they are not regular expressions.</p>
</div>
<div class="section" id="reducing-the-number-of-tests">
<h3><a class="toc-backref" href="#id97">Reducing the number of tests</a><a class="headerlink" href="#reducing-the-number-of-tests" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">rados</span></tt> suite generates thousands of tests out of a few hundred
files. For instance, all tests in the <a class="reference external" href="https://github.com/ceph/ceph/tree/master/qa/suites/rados/thrash">rados/thrash suite</a>
run for <tt class="docutils literal"><span class="pre">xfs</span></tt>, <tt class="docutils literal"><span class="pre">btrfs</span></tt> and <tt class="docutils literal"><span class="pre">ext4</span></tt> because they are combined (via
special file <tt class="docutils literal"><span class="pre">%</span></tt>) with the <a class="reference external" href="https://github.com/ceph/ceph/tree/master/qa/suites/rados/thrash/fs">fs directory</a></p>
<p>All integration tests are required to be run before a Ceph release is published.
When merely verifying whether a contribution can be merged without
risking a trivial regression, it is enough to run a subset. The <tt class="docutils literal"><span class="pre">--subset</span></tt> option can be used to
reduce the number of tests that are triggered. For instance:</p>
<div class="highlight-python"><pre>teuthology-suite --suite rados --subset 0/4000</pre>
</div>
<p>will run as few tests as possible. The tradeoff in this case is that
some tests will only run on <tt class="docutils literal"><span class="pre">xfs</span></tt> and not on <tt class="docutils literal"><span class="pre">ext4</span></tt> or <tt class="docutils literal"><span class="pre">btrfs</span></tt>,
but no matter how small a ratio is provided in the <tt class="docutils literal"><span class="pre">--subset</span></tt>,
teuthology will still ensure that all files in the suite are in at
least one test. Understanding the actual logic that drives this
requires reading the teuthology source code.</p>
<p>The <tt class="docutils literal"><span class="pre">--limit</span></tt> option only runs the first <tt class="docutils literal"><span class="pre">N</span></tt> tests in the suite:
this is rarely useful, however, because there is no way to control which
test will be first.</p>
</div>
</div>
<div class="section" id="id45">
<h2><a class="toc-backref" href="#id98">在云端测试</a><a class="headerlink" href="#id45" title="Permalink to this headline">¶</a></h2>
<p>In this chapter, we will explain in detail how use an OpenStack
tenant as an environment for Ceph integration testing.</p>
<div class="section" id="assumptions-and-caveat">
<h3><a class="toc-backref" href="#id99">Assumptions and caveat</a><a class="headerlink" href="#assumptions-and-caveat" title="Permalink to this headline">¶</a></h3>
<p>We assume that:</p>
<ol class="arabic simple">
<li>you are the only person using the tenant</li>
<li>you have the credentials</li>
<li>the tenant supports the <tt class="docutils literal"><span class="pre">nova</span></tt> and <tt class="docutils literal"><span class="pre">cinder</span></tt> APIs</li>
</ol>
<p>Caveat: be aware that, as of this writing (July 2016), testing in
OpenStack clouds is a new feature. Things may not work as advertised.
If you run into trouble, ask for help on <a class="reference internal" href="#irc">IRC</a> or the <a class="reference internal" href="#id9">邮件列表</a>, or
open a bug report at the <a class="reference external" href="http://ceph-workbench.dachary.org/root/ceph-workbench/issues">ceph-workbench bug tracker</a>.</p>
</div>
<div class="section" id="prepare-tenant">
<h3><a class="toc-backref" href="#id100">Prepare tenant</a><a class="headerlink" href="#prepare-tenant" title="Permalink to this headline">¶</a></h3>
<p>If you have not tried to use <tt class="docutils literal"><span class="pre">ceph-workbench</span></tt> with this tenant before,
proceed to the next step.</p>
<p>To start with a clean slate, login to your tenant via the Horizon dashboard and:</p>
<ul class="simple">
<li>terminate the <tt class="docutils literal"><span class="pre">teuthology</span></tt> and <tt class="docutils literal"><span class="pre">packages-repository</span></tt> instances, if any</li>
<li>delete the <tt class="docutils literal"><span class="pre">teuthology</span></tt> and <tt class="docutils literal"><span class="pre">teuthology-worker</span></tt> security groups, if any</li>
<li>delete the <tt class="docutils literal"><span class="pre">teuthology</span></tt> and <tt class="docutils literal"><span class="pre">teuthology-myself</span></tt> key pairs, if any</li>
</ul>
<p>Also do the above if you ever get key-related errors (&#8220;invalid key&#8221;, etc.) when
trying to schedule suites.</p>
</div>
<div class="section" id="getting-ceph-workbench">
<h3><a class="toc-backref" href="#id101">Getting ceph-workbench</a><a class="headerlink" href="#getting-ceph-workbench" title="Permalink to this headline">¶</a></h3>
<p>Since testing in the cloud is done using the <a class="reference external" href="http://ceph-workbench.readthedocs.org/">ceph-workbench
ceph-qa-suite</a> tool, you will need to install that first. It is designed
to be installed via Docker, so if you don&#8217;t have Docker running on your
development machine, take care of that first. The Docker project has a good
tutorial called <a class="reference external" href="https://docs.docker.com/linux/">Get Started with Docker Engine for Linux</a> if you unsure how to proceed.</p>
<p>Once Docker is up and running, install <tt class="docutils literal"><span class="pre">ceph-workbench</span></tt> by following the
<a class="reference external" href="http://ceph-workbench.readthedocs.org/en/latest/#installation">Installation instructions in the ceph-workbench documentation</a>.</p>
</div>
<div class="section" id="linking-ceph-workbench-with-your-openstack-tenant">
<h3><a class="toc-backref" href="#id102">Linking ceph-workbench with your OpenStack tenant</a><a class="headerlink" href="#linking-ceph-workbench-with-your-openstack-tenant" title="Permalink to this headline">¶</a></h3>
<p>Before you can trigger your first teuthology suite, you will need to link
<tt class="docutils literal"><span class="pre">ceph-workbench</span></tt> with your OpenStack account.</p>
<p>First, download a <tt class="docutils literal"><span class="pre">openrc.sh</span></tt> file by clicking on the &#8220;Download OpenStack
RC File&#8221; button, which can be found in the &#8220;API Access&#8221; tab of the &#8220;Access
&amp; Security&#8221; dialog of the OpenStack Horizon dashboard.</p>
<p>Second, create a <tt class="docutils literal"><span class="pre">~/.ceph-workbench</span></tt> directory, set its permissions to
700, and move the <tt class="docutils literal"><span class="pre">openrc.sh</span></tt> file into it. Make sure that the filename
is exactly <tt class="docutils literal"><span class="pre">~/.ceph-workbench/openrc.sh</span></tt>.</p>
<p>Third, edit the file so it does not ask for your OpenStack password
interactively. Comment out the relevant lines and replace them with
something like:</p>
<div class="highlight-python"><pre>export OS_PASSWORD="aiVeth0aejee3eep8rogho3eep7Pha6ek"</pre>
</div>
<p>When <a class="reference external" href="http://ceph-workbench.readthedocs.org/">ceph-workbench ceph-qa-suite</a> connects to your OpenStack tenant for
the first time, it will generate two keypairs: <tt class="docutils literal"><span class="pre">teuthology-myself</span></tt> and
<tt class="docutils literal"><span class="pre">teuthology</span></tt>.</p>
</div>
<div class="section" id="run-the-dummy-suite">
<h3><a class="toc-backref" href="#id103">Run the dummy suite</a><a class="headerlink" href="#run-the-dummy-suite" title="Permalink to this headline">¶</a></h3>
<p>You are now ready to take your OpenStack teuthology setup for a test
drive:</p>
<div class="highlight-python"><pre>$ ceph-workbench ceph-qa-suite --suite dummy</pre>
</div>
<p>Be forewarned that the first run of <a class="reference external" href="http://ceph-workbench.readthedocs.org/">ceph-workbench ceph-qa-suite</a> on a
pristine tenant will take a long time to complete because it downloads a VM
image and during this time the command may not produce any output.</p>
<p>The images are cached in OpenStack, so they are only downloaded once.
Subsequent runs of the same command will complete faster.</p>
<p>Although <tt class="docutils literal"><span class="pre">dummy</span></tt> suite does not run any tests, in all other respects it
behaves just like a teuthology suite and produces some of the same
artifacts.</p>
<p>The last bit of output should look something like this:</p>
<div class="highlight-python"><pre>pulpito web interface: http://149.202.168.201:8081/
ssh access           : ssh -i /home/smithfarm/.ceph-workbench/teuthology-myself.pem ubuntu@149.202.168.201 # logs in /usr/share/nginx/html</pre>
</div>
<p>What this means is that <a class="reference external" href="http://ceph-workbench.readthedocs.org/">ceph-workbench ceph-qa-suite</a> triggered the test
suite run. It does not mean that the suite run has completed. To monitor
progress of the run, check the Pulpito web interface URL periodically, or
if you are impatient, ssh to the teuthology machine using the ssh command
shown and do:</p>
<div class="highlight-python"><pre>$ tail -f /var/log/teuthology.*</pre>
</div>
<p>The <cite>/usr/share/nginx/html</cite> directory contains the complete logs of the
test suite. If we had provided the <tt class="docutils literal"><span class="pre">--upload</span></tt> option to the
<a class="reference external" href="http://ceph-workbench.readthedocs.org/">ceph-workbench ceph-qa-suite</a> command, these logs would have been
uploaded to <a class="reference external" href="http://teuthology-logs.public.ceph.com">http://teuthology-logs.public.ceph.com</a>.</p>
</div>
<div class="section" id="run-a-standalone-test">
<h3><a class="toc-backref" href="#id104">Run a standalone test</a><a class="headerlink" href="#run-a-standalone-test" title="Permalink to this headline">¶</a></h3>
<p>The standalone test explained in <a class="reference internal" href="#reading-a-standalone-test">Reading a standalone test</a> can be run
with the following command:</p>
<div class="highlight-python"><pre>$ ceph-workbench ceph-qa-suite --suite rados/singleton/all/admin-socket.yaml</pre>
</div>
<p>This will run the suite shown on the current <tt class="docutils literal"><span class="pre">master</span></tt> branch of
<tt class="docutils literal"><span class="pre">ceph/ceph.git</span></tt>. You can specify a different branch with the <tt class="docutils literal"><span class="pre">--ceph</span></tt>
option, and even a different git repo with the <tt class="docutils literal"><span class="pre">--ceph-git-url</span></tt> option. (Run
<tt class="docutils literal"><span class="pre">ceph-workbench</span> <span class="pre">ceph-qa-suite</span> <span class="pre">--help</span></tt> for an up-to-date list of available
options.)</p>
<p>The first run of a suite will also take a long time, because ceph packages
have to be built, first. Again, the packages so built are cached and
<a class="reference external" href="http://ceph-workbench.readthedocs.org/">ceph-workbench ceph-qa-suite</a> will not build identical packages a second
time.</p>
</div>
<div class="section" id="interrupt-a-running-suite">
<h3><a class="toc-backref" href="#id105">Interrupt a running suite</a><a class="headerlink" href="#interrupt-a-running-suite" title="Permalink to this headline">¶</a></h3>
<p>Teuthology suites take time to run. From time to time one may wish to
interrupt a running suite. One obvious way to do this is:</p>
<div class="highlight-python"><pre>ceph-workbench ceph-qa-suite --teardown</pre>
</div>
<p>This destroys all VMs created by <a class="reference external" href="http://ceph-workbench.readthedocs.org/">ceph-workbench ceph-qa-suite</a> and
returns the OpenStack tenant to a &#8220;clean slate&#8221;.</p>
<p>Sometimes you may wish to interrupt the running suite, but keep the logs,
the teuthology VM, the packages-repository VM, etc. To do this, you can
<tt class="docutils literal"><span class="pre">ssh</span></tt> to the teuthology VM (using the <tt class="docutils literal"><span class="pre">ssh</span> <span class="pre">access</span></tt> command reported
when you triggered the suite &#8211; see <a class="reference internal" href="#run-the-dummy-suite">Run the dummy suite</a>) and, once
there:</p>
<div class="highlight-python"><pre>sudo /etc/init.d/teuthology restart</pre>
</div>
<p>This will keep the teuthology machine, the logs and the packages-repository
instance but nuke everything else.</p>
</div>
<div class="section" id="upload-logs-to-archive-server">
<h3><a class="toc-backref" href="#id106">Upload logs to archive server</a><a class="headerlink" href="#upload-logs-to-archive-server" title="Permalink to this headline">¶</a></h3>
<p>Since the teuthology instance in OpenStack is only semi-permanent, with limited
space for storing logs, <tt class="docutils literal"><span class="pre">teuthology-openstack</span></tt> provides an <tt class="docutils literal"><span class="pre">--upload</span></tt>
option which, if included in the <tt class="docutils literal"><span class="pre">ceph-workbench</span> <span class="pre">ceph-qa-suite</span></tt> command,
will cause logs from all failed jobs to be uploaded to the log archive server
maintained by the Ceph project. The logs will appear at the URL:</p>
<div class="highlight-python"><pre>http://teuthology-logs.public.ceph.com/$RUN</pre>
</div>
<p>where <tt class="docutils literal"><span class="pre">$RUN</span></tt> is the name of the run. It will be a string like this:</p>
<div class="highlight-python"><pre>ubuntu-2016-07-23_16:08:12-rados-hammer-backports---basic-openstack</pre>
</div>
<p>Even if you don&#8217;t providing the <tt class="docutils literal"><span class="pre">--upload</span></tt> option, however, all the logs can
still be found on the teuthology machine in the directory
<tt class="docutils literal"><span class="pre">/usr/share/nginx/html</span></tt>.</p>
</div>
<div class="section" id="provision-vms-ad-hoc">
<h3><a class="toc-backref" href="#id107">Provision VMs ad hoc</a><a class="headerlink" href="#provision-vms-ad-hoc" title="Permalink to this headline">¶</a></h3>
<p>From the teuthology VM, it is possible to provision machines on an &#8220;ad hoc&#8221;
basis, to use however you like. The magic incantation is:</p>
<div class="highlight-python"><pre>teuthology-lock --lock-many $NUMBER_OF_MACHINES \
    --os-type $OPERATING_SYSTEM \
    --os-version $OS_VERSION \
    --machine-type openstack \
    --owner $EMAIL_ADDRESS</pre>
</div>
<p>The command must be issued from the <tt class="docutils literal"><span class="pre">~/teuthology</span></tt> directory. The possible
values for <tt class="docutils literal"><span class="pre">OPERATING_SYSTEM</span></tt> AND <tt class="docutils literal"><span class="pre">OS_VERSION</span></tt> can be found by examining
the contents of the directory <tt class="docutils literal"><span class="pre">teuthology/openstack/</span></tt>. For example:</p>
<div class="highlight-python"><pre>teuthology-lock --lock-many 1 --os-type ubuntu --os-version 16.04 \
    --machine-type openstack --owner foo@example.com</pre>
</div>
<p>When you are finished with the machine, find it in the list of machines:</p>
<div class="highlight-python"><pre>openstack server list</pre>
</div>
<p>to determine the name or ID, and then terminate it with:</p>
<div class="highlight-python"><pre>openstack server delete $NAME_OR_ID</pre>
</div>
</div>
<div class="section" id="deploy-a-cluster-for-manual-testing">
<span id="id46"></span><h3><a class="toc-backref" href="#id108">部署用于手动测试的集群</a><a class="headerlink" href="#deploy-a-cluster-for-manual-testing" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="https://github.com/ceph/teuthology">teuthology framework</a> and <a class="reference external" href="http://ceph-workbench.readthedocs.org/">ceph-workbench ceph-qa-suite</a> are
versatile tools that automatically provision Ceph clusters in the cloud and
run various tests on them in an automated fashion. This enables a single
engineer, in a matter of hours, to perform thousands of tests that would
keep dozens of human testers occupied for days or weeks if conducted
manually.</p>
<p>However, there are times when the automated tests do not cover a particular
scenario and manual testing is desired. It turns out that it is simple to
adapt a test to stop and wait after the Ceph installation phase, and the
engineer can then ssh into the running cluster. Simply add the following
snippet in the desired place within the test YAML and schedule a run with the
test:</p>
<div class="highlight-python"><pre>tasks:
- exec:
    client.0:
      - sleep 1000000000 # forever</pre>
</div>
<p>(Make sure you have a <tt class="docutils literal"><span class="pre">client.0</span></tt> defined in your <tt class="docutils literal"><span class="pre">roles</span></tt> stanza or adapt
accordingly.)</p>
<p>The same effect can be achieved using the <tt class="docutils literal"><span class="pre">interactive</span></tt> task:</p>
<div class="highlight-python"><pre>tasks:
- interactive</pre>
</div>
<p>By following the test log, you can determine when the test cluster has entered
the &#8220;sleep forever&#8221; condition. At that point, you can ssh to the teuthology
machine and from there to one of the target VMs (OpenStack) or teuthology
worker machines machine (Sepia) where the test cluster is running.</p>
<p>The VMs (or &#8220;instances&#8221; in OpenStack terminology) created by
<a class="reference external" href="http://ceph-workbench.readthedocs.org/">ceph-workbench ceph-qa-suite</a> are named as follows:</p>
<p><tt class="docutils literal"><span class="pre">teuthology</span></tt> - the teuthology machine</p>
<p><tt class="docutils literal"><span class="pre">packages-repository</span></tt> - VM where packages are stored</p>
<p><tt class="docutils literal"><span class="pre">ceph-*</span></tt> - VM where packages are built</p>
<p><tt class="docutils literal"><span class="pre">target*</span></tt> - machines where tests are run</p>
<p>The VMs named <tt class="docutils literal"><span class="pre">target*</span></tt> are used by tests. If you are monitoring the
teuthology log for a given test, the hostnames of these target machines can
be found out by searching for the string <tt class="docutils literal"><span class="pre">Locked</span> <span class="pre">targets</span></tt>:</p>
<div class="highlight-python"><pre>2016-03-20T11:39:06.166 INFO:teuthology.task.internal:Locked targets:
  target149202171058.teuthology: null
  target149202171059.teuthology: null</pre>
</div>
<p>The IP addresses of the target machines can be found by running <tt class="docutils literal"><span class="pre">openstack</span>
<span class="pre">server</span> <span class="pre">list</span></tt> on the teuthology machine, but the target VM hostnames (e.g.
<tt class="docutils literal"><span class="pre">target149202171058.teuthology</span></tt>) are resolvable within the teuthology
cluster.</p>
</div>
</div>
<div class="section" id="s3">
<span id="testing-how-to-run-s3-tests-locally"></span><h2><a class="toc-backref" href="#id109">测试——如何在本地测试 S3</a><a class="headerlink" href="#s3" title="Permalink to this headline">¶</a></h2>
<p>RGW code can be tested by building Ceph locally from source, starting a vstart
cluster, and running the &#8220;s3-tests&#8221; suite against it.</p>
<p>The following instructions should work on jewel and above.</p>
<div class="section" id="step-1-build-ceph">
<h3><a class="toc-backref" href="#id110">Step 1 - build Ceph</a><a class="headerlink" href="#step-1-build-ceph" title="Permalink to this headline">¶</a></h3>
<p>Refer to <a class="reference internal" href="../install/build-ceph/"><em>构建 Ceph</em></a>.</p>
<p>You can do step 2 separately while it is building.</p>
</div>
<div class="section" id="step-2-s3-tests">
<h3><a class="toc-backref" href="#id111">Step 2 - s3-tests</a><a class="headerlink" href="#step-2-s3-tests" title="Permalink to this headline">¶</a></h3>
<p>The test suite is in a separate git repo, and is written in python. Perform the
following steps for jewel:</p>
<div class="highlight-python"><pre>git clone git://github.com/ceph/s3-tests
cd s3-tests
git checkout ceph-jewel
./bootstrap</pre>
</div>
<p>For kraken, checkout the <tt class="docutils literal"><span class="pre">ceph-kraken</span></tt> branch instead of <tt class="docutils literal"><span class="pre">ceph-jewel</span></tt>. For
master, use <tt class="docutils literal"><span class="pre">ceph-master</span></tt>.</p>
</div>
<div class="section" id="step-3-vstart">
<h3><a class="toc-backref" href="#id112">Step 3 - vstart</a><a class="headerlink" href="#step-3-vstart" title="Permalink to this headline">¶</a></h3>
<p>When the build completes, and still in the top-level directory of the git
clone where you built Ceph, do the following:</p>
<div class="highlight-python"><pre>cd src/
./vstart.sh -n -r --mds_num 0</pre>
</div>
<p>This will produce a lot of output as the vstart cluster is started up. At the
end you should see a message like:</p>
<div class="highlight-python"><pre>started.  stop.sh to stop.  see out/* (e.g. 'tail -f out/????') for debug output.</pre>
</div>
<p>This means the cluster is running.</p>
</div>
<div class="section" id="step-4-prepare-s3-environment">
<h3><a class="toc-backref" href="#id113">Step 4 - prepare S3 environment</a><a class="headerlink" href="#step-4-prepare-s3-environment" title="Permalink to this headline">¶</a></h3>
<p>The s3-tests suite expects to run in a particular environment (S3 users, keys,
configuration file).</p>
<p>Before you try to prepare the environment, make sure you don&#8217;t have any
existing keyring or <tt class="docutils literal"><span class="pre">ceph.conf</span></tt> files in <tt class="docutils literal"><span class="pre">/etc/ceph</span></tt>.</p>
<p>For jewel, Abhishek Lekshmanan wrote a script that can be used for this
purpose. Assuming you are testing jewel, run the following commands from the
<tt class="docutils literal"><span class="pre">src/</span></tt> directory of your ceph clone (where you just started the vstart
cluster):</p>
<div class="highlight-python"><pre>pushd ~
wget https://gist.githubusercontent.com/theanalyst/2fee6bc2780f67c79cad7802040fcddc/raw/b497ddba053d9a6fb5d91b73924cbafcfc32f137/s3tests-bootstrap.sh
popd
sh ~/s3tests-bootstrap.sh</pre>
</div>
<p>If the script is successful, it will display a blob of JSON and create a file
called <tt class="docutils literal"><span class="pre">s3.conf</span></tt> in the current directory.</p>
</div>
<div class="section" id="step-5-run-s3-tests">
<h3><a class="toc-backref" href="#id114">Step 5 - run s3-tests</a><a class="headerlink" href="#step-5-run-s3-tests" title="Permalink to this headline">¶</a></h3>
<p>To actually run the tests, take note of the full path to the <tt class="docutils literal"><span class="pre">s3.conf</span></tt> file
created in the previous step and then move to the directory where you cloned
<tt class="docutils literal"><span class="pre">s3-tests</span></tt> in Step 2.</p>
<p>First, verify that the test suite is there and can be run:</p>
<div class="highlight-python"><pre>S3TEST_CONF=/path/to/s3.conf ./virtualenv/bin/nosetests -a '!fails_on_rgw' -v --collect-only</pre>
</div>
<p>This should complete quickly - it is like a &#8220;dry run&#8221; of all the tests in the
suite.</p>
<p>Finally, run the test suite itself:</p>
<div class="highlight-python"><pre>S3TEST_CONF=/path/to/s3.conf ./virtualenv/bin/nosetests -a '!fails_on_rgw' -v</pre>
</div>
<p>Note: the following test is expected to error - this is a problem in the test
setup (WIP), not an actual test failure:</p>
<div class="highlight-python"><pre>ERROR: s3tests.functional.test_s3.test_bucket_acl_grant_email</pre>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../">
              <img class="logo" src="../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../start/intro/">Ceph 简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../start/">安装（快速）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/">安装（手动）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rados/">Ceph 存储集群</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cephfs/">Ceph 文件系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rbd/rbd/">Ceph 块设备</a></li>
<li class="toctree-l1"><a class="reference internal" href="../radosgw/">Ceph 对象网关</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mgr/">Ceph 管理器守护进程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/">API 文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture/">体系结构</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">开发文档</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">简介</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">必备知识</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">项目领袖</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">历史</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">软件许可</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">源代码仓库</a></li>
<li class="toctree-l3"><a class="reference internal" href="#redmine">Redmine 问题跟踪器</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id9">邮件列表</a></li>
<li class="toctree-l3"><a class="reference internal" href="#irc">IRC</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">补丁的提交</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">从源码构建</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ccache">用 ccache 加速本地构建</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id13">开发模式的集群</a></li>
<li class="toctree-l3"><a class="reference internal" href="#backporting">补丁移植（ Backporting ）</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#what-is-merged-where-and-when">What is merged where and when ?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#x-0-z">开发版（即 x.0.z ）</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#what">What ?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#where">Where ?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#when">When ?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#branch-merges">Branch merges</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#x-1-z">稳定版候选（即 x.1.z ）阶段一</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id14">What ?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id15">Where ?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id16">When ?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id17">Branch merges</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id18">稳定版候选（即 x.1.z ）阶段二</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id19">What ?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id20">Where ?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id21">When ?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id22">Branch merges</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#x-2-z">稳定版（即 x.2.z ）</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id23">What ?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id24">Where ?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id25">When ?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id26">分支合并</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id27">问题跟踪</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id28">问题跟踪器惯例</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id29">基本工作流</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id30">更新追踪器</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id31">上游源码</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id32">本地环境</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id33">缺陷修订分支</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id34">在本地修正缺陷</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id35">GitHub 拉取请求</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pr">全自动的 PR 校验</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ceph-qa-suite">集成测试（也就是 ceph-qa-suite ）</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id37">源码审核</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id38">修订你的 PR</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id39">合并</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id40">测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="#make-check">测试 - make check</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#future-sections">Future sections</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id41">测试 - 集成测试</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#teuthology-consumes-packages">Teuthology consumes packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-nightlies">The nightlies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#suites-inventory">Suites inventory</a></li>
<li class="toctree-l3"><a class="reference internal" href="#teuthology-describe-tests">teuthology-describe-tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id42">集成测试是如何运作的</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-integration-tests-are-defined">如何定义集成测试</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reading-a-standalone-test">Reading a standalone test</a></li>
<li class="toctree-l3"><a class="reference internal" href="#test-descriptions">Test descriptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-are-tests-built-from-directories">How are tests built from directories?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#convolution-operator">Convolution operator</a></li>
<li class="toctree-l3"><a class="reference internal" href="#concatenation-operator">Concatenation operator</a></li>
<li class="toctree-l3"><a class="reference internal" href="#filtering-tests-by-their-description">Filtering tests by their description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reducing-the-number-of-tests">Reducing the number of tests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id45">在云端测试</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#assumptions-and-caveat">Assumptions and caveat</a></li>
<li class="toctree-l3"><a class="reference internal" href="#prepare-tenant">Prepare tenant</a></li>
<li class="toctree-l3"><a class="reference internal" href="#getting-ceph-workbench">Getting ceph-workbench</a></li>
<li class="toctree-l3"><a class="reference internal" href="#linking-ceph-workbench-with-your-openstack-tenant">Linking ceph-workbench with your OpenStack tenant</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-the-dummy-suite">Run the dummy suite</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-a-standalone-test">Run a standalone test</a></li>
<li class="toctree-l3"><a class="reference internal" href="#interrupt-a-running-suite">Interrupt a running suite</a></li>
<li class="toctree-l3"><a class="reference internal" href="#upload-logs-to-archive-server">Upload logs to archive server</a></li>
<li class="toctree-l3"><a class="reference internal" href="#provision-vms-ad-hoc">Provision VMs ad hoc</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deploy-a-cluster-for-manual-testing">部署用于手动测试的集群</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#s3">测试——如何在本地测试 S3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-1-build-ceph">Step 1 - build Ceph</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-s3-tests">Step 2 - s3-tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-3-vstart">Step 3 - vstart</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-4-prepare-s3-environment">Step 4 - prepare S3 environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-5-run-s3-tests">Step 5 - run s3-tests</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes/">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases/">Ceph 版本</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary/">Ceph 术语</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README/">中文版翻译说明</a></li>
<li class="toctree-l1"><a class="reference internal" href="../translation-convention/">中文版词语翻译惯例</a></li>
</ul>


<!-- ugly kludge to make genindex look like it's part of the toc -->
<ul style="margin-top: -10px"><li class="toctree-l1"><a class="reference internal" href="../genindex/">Index</a></li></ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../release-notes/" title="Release Notes"
             >next</a> |</li>
        <li class="right" >
          <a href="../architecture/" title="体系结构"
             >previous</a> |</li>
        <li><a href="../">Ceph Documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2016, Red Hat, Inc, and contributors. Licensed under Creative Commons BY-SA.
    </div>
  </body>
</html>