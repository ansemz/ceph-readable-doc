
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>activate &#8212; Ceph Documentation</title>
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../../_static/js/ceph.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex/" />
    <link rel="search" title="Search" href="../../../search/" />
    <link rel="next" title="batch" href="../batch/" />
    <link rel="prev" title="lvm" href="../" />
    <script type="text/javascript" src="http://ayni.ceph.com/public/js/ceph.js"></script>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../batch/" title="batch"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../" title="lvm"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../">Ceph Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../" accesskey="U">ceph-volume</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            

<div id="dev-warning" class="admonition note" style="display:none;">
  <p class="first admonition-title">Notice</p>
  <p class="last">This document is for a development version of Ceph.</p>
</div>

<div id="eol-warning" class="admonition warning" style="display:none;">
  <p class="first admonition-title">Warning</p>
  <p class="last">This document is for an unsupported version of Ceph.</p>
</div>
  <div id="docubetter" align="right" style="display:none; padding: 15px; font-weight: bold;">
    <a id="edit-on-github" href="https://github.com/ceph/ceph/edit/master/doc/ceph-volume/lvm/activate.rst" rel="nofollow">Edit on GitHub</a> | <a href="https://github.com/ceph/ceph/projects/4">Report a Documentation Bug</a>
  </div>

  
  <div class="section" id="activate">
<span id="ceph-volume-lvm-activate"></span><h1><code class="docutils literal notranslate"><span class="pre">activate</span></code><a class="headerlink" href="#activate" title="Permalink to this headline">¶</a></h1>
<p>Once <a class="reference internal" href="../prepare/#ceph-volume-lvm-prepare"><span class="std std-ref">prepare</span></a> is completed, and all the various steps
that entails are done, the volume is ready to get “activated”.</p>
<p>This activation process enables a systemd unit that persists the OSD ID and its
UUID (also called <code class="docutils literal notranslate"><span class="pre">fsid</span></code> in Ceph CLI tools), so that at boot time it can
understand what OSD is enabled and needs to be mounted.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The execution of this call is fully idempotent, and there is no
side-effects when running multiple times</p>
</div>
<div class="section" id="new-osds">
<h2>New OSDs<a class="headerlink" href="#new-osds" title="Permalink to this headline">¶</a></h2>
<p>To activate newly prepared OSDs both the <a class="reference internal" href="../../../glossary/#term-osd-id"><span class="xref std std-term">OSD id</span></a> and <a class="reference internal" href="../../../glossary/#term-osd-uuid"><span class="xref std std-term">OSD uuid</span></a>
need to be supplied. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span><span class="o">-</span><span class="n">volume</span> <span class="n">lvm</span> <span class="n">activate</span> <span class="o">--</span><span class="n">bluestore</span> <span class="mi">0</span> <span class="mi">0263644</span><span class="n">D</span><span class="o">-</span><span class="mi">0</span><span class="n">BF1</span><span class="o">-</span><span class="mi">4</span><span class="n">D6D</span><span class="o">-</span><span class="n">BC34</span><span class="o">-</span><span class="mi">28</span><span class="n">BD98AE3BC8</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The UUID is stored in the <code class="docutils literal notranslate"><span class="pre">fsid</span></code> file in the OSD path, which is
generated when <a class="reference internal" href="../prepare/#ceph-volume-lvm-prepare"><span class="std std-ref">prepare</span></a> is used.</p>
</div>
</div>
<div class="section" id="activating-all-osds">
<h2>Activating all OSDs<a class="headerlink" href="#activating-all-osds" title="Permalink to this headline">¶</a></h2>
<p>It is possible to activate all existing OSDs at once by using the <code class="docutils literal notranslate"><span class="pre">--all</span></code>
flag. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span><span class="o">-</span><span class="n">volume</span> <span class="n">lvm</span> <span class="n">activate</span> <span class="o">--</span><span class="nb">all</span>
</pre></div>
</div>
<p>This call will inspect all the OSDs created by ceph-volume that are inactive
and will activate them one by one. If any of the OSDs are already running, it
will report them in the command output and skip them, making it safe to rerun
(idempotent).</p>
<div class="section" id="requiring-uuids">
<h3>requiring uuids<a class="headerlink" href="#requiring-uuids" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="../../../glossary/#term-osd-uuid"><span class="xref std std-term">OSD uuid</span></a> is being required as an extra step to ensure that the
right OSD is being activated. It is entirely possible that a previous OSD with
the same id exists and would end up activating the incorrect one.</p>
</div>
<div class="section" id="dmcrypt">
<h3>dmcrypt<a class="headerlink" href="#dmcrypt" title="Permalink to this headline">¶</a></h3>
<p>If the OSD was prepared with dmcrypt by ceph-volume, there is no need to
specify <code class="docutils literal notranslate"><span class="pre">--dmcrypt</span></code> on the command line again (that flag is not available for
the <code class="docutils literal notranslate"><span class="pre">activate</span></code> subcommand). An encrypted OSD will be automatically detected.</p>
</div>
</div>
<div class="section" id="discovery">
<h2>Discovery<a class="headerlink" href="#discovery" title="Permalink to this headline">¶</a></h2>
<p>With OSDs previously created by <code class="docutils literal notranslate"><span class="pre">ceph-volume</span></code>, a <em>discovery</em> process is
performed using <a class="reference internal" href="../../../glossary/#term-lvm-tags"><span class="xref std std-term">LVM tags</span></a> to enable the systemd units.</p>
<p>The systemd unit will capture the <a class="reference internal" href="../../../glossary/#term-osd-id"><span class="xref std std-term">OSD id</span></a> and <a class="reference internal" href="../../../glossary/#term-osd-uuid"><span class="xref std std-term">OSD uuid</span></a> and
persist it. Internally, the activation will enable it like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>systemctl enable ceph-volume@lvm-$id-$uuid
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="n">enable</span> <span class="n">ceph</span><span class="o">-</span><span class="n">volume</span><span class="nd">@lvm</span><span class="o">-</span><span class="mi">0</span><span class="o">-</span><span class="mi">8715</span><span class="n">BEB4</span><span class="o">-</span><span class="mi">15</span><span class="n">C5</span><span class="o">-</span><span class="mi">49</span><span class="n">DE</span><span class="o">-</span><span class="n">BA6F</span><span class="o">-</span><span class="mi">401086</span><span class="n">EC7B41</span>
</pre></div>
</div>
<p>Would start the discovery process for the OSD with an id of <code class="docutils literal notranslate"><span class="pre">0</span></code> and a UUID of
<code class="docutils literal notranslate"><span class="pre">8715BEB4-15C5-49DE-BA6F-401086EC7B41</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">for more details on the systemd workflow see <a class="reference internal" href="../systemd/#ceph-volume-lvm-systemd"><span class="std std-ref">systemd</span></a></p>
</div>
<p>The systemd unit will look for the matching OSD device, and by looking at its
<a class="reference internal" href="../../../glossary/#term-lvm-tags"><span class="xref std std-term">LVM tags</span></a> will proceed to:</p>
<dl class="docutils">
<dt># mount the device in the corresponding location (by convention this is</dt>
<dd><code class="docutils literal notranslate"><span class="pre">/var/lib/ceph/osd/&lt;cluster</span> <span class="pre">name&gt;-&lt;osd</span> <span class="pre">id&gt;/</span></code>)</dd>
</dl>
<p># ensure that all required devices are ready for that OSD. In the case of
a journal (when <code class="docutils literal notranslate"><span class="pre">--filestore</span></code> is selected) the device will be queried (with
<code class="docutils literal notranslate"><span class="pre">blkid</span></code> for partitions, and lvm for logical volumes) to ensure that the
correct device is being linked. The symbolic link will <em>always</em> be re-done to
ensure that the correct device is linked.</p>
<p># start the <code class="docutils literal notranslate"><span class="pre">ceph-osd&#64;0</span></code> systemd unit</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The system infers the objectstore type (filestore or bluestore) by
inspecting the LVM tags applied to the OSD devices</p>
</div>
</div>
<div class="section" id="existing-osds">
<h2>Existing OSDs<a class="headerlink" href="#existing-osds" title="Permalink to this headline">¶</a></h2>
<p>For existing OSDs that have been deployed with <code class="docutils literal notranslate"><span class="pre">ceph-disk</span></code>, they need to be
scanned and activated <a class="reference internal" href="../../simple/#ceph-volume-simple"><span class="std std-ref">using the simple sub-command</span></a>.
If a different tooling was used then the only way to port them over to the new
mechanism is to prepare them again (losing data). See
<a class="reference internal" href="../prepare/#ceph-volume-lvm-existing-osds"><span class="std std-ref">Existing OSDs</span></a> for details on how to proceed.</p>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>To recap the <code class="docutils literal notranslate"><span class="pre">activate</span></code> process for <a class="reference internal" href="../../../glossary/#term-bluestore"><span class="xref std std-term">bluestore</span></a>:</p>
<ol class="arabic simple">
<li>require both <a class="reference internal" href="../../../glossary/#term-osd-id"><span class="xref std std-term">OSD id</span></a> and <a class="reference internal" href="../../../glossary/#term-osd-uuid"><span class="xref std std-term">OSD uuid</span></a></li>
<li>enable the system unit with matching id and uuid</li>
<li>Create the <code class="docutils literal notranslate"><span class="pre">tmpfs</span></code> mount at the OSD directory in
<code class="docutils literal notranslate"><span class="pre">/var/lib/ceph/osd/$cluster-$id/</span></code></li>
<li>Recreate all the files needed with <code class="docutils literal notranslate"><span class="pre">ceph-bluestore-tool</span> <span class="pre">prime-osd-dir</span></code> by
pointing it to the OSD <code class="docutils literal notranslate"><span class="pre">block</span></code> device.</li>
<li>the systemd unit will ensure all devices are ready and linked</li>
<li>the matching <code class="docutils literal notranslate"><span class="pre">ceph-osd</span></code> systemd unit will get started</li>
</ol>
<p>And for <a class="reference internal" href="../../../glossary/#term-filestore"><span class="xref std std-term">filestore</span></a>:</p>
<ol class="arabic simple">
<li>require both <a class="reference internal" href="../../../glossary/#term-osd-id"><span class="xref std std-term">OSD id</span></a> and <a class="reference internal" href="../../../glossary/#term-osd-uuid"><span class="xref std std-term">OSD uuid</span></a></li>
<li>enable the system unit with matching id and uuid</li>
<li>the systemd unit will ensure all devices are ready and mounted (if needed)</li>
<li>the matching <code class="docutils literal notranslate"><span class="pre">ceph-osd</span></code> systemd unit will get started</li>
</ol>
</div>
</div>



          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../">
              <img class="logo" src="../../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../../">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../start/intro/">Intro to Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../start/">Installation (ceph-deploy)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/">Installation (Manual)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../start/kube-helm/">Installation (Kubernetes + Helm)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rados/">Ceph Storage Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cephfs/">Ceph Filesystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rbd/">Ceph Block Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../radosgw/">Ceph Object Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mgr/">Ceph Manager Daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../architecture/">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev/">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev/internals/">Ceph Internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../governance/">Governance</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../">ceph-volume</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../#migrating">Migrating</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../#new-deployments">New deployments</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../#existing-osds">Existing OSDs</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../../intro/">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../intro/#replacing-ceph-disk">Replacing <code class="docutils literal notranslate"><span class="pre">ceph-disk</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../intro/#gpt-partitions-are-simple">GPT partitions are simple?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../intro/#modularity">Modularity</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../intro/#ceph-volume-lvm"><code class="docutils literal notranslate"><span class="pre">ceph-volume</span> <span class="pre">lvm</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../intro/#lvm-performance-penalty">LVM performance penalty</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../systemd/">systemd</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../inventory/"><code class="docutils literal notranslate"><span class="pre">inventory</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../"><code class="docutils literal notranslate"><span class="pre">lvm</span></code></a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">activate</span></code></a><ul>
<li class="toctree-l5"><a class="reference internal" href="#new-osds">New OSDs</a></li>
<li class="toctree-l5"><a class="reference internal" href="#activating-all-osds">Activating all OSDs</a><ul>
<li class="toctree-l6"><a class="reference internal" href="#requiring-uuids">requiring uuids</a></li>
<li class="toctree-l6"><a class="reference internal" href="#dmcrypt">dmcrypt</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="#discovery">Discovery</a></li>
<li class="toctree-l5"><a class="reference internal" href="#existing-osds">Existing OSDs</a></li>
<li class="toctree-l5"><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../batch/"><code class="docutils literal notranslate"><span class="pre">batch</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batch/#reporting">Reporting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../encryption/">Encryption</a></li>
<li class="toctree-l4"><a class="reference internal" href="../prepare/"><code class="docutils literal notranslate"><span class="pre">prepare</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../create/"><code class="docutils literal notranslate"><span class="pre">create</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../scan/">scan</a></li>
<li class="toctree-l4"><a class="reference internal" href="../systemd/">systemd</a></li>
<li class="toctree-l4"><a class="reference internal" href="../list/"><code class="docutils literal notranslate"><span class="pre">list</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../zap/"><code class="docutils literal notranslate"><span class="pre">zap</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../simple/"><code class="docutils literal notranslate"><span class="pre">simple</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../simple/activate/"><code class="docutils literal notranslate"><span class="pre">activate</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../simple/scan/"><code class="docutils literal notranslate"><span class="pre">scan</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../simple/systemd/">systemd</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/">Ceph Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary/">Glossary</a></li>
</ul>


<!-- ugly kludge to make genindex look like it's part of the toc -->
<ul style="margin-top: -10px"><li class="toctree-l1"><a class="reference internal" href="../../../genindex/">Index</a></li></ul>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../batch/" title="batch"
             >next</a> |</li>
        <li class="right" >
          <a href="../" title="lvm"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../">Ceph Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../" >ceph-volume</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Red Hat, Inc, and contributors. Licensed under Creative Commons Attribution Share Alike 3.0 (CC-BY-SA-3.0).
    </div>
  </body>
</html>