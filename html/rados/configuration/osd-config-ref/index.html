
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>OSD 配置参考 &#8212; Ceph Documentation</title>
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script src="../../../_static/js/ceph.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex/" />
    <link rel="search" title="Search" href="../../../search/" />
    <link rel="next" title="BlueStore 配置参考" href="../bluestore-config-ref/" />
    <link rel="prev" title="监视器与 OSD 交互的配置" href="../mon-osd-interaction/" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../bluestore-config-ref/" title="BlueStore 配置参考"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../mon-osd-interaction/" title="监视器与 OSD 交互的配置"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../">Ceph Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../" >Ceph 存储集群</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../" accesskey="U">配置</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            

<div id="dev-warning" class="admonition note" style="display:none;">
  <p class="first admonition-title">Notice</p>
  <p class="last">This document is for a development version of Ceph.</p>
</div>

<div id="eol-warning" class="admonition warning" style="display:none;">
  <p class="first admonition-title">Warning</p>
  <p class="last">This document is for an unsupported version of Ceph.</p>
</div>
  <div id="docubetter" align="right" style="display:none; padding: 15px; font-weight: bold;">
    <a id="edit-on-github" href="https://github.com/ceph/ceph/edit/master/doc/rados/configuration/osd-config-ref.rst" rel="nofollow">Edit on GitHub</a> | <a href="https://pad.ceph.com/p/Report_Documentation_Bugs">Report a Documentation Bug</a>
  </div>

  
  <div class="section" id="osd">
<h1>OSD 配置参考<a class="headerlink" href="#osd" title="Permalink to this headline">¶</a></h1>
<p id="index-0">你可以通过配置文件调整 OSD ，但靠默认值和极少的配置 OSD 守护进程就能运行。最简 OSD 配置需设置 <code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">journal</span> <span class="pre">size</span></code> 和 <code class="docutils literal notranslate"><span class="pre">host</span></code> ，其他几乎都能用默认值。</p>
<p>Ceph 的 OSD 守护进程用递增的数字作标识，按惯例以 <code class="docutils literal notranslate"><span class="pre">0</span></code> 开始，如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">osd</span><span class="o">.</span><span class="mi">0</span>
<span class="n">osd</span><span class="o">.</span><span class="mi">1</span>
<span class="n">osd</span><span class="o">.</span><span class="mi">2</span>
</pre></div>
</div>
<p>在配置文件里， <code class="docutils literal notranslate"><span class="pre">[osd]</span></code> 段下的配置适用于所有 OSD ；要添加针对特定 OSD 的选项（如 <code class="docutils literal notranslate"><span class="pre">host</span></code> ），把它放到那个 OSD 段下即可，如：</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[osd]</span>
        <span class="na">osd journal size</span> <span class="o">=</span> <span class="s">5120</span>

<span class="k">[osd.0]</span>
        <span class="na">host</span> <span class="o">=</span> <span class="s">osd-host-a</span>

<span class="k">[osd.1]</span>
        <span class="na">host</span> <span class="o">=</span> <span class="s">osd-host-b</span>
</pre></div>
</div>
<span class="target" id="index-1"></span><div class="section" id="id1">
<h2>常规配置<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>下列选项可配置一 OSD 的唯一标识符、以及数据和日志的路径。 Ceph
部署脚本通常会自动生成 UUID 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>我们<strong>不建议</strong>更改数据和日志的默认路径，因为这样会增加后续的排障难度。</p>
</div>
<p>日志尺寸应该大于期望的驱动器速度和 <code class="docutils literal notranslate"><span class="pre">filestore</span> <span class="pre">max</span> <span class="pre">sync</span> <span class="pre">interval</span></code>
之乘积的两倍；最常见的方法是为日志驱动器（通常是 SSD ）分区并挂载好，这样 Ceph 就可以用整个分区做日志。</p>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">uuid</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>OSD 的全局唯一标识符（ UUID ）。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>UUID</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p>The UUID.</p>
</dd>
<dt class="field-even">备注</dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">uuid</span></code> 适用于单个 OSD ， <code class="docutils literal notranslate"><span class="pre">fsid</span></code> 适用于整个集群。</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">data</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>OSD 数据存储位置，你得创建并把数据盘挂载到其下。我们不推荐更改默认值。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>String</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">/var/lib/ceph/osd/$cluster-$id</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">max</span> <span class="pre">write</span> <span class="pre">size</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>一次写入的最大尺寸，MB。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">90</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">max</span> <span class="pre">object</span> <span class="pre">size</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>单个 RADOS 对象的最大尺寸，单位为字节。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Unsigned Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p>128MB</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">client</span> <span class="pre">message</span> <span class="pre">size</span> <span class="pre">cap</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>内存里允许的最大客户端数据消息。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>64-bit Unsigned Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p>默认为 500MB 。 <code class="docutils literal notranslate"><span class="pre">500*1024L*1024L</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">class</span> <span class="pre">dir</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>RADOS 类插件的路径。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>String</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">$libdir/rados-classes</span></code></p>
</dd>
</dl>
<span class="target" id="index-2"></span></div>
<div class="section" id="id2">
<h2>文件系统选项<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>Ceph 可自动创建并挂载所需的文件系统。</p>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">mkfs</span> <span class="pre">options</span> <span class="pre">{fs-type}</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>为 OSD 新建 {fs-type} 类型的文件系统时使用的选项。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>String</p>
</dd>
<dt class="field-odd">xfs 默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">-i</span> <span class="pre">2048</span></code></p>
</dd>
<dt class="field-even">其余文件系统默认值</dt>
<dd class="field-even"><p>{empty string}</p>
</dd>
<dt class="field-odd">实例</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">mkfs</span> <span class="pre">options</span> <span class="pre">xfs</span> <span class="pre">=</span> <span class="pre">-f</span> <span class="pre">-d</span> <span class="pre">agcount=24</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">mount</span> <span class="pre">options</span> <span class="pre">{fs-type}</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>挂载 {fs-type} 类型的文件系统作为 OSD 数据目录时所用的选项。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>String</p>
</dd>
<dt class="field-odd">xfs 默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">rw,noatime,inode64</span></code></p>
</dd>
<dt class="field-even">其余文件系统默认值</dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">rw,</span> <span class="pre">noatime</span></code></p>
</dd>
<dt class="field-odd">实例</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">mount</span> <span class="pre">options</span> <span class="pre">xfs</span> <span class="pre">=</span> <span class="pre">rw,</span> <span class="pre">noatime,</span> <span class="pre">inode64,</span> <span class="pre">logbufs=8</span></code></p>
</dd>
</dl>
<span class="target" id="index-3"></span></div>
<div class="section" id="id3">
<h2>日志选项<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>默认情况下， Ceph 觉得你会把 OSD 日志存储于下列路径：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/var/lib/ceph/osd/$cluster-$id/journal
</pre></div>
</div>
<p>When using a single device type (for example, spinning drives), the journals
should be <em>colocated</em>: the logical volume (or partition) should be in the same
device as the <code class="docutils literal notranslate"><span class="pre">data</span></code> logical volume.</p>
<p>When using a mix of fast (SSDs, NVMe) devices with slower ones (like spinning
drives) it makes sense to place the journal on the faster device, while
<code class="docutils literal notranslate"><span class="pre">data</span></code> occupies the slower device fully.</p>
<p>The default <code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">journal</span> <span class="pre">size</span></code> value is 5120 (5 gigabytes), but it can be
larger, in which case it will need to be set in the <code class="docutils literal notranslate"><span class="pre">ceph.conf</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">osd</span> <span class="n">journal</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">10240</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">journal</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>OSD 日志路径，可以是一个文件或块设备（ SSD 的一个分区）的路径。如果是文件，要先创建相应目录。我们建议用 <code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">data</span></code> 以外的独立驱动器。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>String</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">/var/lib/ceph/osd/$cluster-$id/journal</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">journal</span> <span class="pre">size</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>日志尺寸（ MB ）。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">5120</span></code></p>
</dd>
</dl>
<p>详情见<a class="reference external" href="../journal-ref">日志配置参考</a>。</p>
</div>
<div class="section" id="id4">
<h2>监视器和 OSD 的交互<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>OSD 周期性地相互检查心跳并报告给监视器。 Ceph 默认配置可满足多数情况，但是如果你的网络延时大，就得用较长间隔。关于心跳的讨论参见<a class="reference external" href="../mon-osd-interaction">监视器与 OSD 交互的配置</a>。</p>
</div>
<div class="section" id="id5">
<h2>数据归置<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>详情见<a class="reference external" href="../pool-pg-config-ref">存储池和归置组配置参考</a>。</p>
<span class="target" id="index-4"></span></div>
<div class="section" id="id6">
<h2>洗刷<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<p>除了为对象复制多个副本外， Ceph 还要洗刷归置组以确保数据完整性。这种洗刷类似对象存储层的 <code class="docutils literal notranslate"><span class="pre">fsck</span></code> ，对每个归置组， Ceph 生成一个所有对象的目录，并比对每个主对象及其副本以确保没有对象丢失或错配。轻微洗刷（每天）检查对象尺寸和属性，深层洗刷（每周）会读出数据并用校验和方法确认数据完整性。</p>
<p>洗刷对维护数据完整性很重要，但会影响性能；你可以用下列选项来增加或减少洗刷操作。</p>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">max</span> <span class="pre">scrubs</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>一 OSD 的最大并发洗刷操作数。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Int</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">1</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">scrub</span> <span class="pre">begin</span> <span class="pre">hour</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>被调度的洗刷操作在一天中可以运行的时间下限。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>0 到 24 之间的整数</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">scrub</span> <span class="pre">end</span> <span class="pre">hour</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>被调度的洗刷操作在一天中可以运行的时间上限。本选项与 <code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">scrub</span> <span class="pre">begin</span> <span class="pre">hour</span></code> 一起定义了一个时间窗口，在此期间可以进行洗刷操作。但是，在某个归置组的洗刷间隔超过 <code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">scrub</span> <span class="pre">max</span> <span class="pre">interval</span></code> 时，不管这个时间窗口是否合适都会执行。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>0 到 24 之间的整数</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">24</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">scrub</span> <span class="pre">during</span> <span class="pre">recovery</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>在恢复期间允许洗刷。有正在进行的恢复，且这里为 <code class="docutils literal notranslate"><span class="pre">false</span></code>
时，就会禁止调度新的洗刷（和深层洗刷）。已经在运行的洗刷不受影响。对繁忙的集群来说，这样做可降低负载。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Boolean</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">true</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">scrub</span> <span class="pre">thread</span> <span class="pre">timeout</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>洗刷线程最大死亡时值。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">60</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">scrub</span> <span class="pre">finalize</span> <span class="pre">thread</span> <span class="pre">timeout</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>洗刷终结线程最大超时值。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">60*10</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">scrub</span> <span class="pre">load</span> <span class="pre">threshold</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>标准的最大负载，当前系统负载（ <code class="docutils literal notranslate"><span class="pre">getloadavg()</span> <span class="pre">/</span> <span class="pre">在线</span> <span class="pre">CPU</span> <span class="pre">数量</span></code>
所定义的）高于此值时 Ceph 不会洗刷。默认 <code class="docutils literal notranslate"><span class="pre">0.5</span></code> 。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">0.5</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">scrub</span> <span class="pre">min</span> <span class="pre">interval</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>集群负载低的时候，洗刷的最小间隔时间，秒。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p>每天一次。 <code class="docutils literal notranslate"><span class="pre">60*60*24</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">scrub</span> <span class="pre">max</span> <span class="pre">interval</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>不论集群负载如何，都要进行洗刷的时间间隔。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p>每周一次。 <code class="docutils literal notranslate"><span class="pre">7*60*60*24</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">scrub</span> <span class="pre">chunk</span> <span class="pre">min</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>单个操作可洗刷的最小对象块数。数据块在洗刷期间， Ceph 会阻塞别人向它写入。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p>5</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">scrub</span> <span class="pre">chunk</span> <span class="pre">max</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>单个操作可洗刷的最大对象块数。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p>25</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">scrub</span> <span class="pre">sleep</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>洗刷下一组数据块前等待的时间。增加此值会拖慢整个洗刷进度，但对客户端操作没什么影响。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p>0</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">deep</span> <span class="pre">scrub</span> <span class="pre">interval</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>深层洗刷的间隔（完整地读所有数据）。
<code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">scrub</span> <span class="pre">load</span> <span class="pre">threshold</span></code> 不会影响此选项。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p>每周一次。 <code class="docutils literal notranslate"><span class="pre">60*60*24*7</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">scrub</span> <span class="pre">interval</span> <span class="pre">randomize</span> <span class="pre">ratio</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>在给某一归置组调度下一个洗刷作业时，给 <code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">scrub</span> <span class="pre">min</span> <span class="pre">interval</span></code> 增加个随机延时，这个延时是个小于 <code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">scrub</span> <span class="pre">min</span> <span class="pre">interval</span></code> * <code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">scrub</span> <span class="pre">interval</span> <span class="pre">randomized</span> <span class="pre">ratio</span></code> 的随机值。所以在实践中，这个默认设置会把洗刷操作随机地散布到允许的时间窗口内，即 <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">1.5]</span></code> *
<code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">scrub</span> <span class="pre">min</span> <span class="pre">interval</span></code> 。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">0.5</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">deep</span> <span class="pre">scrub</span> <span class="pre">stride</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>深层洗刷时的读取尺寸。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p>512 KB. <code class="docutils literal notranslate"><span class="pre">524288</span></code></p>
</dd>
</dl>
<span class="target" id="index-5"></span></div>
<div class="section" id="id7">
<h2>操作数<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">op</span> <span class="pre">queue</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>本选项用于配置 OSD 内各种操作（ ops ）的优先顺序。两种队列都实现了严格子队列，出常规队列之前要先出子队列，它与常规队列的实现机制不同。最初的 PrioritizedQueue
(<code class="docutils literal notranslate"><span class="pre">prio</span></code>) 使用令牌桶系统，在令牌足够多时它会先处理优先级高的队列；在令牌不够多时，则按优先级从低到高依次处理。 WeightedPriorityQueue (<code class="docutils literal notranslate"><span class="pre">wpq</span></code>) 会根据其优先级处理所有队列，以避免出现饥饿队列。在一部分
OSD 负载高于其它的时， WPQ 应该有优势。
新的、基于 mClock 的 OpClassQueue (<code class="docutils literal notranslate"><span class="pre">mclock_opclass</span></code>)可针对它们所属的类（ recovery 、 scrub 、 snaptrim 、
client op 、 osd subop ）来划分优先级。还有，基于 mClock
的 ClientQueue (<code class="docutils literal notranslate"><span class="pre">mclock_client</span></code>) 还能结合客户端标识符来增进各客户端之间的公平性。见<a class="reference internal" href="#mclock-qos">基于 mClock 的 QoS</a>。此配置更改后需重启。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>String</p>
</dd>
<dt class="field-odd">可选值</dt>
<dd class="field-odd"><p>prio, wpq, mclock_opclass, mclock_client</p>
</dd>
<dt class="field-even">默认值</dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">prio</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">op</span> <span class="pre">queue</span> <span class="pre">cut</span> <span class="pre">off</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>本选项用于配置把哪个优先级的操作放入严格队列、还是常规队列。 <code class="docutils literal notranslate"><span class="pre">low</span></code> 这个选项会把所有复制操作以及优先级更高的放入严格队列；而 <code class="docutils literal notranslate"><span class="pre">high</span></code> 选项只会把复制的确认反馈操作以及优先级更高的发往严格队列。此选项设置为
<code class="docutils literal notranslate"><span class="pre">high</span></code> 时，应该有助于缓解集群内某些 OSD 特别繁忙的情形，尤其是配合 <code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">op</span> <span class="pre">queue</span></code> 设置为 <code class="docutils literal notranslate"><span class="pre">wpq</span></code> 使用时效果更佳。忙于处理副本流量的 OSD 们，如果没有这些配置，它们的主副本（ primary client ）客户端往往比较空闲。此配置更改后需重启。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>String</p>
</dd>
<dt class="field-odd">可选值</dt>
<dd class="field-odd"><p>low, high</p>
</dd>
<dt class="field-even">默认值</dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">low</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">client</span> <span class="pre">op</span> <span class="pre">priority</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>设置客户端操作优先级，它相对于
<code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">recovery</span> <span class="pre">op</span> <span class="pre">priority</span></code> 。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">63</span></code></p>
</dd>
<dt class="field-even">有效范围</dt>
<dd class="field-even"><p>1-63</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">recovery</span> <span class="pre">op</span> <span class="pre">priority</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>设置恢复优先级，其值相对于 <code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">client</span> <span class="pre">op</span> <span class="pre">priority</span></code> 。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">3</span></code></p>
</dd>
<dt class="field-even">有效范围</dt>
<dd class="field-even"><p>1-63</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">scrub</span> <span class="pre">priority</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>设置洗刷操作的优先级。与 <code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">client</span> <span class="pre">op</span> <span class="pre">priority</span></code> 有关。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">5</span></code></p>
</dd>
<dt class="field-even">有效范围</dt>
<dd class="field-even"><p>1-63</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">requested</span> <span class="pre">scrub</span> <span class="pre">priority</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>The priority set for user requested scrub on the work queue.  If
this value were to be smaller than <code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">client</span> <span class="pre">op</span> <span class="pre">priority</span></code> it
can be boosted to the value of <code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">client</span> <span class="pre">op</span> <span class="pre">priority</span></code> when
scrub is blocking client operations.</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">120</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">snap</span> <span class="pre">trim</span> <span class="pre">priority</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>设置快照修建操作的优先级。与 <code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">client</span> <span class="pre">op</span> <span class="pre">priority</span></code>
有关。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">5</span></code></p>
</dd>
<dt class="field-even">有效范围</dt>
<dd class="field-even"><p>1-63</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">snap</span> <span class="pre">trim</span> <span class="pre">sleep</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>Time in seconds to sleep before next snap trim op.
Increasing this value will slow down snap trimming.
This option overrides backend specific variants.</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">snap</span> <span class="pre">trim</span> <span class="pre">sleep</span> <span class="pre">hdd</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>Time in seconds to sleep before next snap trim op
for HDDs.</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">5</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">snap</span> <span class="pre">trim</span> <span class="pre">sleep</span> <span class="pre">ssd</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>Time in seconds to sleep before next snap trim op
for SSDs.</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">snap</span> <span class="pre">trim</span> <span class="pre">sleep</span> <span class="pre">hybrid</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>Time in seconds to sleep before next snap trim op
when osd data is on HDD and osd journal is on SSD.</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">2</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">op</span> <span class="pre">thread</span> <span class="pre">timeout</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>OSD 线程超时秒数。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">15</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">op</span> <span class="pre">complaint</span> <span class="pre">time</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>一个操作进行多久后开始抱怨。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">30</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">disk</span> <span class="pre">threads</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>硬盘线程数，用于在后台执行磁盘密集型操作，像数据洗刷和快照修复。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">1</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">disk</span> <span class="pre">thread</span> <span class="pre">ioprio</span> <span class="pre">class</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>警告：只有 <code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">disk</span> <span class="pre">thread</span> <span class="pre">ioprio</span> <span class="pre">class</span></code> 和 <code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">disk</span> <span class="pre">thread</span> <span class="pre">ioprio</span> <span class="pre">priority</span></code> 同时改为非默认值时此配置才生效。 OSD 用 ioprio_set(2) 为磁盘线程设置 I/O
调度分类（ <code class="docutils literal notranslate"><span class="pre">class</span></code> ），当前支持 <code class="docutils literal notranslate"><span class="pre">idle</span></code> 、 <code class="docutils literal notranslate"><span class="pre">be</span></code> 或
<code class="docutils literal notranslate"><span class="pre">rt</span></code> 。其中， <code class="docutils literal notranslate"><span class="pre">idle</span></code> 类意味着磁盘线程的优先级低于其它的 OSD 线程，适合需延缓洗刷操作的情形，如 OSD 正忙于处理客户端操作。 <code class="docutils literal notranslate"><span class="pre">be</span></code> 是默认值，将设置与其它 OSD 线程相同的优先级。 <code class="docutils literal notranslate"><span class="pre">rt</span></code> 意为磁盘线程的优先级将高于其它任何
OSD 线程。注：只能与 Linux 内核的 CFQ 调度器配合使用。从
Jewel 版起，洗刷操作已经不再由磁盘的 iothread 发起了，请参考 OSD 优先级选项。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>String</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p>空字符串</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">disk</span> <span class="pre">thread</span> <span class="pre">ioprio</span> <span class="pre">priority</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>警告：只有 <code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">disk</span> <span class="pre">thread</span> <span class="pre">ioprio</span> <span class="pre">class</span></code> 和 <code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">disk</span> <span class="pre">thread</span> <span class="pre">ioprio</span> <span class="pre">priority</span></code> 同时改为非默认值时此配置才生效。它通过 ioprio_set(2) 设置磁盘线程的 I/O 调度优先级（ <code class="docutils literal notranslate"><span class="pre">priority</span></code> ），优先级从最高的 0 到最低的
7 。如果某主机上的所有 OSD 都在 <code class="docutils literal notranslate"><span class="pre">idle</span></code> 类中竞争 I/O 资源（即控制器拥塞了），那么你就可以用此选项把某 OSD 的磁盘线程优先级调低为 7 ，其它优先级为 0 的 OSD 就获得优先权了。注：只能与 Linux 内核的 CFQ 调度器配合使用。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>0 到 7 间的整数， -1 禁用此功能。</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">-1</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">op</span> <span class="pre">history</span> <span class="pre">size</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>要跟踪的最大已完成操作数量。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Unsigned Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">20</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">op</span> <span class="pre">history</span> <span class="pre">duration</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>要跟踪的最老已完成操作。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Unsigned Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">600</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">op</span> <span class="pre">log</span> <span class="pre">threshold</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>一次显示多少操作日志。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">5</span></code></p>
</dd>
</dl>
<div class="section" id="mclock-qos">
<span id="dmclock-qos"></span><h3>基于 mClock 的 QoS<a class="headerlink" href="#mclock-qos" title="Permalink to this headline">¶</a></h3>
<p>Ceph 对 mClock 的应用仍处于实验阶段，应当以探索心态试用。</p>
<div class="section" id="id8">
<h4>核心概念<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<p>The QoS support of Ceph is implemented using a queueing scheduler
based on <a class="reference external" href="https://www.usenix.org/legacy/event/osdi10/tech/full_papers/Gulati.pdf">the dmClock algorithm</a>. This algorithm allocates the I/O
resources of the Ceph cluster in proportion to weights, and enforces
the constraints of minimum reservation and maximum limitation, so that
the services can compete for the resources fairly. Currently the
<em>mclock_opclass</em> operation queue divides Ceph services involving I/O
resources into following buckets:</p>
<ul class="simple">
<li><p>client op: the iops issued by client</p></li>
<li><p>osd subop: the iops issued by primary OSD</p></li>
<li><p>snap trim: the snap trimming related requests</p></li>
<li><p>pg recovery: the recovery related requests</p></li>
<li><p>pg scrub: the scrub related requests</p></li>
</ul>
<p>And the resources are partitioned using following three sets of tags. In other
words, the share of each type of service is controlled by three tags:</p>
<ol class="arabic simple">
<li><p>reservation: the minimum IOPS allocated for the service.</p></li>
<li><p>limitation: the maximum IOPS allocated for the service.</p></li>
<li><p>weight: the proportional share of capacity if extra capacity or system
oversubscribed.</p></li>
</ol>
<p>In Ceph operations are graded with “cost”. And the resources allocated
for serving various services are consumed by these “costs”. So, for
example, the more reservation a services has, the more resource it is
guaranteed to possess, as long as it requires. Assuming there are 2
services: recovery and client ops:</p>
<ul class="simple">
<li><p>recovery: (r:1, l:5, w:1)</p></li>
<li><p>client ops: (r:2, l:0, w:9)</p></li>
</ul>
<p>The settings above ensure that the recovery won’t get more than 5
requests per second serviced, even if it requires so (see CURRENT
IMPLEMENTATION NOTE below), and no other services are competing with
it. But if the clients start to issue large amount of I/O requests,
neither will they exhaust all the I/O resources. 1 request per second
is always allocated for recovery jobs as long as there are any such
requests. So the recovery jobs won’t be starved even in a cluster with
high load. And in the meantime, the client ops can enjoy a larger
portion of the I/O resource, because its weight is “9”, while its
competitor “1”. In the case of client ops, it is not clamped by the
limit setting, so it can make use of all the resources if there is no
recovery ongoing.</p>
<p>Along with <em>mclock_opclass</em> another mclock operation queue named
<em>mclock_client</em> is available. It divides operations based on category
but also divides them based on the client making the request. This
helps not only manage the distribution of resources spent on different
classes of operations but also tries to insure fairness among clients.</p>
<p>CURRENT IMPLEMENTATION NOTE: the current experimental implementation
does not enforce the limit values. As a first approximation we decided
not to prevent operations that would otherwise enter the operation
sequencer from doing so.</p>
</div>
<div class="section" id="mclock">
<h4>mClock 的精妙之处<a class="headerlink" href="#mclock" title="Permalink to this headline">¶</a></h4>
<p>The reservation and limit values have a unit of requests per
second. The weight, however, does not technically have a unit and the
weights are relative to one another. So if one class of requests has a
weight of 1 and another a weight of 9, then the latter class of
requests should get 9 executed at a 9 to 1 ratio as the first class.
However that will only happen once the reservations are met and those
values include the operations executed under the reservation phase.</p>
<p>Even though the weights do not have units, one must be careful in
choosing their values due how the algorithm assigns weight tags to
requests. If the weight is <em>W</em>, then for a given class of requests,
the next one that comes in will have a weight tag of <em>1/W</em> plus the
previous weight tag or the current time, whichever is larger. That
means if <em>W</em> is sufficiently large and therefore <em>1/W</em> is sufficiently
small, the calculated tag may never be assigned as it will get a value
of the current time. The ultimate lesson is that values for weight
should not be too large. They should be under the number of requests
one expects to ve serviced each second.</p>
</div>
<div class="section" id="id9">
<h4>注意事项<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<p>There are some factors that can reduce the impact of the mClock op
queues within Ceph. First, requests to an OSD are sharded by their
placement group identifier. Each shard has its own mClock queue and
these queues neither interact nor share information among them. The
number of shards can be controlled with the configuration options
<code class="docutils literal notranslate"><span class="pre">osd_op_num_shards</span></code>, <code class="docutils literal notranslate"><span class="pre">osd_op_num_shards_hdd</span></code>, and
<code class="docutils literal notranslate"><span class="pre">osd_op_num_shards_ssd</span></code>. A lower number of shards will increase the
impact of the mClock queues, but may have other deleterious effects.</p>
<p>Second, requests are transferred from the operation queue to the
operation sequencer, in which they go through the phases of
execution. The operation queue is where mClock resides and mClock
determines the next op to transfer to the operation sequencer. The
number of operations allowed in the operation sequencer is a complex
issue. In general we want to keep enough operations in the sequencer
so it’s always getting work done on some operations while it’s waiting
for disk and network access to complete on other operations. On the
other hand, once an operation is transferred to the operation
sequencer, mClock no longer has control over it. Therefore to maximize
the impact of mClock, we want to keep as few operations in the
operation sequencer as possible. So we have an inherent tension.</p>
<p>The configuration options that influence the number of operations in
the operation sequencer are <code class="docutils literal notranslate"><span class="pre">bluestore_throttle_bytes</span></code>,
<code class="docutils literal notranslate"><span class="pre">bluestore_throttle_deferred_bytes</span></code>,
<code class="docutils literal notranslate"><span class="pre">bluestore_throttle_cost_per_io</span></code>,
<code class="docutils literal notranslate"><span class="pre">bluestore_throttle_cost_per_io_hdd</span></code>, and
<code class="docutils literal notranslate"><span class="pre">bluestore_throttle_cost_per_io_ssd</span></code>.</p>
<p>A third factor that affects the impact of the mClock algorithm is that
we’re using a distributed system, where requests are made to multiple
OSDs and each OSD has (can have) multiple shards. Yet we’re currently
using the mClock algorithm, which is not distributed (note: dmClock is
the distributed version of mClock).</p>
<p>Various organizations and individuals are currently experimenting with
mClock as it exists in this code base along with their modifications
to the code base. We hope you’ll share you’re experiences with your
mClock and dmClock experiments in the ceph-devel mailing list.</p>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">push</span> <span class="pre">per</span> <span class="pre">object</span> <span class="pre">cost</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>一个推送操作允许的开销。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Unsigned Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p>1000</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">recovery</span> <span class="pre">max</span> <span class="pre">chunk</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>一个恢复操作可携带数据块的最大尺寸。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Unsigned Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p>8 MiB</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">op</span> <span class="pre">queue</span> <span class="pre">mclock</span> <span class="pre">client</span> <span class="pre">op</span> <span class="pre">res</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>为客户端操作预留的值。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p>1000.0</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">op</span> <span class="pre">queue</span> <span class="pre">mclock</span> <span class="pre">client</span> <span class="pre">op</span> <span class="pre">wgt</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>客户端操作的权重。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p>500.0</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">op</span> <span class="pre">queue</span> <span class="pre">mclock</span> <span class="pre">client</span> <span class="pre">op</span> <span class="pre">lim</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>客户端操作的上限。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p>1000.0</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">op</span> <span class="pre">queue</span> <span class="pre">mclock</span> <span class="pre">osd</span> <span class="pre">subop</span> <span class="pre">res</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>为 OSD 子操作预留的值。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p>1000.0</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">op</span> <span class="pre">queue</span> <span class="pre">mclock</span> <span class="pre">osd</span> <span class="pre">subop</span> <span class="pre">wgt</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>OSD 子操作的权重。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p>500.0</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">op</span> <span class="pre">queue</span> <span class="pre">mclock</span> <span class="pre">osd</span> <span class="pre">subop</span> <span class="pre">lim</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>OSD 子操作的上限。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p>0.0</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">op</span> <span class="pre">queue</span> <span class="pre">mclock</span> <span class="pre">snap</span> <span class="pre">res</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>为快照修剪操作预留的值。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p>0.0</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">op</span> <span class="pre">queue</span> <span class="pre">mclock</span> <span class="pre">snap</span> <span class="pre">wgt</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>快照修剪操作的权重。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p>1.0</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">op</span> <span class="pre">queue</span> <span class="pre">mclock</span> <span class="pre">snap</span> <span class="pre">lim</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>快照修剪操作的上限。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p>0.001</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">op</span> <span class="pre">queue</span> <span class="pre">mclock</span> <span class="pre">recov</span> <span class="pre">res</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>为恢复预留的值。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p>0.0</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">op</span> <span class="pre">queue</span> <span class="pre">mclock</span> <span class="pre">recov</span> <span class="pre">wgt</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>恢复操作的权重。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p>1.0</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">op</span> <span class="pre">queue</span> <span class="pre">mclock</span> <span class="pre">recov</span> <span class="pre">lim</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>恢复操作的上限。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p>0.001</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">op</span> <span class="pre">queue</span> <span class="pre">mclock</span> <span class="pre">scrub</span> <span class="pre">res</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>为洗刷作业预留的值。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p>0.0</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">op</span> <span class="pre">queue</span> <span class="pre">mclock</span> <span class="pre">scrub</span> <span class="pre">wgt</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>洗刷作业的权重。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p>1.0</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">op</span> <span class="pre">queue</span> <span class="pre">mclock</span> <span class="pre">scrub</span> <span class="pre">lim</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>洗刷作业的上限。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p>0.001</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="section" id="index-6">
<span id="id10"></span><h2>回填<a class="headerlink" href="#index-6" title="Permalink to this headline">¶</a></h2>
<p>当集群新增或移除 OSD 时，按照 CRUSH 算法应该重新均衡集群，它会把一些归置组移出或移入多个 OSD 以回到均衡状态。归置组和对象的迁移会导致集群运营性能显著降低，为维持运营性能， Ceph 用 backfilling 来执行此迁移，它可以使得 Ceph 的回填操作优先级低于用户读写请求。</p>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">max</span> <span class="pre">backfills</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>单个 OSD 允许的最大回填操作数。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>64-bit Unsigned Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">1</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">backfill</span> <span class="pre">scan</span> <span class="pre">min</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>集群负载低时，回填操作时扫描间隔。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">64</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">backfill</span> <span class="pre">scan</span> <span class="pre">max</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>回填操作时最大扫描间隔。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">512</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">backfill</span> <span class="pre">retry</span> <span class="pre">interval</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>重试回填请求前等待秒数。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Double</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">10.0</span></code></p>
</dd>
</dl>
<span class="target" id="index-7"></span></div>
<div class="section" id="id11">
<h2>OSD 运行图<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h2>
<p>OSD 运行图反映集群中运行的 OSD 守护进程，斗转星移，图元增加。
Ceph 用一些选项来确保 OSD 运行图增大时仍运行良好。</p>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">map</span> <span class="pre">dedup</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>允许删除 OSD 图里的重复项。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Boolean</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">true</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">map</span> <span class="pre">cache</span> <span class="pre">size</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>缓存的 OSD 图个数。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">500</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">map</span> <span class="pre">cache</span> <span class="pre">bl</span> <span class="pre">size</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>OSD 进程中，驻留内存的 OSD 图缓存尺寸。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">50</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">map</span> <span class="pre">cache</span> <span class="pre">bl</span> <span class="pre">inc</span> <span class="pre">size</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>OSD 进程中，驻留内存的 OSD 图缓存增量尺寸。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">100</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">map</span> <span class="pre">message</span> <span class="pre">max</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>每个  MOSDMap 图消息允许的最大条目数量。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">100</span></code></p>
</dd>
</dl>
<span class="target" id="index-8"></span></div>
<div class="section" id="id12">
<h2>恢复<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h2>
<p>当集群启动、或某 OSD 守护进程崩溃后重启时，此 OSD 开始与其它 OSD 们建立连接，这样才能正常工作。详情见<a class="reference external" href="../../operations/monitoring-osd-pg#peering">监控 OSD 和归置组</a>。</p>
<p>如果某 OSD 崩溃并重生，通常会落后于其他 OSD ，也就是没有同归置组内最新版本的对象。这时， OSD 守护进程进入恢复模式并检索最新数据副本，并更新运行图。根据 OSD 挂的时间长短， OSD 的对象和归置组可能落后得厉害，另外，如果挂的是一个失效域（如一个机柜），多个 OSD 会同时重生，这样恢复时间更长、更耗资源。</p>
<p>为保持运营性能， Ceph 进行恢复时会限制恢复请求数、线程数、对象块尺寸，这样在降级状态下也能保持良好的性能。</p>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">recovery</span> <span class="pre">delay</span> <span class="pre">start</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>对等关系建立完毕后， Ceph 开始对象恢复前等待的时间（秒）。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">recovery</span> <span class="pre">max</span> <span class="pre">active</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>每个 OSD 一次可以处理的活跃恢复请求数量，增大此值能加速恢复，但它们会增大集群负载。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">3</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">recovery</span> <span class="pre">max</span> <span class="pre">chunk</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>一次推送的数据块的最大尺寸。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>64-bit Unsigned Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">8</span> <span class="pre">&lt;&lt;</span> <span class="pre">20</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">recovery</span> <span class="pre">max</span> <span class="pre">single</span> <span class="pre">start</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>某个 OSD 恢复时，各 OSD 即将新开的最大恢复操作数量。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>64-bit Unsigned Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">1</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">recovery</span> <span class="pre">thread</span> <span class="pre">timeout</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>恢复线程最大死亡时值。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">30</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">recover</span> <span class="pre">clone</span> <span class="pre">overlap</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>在数据恢复期间保留重叠副本。应该总是 <code class="docutils literal notranslate"><span class="pre">true</span></code> 。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Boolean</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">true</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">recovery</span> <span class="pre">sleep</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>下一轮恢复或回填操作前睡眠的时间，单位为秒。增大此值会减慢恢复操作，同时客户端操作受到的影响也小些了。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">recovery</span> <span class="pre">sleep</span> <span class="pre">hdd</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>对于机械硬盘，下一轮恢复或回填操作前睡眠的时间，单位为秒。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">0.1</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">recovery</span> <span class="pre">sleep</span> <span class="pre">ssd</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>对于固态硬盘，下一轮恢复或回填操作前睡眠的时间，单位为秒。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">recovery</span> <span class="pre">sleep</span> <span class="pre">hybrid</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>OSD 数据在机械硬盘上而 OSD 日志在固态硬盘上时，下一轮恢复或回填操作前睡眠的时间，单位为秒。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Float</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">0.025</span></code></p>
</dd>
</dl>
</div>
<div class="section" id="id13">
<h2>分级缓存选项<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">agent</span> <span class="pre">max</span> <span class="pre">ops</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>在高速模式下，每个分级缓存代理同时执行刷回操作的最大数量。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">4</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">agent</span> <span class="pre">max</span> <span class="pre">low</span> <span class="pre">ops</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>在低速模式下，每个分级缓存代理同时执行刷回操作的最大数量。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">2</span></code></p>
</dd>
</dl>
<p>关于在高速模式下，分级缓存代理何时刷回脏对象，见
<a class="reference external" href="../../operations/pools#cache-target-dirty-high-ratio">cache target dirty high ratio</a> 选项。</p>
</div>
<div class="section" id="id14">
<h2>杂项<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">snap</span> <span class="pre">trim</span> <span class="pre">thread</span> <span class="pre">timeout</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>快照修复线程最大死亡时值。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">60*60*1</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">backlog</span> <span class="pre">thread</span> <span class="pre">timeout</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>积压线程最大死亡时值。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">60*60*1</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">default</span> <span class="pre">notify</span> <span class="pre">timeout</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>OSD 默认通告超时，秒。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Unsigned Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">30</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">check</span> <span class="pre">for</span> <span class="pre">log</span> <span class="pre">corruption</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>根据日志文件查找数据损坏，会耗费大量计算时间。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Boolean</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">false</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">remove</span> <span class="pre">thread</span> <span class="pre">timeout</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>OSD 删除线程的最大死亡时值。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">60*60</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">command</span> <span class="pre">thread</span> <span class="pre">timeout</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>命令线程最大超时值。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">10*60</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">command</span> <span class="pre">max</span> <span class="pre">records</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>限制返回的丢失对象数量。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>32-bit Integer</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">256</span></code></p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">fast</span> <span class="pre">fail</span> <span class="pre">on</span> <span class="pre">connection</span> <span class="pre">refused</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">描述</dt>
<dd class="field-odd"><p>如果启用此选项，崩溃的 OSD 会即刻被已互联的 OSD 和监视器们标记为 down （假设已崩溃 OSD 所在主机还活着）。禁用此选项即可恢复原来的行为，代价是 I/O 操作中途若有 OSD 崩溃可能会导致较长时间的 I/O 停顿。</p>
</dd>
<dt class="field-even">类型</dt>
<dd class="field-even"><p>Boolean</p>
</dd>
<dt class="field-odd">默认值</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">true</span></code></p>
</dd>
</dl>
</div>
</div>



          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../">
              <img class="logo" src="../../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../../">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../start/intro/">Ceph 简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/">安装 Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cephadm/">Cephadm</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../">Ceph 存储集群</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../">配置</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../storage-devices/">存储设备</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ceph-conf/">配置 Ceph</a></li>
<li class="toctree-l3"><a class="reference internal" href="../common/">通用选项</a></li>
<li class="toctree-l3"><a class="reference internal" href="../common/#ceph-network-config">网络</a></li>
<li class="toctree-l3"><a class="reference internal" href="../common/#id3">监视器</a></li>
<li class="toctree-l3"><a class="reference internal" href="../common/#ceph-osd-config">认证</a></li>
<li class="toctree-l3"><a class="reference internal" href="../common/#osds">OSDs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../common/#id5">心跳</a></li>
<li class="toctree-l3"><a class="reference internal" href="../common/#ceph-logging-and-debugging">日志记录、调试</a></li>
<li class="toctree-l3"><a class="reference internal" href="../common/#ceph-conf">ceph.conf 实例</a></li>
<li class="toctree-l3"><a class="reference internal" href="../common/#id7">跑多个集群</a></li>
<li class="toctree-l3"><a class="reference internal" href="../network-config-ref/">网络选项</a></li>
<li class="toctree-l3"><a class="reference internal" href="../msgr2/">信使协议 v2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auth-config-ref/">认证选项</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mon-config-ref/">监视器选项</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mon-lookup-dns/">Looking op Monitors through DNS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mon-osd-interaction/">心跳选项</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">OSD 选项</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">常规配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">文件系统选项</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">日志选项</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">监视器和 OSD 的交互</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">数据归置</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">洗刷</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">操作数</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#mclock-qos">基于 mClock 的 QoS</a><ul>
<li class="toctree-l6"><a class="reference internal" href="#id8">核心概念</a></li>
<li class="toctree-l6"><a class="reference internal" href="#mclock">mClock 的精妙之处</a></li>
<li class="toctree-l6"><a class="reference internal" href="#id9">注意事项</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#index-6">回填</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id11">OSD 运行图</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id12">恢复</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id13">分级缓存选项</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id14">杂项</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../bluestore-config-ref/">BlueStore 配置</a></li>
<li class="toctree-l3"><a class="reference internal" href="../filestore-config-ref/">FileStore 配置</a></li>
<li class="toctree-l3"><a class="reference internal" href="../journal-ref/">日志选项</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pool-pg-config-ref/">存储池、归置组和 CRUSH 选项</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ms-ref/">消息传递选项</a></li>
<li class="toctree-l3"><a class="reference internal" href="../general-config-ref/">常规选项</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../deployment/">部署</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/">运维</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../man/">手册页</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../troubleshooting/">故障排除</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/">APIs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../cephfs/">Ceph 文件系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rbd/">Ceph 块设备</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../radosgw/">Ceph 对象网关</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mgr/">Ceph 管理器守护进程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mgr/dashboard/">Ceph 仪表盘</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/">API 文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../architecture/">体系结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev/developer_guide/">开发者指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev/internals/">Ceph 内幕</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../governance/">项目管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../foundation/">Ceph 基金会</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ceph-volume/">ceph-volume</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/general/">Ceph 版本（总目录）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/">Ceph 版本（索引）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary/">Ceph 术语</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../translation_cn/">中文版翻译资源</a></li>
</ul>


<!-- ugly kludge to make genindex look like it's part of the toc -->
<ul style="margin-top: -10px"><li class="toctree-l1"><a class="reference internal" href="../../../genindex/">Index</a></li></ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../bluestore-config-ref/" title="BlueStore 配置参考"
             >next</a> |</li>
        <li class="right" >
          <a href="../mon-osd-interaction/" title="监视器与 OSD 交互的配置"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../">Ceph Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../" >Ceph 存储集群</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../" >配置</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Ceph authors and contributors. Licensed under Creative Commons Attribution Share Alike 3.0 (CC-BY-SA-3.0).
    </div>
  </body>
</html>